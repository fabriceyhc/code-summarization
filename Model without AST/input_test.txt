decorators api view post dcnl decorators permission classes twitteraccountignorepermission dcnl def ignore request dcsp username json loads request body get username dcnl dcsp if not username dcnl dcsp dcsp raise genericapiexception status http 400 bad request username dcsp not dcsp provided dcnl dcsp username username1 if username startswith else username dcnl dcsp account created twitteraccount objects get or create username username defaults ignored true dcnl dcsp if not created and account ignored dcnl dcsp dcsp raise genericapiexception status http 409 conflict this dcsp account dcsp is dcsp already dcsp in dcsp the dcsp ignore dcsp list dcnl dcsp else dcnl dcsp dcsp account ignored true dcnl dcsp dcsp account save dcnl dcsp return response success account dcsp is dcsp now dcsp being dcsp ignored
decorators api view post dcnl decorators permission classes twitteraccountignorepermission dcnl def unignore request dcsp usernames json loads request body get usernames dcnl dcsp if not usernames dcnl dcsp dcsp raise genericapiexception status http 400 bad request usernames dcsp not dcsp provided dcnl dcsp accounts twitteraccount objects filter username in usernames dcnl dcsp for account in accounts dcnl dcsp dcsp if account and account ignored dcnl dcsp dcsp dcsp account ignored false dcnl dcsp dcsp dcsp account save dcnl dcsp message success 0 dcsp users dcsp unignored dcsp successfully format len accounts dcnl dcsp return response message
def tweet for template tweet https false dcsp data json loads tweet raw json dcnl dcsp parsed date parsedate data created at dcnl dcsp date datetime parsed date0 6 dcnl dcsp if settings cc show replies dcnl dcsp dcsp replies get tweets limit 0 reply to tweet https https dcnl dcsp else dcnl dcsp dcsp replies none dcnl dcsp if from user in data dcnl dcsp dcsp user data data dcnl dcsp dcsp from user data from user dcnl dcsp else dcnl dcsp dcsp user data data user dcnl dcsp dcsp from user user data screen name dcnl dcsp if https dcnl dcsp dcsp img bleach clean user data profile image url https dcnl dcsp else dcnl dcsp dcsp img bleach clean user data profile image url dcnl dcsp return profile img img user from user text bleach clean data text id tweet pk date date reply count len replies if replies else 0 replies replies reply to tweet reply to and tweet reply to pk hidden tweet hidden
def get tweets locale settings language code limit max tweets max id none reply to none filter none https false dcsp locale settings localeslocale iso639 1 dcnl dcsp created limit datetime now timedelta days settings cc tweets days dcnl dcsp q tweet objects filter locale locale reply to reply to created gt created limit dcnl dcsp if max id dcnl dcsp dcsp q q filter pk lt max id dcnl dcsp if filter all dcnl dcsp dcsp q q filter hidden false dcnl dcsp if filter unanswered dcnl dcsp dcsp q q filter replies pk isnull true dcnl dcsp elif filter answered dcnl dcsp dcsp q q filter replies pk isnull false dcnl dcsp if limit dcnl dcsp dcsp q q limit dcnl dcsp return tweet for template tweet https for tweet in q
require get dcnl def more tweets request dcsp max id request get get max id dcnl dcsp raw filter request get get filter dcnl dcsp filter raw filter if raw filter in filters else recent dcnl dcsp return render request customercare tweets html tweets get tweets locale request language code max id max id filter filter https request is secure
ssl required dcnl require get dcnl twitter auth wanted dcnl def landing request dcsp redis none dcnl dcsp try dcnl dcsp dcsp redis redis client name default dcnl dcsp except rediserror as e dcnl dcsp dcsp statsd incr redis errror dcnl dcsp dcsp log error redis dcsp error dcsp s e dcnl dcsp contributor stats redis and redis get settings cc top contrib cache key dcnl dcsp if contributor stats dcnl dcsp dcsp contributor stats json loads contributor stats dcnl dcsp dcsp statsd incr customercare stats contributors hit dcnl dcsp else dcnl dcsp dcsp statsd incr customercare stats contributors miss dcnl dcsp twitter user none dcnl dcsp if request twitter authed dcnl dcsp dcsp try dcnl dcsp dcsp dcsp credentials request twitter api verify credentials dcnl dcsp dcsp except twythonerror twythonautherror dcnl dcsp dcsp dcsp request twitter twitter session dcnl dcsp dcsp else dcnl dcsp dcsp dcsp twitter user credentials screen name dcnl dcsp yesterday datetime now timedelta days 1 dcnl dcsp recent replied count count answered tweets since yesterday dcnl dcsp return render request customercare landing html contributor stats contributor stats canned responses get common replies request language code tweets get tweets locale request language code filter unanswered https request is secure authed request user is authenticated and request twitter authed twitter user twitter user filters filters filter unanswered time datetime now goal settings cc replies goal recent replied count recent replied count
permission required customercare ban account dcnl def moderate request dcsp return render request customercare moderate html
require post dcnl login required dcnl twitter auth required dcnl def twitter post request dcsp try dcnl dcsp dcsp reply to id int request post get reply to dcnl dcsp except valueerror dcnl dcsp dcsp return httpresponsebadrequest replyto dcsp is dcsp empty dcnl dcsp original tweet objects get pk reply to id dcnl dcsp if original replies count 0 dcnl dcsp dcsp return httpresponsebadrequest tweet dcsp has dcsp already dcsp been dcsp replied dcsp to dcnl dcsp content request post get content dcnl dcsp if len content 0 dcnl dcsp dcsp return httpresponsebadrequest message dcsp is dcsp empty dcnl dcsp if len content 140 dcnl dcsp dcsp return httpresponsebadrequest message dcsp is dcsp too dcsp long dcnl dcsp try dcnl dcsp dcsp credentials request twitter api verify credentials dcnl dcsp dcsp username credentials screen name dcnl dcsp dcsp banned twitteraccount objects filter username username banned true first dcnl dcsp dcsp if banned dcnl dcsp dcsp dcsp return render request customercare tweets html tweets dcnl dcsp dcsp result request twitter api update status status content in reply to status id reply to id dcnl dcsp except twythonerror twythonautherror as e dcnl dcsp dcsp return httpresponsebadrequest an dcsp error dcsp occured dcsp message format message e dcnl dcsp status result dcnl dcsp author result user dcnl dcsp created at datetime strptime status created at a dcsp b dcsp d dcsp h m s dcsp +0000 dcsp y dcnl dcsp raw tweet data id status id text status text created at status created at iso language code author lang from user id author id from user author screen name profile image url author profile image url profile image url https author profile image url https dcnl dcsp tweet tweet objects create pk status id raw json json dumps raw tweet data locale author lang created created at reply to id reply to id dcnl dcsp reply objects create user request user if request user is authenticated else none twitter username author screen name tweet id status id raw json json dumps raw tweet data locale author lang created created at reply to tweet id reply to id dcnl dcsp return render request customercare tweets html tweets tweet for template tweet request is secure
require post dcnl login required dcnl def hide tweet request dcsp if not settings cc allow remove dcnl dcsp dcsp return httpresponse status 418 dcnl dcsp try dcnl dcsp dcsp id int request post get id dcnl dcsp except valueerror typeerror dcnl dcsp dcsp return httpresponsebadrequest invalid dcsp id dcnl dcsp try dcnl dcsp dcsp tweet tweet objects get pk id dcnl dcsp except tweet doesnotexist dcnl dcsp dcsp return httpresponsenotfound invalid dcsp id dcnl dcsp if tweet reply to is not none or tweet objects filter reply to tweet exists dcnl dcsp dcsp return httpresponsebadrequest tweets dcsp that dcsp are dcsp replies dcsp or dcsp have dcsp replies dcsp must dcsp not dcsp be dcsp hidden dcnl dcsp try dcnl dcsp dcsp tweet hidden true dcnl dcsp dcsp tweet save force update true dcnl dcsp except exception as e dcnl dcsp dcsp return httpresponseservererror an dcsp error dcsp occured dcsp message format message e dcnl dcsp return httpresponse ok
def on reply save sender instance kwargs dcsp reply instance dcnl dcsp year reply created year dcnl dcsp user reply user dcnl dcsp if not user dcnl dcsp dcsp return dcnl dcsp from kitsune customercare tasks import maybe award badge dcnl dcsp maybe award badge delay aoa badge year user
login required dcnl permission required flagit can moderate dcnl def queue request content type none dcsp return render request flagit queue html objects flaggedobject objects pending
require post dcnl login required dcnl permission required flagit can moderate dcnl def update request flagged object id dcsp flagged get object or 404 flaggedobject pk flagged object id dcnl dcsp new status request post get status dcnl dcsp if new status dcnl dcsp dcsp flagged status new status dcnl dcsp dcsp flagged save dcnl dcsp return httpresponseredirect reverse flagit queue
task dcnl timeit dcnl def send group email announcement id dcsp try dcnl dcsp dcsp announcement announcement objects get pk announcement id dcnl dcsp except announcement doesnotexist dcnl dcsp dcsp return dcnl dcsp group announcement group dcnl dcsp users user objects filter groups in group dcnl dcsp plain content bleach clean announcement content parsed tags strip true strip dcnl dcsp email kwargs content plain content content html announcement content parsed domain site objects get current domain dcnl dcsp text template announcements email announcement ltxt dcnl dcsp html template announcements email announcement html dcnl dcsp safe translation dcnl dcsp def make mail locale user dcnl dcsp dcsp subject new dcsp announcement dcsp for dcsp group format group group name dcnl dcsp dcsp mail make mail subject subject text template text template html template html template context vars email kwargs from email settings tidings from address to email user email dcnl dcsp dcsp return mail dcnl dcsp messages dcnl dcsp for u in users dcnl dcsp dcsp locale u profile locale or settings language code dcnl dcsp dcsp messages append make mail locale u dcnl dcsp send messages messages
require post dcnl login required dcnl def create for locale request dcsp user request user dcnl dcsp locale locale objects get locale request language code dcnl dcsp if not user can announce user locale dcnl dcsp dcsp return httpresponseforbidden dcnl dcsp form announcementform request post dcnl dcsp if form is valid dcnl dcsp dcsp a announcement creator user locale locale form cleaned data dcnl dcsp dcsp a save dcnl dcsp dcsp return httpresponse json dumps id a id content type application json dcnl dcsp else dcnl dcsp dcsp return httpresponse json dumps form errors status 400 content type application json
require post dcnl login required dcnl def delete request announcement id dcsp user request user dcnl dcsp locale locale objects get locale request language code dcnl dcsp if not user can announce user locale dcnl dcsp dcsp return httpresponseforbidden dcnl dcsp a get object or 404 announcement id announcement id dcnl dcsp a delete dcnl dcsp return httpresponse status 204
task dcnl timeit dcnl def send award notification award dcsp email utils safe translation dcnl dcsp def make mail locale context email dcnl dcsp dcsp subject u you dcsp were dcsp awarded dcsp the dcsp title dcsp badge format title pgettext db dcsp badger badge title award badge title dcnl dcsp dcsp mail email utils make mail subject subject text template kbadge email award notification ltxt html template kbadge email award notification html context vars context from email settings default from email to email email dcnl dcsp dcsp return mail dcnl dcsp msg make mail locale award user profile locale context host site objects get current domain award award badge award badge email award user email dcnl dcsp email utils send messages msg
def get or create badge badge template year none dcsp if year is not none dcnl dcsp dcsp badge template dict key value format year year for key value in badge template items dcnl dcsp slug badge template pop slug dcnl dcsp try dcnl dcsp dcsp return badge objects get slug slug dcnl dcsp except badge doesnotexist dcnl dcsp dcsp return badge objects create slug slug badge template
receiver badge was awarded dcnl def notify award recipient sender award kwargs dcsp if not settings stage dcnl dcsp dcsp send award notification delay award
cronjobs register dcnl def update visitors metric dcsp if settings stage dcnl dcsp dcsp return dcnl dcsp latest metric get latest metric visitors metric code dcnl dcsp if latest metric is not none dcnl dcsp dcsp latest metric date latest metric start dcnl dcsp else dcnl dcsp dcsp latest metric date date 2011 1 1 dcnl dcsp start latest metric date + timedelta days 1 dcnl dcsp end date today timedelta days 1 dcnl dcsp visitors googleanalytics visitors start end dcnl dcsp metric kind metrickind objects get code visitors metric code dcnl dcsp for date str visits in visitors items dcnl dcsp dcsp day datetime strptime date str y m d date dcnl dcsp dcsp metric objects create kind metric kind start day end day + timedelta days 1 value visits
cronjobs register dcnl def update l10n metric dcsp if settings stage dcnl dcsp dcsp return dcnl dcsp top 60 docs get top docs 60 dcnl dcsp end date today timedelta days 1 dcnl dcsp start end timedelta days 30 dcnl dcsp locale visits googleanalytics visitors by locale start end dcnl dcsp total visits sum locale visits itervalues dcnl dcsp coverage 0 dcnl dcsp for locale visits in locale visits iteritems dcnl dcsp dcsp if locale settings wiki default language dcnl dcsp dcsp dcsp num docs max docs up to date dcnl dcsp dcsp dcsp up to date docs max docs up to date dcnl dcsp dcsp else dcnl dcsp dcsp dcsp up to date docs num docs get up to date count top 60 docs locale dcnl dcsp dcsp if num docs and total visits dcnl dcsp dcsp dcsp coverage + float up to date docs num docs float visits total visits dcnl dcsp metric kind metrickind objects get code l10n metric code dcnl dcsp day date today dcnl dcsp metric objects create kind metric kind start day end day + timedelta days 1 value int coverage 100
cronjobs register dcnl def update contributor metrics day none dcsp if settings stage dcnl dcsp dcsp return dcnl dcsp update support forum contributors metric day dcnl dcsp update kb contributors metric day dcnl dcsp update aoa contributors metric day
def update support forum contributors metric day none dcsp if day dcnl dcsp dcsp start end day dcnl dcsp else dcnl dcsp dcsp latest metric get latest metric support forum contributors metric code dcnl dcsp dcsp if latest metric is not none dcnl dcsp dcsp dcsp start latest metric end + timedelta days 1 dcnl dcsp dcsp else dcnl dcsp dcsp dcsp start date 2011 1 1 dcnl dcsp dcsp end date today timedelta days 1 dcnl dcsp day start dcnl dcsp while day < end dcnl dcsp dcsp thirty days back day timedelta days 30 dcnl dcsp dcsp contributors answer objects exclude creator f question creator filter created gte thirty days back created lt day values creator annotate count count creator filter count gte 10 dcnl dcsp dcsp count contributors count dcnl dcsp dcsp metric kind metrickind objects get code support forum contributors metric code dcnl dcsp dcsp metric objects create kind metric kind start thirty days back end day value count dcnl dcsp dcsp day day + timedelta days 1
def update kb contributors metric day none dcsp if day dcnl dcsp dcsp start end day dcnl dcsp else dcnl dcsp dcsp latest metric get latest metric kb enus contributors metric code dcnl dcsp dcsp if latest metric is not none dcnl dcsp dcsp dcsp start latest metric end + timedelta days 1 dcnl dcsp dcsp else dcnl dcsp dcsp dcsp start date 2011 1 1 dcnl dcsp dcsp end date today timedelta days 1 dcnl dcsp day start dcnl dcsp while day < end dcnl dcsp dcsp thirty days back day timedelta days 30 dcnl dcsp dcsp editors revision objects filter created gte thirty days back created lt day values list creator flat true distinct dcnl dcsp dcsp reviewers revision objects filter reviewed gte thirty days back reviewed lt day values list reviewer flat true distinct dcnl dcsp dcsp en us count len set list editors filter document locale enus + list reviewers filter document locale enus dcnl dcsp dcsp l10n count len set list editors exclude document locale enus + list reviewers exclude document locale enus dcnl dcsp dcsp metric kind metrickind objects get code kb enus contributors metric code dcnl dcsp dcsp metric objects create kind metric kind start thirty days back end day value en us count dcnl dcsp dcsp metric kind metrickind objects get code kb l10n contributors metric code dcnl dcsp dcsp metric objects create kind metric kind start thirty days back end day value l10n count dcnl dcsp dcsp day day + timedelta days 1
def update aoa contributors metric day none dcsp if day dcnl dcsp dcsp start end day dcnl dcsp else dcnl dcsp dcsp latest metric get latest metric aoa contributors metric code dcnl dcsp dcsp if latest metric is not none dcnl dcsp dcsp dcsp start latest metric end + timedelta days 1 dcnl dcsp dcsp else dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp first reply reply objects order by created 0 dcnl dcsp dcsp dcsp dcsp start first reply created date + timedelta days 30 dcnl dcsp dcsp dcsp except indexerror dcnl dcsp dcsp dcsp dcsp return dcnl dcsp dcsp end date today timedelta days 1 dcnl dcsp day start dcnl dcsp while day < end dcnl dcsp dcsp thirty days back day timedelta days 30 dcnl dcsp dcsp contributors reply objects filter created gte thirty days back created lt day values list twitter username distinct dcnl dcsp dcsp count contributors count dcnl dcsp dcsp metric kind metrickind objects get code aoa contributors metric code dcnl dcsp dcsp metric objects create kind metric kind start thirty days back end day value count dcnl dcsp dcsp day day + timedelta days 1
cronjobs register dcnl def update search ctr metric dcsp if settings stage dcnl dcsp dcsp return dcnl dcsp latest metric get latest metric search clicks metric code dcnl dcsp if latest metric is not none dcnl dcsp dcsp latest metric date latest metric start dcnl dcsp else dcnl dcsp dcsp latest metric date date 2011 1 1 dcnl dcsp start latest metric date + timedelta days 1 dcnl dcsp end date today timedelta days 1 dcnl dcsp ctr data googleanalytics search ctr start end dcnl dcsp clicks kind metrickind objects get code search clicks metric code dcnl dcsp searches kind metrickind objects get code search searches metric code dcnl dcsp for date str ctr in ctr data items dcnl dcsp dcsp day datetime strptime date str y m d date dcnl dcsp dcsp metric objects create kind searches kind start day end day + timedelta days 1 value 1000 dcnl dcsp dcsp metric objects create kind clicks kind start day end day + timedelta days 1 value round ctr 1 10
def get latest metric metric code dcsp try dcnl dcsp dcsp last metric metric objects filter kind code metric code order by start 0 dcnl dcsp dcsp return last metric dcnl dcsp except indexerror dcnl dcsp dcsp return none
def get top docs count dcsp top qs wikidocumentvisits objects select related document filter period last 90 days order by visits count dcnl dcsp return v document for v in top qs
cronjobs register dcnl def process exit surveys dcsp process exit survey results dcnl dcsp if settings stage dcnl dcsp dcsp return dcnl dcsp startdate date today timedelta days 2 dcnl dcsp enddate date today timedelta days 1 dcnl dcsp for survey in surveys keys dcnl dcsp dcsp if email collection survey id not in surveyssurvey dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp emails get email addresses survey startdate enddate dcnl dcsp dcsp for email in emails dcnl dcsp dcsp dcsp add email to campaign survey email dcnl dcsp dcsp statsd gauge survey 0 format survey len emails
def process exit survey results dcsp yes kind metrickind objects get or create code exit survey yes code dcnl dcsp no kind metrickind objects get or create code exit survey no code dcnl dcsp dunno kind metrickind objects get or create code exit survey dont know code dcnl dcsp latest metric get latest metric exit survey yes code dcnl dcsp if latest metric is not none dcnl dcsp dcsp latest metric date latest metric start dcnl dcsp else dcnl dcsp dcsp latest metric date date 2013 7 1 dcnl dcsp day latest metric date + timedelta days 1 dcnl dcsp today date today dcnl dcsp while day < today dcnl dcsp dcsp results get exit survey results general day dcnl dcsp dcsp metric objects create kind yes kind start day end day + timedelta days 1 value results yes dcnl dcsp dcsp metric objects create kind no kind start day end day + timedelta days 1 value results no dcnl dcsp dcsp metric objects create kind dunno kind start day end day + timedelta days 1 value results dontknow dcnl dcsp dcsp day + timedelta days 1
cronjobs register dcnl def survey recent askers dcsp if settings stage dcnl dcsp dcsp return dcnl dcsp two days ago date today timedelta days 2 dcnl dcsp yesterday date today timedelta days 1 dcnl dcsp emails question objects filter created gte two days ago created lt yesterday values list creator email flat true dcnl dcsp for email in emails dcnl dcsp dcsp add email to campaign askers email dcnl dcsp statsd gauge survey askers len emails
def count contributors in range querysets users date range dcsp start end date range dcnl dcsp retained users set dcnl dcsp for queryset fields in querysets dcnl dcsp dcsp for field in fields dcnl dcsp dcsp dcsp filters s in field users created gte start created lt end dcnl dcsp dcsp dcsp retained users | set getattr o field for o in queryset filter filters dcnl dcsp return len retained users
def get email addresses survey startdate enddate dcsp token settings surveygizmo api token dcnl dcsp secret settings surveygizmo api token secret dcnl dcsp emails dcnl dcsp page 1 dcnl dcsp more pages true dcnl dcsp survey id surveyssurvey email collection survey id dcnl dcsp if token is none or secret is none dcnl dcsp dcsp return emails dcnl dcsp while more pages dcnl dcsp dcsp response requests get https restapi surveygizmo com v2 survey survey surveyresponse filterfield0 datesubmitted filteroperator0 filtervalue0 start +0 0 0filterfield1 datesubmitted filteroperator1 < filtervalue1 end +0 0 0 filterfield2 status filteroperator2 filtervalue2 complete resultsperpage 500 page page api token token api token secret secret format survey survey id start startdate end enddate page page token token secret secret timeout 300 dcnl dcsp dcsp results json loads response content dcnl dcsp dcsp total pages results total pages dcnl dcsp dcsp more pages page < total pages dcnl dcsp dcsp emails emails + r question 13 for r in results data dcnl dcsp dcsp page + 1 dcnl dcsp return emails
def add email to campaign survey email dcsp token settings surveygizmo api token dcnl dcsp secret settings surveygizmo api token secret dcnl dcsp if token is none or secret is none dcnl dcsp dcsp return dcnl dcsp survey id surveyssurvey exit survey id dcnl dcsp campaign id surveyssurvey exit survey campaign id dcnl dcsp try dcnl dcsp dcsp requests put https restapi surveygizmo com v2 survey survey surveycampaign campaign contact semailaddress email api token token api token secret secret format survey survey id campaign campaign id email email token token secret secret timeout 30 dcnl dcsp except requests exceptions timeout dcnl dcsp dcsp print timedout dcsp adding dcsp s email
def get exit survey results survey date dcsp token settings surveygizmo api token dcnl dcsp secret settings surveygizmo api token secret dcnl dcsp answers dcnl dcsp page 1 dcnl dcsp more pages true dcnl dcsp survey id surveyssurvey exit survey id dcnl dcsp summary yes 0 no 0 dontknow 0 dcnl dcsp if token is none or secret is none dcnl dcsp dcsp return summary dcnl dcsp while more pages dcnl dcsp dcsp response requests get https restapi surveygizmo com v2 survey survey surveyresponse filterfield0 datesubmitted filteroperator0 filtervalue0 start +0 0 0 filterfield1 datesubmitted filteroperator1 < filtervalue1 end +0 0 0 filterfield2 status filteroperator2 filtervalue2 complete resultsperpage 500 page page api token token api token secret secret format survey survey id start date end date + timedelta days 1 page page token token secret secret timeout 300 dcnl dcsp dcsp results json loads response content dcnl dcsp dcsp total pages results get total pages 0 dcnl dcsp dcsp more pages page < total pages dcnl dcsp dcsp answers answers + r get question 2 for r in results get data dcnl dcsp dcsp page + 1 dcnl dcsp for answer in answers dcnl dcsp dcsp lower stripped answer lower strip dcnl dcsp dcsp if lower stripped in no yes dcnl dcsp dcsp dcsp summarylower stripped + 1 dcnl dcsp dcsp else dcnl dcsp dcsp dcsp summary dontknow + 1 dcnl dcsp return summary
def daily qs for model cls dcsp return model cls objects filter created gte date 2011 1 1 creator is active 1 extra select day extract dcsp day dcsp from dcsp created dcsp month extract dcsp month dcsp from dcsp created dcsp year extract dcsp year dcsp from dcsp created dcsp values year month day annotate count count created
def qs for model cls dcsp return model cls objects filter created gte date 2011 1 1 extra select day extract dcsp day dcsp from dcsp created dcsp month extract dcsp month dcsp from dcsp created dcsp year extract dcsp year dcsp from dcsp created dcsp values year month day annotate count count created
def start date dcsp year ago date today timedelta days 365 dcnl dcsp return date year ago year year ago month 1
def remap date counts kwargs dcsp for label qs in kwargs iteritems dcnl dcsp dcsp res defaultdict lambda label 0 dcnl dcsp dcsp for x in qs dcnl dcsp dcsp dcsp key date x year x month x get day 1 dcnl dcsp dcsp dcsp reskeylabel + x count dcnl dcsp dcsp yield res
def merge results x y dcsp return dict s dict x get s items + y get s items for s in set x keys + y keys
def cursor dcsp return connectionsrouter db for read metric cursor
def parse date text dcsp return tuple int i for i in text split
jinja2 contextfunction dcnl library global function dcnl def has perm context perm obj dcsp return access has perm context request user perm obj
jinja2 contextfunction dcnl library global function dcnl def has perm or owns context perm obj perm obj field name creator dcsp user context request user dcnl dcsp if user is anonymous dcnl dcsp dcsp return false dcnl dcsp return access has perm or owns user perm obj perm obj field name
def has perm or owns user perm obj perm obj field name creator dcsp if user is anonymous dcnl dcsp dcsp return false dcnl dcsp if hasattr obj s id field name dcnl dcsp dcsp if getattr obj s id field name user pk dcnl dcsp dcsp dcsp return true dcnl dcsp elif user getattr obj field name dcnl dcsp dcsp return true dcnl dcsp check get check user perm dcnl dcsp return user has perm perm or check and check perm obj
def has perm user perm obj dcsp check get check user perm dcnl dcsp return user has perm perm or check and check obj
def perm is defined on perm obj dcsp return permission objects filter codename perm content type contenttype objects get for model obj pk object id obj pk approved true exists
def user access decorator redirect func redirect url func deny func none redirect field redirect field name dcsp def decorator view fn dcnl dcsp dcsp def wrapped view request args kwargs dcnl dcsp dcsp dcsp redirect redirect func request user dcnl dcsp dcsp dcsp if redirect and not request is ajax dcnl dcsp dcsp dcsp dcsp redirect url redirect url func or reverse users login dcnl dcsp dcsp dcsp dcsp if redirect field dcnl dcsp dcsp dcsp dcsp dcsp path urlquote request get full path dcnl dcsp dcsp dcsp dcsp dcsp redirect url s s s redirect url redirect field path dcnl dcsp dcsp dcsp dcsp return httpresponseredirect redirect url dcnl dcsp dcsp dcsp elif redirect and request is ajax or deny func and deny func request user dcnl dcsp dcsp dcsp dcsp return httpresponseforbidden dcnl dcsp dcsp dcsp return view fn request args kwargs dcnl dcsp dcsp return wraps view fn assigned available attrs view fn wrapped view dcnl dcsp return decorator
def logout required redirect dcsp def redirect func user dcnl dcsp dcsp return user is authenticated dcnl dcsp if hasattr redirect call dcnl dcsp dcsp return user access decorator redirect func redirect field none redirect url func lambda reverse home redirect dcnl dcsp else dcnl dcsp dcsp return user access decorator redirect func redirect field none redirect url func lambda redirect
def login required func login url none redirect redirect field name only active true dcsp if only active dcnl dcsp dcsp def redirect func user dcnl dcsp dcsp dcsp return not user is authenticated and user is active dcnl dcsp else dcnl dcsp dcsp def redirect func user dcnl dcsp dcsp dcsp return not user is authenticated dcnl dcsp return user access decorator redirect func redirect field redirect redirect url func lambda login url func
def permission required perm login url none redirect redirect field name only active true dcsp if only active dcnl dcsp dcsp def deny func user dcnl dcsp dcsp dcsp return not user is active and user has perm perm dcnl dcsp else dcnl dcsp dcsp def deny func user dcnl dcsp dcsp dcsp return not user has perm perm dcnl dcsp return user access decorator lambda u not u is authenticated redirect field redirect redirect url func lambda login url deny func deny func
def has perm or owns or 403 perm owner attr obj lookup perm obj lookup kwargs dcsp def decorator view func dcnl dcsp dcsp def wrapped view request args kwargs dcnl dcsp dcsp dcsp user request user dcnl dcsp dcsp dcsp if user is authenticated dcnl dcsp dcsp dcsp dcsp obj resolve lookup obj lookup kwargs dcnl dcsp dcsp dcsp dcsp perm obj resolve lookup perm obj lookup kwargs dcnl dcsp dcsp dcsp dcsp granted access has perm or owns user perm obj perm obj owner attr dcnl dcsp dcsp dcsp dcsp if granted or user has perm perm dcnl dcsp dcsp dcsp dcsp dcsp return view func request args kwargs dcnl dcsp dcsp dcsp return httpresponseforbidden dcnl dcsp dcsp return wraps view func wrapped view dcnl dcsp return decorator
def resolve lookup model lookup arg name view kwargs dcsp value view kwargs get arg name dcnl dcsp if value is none dcnl dcsp dcsp raise valueerror expected dcsp kwarg dcsp s dcsp not dcsp found arg name dcnl dcsp if isinstance model basestring dcnl dcsp dcsp model class get model model split dcnl dcsp else dcnl dcsp dcsp model class model dcnl dcsp if model class is none dcnl dcsp dcsp raise valueerror the dcsp given dcsp argument dcsp s dcsp is dcsp not dcsp a dcsp valid dcsp model model dcnl dcsp if inspect isclass model class and not issubclass model class model dcnl dcsp dcsp raise valueerror the dcsp argument dcsp s dcsp needs dcsp to dcsp be dcsp a dcsp model model dcnl dcsp return get object or 404 model class lookup value
def create image files user dcsp up file files values 0 dcnl dcsp check file size up file settings image max filesize dcnl dcsp try dcnl dcsp dcsp image image objects filter creator user is draft true dcnl dcsp dcsp image exclude pk image0 pk delete dcnl dcsp dcsp image image0 dcnl dcsp except indexerror dcnl dcsp dcsp image image creator user is draft true dcnl dcsp image title get draft title user dcnl dcsp image description u autosaved dcsp draft dcnl dcsp image locale settings wiki default language dcnl dcsp up file is animated image to png up file dcnl dcsp image file save up file name file up file save true dcnl dcsp width height scale dimensions image file width image file height dcnl dcsp delete url reverse gallery delete media args image image id dcnl dcsp return name up file name url image get absolute url thumbnail url image thumbnail url if set width width height height delete url delete url
def upload image request dcsp return upload media request imageform create image
def check media permissions media user perm type dcsp media type media class name lower dcnl dcsp perm name gallery s s perm type media type dcnl dcsp if user media creator and not user has perm perm name dcnl dcsp dcsp raise permissiondenied
def save form form update user none is draft true kwargs dcsp obj super mediaform form save commit false kwargs dcnl dcsp if update user dcnl dcsp dcsp obj updated by update user dcnl dcsp obj is draft is draft dcnl dcsp obj save dcnl dcsp return obj
def gallery request media type image dcsp if media type image dcnl dcsp dcsp media qs image objects filter locale request language code dcnl dcsp elif media type video dcnl dcsp dcsp media qs video objects filter locale request language code dcnl dcsp else dcnl dcsp dcsp raise http404 dcnl dcsp media paginate request media qs per page items per page dcnl dcsp drafts get drafts request user dcnl dcsp image drafts image 0 if drafts image else none dcnl dcsp image form init media form imageform request image dcnl dcsp if request method post dcnl dcsp dcsp image form is valid dcnl dcsp return render request gallery gallery html media media media type media type image form image form submitted request method post
login required dcnl require post dcnl def upload request media type image dcsp drafts get drafts request user dcnl dcsp if media type image and drafts image dcnl dcsp dcsp image form init media form imageform request drafts image 0 dcnl dcsp dcsp if image form is valid dcnl dcsp dcsp dcsp img image form save is draft none dcnl dcsp dcsp dcsp generate thumbnail delay img file thumbnail dcnl dcsp dcsp dcsp compress image delay img file dcnl dcsp dcsp dcsp schedule rebuild kb dcnl dcsp dcsp dcsp return httpresponseredirect img get absolute url dcnl dcsp dcsp else dcnl dcsp dcsp dcsp return gallery request media type image dcnl dcsp return httpresponsebadrequest u unrecognized dcsp post dcsp request
login required dcnl require post dcnl def cancel draft request media type image dcsp drafts get drafts request user dcnl dcsp if media type image and drafts image dcnl dcsp dcsp drafts image delete dcnl dcsp dcsp drafts image none dcnl dcsp else dcnl dcsp dcsp msg u unrecognized dcsp request dcsp or dcsp nothing dcsp to dcsp cancel dcnl dcsp dcsp content type none dcnl dcsp dcsp if request is ajax dcnl dcsp dcsp dcsp msg json dumps status error message msg dcnl dcsp dcsp dcsp content type application json dcnl dcsp dcsp return httpresponsebadrequest msg content type content type dcnl dcsp if request is ajax dcnl dcsp dcsp return httpresponse json dumps status success content type application json dcnl dcsp return httpresponseredirect reverse gallery gallery args media type
def gallery async request dcsp media type request get get type image dcnl dcsp term request get get q dcnl dcsp media locale request get get locale settings wiki default language dcnl dcsp if media type image dcnl dcsp dcsp media qs image objects dcnl dcsp elif media type video dcnl dcsp dcsp media qs video objects dcnl dcsp else dcnl dcsp dcsp raise http404 dcnl dcsp media qs media qs filter locale media locale dcnl dcsp if term dcnl dcsp dcsp media qs media qs filter q title icontains term | q description icontains term dcnl dcsp media paginate request media qs per page items per page dcnl dcsp return render request gallery includes media list html media list media
def search request media type dcsp term request get get q dcnl dcsp if not term dcnl dcsp dcsp url reverse gallery gallery args media type dcnl dcsp dcsp return httpresponseredirect url dcnl dcsp filter q title icontains term | q description icontains term dcnl dcsp if media type image dcnl dcsp dcsp media qs image objects filter filter locale request language code dcnl dcsp elif media type video dcnl dcsp dcsp media qs video objects filter filter locale request language code dcnl dcsp else dcnl dcsp dcsp raise http404 dcnl dcsp media paginate request media qs per page items per page dcnl dcsp return render request gallery search html media media media type media type q term
login required dcnl def delete media request media id media type image dcsp media media format get media info media id media type dcnl dcsp check media permissions media request user delete dcnl dcsp if request method get dcnl dcsp dcsp return render request gallery confirm media delete html media media media type media type media format media format dcnl dcsp log warning user dcsp s dcsp is dcsp deleting dcsp s dcsp with dcsp id s request user media type media id dcnl dcsp media delete dcnl dcsp schedule rebuild kb dcnl dcsp return httpresponseredirect reverse gallery gallery args media type
login required dcnl def edit media request media id media type image dcsp media media format get media info media id media type dcnl dcsp check media permissions media request user change dcnl dcsp if media type image dcnl dcsp dcsp media form init media form imageform request media locale title dcnl dcsp else dcnl dcsp dcsp raise http404 dcnl dcsp if request method post and media form is valid dcnl dcsp dcsp media media form save update user request user is draft false dcnl dcsp dcsp return httpresponseredirect reverse gallery media args media type media id dcnl dcsp return render request gallery edit media html media media media format media format form media form media type media type
def media request media id media type image dcsp media media format get media info media id media type dcnl dcsp return render request gallery media html media media media format media format media type media type
login required dcnl require post dcnl xframe options sameorigin dcnl def upload async request media type image dcsp try dcnl dcsp dcsp if media type image dcnl dcsp dcsp dcsp file info upload image request dcnl dcsp dcsp else dcnl dcsp dcsp dcsp msg u unrecognized dcsp media dcsp type dcnl dcsp dcsp dcsp return httpresponsebadrequest json dumps status error message msg dcnl dcsp except filetoolargeerror as e dcnl dcsp dcsp return httpresponsebadrequest json dumps status error message e args0 dcnl dcsp if isinstance file info dict and thumbnail url in file info dcnl dcsp dcsp schedule rebuild kb dcnl dcsp dcsp return httpresponse json dumps status success file file info dcnl dcsp message u could dcsp not dcsp upload dcsp your dcsp image dcnl dcsp return httpresponsebadrequest json dumps status error message unicode message errors file info
def get media info media id media type dcsp media format none dcnl dcsp if media type image dcnl dcsp dcsp media get object or 404 image pk media id dcnl dcsp dcsp try dcnl dcsp dcsp dcsp media format imghdr what media file path dcnl dcsp dcsp except unicodeencodeerror dcnl dcsp dcsp dcsp pass dcnl dcsp elif media type video dcnl dcsp dcsp media get object or 404 video pk media id dcnl dcsp else dcnl dcsp dcsp raise http404 dcnl dcsp return media media format
def get drafts user dcsp drafts image none video none dcnl dcsp if user is authenticated dcnl dcsp dcsp drafts image image objects filter creator user is draft true dcnl dcsp dcsp drafts video video objects filter creator user is draft true dcnl dcsp return drafts
def init media form form cls request none obj none ignore fields dcsp post data none dcnl dcsp initial none dcnl dcsp if request dcnl dcsp dcsp initial locale request language code dcnl dcsp file data none dcnl dcsp if request method post dcnl dcsp dcsp file data request files dcnl dcsp dcsp post data request post copy dcnl dcsp dcsp if obj and ignore fields dcnl dcsp dcsp dcsp for f in ignore fields dcnl dcsp dcsp dcsp dcsp post dataf getattr obj f dcnl dcsp return form cls post data file data instance obj initial initial is ajax false
cronjobs register dcnl def send welcome emails dcsp wait period datetime now timedelta hours 24 dcnl dcsp messages dcnl dcsp context host site objects get current domain dcnl dcsp answer filter q created lte wait period dcnl dcsp answer filter ~ q question creator f creator dcnl dcsp answer filter q creator profile first answer email sent false dcnl dcsp answer recipient ids set answer objects filter answer filter values list creator flat true dcnl dcsp safe translation dcnl dcsp def make answer email locale to dcnl dcsp dcsp return make mail subject thank dcsp you dcsp for dcsp your dcsp contribution dcsp to dcsp mozilla dcsp support text template community email first answer ltxt html template community email first answer html context vars context from email settings tidings from address to email to email dcnl dcsp for user in user objects filter id in answer recipient ids dcnl dcsp dcsp messages append make answer email user profile locale user dcnl dcsp l10n filter q created lte wait period dcnl dcsp l10n filter ~ q document locale settings wiki default language dcnl dcsp l10n filter q creator profile first l10n email sent false dcnl dcsp l10n recipient ids set revision objects filter l10n filter values list creator flat true dcnl dcsp for user in user objects filter id in l10n recipient ids dcnl dcsp dcsp messages append make mail subject thank dcsp you dcsp for dcsp your dcsp contribution dcsp to dcsp mozilla dcsp support text template community email first l10n ltxt html template community email first l10n html context vars context from email settings tidings from address to email user email dcnl dcsp send messages messages dcnl dcsp profile objects filter user id in answer recipient ids update first answer email sent true dcnl dcsp profile objects filter user id in l10n recipient ids update first l10n email sent true
def top contributors questions start none end none locale none product none count 10 page 1 use cache true dcsp if use cache dcnl dcsp dcsp cache key u format start end locale product count page dcnl dcsp dcsp cache key hashlib sha1 cache key encode utf8 hexdigest dcnl dcsp dcsp cache key top contributors questions format cache key dcnl dcsp dcsp cached cache get cache key none dcnl dcsp dcsp if cached dcnl dcsp dcsp dcsp return cached dcnl dcsp query answermetricsmappingtype search dcnl dcsp query query filter by asker false dcnl dcsp query apply filters query start end locale product dcnl dcsp answers q id for q in query all huge number dcnl dcsp users user objects filter answers in answers annotate query count count answers order by query count dcnl dcsp counts get creator counts users count page dcnl dcsp if use cache dcnl dcsp dcsp cache set cache key counts 60 15 dcnl dcsp return counts
def top contributors kb start none end none product none count 10 page 1 use cache true dcsp return top contributors l10n start end settings wiki default language product count use cache
def top contributors l10n start none end none locale none product none count 10 page 1 use cache true dcsp if use cache dcnl dcsp dcsp cache key u format start end locale product count page dcnl dcsp dcsp cache key hashlib sha1 cache key encode utf8 hexdigest dcnl dcsp dcsp cache key u top contributors l10n format cache key dcnl dcsp dcsp cached cache get cache key none dcnl dcsp dcsp if cached dcnl dcsp dcsp dcsp return cached dcnl dcsp query revisionmetricsmappingtype search dcnl dcsp if locale is none dcnl dcsp dcsp query query filter ~ f locale settings wiki default language dcnl dcsp query apply filters query start end locale product dcnl dcsp revisions q id for q in query all huge number dcnl dcsp users user objects filter created revisions in revisions annotate query count count created revisions order by query count dcnl dcsp counts get creator counts users count page dcnl dcsp if use cache dcnl dcsp dcsp cache set cache key counts 60 15 dcnl dcsp return counts
def top contributors aoa start none end none locale none count 10 page 1 use cache true dcsp if use cache dcnl dcsp dcsp cache key u format start end locale count page dcnl dcsp dcsp cache key hashlib sha1 cache key encode utf8 hexdigest dcnl dcsp dcsp cache key u top contributors aoa format cache key dcnl dcsp dcsp cached cache get cache key none dcnl dcsp dcsp if cached dcnl dcsp dcsp dcsp return cached dcnl dcsp query replymetricsmappingtype search dcnl dcsp locale locale split 0 if locale else none dcnl dcsp query apply filters query start end locale dcnl dcsp tweets q id for q in query all huge number dcnl dcsp users user objects filter tweet replies in tweets annotate query count count tweet replies order by query count dcnl dcsp counts get creator counts users count page dcnl dcsp if use cache dcnl dcsp dcsp cache set cache key counts 60 15 dcnl dcsp return counts
def apply filters query start end locale none product none dcsp if start is none dcnl dcsp dcsp start date today timedelta days 90 dcnl dcsp query query filter created gte start dcnl dcsp if end dcnl dcsp dcsp query query filter created lt end dcnl dcsp if locale dcnl dcsp dcsp query query filter locale locale dcnl dcsp if product dcnl dcsp dcsp if isinstance product product dcnl dcsp dcsp dcsp product product slug dcnl dcsp dcsp query query filter product product dcnl dcsp return query
def home request dcsp community news get object fallback document community news doc request language code dcnl dcsp locale validate locale request get get locale dcnl dcsp product request get get product dcnl dcsp if product dcnl dcsp dcsp product get object or 404 product slug product dcnl dcsp recent threads thread objects filter forum slug contributors 5 dcnl dcsp data community news community news locale locale product product products product objects filter visible true threads recent threads dcnl dcsp if locale dcnl dcsp dcsp data top contributors aoa top contributors aoa locale locale dcnl dcsp dcsp if locale settings wiki default language dcnl dcsp dcsp dcsp data top contributors kb top contributors kb product product dcnl dcsp dcsp else dcnl dcsp dcsp dcsp data top contributors l10n top contributors l10n locale locale product product dcnl dcsp dcsp if locale in questionlocale objects locales list dcnl dcsp dcsp dcsp data top contributors questions top contributors questions locale locale product product dcnl dcsp else dcnl dcsp dcsp data top contributors aoa top contributors aoa dcnl dcsp dcsp data top contributors kb top contributors kb product product dcnl dcsp dcsp data top contributors l10n top contributors l10n product product dcnl dcsp dcsp data top contributors questions top contributors questions product product dcnl dcsp return render request community index html data
def search request dcsp results dcnl dcsp search errored false dcnl dcsp q request get get q dcnl dcsp if q dcnl dcsp dcsp lowerq q lower dcnl dcsp dcsp try dcnl dcsp dcsp dcsp results usermappingtype search query iusername match lowerq idisplay name match whitespace lowerq itwitter usernames match lowerq should true values dict id username display name avatar twitter usernames last contribution date dcnl dcsp dcsp dcsp results usermappingtype reshape results dcnl dcsp dcsp dcsp statsd incr community usersearch success dcnl dcsp dcsp except es exceptions dcnl dcsp dcsp dcsp search errored true dcnl dcsp dcsp dcsp statsd incr community usersearch error dcnl dcsp dcsp dcsp log exception user dcsp search dcsp failed dcnl dcsp results list results 30 dcnl dcsp for r in results dcnl dcsp dcsp lcd r get last contribution date none dcnl dcsp dcsp if lcd dcnl dcsp dcsp dcsp delta datetime now lcd dcnl dcsp dcsp dcsp r days since last activity delta days dcnl dcsp dcsp else dcnl dcsp dcsp dcsp r days since last activity none dcnl dcsp data q q results results search errored search errored dcnl dcsp return render request community search html data
def top contributors request area dcsp try dcnl dcsp dcsp page int request get get page 1 dcnl dcsp except valueerror dcnl dcsp dcsp page 1 dcnl dcsp page size 100 dcnl dcsp locale validate locale request get get locale dcnl dcsp product request get get product dcnl dcsp if product dcnl dcsp dcsp product get object or 404 product slug product dcnl dcsp if area armyofawesome dcnl dcsp dcsp results total top contributors aoa locale locale count page size page page dcnl dcsp dcsp locales settings sumo languages dcnl dcsp elif area questions dcnl dcsp dcsp results total top contributors questions locale locale product product count page size page page dcnl dcsp dcsp locales questionlocale objects locales list dcnl dcsp elif area kb dcnl dcsp dcsp results total top contributors kb product product count page size page page dcnl dcsp dcsp locales none dcnl dcsp elif area l10n dcnl dcsp dcsp results total top contributors l10n locale locale product product count page size page page dcnl dcsp dcsp locales settings sumo languages dcnl dcsp else dcnl dcsp dcsp raise http404 dcnl dcsp return render request community top contributors html results results total total area area locale locale locales locales product product products product objects filter visible true page page page size page size
def validate locale locale dcsp if locale and locale not in settings sumo languages dcnl dcsp dcsp raise http404 dcnl dcsp return locale
library global function dcnl def group avatar group profile dcsp if group profile avatar dcnl dcsp dcsp return group profile avatar url dcnl dcsp else dcnl dcsp dcsp return settings static url + settings default avatar
login required dcnl require http methods get post dcnl def edit avatar request group slug dcsp prof get object or 404 groupprofile slug group slug dcnl dcsp if not user can edit request user prof dcnl dcsp dcsp raise permissiondenied dcnl dcsp form groupavatarform request post or none request files or none instance prof dcnl dcsp old avatar path none dcnl dcsp if prof avatar and os path isfile prof avatar path dcnl dcsp dcsp old avatar path prof avatar path dcnl dcsp if request method post and form is valid dcnl dcsp dcsp if old avatar path dcnl dcsp dcsp dcsp os unlink old avatar path dcnl dcsp dcsp prof form save dcnl dcsp dcsp content create image thumbnail prof avatar path settings avatar size pad true dcnl dcsp dcsp name prof avatar name + png dcnl dcsp dcsp prof avatar delete dcnl dcsp dcsp prof avatar save name content save true dcnl dcsp dcsp return httpresponseredirect prof get absolute url dcnl dcsp return render request groups edit avatar html form form profile prof
login required dcnl require http methods get post dcnl def delete avatar request group slug dcsp prof get object or 404 groupprofile slug group slug dcnl dcsp if not user can edit request user prof dcnl dcsp dcsp raise permissiondenied dcnl dcsp if request method post dcnl dcsp dcsp if prof avatar dcnl dcsp dcsp dcsp prof avatar delete dcnl dcsp dcsp return httpresponseredirect prof get absolute url dcnl dcsp return render request groups confirm avatar delete html profile prof
login required dcnl require post dcnl def add member request group slug dcsp prof get object or 404 groupprofile slug group slug dcnl dcsp if not user can edit request user prof dcnl dcsp dcsp raise permissiondenied dcnl dcsp form adduserform request post dcnl dcsp if form is valid dcnl dcsp dcsp for user in form cleaned data users dcnl dcsp dcsp dcsp user groups add prof group dcnl dcsp dcsp msg users dcsp added dcsp to dcsp the dcsp group dcsp successfully format users request post get users dcnl dcsp dcsp messages add message request messages success msg dcnl dcsp dcsp return httpresponseredirect prof get absolute url dcnl dcsp msg there dcsp were dcsp errors dcsp adding dcsp members dcsp to dcsp the dcsp group dcsp see dcsp below dcnl dcsp messages add message request messages error msg dcnl dcsp return profile request group slug member form form
login required dcnl require http methods get post dcnl def remove member request group slug user id dcsp prof get object or 404 groupprofile slug group slug dcnl dcsp user get object or 404 user id user id dcnl dcsp if not user can edit request user prof dcnl dcsp dcsp raise permissiondenied dcnl dcsp if request method post dcnl dcsp dcsp if user in prof leaders all dcnl dcsp dcsp dcsp prof leaders remove user dcnl dcsp dcsp user groups remove prof group dcnl dcsp dcsp msg user dcsp removed dcsp from dcsp the dcsp group dcsp successfully format user user username dcnl dcsp dcsp messages add message request messages success msg dcnl dcsp dcsp return httpresponseredirect prof get absolute url dcnl dcsp return render request groups confirm remove member html profile prof member user
login required dcnl require post dcnl def add leader request group slug dcsp prof get object or 404 groupprofile slug group slug dcnl dcsp if not user can manage leaders request user prof dcnl dcsp dcsp raise permissiondenied dcnl dcsp form adduserform request post dcnl dcsp if form is valid dcnl dcsp dcsp for user in form cleaned data users dcnl dcsp dcsp dcsp if prof group not in user groups all dcnl dcsp dcsp dcsp dcsp user groups add prof group dcnl dcsp dcsp dcsp prof leaders add user dcnl dcsp dcsp msg users dcsp added dcsp to dcsp the dcsp group dcsp leaders dcsp successfully format users request post get users dcnl dcsp dcsp messages add message request messages success msg dcnl dcsp dcsp return httpresponseredirect prof get absolute url dcnl dcsp msg there dcsp were dcsp errors dcsp adding dcsp leaders dcsp to dcsp the dcsp group dcsp see dcsp below dcnl dcsp messages add message request messages error msg dcnl dcsp return profile request group slug leader form form
login required dcnl require http methods get post dcnl def remove leader request group slug user id dcsp prof get object or 404 groupprofile slug group slug dcnl dcsp user get object or 404 user id user id dcnl dcsp if not user can manage leaders request user prof dcnl dcsp dcsp raise permissiondenied dcnl dcsp if request method post dcnl dcsp dcsp prof leaders remove user dcnl dcsp dcsp msg user dcsp removed dcsp from dcsp the dcsp group dcsp leaders dcsp successfully format user user username dcnl dcsp dcsp messages add message request messages success msg dcnl dcsp dcsp return httpresponseredirect prof get absolute url dcnl dcsp return render request groups confirm remove leader html profile prof leader user
login required dcnl require post dcnl def join contributors request dcsp next get next url request or reverse home dcnl dcsp group group objects get name contributors dcnl dcsp request user groups add group dcnl dcsp messages add message request messages success you dcsp are dcsp now dcsp part dcsp of dcsp the dcsp contributors dcsp group dcnl dcsp return httpresponseredirect next
def user can edit user group profile dcsp return user has perm groups change groupprofile or user in group profile leaders all
def user can manage leaders user group profile dcsp return user has perm groups change groupprofile
def last post from posts exclude post none dcsp if exclude post dcnl dcsp dcsp posts posts exclude id exclude post id dcnl dcsp posts posts order by created dcnl dcsp try dcnl dcsp dcsp return posts0 dcnl dcsp except indexerror dcnl dcsp dcsp return none
def user pre save sender instance kw dcsp if instance id dcnl dcsp dcsp user user objects get id instance id dcnl dcsp dcsp if user username instance username dcnl dcsp dcsp dcsp threads thread objects filter q creator instance | q post author instance only id distinct dcnl dcsp dcsp dcsp for t in threads dcnl dcsp dcsp dcsp dcsp t index later
def forums request dcsp qs forum objects filter is listed true dcnl dcsp qs qs select related last post last post author dcnl dcsp qs qs extra select thread count select dcsp count dcsp from dcsp forums thread dcsp where dcsp forums thread forum id dcsp dcsp forums forum id dcnl dcsp forums f for f in qs if f allows viewing by request user dcnl dcsp return render request forums forums html forums paginate request forums
def threads request forum slug dcsp forum get object or 404 forum slug forum slug dcnl dcsp if not forum allows viewing by request user dcnl dcsp dcsp raise http404 dcnl dcsp try dcnl dcsp dcsp sort int request get get sort 0 dcnl dcsp except valueerror dcnl dcsp dcsp sort 0 dcnl dcsp try dcnl dcsp dcsp desc int request get get desc 0 dcnl dcsp except valueerror dcnl dcsp dcsp desc 0 dcnl dcsp desc toggle 0 if desc else 1 dcnl dcsp threads sort threads forum thread set sort desc dcnl dcsp count threads count dcnl dcsp threads threads select related creator last post last post author dcnl dcsp threads paginate request threads per page constants threads per page count count dcnl dcsp feed urls reverse forums threads feed args forum slug threadsfeed title forum dcnl dcsp is watching forum request user is authenticated and newthreadevent is notifying request user forum dcnl dcsp return render request forums threads html forum forum threads threads is watching forum is watching forum sort sort desc toggle desc toggle feeds feed urls
def posts request forum slug thread id form none post preview none is reply false dcsp thread get object or 404 thread pk thread id dcnl dcsp forum thread forum dcnl dcsp if forum slug forum slug and not is reply dcnl dcsp dcsp new forum get object or 404 forum slug forum slug dcnl dcsp dcsp if new forum allows viewing by request user dcnl dcsp dcsp dcsp return httpresponseredirect thread get absolute url dcnl dcsp dcsp raise http404 dcnl dcsp elif forum slug forum slug dcnl dcsp dcsp raise http404 dcnl dcsp if not forum allows viewing by request user dcnl dcsp dcsp raise http404 dcnl dcsp posts thread post set all dcnl dcsp count posts count dcnl dcsp if count dcnl dcsp dcsp last post posts count 1 dcnl dcsp else dcnl dcsp dcsp last post none dcnl dcsp posts posts select related author updated by dcnl dcsp posts posts extra select author post count select dcsp count dcsp from dcsp forums post dcsp where dcsp forums post author id dcsp dcsp auth user id dcnl dcsp posts paginate request posts constants posts per page count count dcnl dcsp if not form dcnl dcsp dcsp form replyform dcnl dcsp feed urls reverse forums posts feed kwargs forum slug forum slug thread id thread id postsfeed title thread dcnl dcsp is watching thread request user is authenticated and newpostevent is notifying request user thread dcnl dcsp return render request forums posts html forum forum thread thread posts posts form form count count last post last post post preview post preview is watching thread is watching thread feeds feed urls forums forum objects all
require post dcnl login required dcnl def reply request forum slug thread id dcsp forum get object or 404 forum slug forum slug dcnl dcsp user request user dcnl dcsp if not forum allows posting by user dcnl dcsp dcsp if forum allows viewing by user dcnl dcsp dcsp dcsp raise permissiondenied dcnl dcsp dcsp else dcnl dcsp dcsp dcsp raise http404 dcnl dcsp form replyform request post dcnl dcsp post preview none dcnl dcsp if form is valid dcnl dcsp dcsp thread get object or 404 thread pk thread id forum forum dcnl dcsp dcsp if not thread is locked dcnl dcsp dcsp dcsp reply form save commit false dcnl dcsp dcsp dcsp reply thread thread dcnl dcsp dcsp dcsp reply author request user dcnl dcsp dcsp dcsp if preview in request post dcnl dcsp dcsp dcsp dcsp post preview reply dcnl dcsp dcsp dcsp dcsp post preview author post count reply author post set count dcnl dcsp dcsp dcsp elif not is ratelimited request forumpost 15 d dcnl dcsp dcsp dcsp dcsp reply save dcnl dcsp dcsp dcsp dcsp statsd incr forums reply dcnl dcsp dcsp dcsp dcsp if setting get for user request user forums watch after reply dcnl dcsp dcsp dcsp dcsp dcsp newpostevent notify request user thread dcnl dcsp dcsp dcsp dcsp newpostevent reply fire exclude reply author dcnl dcsp dcsp dcsp dcsp return httpresponseredirect thread get last post url dcnl dcsp return posts request forum slug thread id form post preview is reply true
login required dcnl def new thread request forum slug dcsp forum get object or 404 forum slug forum slug dcnl dcsp user request user dcnl dcsp if not forum allows posting by user dcnl dcsp dcsp if forum allows viewing by user dcnl dcsp dcsp dcsp raise permissiondenied dcnl dcsp dcsp else dcnl dcsp dcsp dcsp raise http404 dcnl dcsp if request method get dcnl dcsp dcsp form newthreadform dcnl dcsp dcsp return render request forums new thread html form form forum forum dcnl dcsp form newthreadform request post dcnl dcsp post preview none dcnl dcsp if form is valid dcnl dcsp dcsp if preview in request post dcnl dcsp dcsp dcsp thread thread creator request user title form cleaned data title dcnl dcsp dcsp dcsp post preview post thread thread author request user content form cleaned data content dcnl dcsp dcsp dcsp post preview author post count post preview author post set count dcnl dcsp dcsp elif not is ratelimited request forumpost 5 d dcnl dcsp dcsp dcsp thread forum thread set create creator request user title form cleaned data title dcnl dcsp dcsp dcsp thread save dcnl dcsp dcsp dcsp statsd incr forums thread dcnl dcsp dcsp dcsp post thread new post author request user content form cleaned data content dcnl dcsp dcsp dcsp post save dcnl dcsp dcsp dcsp newthreadevent post fire exclude post author dcnl dcsp dcsp dcsp if setting get for user request user forums watch new thread dcnl dcsp dcsp dcsp dcsp newpostevent notify request user thread dcnl dcsp dcsp dcsp url reverse forums posts args forum slug thread id dcnl dcsp dcsp dcsp return httpresponseredirect urlparams url last post id dcnl dcsp return render request forums new thread html form form forum forum post preview post preview
require post dcnl login required dcnl permission required or 403 forums forum thread locked forum forum slug iexact forum slug dcnl def lock thread request forum slug thread id dcsp forum get object or 404 forum slug forum slug dcnl dcsp thread get object or 404 thread pk thread id forum forum dcnl dcsp thread is locked not thread is locked dcnl dcsp log info user dcsp s dcsp set dcsp is locked s dcsp on dcsp thread dcsp with dcsp id s dcsp request user thread is locked thread id dcnl dcsp thread save dcnl dcsp return httpresponseredirect reverse forums posts args forum slug thread id
require post dcnl login required dcnl permission required or 403 forums forum thread sticky forum forum slug iexact forum slug dcnl def sticky thread request forum slug thread id dcsp forum get object or 404 forum slug forum slug dcnl dcsp thread get object or 404 thread pk thread id forum forum dcnl dcsp thread is sticky not thread is sticky dcnl dcsp log info user dcsp s dcsp set dcsp is sticky s dcsp on dcsp thread dcsp with dcsp id s dcsp request user thread is sticky thread id dcnl dcsp thread save dcnl dcsp return httpresponseredirect reverse forums posts args forum slug thread id
login required dcnl has perm or owns or 403 forums forum thread edit forum creator thread id iexact thread id forum slug iexact forum slug dcnl def edit thread request forum slug thread id dcsp forum get object or 404 forum slug forum slug dcnl dcsp thread get object or 404 thread pk thread id forum forum dcnl dcsp if thread is locked dcnl dcsp dcsp raise permissiondenied dcnl dcsp if request method get dcnl dcsp dcsp form editthreadform instance thread dcnl dcsp dcsp return render request forums edit thread html form form forum forum thread thread dcnl dcsp form editthreadform request post dcnl dcsp if form is valid dcnl dcsp dcsp log warning user dcsp s dcsp is dcsp editing dcsp thread dcsp with dcsp id s request user thread id dcnl dcsp dcsp thread title form cleaned data title dcnl dcsp dcsp thread save dcnl dcsp dcsp url reverse forums posts args forum slug thread id dcnl dcsp dcsp return httpresponseredirect url dcnl dcsp return render request forums edit thread html form form forum forum thread thread
login required dcnl permission required or 403 forums forum thread delete forum forum slug iexact forum slug dcnl def delete thread request forum slug thread id dcsp forum get object or 404 forum slug forum slug dcnl dcsp thread get object or 404 thread pk thread id forum forum dcnl dcsp if request method get dcnl dcsp dcsp return render request forums confirm thread delete html forum forum thread thread dcnl dcsp log warning user dcsp s dcsp is dcsp deleting dcsp thread dcsp with dcsp id s request user thread id dcnl dcsp thread delete dcnl dcsp statsd incr forums delete thread dcnl dcsp return httpresponseredirect reverse forums threads args forum slug
require post dcnl login required dcnl def move thread request forum slug thread id dcsp forum get object or 404 forum slug forum slug dcnl dcsp thread get object or 404 thread pk thread id forum forum dcnl dcsp user request user dcnl dcsp new forum id request post get forum dcnl dcsp new forum get object or 404 forum id new forum id dcnl dcsp if not forum allows viewing by user and new forum allows viewing by user dcnl dcsp dcsp raise http404 dcnl dcsp if not new forum allows posting by user dcnl dcsp dcsp raise permissiondenied dcnl dcsp if not has perm user forums forum thread move forum new forum and has perm user forums forum thread move forum forum dcnl dcsp dcsp raise permissiondenied dcnl dcsp log warning user dcsp s dcsp is dcsp moving dcsp thread dcsp with dcsp id s dcsp to dcsp forum dcsp with dcsp id s user thread id new forum id dcnl dcsp thread forum new forum dcnl dcsp thread save dcnl dcsp return httpresponseredirect thread get absolute url
login required dcnl has perm or owns or 403 forums forum post edit forum author post id iexact post id forum slug iexact forum slug dcnl def edit post request forum slug thread id post id dcsp forum get object or 404 forum slug forum slug dcnl dcsp thread get object or 404 thread pk thread id forum forum dcnl dcsp post get object or 404 post pk post id thread thread dcnl dcsp if thread is locked dcnl dcsp dcsp raise permissiondenied dcnl dcsp if request method get dcnl dcsp dcsp form editpostform content post content dcnl dcsp dcsp return render request forums edit post html form form forum forum thread thread post post dcnl dcsp form editpostform request post dcnl dcsp post preview none dcnl dcsp if form is valid dcnl dcsp dcsp post content form cleaned data content dcnl dcsp dcsp post updated by request user dcnl dcsp dcsp if preview in request post dcnl dcsp dcsp dcsp post updated datetime now dcnl dcsp dcsp dcsp post preview post dcnl dcsp dcsp else dcnl dcsp dcsp dcsp log warning user dcsp s dcsp is dcsp editing dcsp post dcsp with dcsp id s request user post id dcnl dcsp dcsp dcsp post save dcnl dcsp dcsp dcsp return httpresponseredirect post get absolute url dcnl dcsp return render request forums edit post html form form forum forum thread thread post post post preview post preview
login required dcnl permission required or 403 forums forum post delete forum forum slug iexact forum slug dcnl def delete post request forum slug thread id post id dcsp forum get object or 404 forum slug forum slug dcnl dcsp thread get object or 404 thread pk thread id forum forum dcnl dcsp post get object or 404 post pk post id thread thread dcnl dcsp if request method get dcnl dcsp dcsp return render request forums confirm post delete html forum forum thread thread post post dcnl dcsp log warning user dcsp s dcsp is dcsp deleting dcsp post dcsp with dcsp id s request user post id dcnl dcsp post delete dcnl dcsp statsd incr forums delete post dcnl dcsp try dcnl dcsp dcsp thread objects get pk thread id dcnl dcsp dcsp goto reverse forums posts args forum slug thread id dcnl dcsp except thread doesnotexist dcnl dcsp dcsp goto reverse forums threads args forum slug dcnl dcsp return httpresponseredirect goto
require post dcnl login required dcnl def watch thread request forum slug thread id dcsp forum get object or 404 forum slug forum slug dcnl dcsp if not forum allows viewing by request user dcnl dcsp dcsp raise http404 dcnl dcsp thread get object or 404 thread pk thread id forum forum dcnl dcsp if request post get watch yes dcnl dcsp dcsp newpostevent notify request user thread dcnl dcsp dcsp statsd incr forums watches thread dcnl dcsp else dcnl dcsp dcsp newpostevent stop notifying request user thread dcnl dcsp return httpresponseredirect reverse forums posts args forum slug thread id
require post dcnl login required dcnl def watch forum request forum slug dcsp forum get object or 404 forum slug forum slug dcnl dcsp if not forum allows viewing by request user dcnl dcsp dcsp raise http404 dcnl dcsp if request post get watch yes dcnl dcsp dcsp newthreadevent notify request user forum dcnl dcsp dcsp statsd incr forums watches forum dcnl dcsp else dcnl dcsp dcsp newthreadevent stop notifying request user forum dcnl dcsp return httpresponseredirect reverse forums threads args forum slug
require post dcnl login required dcnl def post preview async request dcsp statsd incr forums preview dcnl dcsp post post author request user content request post get content dcnl dcsp post author post count 1 dcnl dcsp return render request forums includes post preview html post preview post
def new post mails reply users and watches dcsp post url add utm reply get absolute url kbforumspost dcnl dcsp c post reply content post html reply content parsed author reply creator host site objects get current domain thread reply thread title forum reply thread document title post url post url dcnl dcsp return emails with users and watches subject lazy u re dcsp forum dcsp dcsp thread text template kbforums email new post ltxt html template kbforums email new post html context vars c users and watches users and watches
def new thread mails post users and watches dcsp post url add utm post thread get absolute url kbforumsthread dcnl dcsp c post post content post html post content parsed author post creator host site objects get current domain thread post thread title forum post thread document title post url post url dcnl dcsp return emails with users and watches subject lazy u forum dcsp dcsp thread text template kbforums email new thread ltxt html template kbforums email new thread html context vars c users and watches users and watches
library global function dcnl def is watching discussion locale user locale dcsp return newpostinlocaleevent is notifying user locale locale
def last post from posts exclude post none dcsp if exclude post dcnl dcsp dcsp posts posts exclude id exclude post id dcnl dcsp posts posts order by created dcnl dcsp try dcnl dcsp dcsp return posts0 dcnl dcsp except indexerror dcnl dcsp dcsp return none
def get document slug request dcsp return get object or 404 document slug slug locale request language code allow discussion true
def threads request document slug dcsp doc get document document slug request dcnl dcsp try dcnl dcsp dcsp sort int request get get sort 0 dcnl dcsp except valueerror dcnl dcsp dcsp sort 0 dcnl dcsp try dcnl dcsp dcsp desc int request get get desc 0 dcnl dcsp except valueerror dcnl dcsp dcsp desc 0 dcnl dcsp desc toggle 0 if desc else 1 dcnl dcsp threads sort threads doc thread set sort desc dcnl dcsp threads paginate request threads per page kbforums threads per page dcnl dcsp feed urls reverse wiki discuss threads feed args document slug threadsfeed title doc dcnl dcsp is watching forum request user is authenticated and newthreadevent is notifying request user doc dcnl dcsp return render request kbforums threads html document doc threads threads is watching forum is watching forum sort sort desc toggle desc toggle feeds feed urls
def posts request document slug thread id form none post preview none dcsp doc get document document slug request dcnl dcsp thread get object or 404 thread pk thread id document doc dcnl dcsp posts thread post set all dcnl dcsp count posts count dcnl dcsp if count dcnl dcsp dcsp last post posts count 1 dcnl dcsp else dcnl dcsp dcsp last post none dcnl dcsp posts paginate request posts kbforums posts per page dcnl dcsp if not form dcnl dcsp dcsp form replyform dcnl dcsp feed urls reverse wiki discuss posts feed kwargs document slug document slug thread id thread id postsfeed title thread dcnl dcsp is watching thread request user is authenticated and newpostevent is notifying request user thread dcnl dcsp return render request kbforums posts html document doc thread thread posts posts form form count count last post last post post preview post preview is watching thread is watching thread feeds feed urls
def is ratelimited request dcsp return is ratelimited request kbforumpostmin 4 m or is ratelimited request kbforumpostday 50 d
login required dcnl require post dcnl def reply request document slug thread id dcsp doc get document document slug request dcnl dcsp form replyform request post dcnl dcsp post preview none dcnl dcsp if form is valid dcnl dcsp dcsp thread get object or 404 thread pk thread id document doc dcnl dcsp dcsp if not thread is locked dcnl dcsp dcsp dcsp reply form save commit false dcnl dcsp dcsp dcsp reply thread thread dcnl dcsp dcsp dcsp reply creator request user dcnl dcsp dcsp dcsp if preview in request post dcnl dcsp dcsp dcsp dcsp post preview reply dcnl dcsp dcsp dcsp elif not is ratelimited request dcnl dcsp dcsp dcsp dcsp reply save dcnl dcsp dcsp dcsp dcsp statsd incr kbforums reply dcnl dcsp dcsp dcsp dcsp if setting get for user request user kbforums watch after reply dcnl dcsp dcsp dcsp dcsp dcsp newpostevent notify request user thread dcnl dcsp dcsp dcsp dcsp newpostevent reply fire exclude reply creator dcnl dcsp dcsp dcsp dcsp return httpresponseredirect reply get absolute url dcnl dcsp return posts request document slug thread id form post preview
login required dcnl def new thread request document slug dcsp doc get document document slug request dcnl dcsp if request method get dcnl dcsp dcsp form newthreadform dcnl dcsp dcsp return render request kbforums new thread html form form document doc dcnl dcsp form newthreadform request post dcnl dcsp post preview none dcnl dcsp if form is valid dcnl dcsp dcsp if preview in request post dcnl dcsp dcsp dcsp thread thread creator request user title form cleaned data title dcnl dcsp dcsp dcsp post preview post thread thread creator request user content form cleaned data content dcnl dcsp dcsp elif not is ratelimited request dcnl dcsp dcsp dcsp thread doc thread set create creator request user title form cleaned data title dcnl dcsp dcsp dcsp thread save dcnl dcsp dcsp dcsp statsd incr kbforums thread dcnl dcsp dcsp dcsp post thread new post creator request user content form cleaned data content dcnl dcsp dcsp dcsp post save dcnl dcsp dcsp dcsp newthreadevent post fire exclude post creator dcnl dcsp dcsp dcsp if setting get for user request user kbforums watch new thread dcnl dcsp dcsp dcsp dcsp newpostevent notify request user thread dcnl dcsp dcsp dcsp return httpresponseredirect reverse wiki discuss posts args document slug thread id dcnl dcsp return render request kbforums new thread html form form document doc post preview post preview
require post dcnl permission required kbforums lock thread dcnl def lock thread request document slug thread id dcsp doc get document document slug request dcnl dcsp thread get object or 404 thread pk thread id document doc dcnl dcsp thread is locked not thread is locked dcnl dcsp log info user dcsp s dcsp set dcsp is locked s dcsp on dcsp kb dcsp thread dcsp with dcsp id s dcsp request user thread is locked thread id dcnl dcsp thread save dcnl dcsp return httpresponseredirect reverse wiki discuss posts args document slug thread id
require post dcnl permission required kbforums sticky thread dcnl def sticky thread request document slug thread id dcsp doc get document document slug request dcnl dcsp thread get object or 404 thread pk thread id document doc dcnl dcsp thread is sticky not thread is sticky dcnl dcsp log info user dcsp s dcsp set dcsp is sticky s dcsp on dcsp kb dcsp thread dcsp with dcsp id s dcsp request user thread is sticky thread id dcnl dcsp thread save dcnl dcsp return httpresponseredirect reverse wiki discuss posts args document slug thread id
login required dcnl def edit thread request document slug thread id dcsp doc get document document slug request dcnl dcsp thread get object or 404 thread pk thread id document doc dcnl dcsp perm request user has perm kbforums change thread dcnl dcsp if not perm or thread creator request user and not thread is locked dcnl dcsp dcsp raise permissiondenied dcnl dcsp if request method get dcnl dcsp dcsp form editthreadform instance thread dcnl dcsp dcsp return render request kbforums edit thread html form form document doc thread thread dcnl dcsp form editthreadform request post dcnl dcsp if form is valid dcnl dcsp dcsp log warning user dcsp s dcsp is dcsp editing dcsp kb dcsp thread dcsp with dcsp id s request user thread id dcnl dcsp dcsp thread title form cleaned data title dcnl dcsp dcsp thread save dcnl dcsp dcsp url reverse wiki discuss posts args document slug thread id dcnl dcsp dcsp return httpresponseredirect url dcnl dcsp return render request kbforums edit thread html form form document doc thread thread
permission required kbforums delete thread dcnl def delete thread request document slug thread id dcsp doc get document document slug request dcnl dcsp thread get object or 404 thread pk thread id document doc dcnl dcsp if request method get dcnl dcsp dcsp return render request kbforums confirm thread delete html document doc thread thread dcnl dcsp log warning user dcsp s dcsp is dcsp deleting dcsp kb dcsp thread dcsp with dcsp id s request user thread id dcnl dcsp thread delete dcnl dcsp statsd incr kbforums delete thread dcnl dcsp return httpresponseredirect reverse wiki discuss threads args document slug
login required dcnl def edit post request document slug thread id post id dcsp doc get document document slug request dcnl dcsp thread get object or 404 thread pk thread id document doc dcnl dcsp post get object or 404 post pk post id thread thread dcnl dcsp perm request user has perm kbforums change post dcnl dcsp if not perm or request user post creator and not thread is locked dcnl dcsp dcsp raise permissiondenied dcnl dcsp if request method get dcnl dcsp dcsp form editpostform content post content dcnl dcsp dcsp return render request kbforums edit post html form form document doc thread thread post post dcnl dcsp form editpostform request post dcnl dcsp post preview none dcnl dcsp if form is valid dcnl dcsp dcsp post content form cleaned data content dcnl dcsp dcsp post updated by request user dcnl dcsp dcsp if preview in request post dcnl dcsp dcsp dcsp post updated datetime now dcnl dcsp dcsp dcsp post preview post dcnl dcsp dcsp else dcnl dcsp dcsp dcsp log warning user dcsp s dcsp is dcsp editing dcsp kb dcsp post dcsp with dcsp id s request user post id dcnl dcsp dcsp dcsp post save dcnl dcsp dcsp dcsp return httpresponseredirect post get absolute url dcnl dcsp return render request kbforums edit post html form form document doc thread thread post post post preview post preview
permission required kbforums delete post dcnl def delete post request document slug thread id post id dcsp doc get document document slug request dcnl dcsp thread get object or 404 thread pk thread id document doc dcnl dcsp post get object or 404 post pk post id thread thread dcnl dcsp if request method get dcnl dcsp dcsp return render request kbforums confirm post delete html document doc thread thread post post dcnl dcsp log warning user dcsp s dcsp is dcsp deleting dcsp kb dcsp post dcsp with dcsp id s request user post id dcnl dcsp post delete dcnl dcsp statsd incr kbforums delete post dcnl dcsp try dcnl dcsp dcsp thread objects get pk thread id dcnl dcsp dcsp goto reverse wiki discuss posts args document slug thread id dcnl dcsp except thread doesnotexist dcnl dcsp dcsp goto reverse wiki discuss threads args document slug dcnl dcsp return httpresponseredirect goto
require post dcnl login required dcnl def watch thread request document slug thread id dcsp doc get document document slug request dcnl dcsp thread get object or 404 thread pk thread id document doc dcnl dcsp if request post get watch yes dcnl dcsp dcsp newpostevent notify request user thread dcnl dcsp dcsp statsd incr kbforums watches thread dcnl dcsp else dcnl dcsp dcsp newpostevent stop notifying request user thread dcnl dcsp return httpresponseredirect reverse wiki discuss posts args document slug thread id
require post dcnl login required dcnl def watch locale request dcsp locale request language code dcnl dcsp if request post get watch yes dcnl dcsp dcsp newpostinlocaleevent notify request user locale locale dcnl dcsp dcsp newthreadinlocaleevent notify request user locale locale dcnl dcsp dcsp statsd incr kbforums watches locale dcnl dcsp else dcnl dcsp dcsp newpostinlocaleevent stop notifying request user locale locale dcnl dcsp dcsp newthreadinlocaleevent stop notifying request user locale locale dcnl dcsp return httpresponseredirect get next url request or reverse home
require post dcnl login required dcnl def watch forum request document slug dcsp doc get document document slug request dcnl dcsp if request post get watch yes dcnl dcsp dcsp newthreadevent notify request user doc dcnl dcsp dcsp statsd incr kbforums watches document dcnl dcsp else dcnl dcsp dcsp newthreadevent stop notifying request user doc dcnl dcsp return httpresponseredirect reverse wiki discuss threads args document slug
require post dcnl login required dcnl def post preview async request document slug dcsp statsd incr forums preview dcnl dcsp post post creator request user content request post get content dcnl dcsp return render request kbforums includes post preview html post preview post
check simple wiki locale dcnl mobile template products mobile products html dcnl def product list request template dcsp products product objects filter visible true dcnl dcsp return render request template products products
check simple wiki locale dcnl mobile template products mobile product html dcnl def product landing request template slug dcsp product get object or 404 product slug slug dcnl dcsp if request is ajax dcnl dcsp dcsp topic list list dcnl dcsp dcsp for t in topic objects filter product product visible true dcnl dcsp dcsp dcsp topic list append id t id title t title dcnl dcsp dcsp return httpresponse json dumps topics topic list content type application json dcnl dcsp if slug firefox dcnl dcsp dcsp latest version product details firefox versions latest firefox version dcnl dcsp else dcnl dcsp dcsp versions product versions filter default true dcnl dcsp dcsp if versions dcnl dcsp dcsp dcsp latest version versions0 min version dcnl dcsp dcsp else dcnl dcsp dcsp dcsp latest version 0 dcnl dcsp return render request template product product products product objects filter visible true topics topics for product product parent none search params product slug latest version latest version
check simple wiki locale dcnl mobile template products mobile documents html dcnl def document listing request template product slug topic slug subtopic slug none dcsp product get object or 404 product slug product slug dcnl dcsp topic get object or 404 topic slug topic slug product product parent isnull true dcnl dcsp doc kw locale request language code products product dcnl dcsp if subtopic slug is not none dcnl dcsp dcsp subtopic get object or 404 topic slug subtopic slug product product parent topic dcnl dcsp dcsp doc kw topics subtopic dcnl dcsp else dcnl dcsp dcsp subtopic none dcnl dcsp dcsp doc kw topics topic dcnl dcsp documents fallback documents documents for doc kw dcnl dcsp user agent request meta get http user agent dcnl dcsp browser get browser user agent dcnl dcsp show fx download product slug thunderbird and browser firefox dcnl dcsp return render request template product product topic topic subtopic subtopic topics topics for product product parent none subtopics topics for product product parent topic documents documents fallback documents fallback documents search params product product slug show fx download show fx download
def full ct query action actor only none dcsp actstream registry check action actor dcnl dcsp query ct query action actor dcnl dcsp if action target is not none dcnl dcsp dcsp actstream registry check action target dcnl dcsp dcsp query | ct query action target actor only dcnl dcsp if action action object is not none dcnl dcsp dcsp actstream registry check action action object dcnl dcsp dcsp query | ct query action action object actor only dcnl dcsp return query
def send simple push endpoint version max retries 3 retry count 0 dcsp try dcnl dcsp dcsp r requests put endpoint version format version dcnl dcsp except requestexception as e dcnl dcsp dcsp if retry count < max retries dcnl dcsp dcsp dcsp return send simple push endpoint version max retries retry count + 1 dcnl dcsp dcsp else dcnl dcsp dcsp dcsp logger error simplepush dcsp put dcsp failed dcsp s e dcnl dcsp dcsp dcsp return dcnl dcsp if r status code 400 dcnl dcsp dcsp try dcnl dcsp dcsp dcsp data r json dcnl dcsp dcsp except simplejson scanner jsondecodeerror dcnl dcsp dcsp dcsp logger error simplepush dcsp error dcsp also dcsp not dcsp json dcsp s dcsp s r status code r text dcnl dcsp dcsp dcsp return dcnl dcsp dcsp if r status code 503 and data errno 202 and retry count < max retries dcnl dcsp dcsp dcsp return send simple push endpoint version max retries retry count + 1 dcnl dcsp dcsp else dcnl dcsp dcsp dcsp logger error simplepush dcsp error dcsp s dcsp s r status code r json
task ignore result true dcnl def send notification notification id dcsp notification notification objects get id notification id dcnl dcsp for handler in notification handlers dcnl dcsp dcsp handler notification
notification handler dcnl def simple push notification dcsp registrations pushnotificationregistration objects filter creator notification owner dcnl dcsp for reg in registrations dcnl dcsp dcsp send simple push reg push url notification id
receiver post save sender action dispatch uid action create notifications dcnl def add notification for action sender instance created kwargs dcsp if not created dcnl dcsp dcsp return dcnl dcsp from kitsune notifications import tasks dcnl dcsp tasks add notification for action delay instance id
def notification handler fn dcsp notification handlers add fn dcnl dcsp return fn
task dcnl timeit dcnl def email private message inbox message id dcsp inbox message inboxmessage objects get id inbox message id dcnl dcsp log debug sending dcsp email dcsp for dcsp user dcsp s inbox message to dcnl dcsp user inbox message to dcnl dcsp safe translation dcnl dcsp def send mail locale dcnl dcsp dcsp from kitsune users templatetags jinja helpers import display name dcnl dcsp dcsp subject u sumo dcsp you dcsp have dcsp a dcsp new dcsp private dcsp message dcsp from dcsp sender dcnl dcsp dcsp subject subject format sender display name inbox message sender dcnl dcsp dcsp msg url reverse messages read kwargs msgid inbox message id dcnl dcsp dcsp settings url reverse users edit settings dcnl dcsp dcsp from kitsune sumo templatetags jinja helpers import add utm dcnl dcsp dcsp context sender inbox message sender message inbox message message message html inbox message content parsed message url add utm msg url messagesnew unsubscribe url add utm settings url messagesnew host site objects get current domain dcnl dcsp dcsp mail make mail subject subject text template messages email private message ltxt html template messages email private message html context vars context from email settings tidings from address to email inbox message to email dcnl dcsp dcsp send messages mail dcnl dcsp if hasattr user profile dcnl dcsp dcsp locale user profile locale dcnl dcsp else dcnl dcsp dcsp locale settings wiki default language dcnl dcsp send mail locale
def send message to text sender none dcsp if sender dcnl dcsp dcsp msg outboxmessage objects create sender sender message text dcnl dcsp dcsp msg to add to dcnl dcsp for user in to dcnl dcsp dcsp im inboxmessage objects create sender sender to user message text dcnl dcsp dcsp if setting get for user user email private messages dcnl dcsp dcsp dcsp email private message inbox message id im id dcnl dcsp message sent send sender inboxmessage to to text text msg sender sender
def unread count for user dcsp return inboxmessage objects filter to user read false count
def unread message count request dcsp count 0 dcnl dcsp if hasattr request user and request user is authenticated dcnl dcsp dcsp count unread count for request user dcnl dcsp return unread message count count
login required dcnl mobile template messages mobile new html dcnl def new message request template dcsp to request get get to dcnl dcsp if to dcnl dcsp dcsp try dcnl dcsp dcsp dcsp for username in to split dcnl dcsp dcsp dcsp dcsp user objects get username username dcnl dcsp dcsp except user doesnotexist dcnl dcsp dcsp dcsp contrib messages add message request contrib messages error invalid dcsp username dcsp provided dcsp enter dcsp a dcsp new dcsp username dcsp below dcnl dcsp dcsp dcsp return httpresponseredirect reverse messages new dcnl dcsp message request get get message dcnl dcsp form messageform request post or none initial to to message message dcnl dcsp if request method post and form is valid and not is ratelimited request primatemessageday 50 d dcnl dcsp dcsp send message form cleaned data to form cleaned data message request user dcnl dcsp dcsp if form cleaned data in reply to dcnl dcsp dcsp dcsp irt form cleaned data in reply to dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp m inboxmessage objects get pk irt to request user dcnl dcsp dcsp dcsp dcsp m update replied true dcnl dcsp dcsp dcsp except inboxmessage doesnotexist dcnl dcsp dcsp dcsp dcsp pass dcnl dcsp dcsp contrib messages add message request contrib messages success your dcsp message dcsp was dcsp sent dcnl dcsp dcsp return httpresponseredirect reverse messages inbox dcnl dcsp return render request template form form
login required dcnl def bulk action request msgtype inbox dcsp msgids request post getlist id dcnl dcsp if len msgids 0 dcnl dcsp dcsp contrib messages add message request contrib messages error no dcsp messages dcsp selected dcsp please dcsp try dcsp again dcnl dcsp elif delete in request post dcnl dcsp dcsp return delete request msgtype msgtype dcnl dcsp elif mark read in request post and msgtype inbox dcnl dcsp dcsp messages inboxmessage objects filter pk in msgids to request user dcnl dcsp dcsp messages update read true dcnl dcsp elif mark unread in request post and msgtype inbox dcnl dcsp dcsp messages inboxmessage objects filter pk in msgids to request user dcnl dcsp dcsp messages update read false dcnl dcsp return redirect messages s msgtype
require post dcnl login required dcnl def preview async request dcsp statsd incr forums preview dcnl dcsp m outboxmessage sender request user message request post get content dcnl dcsp return render request messages includes message preview html message m
def sprint timeline bugs sprint dcsp timeline dcnl dcsp history get history bugs sprint dcnl dcsp for when bug who removed added in history dcnl dcsp dcsp reason no dcsp comment dcnl dcsp dcsp for comment in bug get comments dcnl dcsp dcsp dcsp if comment time when and comment creator who dcnl dcsp dcsp dcsp dcsp reason comment text dcnl dcsp dcsp dcsp dcsp break dcnl dcsp dcsp timeline append when bug id who removed added reason dcnl dcsp timeline sort key lambda item item0 dcnl dcsp for mem in timeline dcnl dcsp dcsp print s dcsp s dcsp s mem0 mem1 mem2 dcnl dcsp dcsp print dcsp dcsp dcsp dcsp s dcsp dcsp s mem3 if mem3 else unassigned mem4 dcnl dcsp dcsp print wrap mem5 dcnl dcsp dcsp print
def activate specifier dcsp try dcnl dcsp dcsp for distro in require specifier dcnl dcsp dcsp dcsp distro activate dcnl dcsp except versionconflict distributionnotfound dcnl dcsp dcsp raise runtimeerror the dcsp installed dcsp version dcsp of dcsp pip dcsp is dcsp too dcsp old dcsp peep dcsp requires dcsp + specifier
def encoded hash sha dcsp return urlsafe b64encode sha digest decode ascii rstrip
def path and line req dcsp path line re match r dcsp dcsp line dcsp d+ req comes from groups dcnl dcsp return path int line
def hashes above path line number dcsp def hash lists path dcnl dcsp dcsp yield dcsp lists dcsp of dcsp hashes dcsp appearing dcsp between dcsp noncomment dcsp lines n n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp the dcsp lists dcsp will dcsp be dcsp in dcsp order dcsp of dcsp appearance dcsp and dcsp for dcsp each dcsp nonempty n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp list dcsp their dcsp place dcsp in dcsp the dcsp results dcsp will dcsp coincide dcsp with dcsp that dcsp of dcsp the n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp line dcsp number dcsp of dcsp the dcsp corresponding dcsp result dcsp from dcsp parse requirements n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp which dcsp changed dcsp in dcsp pip dcsp 7 0 dcsp to dcsp not dcsp count dcsp comments n n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcnl dcsp dcsp hashes dcnl dcsp dcsp with open path as file dcnl dcsp dcsp dcsp for lineno line in enumerate file 1 dcnl dcsp dcsp dcsp dcsp match hash comment re match line dcnl dcsp dcsp dcsp dcsp if match dcnl dcsp dcsp dcsp dcsp dcsp hashes append match groupdict hash dcnl dcsp dcsp dcsp dcsp if not ignored line re match line dcnl dcsp dcsp dcsp dcsp dcsp yield hashes dcnl dcsp dcsp dcsp dcsp dcsp hashes dcnl dcsp dcsp dcsp dcsp elif pip counts comments dcnl dcsp dcsp dcsp dcsp dcsp yield dcnl dcsp return next islice hash lists path line number 1 none
def run pip initial args dcsp status code pip main initial args dcnl dcsp logger consumers dcnl dcsp if status code dcnl dcsp dcsp raise pipexception status code
def hash of file path dcsp with open path rb as archive dcnl dcsp dcsp sha sha256 dcnl dcsp dcsp while true dcnl dcsp dcsp dcsp data archive read 2 20 dcnl dcsp dcsp dcsp if not data dcnl dcsp dcsp dcsp dcsp break dcnl dcsp dcsp dcsp sha update data dcnl dcsp return encoded hash sha
def is git sha text dcsp if len text in 40 7 dcnl dcsp dcsp try dcnl dcsp dcsp dcsp int text 16 dcnl dcsp dcsp dcsp return true dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp pass dcnl dcsp return false
def requirement args argv want paths false want other false dcsp was r false dcnl dcsp for arg in argv dcnl dcsp dcsp if was r dcnl dcsp dcsp dcsp if want paths dcnl dcsp dcsp dcsp dcsp yield arg dcnl dcsp dcsp dcsp was r false dcnl dcsp dcsp elif arg in r requirement dcnl dcsp dcsp dcsp was r true dcnl dcsp dcsp elif want other dcnl dcsp dcsp dcsp yield arg
def peep hash argv dcsp parser optionparser usage usage dcsp prog dcsp hash dcsp file dcsp file dcsp description print dcsp a dcsp peep dcsp hash dcsp line dcsp for dcsp one dcsp or dcsp more dcsp files dcsp for dcsp example dcsp dcsp sha256 dcsp oz42dzy6gowxw8aeldto4grgtw xpdooh484k7i5eoy dcnl dcsp paths parser parse args args argv dcnl dcsp if paths dcnl dcsp dcsp for path in paths dcnl dcsp dcsp dcsp print dcsp sha256 hash of file path dcnl dcsp dcsp return its fine its fine dcnl dcsp else dcnl dcsp dcsp parser print usage dcnl dcsp dcsp return command line error
def memoize func dcsp wraps func dcnl dcsp def memoizer self dcnl dcsp dcsp if not hasattr self cache dcnl dcsp dcsp dcsp self cache dcnl dcsp dcsp if func name not in self cache dcnl dcsp dcsp dcsp self cachefunc name func self dcnl dcsp dcsp return self cachefunc name dcnl dcsp return memoizer
def package finder argv dcsp try dcnl dcsp dcsp command installcommand dcnl dcsp except typeerror dcnl dcsp dcsp from pip baseparser import create main parser dcnl dcsp dcsp command installcommand create main parser dcnl dcsp options loads dumps command parser parse args argv dcnl dcsp possible options find links format control arg allow external allow unverified allow all external allow all prereleases pre process dependency links dcnl dcsp kwargs dcnl dcsp for option in possible options dcnl dcsp dcsp kw attr option if isinstance option tuple else option option dcnl dcsp dcsp value getattr options attr marker dcnl dcsp dcsp if value is not marker dcnl dcsp dcsp dcsp kwargskw value dcnl dcsp index urls options index url + options extra index urls dcnl dcsp if options no index dcnl dcsp dcsp index urls dcnl dcsp index urls + getattr options mirrors dcnl dcsp if hasattr command build session dcnl dcsp dcsp kwargs session command build session options dcnl dcsp return packagefinder index urls index urls kwargs
def bucket things key dcsp ret defaultdict list dcnl dcsp for thing in things dcnl dcsp dcsp retkey thing append thing dcnl dcsp return ret
def first every last iterable first every last dcsp did first false dcnl dcsp for item in iterable dcnl dcsp dcsp if not did first dcnl dcsp dcsp dcsp did first true dcnl dcsp dcsp dcsp first item dcnl dcsp dcsp every item dcnl dcsp if did first dcnl dcsp dcsp last item
def downloaded reqs from path path argv dcsp finder package finder argv dcnl dcsp return downloadedreq req argv finder for req in parse requirements path finder
def peep install argv dcsp output dcnl dcsp out output append dcnl dcsp reqs dcnl dcsp try dcnl dcsp dcsp req paths list requirement args argv want paths true dcnl dcsp dcsp if not req paths dcnl dcsp dcsp dcsp out you dcsp have dcsp to dcsp specify dcsp one dcsp or dcsp more dcsp requirements dcsp files dcsp with dcsp the dcsp r dcsp option dcsp because notherwise dcsp there s dcsp nowhere dcsp for dcsp peep dcsp to dcsp look dcsp up dcsp the dcsp hashes n dcnl dcsp dcsp dcsp return command line error dcnl dcsp dcsp reqs list chain from iterable downloaded reqs from path path argv for path in req paths dcnl dcsp dcsp buckets bucket reqs lambda r r class dcnl dcsp dcsp if any bucketsb for b in error classes dcnl dcsp dcsp dcsp out n dcnl dcsp dcsp printers lambda r out r head lambda r out r error + n lambda r out r foot dcnl dcsp dcsp for c in error classes dcnl dcsp dcsp dcsp first every last bucketsc printers dcnl dcsp dcsp if any bucketsb for b in error classes dcnl dcsp dcsp dcsp out nnot dcsp proceeding dcsp to dcsp installation n dcnl dcsp dcsp dcsp return something went wrong dcnl dcsp dcsp else dcnl dcsp dcsp dcsp for req in bucketsinstallablereq dcnl dcsp dcsp dcsp dcsp req install dcnl dcsp dcsp dcsp first every last bucketssatisfiedreq printers dcnl dcsp dcsp return its fine its fine dcnl dcsp except unsupportedrequirementerror downloaderror as exc dcnl dcsp dcsp out str exc dcnl dcsp dcsp return something went wrong dcnl dcsp finally dcnl dcsp dcsp for req in reqs dcnl dcsp dcsp dcsp req dispose dcnl dcsp dcsp print join output
def peep port paths dcsp if not paths dcnl dcsp dcsp print please dcsp specify dcsp one dcsp or dcsp more dcsp requirements dcsp files dcsp so dcsp i dcsp have dcsp something dcsp to dcsp port n dcnl dcsp dcsp return command line error dcnl dcsp for req in chain from iterable parse requirements path package finder argv for path in paths dcnl dcsp dcsp hashes hexlify urlsafe b64decode hash + encode ascii decode ascii for hash in hashes above path and line req dcnl dcsp dcsp if not hashes dcnl dcsp dcsp dcsp print req req dcnl dcsp dcsp elif len hashes 1 dcnl dcsp dcsp dcsp print s dcsp hash sha256 s req req hashes0 dcnl dcsp dcsp else dcnl dcsp dcsp dcsp print s req req end dcnl dcsp dcsp dcsp for hash in hashes dcnl dcsp dcsp dcsp dcsp print dcsp dcnl dcsp dcsp dcsp dcsp print dcsp dcsp dcsp dcsp hash sha256 s hash end dcnl dcsp dcsp dcsp print
def main dcsp commands hash peep hash install peep install port peep port dcnl dcsp try dcnl dcsp dcsp if len argv 2 and argv1 in commands dcnl dcsp dcsp dcsp return commandsargv1 argv2 dcnl dcsp dcsp else dcnl dcsp dcsp dcsp return pip main dcnl dcsp except pipexception as exc dcnl dcsp dcsp return exc error code
task dcnl def update sumo ctx tag dcsp pre update tag dcnl dcsp update
def count contributors in range queryset users date range dcsp start end date range dcnl dcsp users set o creator for o in queryset filter creator in users created gte start created lt end dcnl dcsp return len users
register tag dcnl def ifhasperm parser token dcsp return permissioncomparisonnode handle token parser token
register tag dcnl def permission form parser token dcsp return permissionformnode handle token parser token approved true
register tag dcnl def permission request form parser token dcsp return permissionformnode handle token parser token approved false
register tag dcnl def get permissions parser token dcsp return permissionsforobjectnode handle token parser token approved true name permissions
register tag dcnl def get permission requests parser token dcsp return permissionsforobjectnode handle token parser token approved false name permission requests
register tag dcnl def get permission parser token dcsp return permissionforobjectnode handle token parser token approved true name permission
register tag dcnl def get permission request parser token dcsp return permissionforobjectnode handle token parser token approved false name permission request
register inclusion tag authority permission delete link html takes context true dcnl def permission delete link context perm dcsp user context request user dcnl dcsp if user is authenticated dcnl dcsp dcsp if user has perm authority delete foreign permissions or user pk perm creator pk dcnl dcsp dcsp dcsp return base link context perm authoritydeletepermission dcnl dcsp return url none
register inclusion tag authority permission request delete link html takes context true dcnl def permission request delete link context perm dcsp user context request user dcnl dcsp if user is authenticated dcnl dcsp dcsp link kwargs base link context perm authoritydeletepermissionrequest dcnl dcsp dcsp if user has perm authority delete permission dcnl dcsp dcsp dcsp link kwargs is requestor false dcnl dcsp dcsp dcsp return link kwargs dcnl dcsp dcsp if not perm approved and perm user user dcnl dcsp dcsp dcsp link kwargs is requestor true dcnl dcsp dcsp dcsp return link kwargs dcnl dcsp return url none
register inclusion tag authority permission request approve link html takes context true dcnl def permission request approve link context perm dcsp user context request user dcnl dcsp if user is authenticated dcnl dcsp dcsp if user has perm authority approve permission requests dcnl dcsp dcsp dcsp return base link context perm authorityapprovepermissionrequest dcnl dcsp return url none
def autodiscover dcsp global loading dcnl dcsp if loading dcnl dcsp dcsp return dcnl dcsp loading true dcnl dcsp import imp dcnl dcsp from django conf import settings dcnl dcsp for app in settings installed apps dcnl dcsp dcsp try dcnl dcsp dcsp dcsp import app dcnl dcsp dcsp dcsp app path sys modulesapp path dcnl dcsp dcsp except attributeerror dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp try dcnl dcsp dcsp dcsp imp find module permissions app path dcnl dcsp dcsp except importerror dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp import s permissions app dcnl dcsp dcsp app path sys modules s permissions app dcnl dcsp loading false
def permission required perm lookup variables kwargs dcsp login url kwargs pop login url settings login url dcnl dcsp redirect field name kwargs pop redirect field name redirect field name dcnl dcsp redirect to login kwargs pop redirect to login true dcnl dcsp def decorate view func dcnl dcsp dcsp def decorated request args kwargs dcnl dcsp dcsp dcsp if request user is authenticated dcnl dcsp dcsp dcsp dcsp params dcnl dcsp dcsp dcsp dcsp for lookup variable in lookup variables dcnl dcsp dcsp dcsp dcsp dcsp if isinstance lookup variable basestring dcnl dcsp dcsp dcsp dcsp dcsp dcsp value kwargs get lookup variable none dcnl dcsp dcsp dcsp dcsp dcsp dcsp if value is none dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp continue dcnl dcsp dcsp dcsp dcsp dcsp dcsp params append value dcnl dcsp dcsp dcsp dcsp dcsp elif isinstance lookup variable tuple list dcnl dcsp dcsp dcsp dcsp dcsp dcsp model lookup varname lookup variable dcnl dcsp dcsp dcsp dcsp dcsp dcsp value kwargs get varname none dcnl dcsp dcsp dcsp dcsp dcsp dcsp if value is none dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp continue dcnl dcsp dcsp dcsp dcsp dcsp dcsp if isinstance model basestring dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp model class get model model split dcnl dcsp dcsp dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp model class model dcnl dcsp dcsp dcsp dcsp dcsp dcsp if model class is none dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp raise valueerror the dcsp given dcsp argument dcsp s dcsp is dcsp not dcsp a dcsp valid dcsp model model dcnl dcsp dcsp dcsp dcsp dcsp dcsp if inspect isclass model class and not issubclass model class model dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp raise valueerror the dcsp argument dcsp s dcsp needs dcsp to dcsp be dcsp a dcsp model model dcnl dcsp dcsp dcsp dcsp dcsp dcsp obj get object or 404 model class lookup value dcnl dcsp dcsp dcsp dcsp dcsp dcsp params append obj dcnl dcsp dcsp dcsp dcsp check get check request user perm dcnl dcsp dcsp dcsp dcsp granted false dcnl dcsp dcsp dcsp dcsp if check is not none dcnl dcsp dcsp dcsp dcsp dcsp granted check params dcnl dcsp dcsp dcsp dcsp if granted or request user has perm perm dcnl dcsp dcsp dcsp dcsp dcsp return view func request args kwargs dcnl dcsp dcsp dcsp if redirect to login dcnl dcsp dcsp dcsp dcsp path urlquote request get full path dcnl dcsp dcsp dcsp dcsp tup login url redirect field name path dcnl dcsp dcsp dcsp dcsp return httpresponseredirect s s s tup dcnl dcsp dcsp dcsp return permission denied request dcnl dcsp dcsp return wraps view func decorated dcnl dcsp return decorate
def permission required or 403 perm args kwargs dcsp kwargs redirect to login false dcnl dcsp return permission required perm args kwargs
def permission denied request template name none extra context none dcsp if template name is none dcnl dcsp dcsp template name 403 html authority 403 html dcnl dcsp context request path request path dcnl dcsp if extra context dcnl dcsp dcsp context update extra context dcnl dcsp return httpresponseforbidden loader render to string template name context context instance requestcontext request
task dcnl transaction atomic dcnl def fetch product icon url ext size size read size 100000 kw dcsp if ext size size dcnl dcsp dcsp resize true dcnl dcsp else dcnl dcsp dcsp resize false dcnl dcsp dcsp size ext size dcnl dcsp try dcnl dcsp dcsp cached im producticon objects get ext url url ext size ext size dcnl dcsp except producticon doesnotexist dcnl dcsp dcsp cached im none dcnl dcsp now datetime now dcnl dcsp if cached im and cached im modified now timedelta days settings product icon expiry dcnl dcsp dcsp log info already dcsp fetched dcsp url dcsp recently dcsp s url dcnl dcsp dcsp return dcnl dcsp tmp dest tempfile namedtemporaryfile delete false dcnl dcsp tmp dst path tmp dest name dcnl dcsp try dcnl dcsp dcsp res requests get url timeout 5 dcnl dcsp dcsp res raise for status dcnl dcsp dcsp for chunk in res iter content read size dcnl dcsp dcsp dcsp tmp dest write chunk dcnl dcsp except attributeerror assertionerror dcnl dcsp dcsp raise dcnl dcsp except dcnl dcsp dcsp tmp dest close dcnl dcsp dcsp os unlink tmp dest name dcnl dcsp dcsp log error fetch product icon dcsp error dcsp with dcsp s url exc info true dcnl dcsp dcsp return dcnl dcsp else dcnl dcsp dcsp tmp dest close dcnl dcsp try dcnl dcsp dcsp valid img format check image tmp dest name url dcnl dcsp dcsp if valid dcnl dcsp dcsp dcsp if resize dcnl dcsp dcsp dcsp dcsp log info resizing dcsp inapp dcsp image dcsp for dcsp url dcsp s url dcnl dcsp dcsp dcsp dcsp tmp dst path resize image tmp dest size dcnl dcsp dcsp dcsp attr dict ext size ext size size size ext url url format img format dcnl dcsp dcsp dcsp if cached im dcnl dcsp dcsp dcsp dcsp cached im update attr dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp cached im producticon objects create attr dcnl dcsp dcsp dcsp log info saving dcsp image dcsp from dcsp url dcsp s url dcnl dcsp dcsp dcsp copy stored file tmp dst path cached im storage path src storage local storage dst storage public storage dcnl dcsp finally dcnl dcsp dcsp os unlink tmp dst path
def make external id product dcsp domain getattr settings domain none dcnl dcsp if not domain dcnl dcsp dcsp domain marketplacedev dcnl dcsp external id domain split 0 dcnl dcsp return 0 1 format external id product pk
def get product jwt product contribution dcsp issued at calendar timegm time gmtime dcnl dcsp product data product product data contribution dcnl dcsp simulation product simulation dcnl dcsp if not simulation and not product data get public id dcnl dcsp dcsp raise valueerror cannot dcsp create dcsp jwt dcsp without dcsp a dcsp cached dcsp public id dcsp for dcsp app dcsp a format a product addon dcnl dcsp token data iss settings app purchase key typ settings app purchase typ aud settings app purchase aud iat issued at exp issued at + 3600 request id product external id name unicode product name defaultlocale product default locale locales product localized properties icons product icons description strip tags product description pricepoint product price name productdata urlencode product data chargebackurl absolutify reverse webpay chargeback postbackurl absolutify reverse webpay postback dcnl dcsp if simulation dcnl dcsp dcsp token data request simulate simulation dcnl dcsp token sign webpay jwt token data dcnl dcsp log debug preparing dcsp webpay dcsp jwt dcsp for dcsp product dcsp p dcsp contrib dcsp c dcsp t format p product id t token data c contribution dcnl dcsp return webpayjwt token contribstatusurl reverse webpaystatus kwargs uuid contribution uuid
api view post dcnl permission classes allowany dcnl def sig check request dcsp issued at calendar timegm time gmtime dcnl dcsp req iss settings app purchase key typ settings sig check typ aud settings app purchase aud iat issued at exp issued at + 3600 request dcnl dcsp return response sig check jwt sign webpay jwt req status 201
task dcnl use master dcnl def update supported locales ids kw dcsp for chunk in chunked ids 50 dcnl dcsp dcsp for app in webapp objects filter id in chunk dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp if app update supported locales dcnl dcsp dcsp dcsp dcsp dcsp log app u updated dcsp supported dcsp locales dcnl dcsp dcsp dcsp except exception dcnl dcsp dcsp dcsp dcsp log app u updating dcsp supported dcsp locales dcsp failed exc info true
cronjobs register dcnl def clean old signed seconds 60 60 dcsp log info removing dcsp old dcsp apps dcsp signed dcsp for dcsp reviewers dcnl dcsp root settings signed apps reviewer path dcnl dcsp now datetime utcnow if storage is remote else datetime now dcnl dcsp for nextroot dirs files in walk storage root storage private storage dcnl dcsp dcsp for fn in files dcnl dcsp dcsp dcsp full os path join nextroot fn dcnl dcsp dcsp dcsp age now private storage modified time full dcnl dcsp dcsp dcsp if age total seconds seconds dcnl dcsp dcsp dcsp dcsp log debug removing dcsp signed dcsp app dcsp s dcsp dsecs dcsp old full age total seconds dcnl dcsp dcsp dcsp dcsp private storage delete full
def get installs app id dcsp popularity period 90 dcnl dcsp client get monolith client dcnl dcsp popular filter range date gte days ago popularity period date isoformat lte days ago 1 date isoformat aggs total installs sum field app installs dcnl dcsp query query filtered query match all filter term appid app id aggregations popular popular region terms field region size len mkt regions all regions aggregations popular popular size 0 dcnl dcsp try dcnl dcsp dcsp res client raw query dcnl dcsp except valueerror as e dcnl dcsp dcsp task log error error dcsp response dcsp from dcsp monolith dcsp 0 format e dcnl dcsp dcsp return dcnl dcsp if aggregations not in res dcnl dcsp dcsp task log error no dcsp installs dcsp for dcsp app dcsp format app id dcnl dcsp dcsp return dcnl dcsp results all res aggregations popular total installs value dcnl dcsp if region in res aggregations dcnl dcsp dcsp for regional res in res aggregations region buckets dcnl dcsp dcsp dcsp region slug regional res key dcnl dcsp dcsp dcsp popular regional res popular total installs value dcnl dcsp dcsp dcsp resultsregion slug popular dcnl dcsp return results
cronjobs register dcnl use master dcnl def update app installs dcsp chunk size 100 dcnl dcsp ids list webapp objects filter status mkt status public disabled by user false values list id flat true dcnl dcsp for chunk in chunked ids chunk size dcnl dcsp dcsp count 0 dcnl dcsp dcsp times dcnl dcsp dcsp reindex ids dcnl dcsp dcsp for app in webapp objects filter id in chunk no transforms dcnl dcsp dcsp dcsp reindex false dcnl dcsp dcsp dcsp count + 1 dcnl dcsp dcsp dcsp now datetime now dcnl dcsp dcsp dcsp t start time time dcnl dcsp dcsp dcsp scores get installs app id dcnl dcsp dcsp dcsp value scores get all dcnl dcsp dcsp dcsp if value 0 dcnl dcsp dcsp dcsp dcsp reindex true dcnl dcsp dcsp dcsp dcsp installs created app popularity get or create region 0 defaults value value dcnl dcsp dcsp dcsp dcsp if not created dcnl dcsp dcsp dcsp dcsp dcsp installs update value value modified now dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp app popularity filter region 0 delete dcnl dcsp dcsp dcsp for region in mkt regions regions dict values dcnl dcsp dcsp dcsp dcsp value scores get region slug dcnl dcsp dcsp dcsp dcsp if value 0 dcnl dcsp dcsp dcsp dcsp dcsp reindex true dcnl dcsp dcsp dcsp dcsp dcsp installs created app popularity get or create region region id defaults value value dcnl dcsp dcsp dcsp dcsp dcsp if not created dcnl dcsp dcsp dcsp dcsp dcsp dcsp installs update value value modified now dcnl dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp app popularity filter region region id delete dcnl dcsp dcsp dcsp if reindex dcnl dcsp dcsp dcsp dcsp reindex ids append app id dcnl dcsp dcsp dcsp times append time time t start dcnl dcsp dcsp if reindex ids dcnl dcsp dcsp dcsp webappindexer run indexing reindex ids dcnl dcsp dcsp log info installs dcsp calculated dcsp for dcsp s dcsp apps dcsp avg dcsp time dcsp overall dcsp 0 2fs count sum times count dcnl dcsp now datetime now dcnl dcsp midnight datetime year now year month now month day now day dcnl dcsp qs installs objects filter modified lte midnight dcnl dcsp purged ids qs values list addon flat true distinct dcnl dcsp qs delete dcnl dcsp for ids in chunked purged ids chunk size dcnl dcsp dcsp webappindexer run indexing ids
def get trending app id dcsp prior week install threshold 100 0 dcnl dcsp client get monolith client dcnl dcsp week1 filter range date gte days ago 8 date isoformat lte days ago 1 date isoformat aggs total installs sum field app installs dcnl dcsp week3 filter range date gte days ago 29 date isoformat lte days ago 9 date isoformat aggs total installs sum field app installs dcnl dcsp query query filtered query match all filter term appid app id aggregations week1 week1 week3 week3 region terms field region size len mkt regions all regions aggregations week1 week1 week3 week3 size 0 dcnl dcsp try dcnl dcsp dcsp res client raw query dcnl dcsp except valueerror as e dcnl dcsp dcsp task log error error dcsp response dcsp from dcsp monolith dcsp 0 format e dcnl dcsp dcsp return dcnl dcsp if aggregations not in res dcnl dcsp dcsp task log error no dcsp installs dcsp for dcsp app dcsp format app id dcnl dcsp dcsp return dcnl dcsp def score week1 week3 dcnl dcsp dcsp if week1 < prior week install threshold dcnl dcsp dcsp dcsp return 0 0 dcnl dcsp dcsp score 0 0 dcnl dcsp dcsp if week3 1 0 dcnl dcsp dcsp dcsp score week1 week3 week3 dcnl dcsp dcsp if score < 0 0 dcnl dcsp dcsp dcsp score 0 0 dcnl dcsp dcsp return score dcnl dcsp week1 res aggregations week1 total installs value dcnl dcsp week3 res aggregations week3 total installs value 3 0 dcnl dcsp if week1 < prior week install threshold dcnl dcsp dcsp return dcnl dcsp results all score week1 week3 dcnl dcsp if region in res aggregations dcnl dcsp dcsp for regional res in res aggregations region buckets dcnl dcsp dcsp dcsp region slug regional res key dcnl dcsp dcsp dcsp week1 regional res week1 total installs value dcnl dcsp dcsp dcsp week3 regional res week3 total installs value 3 0 dcnl dcsp dcsp dcsp resultsregion slug score week1 week3 dcnl dcsp return results
cronjobs register dcnl use master dcnl def update app trending dcsp chunk size 100 dcnl dcsp ids list webapp objects filter status mkt status public disabled by user false values list id flat true dcnl dcsp for chunk in chunked ids chunk size dcnl dcsp dcsp count 0 dcnl dcsp dcsp times dcnl dcsp dcsp reindex ids dcnl dcsp dcsp for app in webapp objects filter id in chunk no transforms dcnl dcsp dcsp dcsp reindex false dcnl dcsp dcsp dcsp count + 1 dcnl dcsp dcsp dcsp now datetime now dcnl dcsp dcsp dcsp t start time time dcnl dcsp dcsp dcsp scores get trending app id dcnl dcsp dcsp dcsp value scores get all dcnl dcsp dcsp dcsp if value 0 dcnl dcsp dcsp dcsp dcsp reindex true dcnl dcsp dcsp dcsp dcsp trending created app trending get or create region 0 defaults value value dcnl dcsp dcsp dcsp dcsp if not created dcnl dcsp dcsp dcsp dcsp dcsp trending update value value modified now dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp app trending filter region 0 delete dcnl dcsp dcsp dcsp for region in mkt regions regions dict values dcnl dcsp dcsp dcsp dcsp value scores get region slug dcnl dcsp dcsp dcsp dcsp if value 0 dcnl dcsp dcsp dcsp dcsp dcsp reindex true dcnl dcsp dcsp dcsp dcsp dcsp trending created app trending get or create region region id defaults value value dcnl dcsp dcsp dcsp dcsp dcsp if not created dcnl dcsp dcsp dcsp dcsp dcsp dcsp trending update value value modified now dcnl dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp app trending filter region region id delete dcnl dcsp dcsp dcsp times append time time t start dcnl dcsp dcsp dcsp if reindex dcnl dcsp dcsp dcsp dcsp reindex ids append app id dcnl dcsp dcsp if reindex ids dcnl dcsp dcsp dcsp webappindexer run indexing reindex ids dcnl dcsp dcsp log info trending dcsp calculated dcsp for dcsp s dcsp apps dcsp avg dcsp time dcsp overall dcsp 0 2fs count sum times count dcnl dcsp now datetime now dcnl dcsp midnight datetime year now year month now month day now day dcnl dcsp qs trending objects filter modified lte midnight dcnl dcsp purged ids qs values list addon flat true distinct dcnl dcsp qs delete dcnl dcsp for ids in chunked purged ids chunk size dcnl dcsp dcsp webappindexer run indexing ids
cronjobs register dcnl def dump user installs cron dcsp chunk size 100 dcnl dcsp user ids set installed objects filter user enable recommendations true values list user flat true dcnl dcsp path to cleanup os path join settings dumped users path users dcnl dcsp task log info cleaning dcsp up dcsp path dcsp 0 format path to cleanup dcnl dcsp try dcnl dcsp dcsp for dirpath dirnames filenames in walk storage path to cleanup storage private storage dcnl dcsp dcsp dcsp for filename in filenames dcnl dcsp dcsp dcsp dcsp private storage delete os path join dirpath filename dcnl dcsp except oserror dcnl dcsp dcsp pass dcnl dcsp grouping dcnl dcsp for chunk in chunked user ids chunk size dcnl dcsp dcsp grouping append dump user installs subtask args chunk dcnl dcsp post zip users subtask immutable true dcnl dcsp ts chord grouping post dcnl dcsp ts apply async
cronjobs register dcnl def mkt gc kw dcsp log info collecting dcsp data dcsp to dcsp delete dcnl dcsp logs activitylog objects filter created lt days ago 90 exclude action in mkt log keep values list id flat true dcnl dcsp for chunk in chunked logs 100 dcnl dcsp dcsp chunk sort dcnl dcsp dcsp log info deleting dcsp log dcsp entries dcsp s str chunk dcnl dcsp dcsp delete logs delay chunk dcnl dcsp nonce objects filter created lt days ago 1 delete dcnl dcsp remove stale files os path join settings dumped apps path tarballs settings dumped apps days delete deleting dcsp old dcsp tarball dcsp 0 storage public storage dcnl dcsp remove stale files os path join settings dumped users path tarballs settings dumped users days delete deleting dcsp old dcsp tarball dcsp 0 storage private storage dcnl dcsp remove stale files os path join settings tmp path preview settings tmp path days delete deleting dcsp tmp path dcsp file dcsp 0 storage private storage dcnl dcsp remove stale files os path join settings tmp path icon settings tmp path days delete deleting dcsp tmp path dcsp file dcsp 0 storage private storage dcnl dcsp for fu in fileupload objects filter created lte days ago 90 dcnl dcsp dcsp log debug u fileupload uuid dcsp removing dcsp file dcsp path format uuid fu uuid path fu path dcnl dcsp dcsp if fu path dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp private storage delete fu path dcnl dcsp dcsp dcsp except oserror dcnl dcsp dcsp dcsp dcsp pass dcnl dcsp dcsp fu delete
def get supported locales manifest dcsp return sorted filter none map find language set manifest get locales keys
def dehydrate content rating rating dcsp try dcnl dcsp dcsp body mkt ratingsbodies dehydrate ratings body mkt ratingsbodies ratings bodiesint rating body dcnl dcsp except typeerror dcnl dcsp dcsp return dcnl dcsp rating mkt ratingsbodies dehydrate rating body ratingsint rating rating dcnl dcsp return rating label
def dehydrate content ratings content ratings dcsp for body in content ratings or dcnl dcsp dcsp content ratingsbody dehydrate content rating content ratingsbody dcnl dcsp return content ratings
def get cached minifest app or langpack force false dcsp cache prefix 1 dcnl dcsp cache key 0 1 2 manifest format cache prefix app or langpack meta model name app or langpack pk dcnl dcsp if not force dcnl dcsp dcsp cached data cache get cache key dcnl dcsp dcsp if cached data dcnl dcsp dcsp dcsp return cached data dcnl dcsp sign if packaged getattr app or langpack sign if packaged none dcnl dcsp if sign if packaged is none dcnl dcsp dcsp signed file path app or langpack file path dcnl dcsp else dcnl dcsp dcsp if not app or langpack current version dcnl dcsp dcsp dcsp return dcnl dcsp dcsp signed file path sign if packaged dcnl dcsp manifest app or langpack get manifest json dcnl dcsp package path app or langpack get package path dcnl dcsp data size public storage size signed file path package path package path dcnl dcsp if hasattr app or langpack current version dcnl dcsp dcsp data version app or langpack current version version dcnl dcsp dcsp data release notes app or langpack current version releasenotes dcnl dcsp dcsp file hash app or langpack current version all files0 hash dcnl dcsp else dcnl dcsp dcsp data version app or langpack version dcnl dcsp dcsp file hash unicode app or langpack file version dcnl dcsp for key in developer icons locales name dcnl dcsp dcsp if key in manifest dcnl dcsp dcsp dcsp datakey manifestkey dcnl dcsp data json dumps data cls jsonencoder dcnl dcsp etag hashlib sha256 dcnl dcsp etag update data dcnl dcsp if file hash dcnl dcsp dcsp etag update file hash dcnl dcsp rval data etag hexdigest dcnl dcsp cache set cache key rval none dcnl dcsp return rval
def clean slug instance slug field app slug dcsp slug getattr instance slug field none or instance name dcnl dcsp if not slug dcnl dcsp dcsp translations translation objects filter id instance name id dcnl dcsp dcsp if translations exists dcnl dcsp dcsp dcsp slug translations0 dcnl dcsp dcsp elif instance id dcnl dcsp dcsp dcsp slug str instance id dcnl dcsp dcsp else dcnl dcsp dcsp dcsp slug instance class name dcnl dcsp max length instance meta get field by name slug field 0 max length dcnl dcsp slug slugify slug max length dcnl dcsp if blockedslug blocked slug dcnl dcsp dcsp slug slug max length 1 + ~ dcnl dcsp manager models manager dcnl dcsp manager model instance meta proxy for model or instance class dcnl dcsp qs manager values list slug field flat true dcnl dcsp if instance id dcnl dcsp dcsp qs qs exclude pk instance id dcnl dcsp clash qs filter slug field slug dcnl dcsp if clash exists dcnl dcsp dcsp slug slugify slug max length 3 dcnl dcsp dcsp prefix s slug dcnl dcsp dcsp lookup s startswith slug field prefix dcnl dcsp dcsp clashes qs filter lookup dcnl dcsp dcsp for idx in range 1 len clashes + 2 dcnl dcsp dcsp dcsp new s s prefix idx max length dcnl dcsp dcsp dcsp if new not in clashes dcnl dcsp dcsp dcsp dcsp slug new dcnl dcsp dcsp dcsp dcsp break dcnl dcsp dcsp else dcnl dcsp dcsp dcsp raise runtimeerror dcnl dcsp setattr instance slug field slug dcnl dcsp return instance
def attach translations addons dcsp attach trans dict webapp addons
def reverse version version dcsp if version dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return reverse versiondetail kwargs pk version pk dcnl dcsp dcsp except attributeerror dcnl dcsp dcsp dcsp return version dcnl dcsp return
webapp on change dcnl def watch status old attr new attr instance none sender none kw dcsp new status new attr get status dcnl dcsp if not new status dcnl dcsp dcsp return dcnl dcsp addon instance dcnl dcsp old status old attr status dcnl dcsp if old status new status dcnl dcsp dcsp log info webapp id dcsp status dcsp changed dcsp from dcsp old status old status name dcsp to dcsp new status new status name format id addon id old status old status old status name mkt status choices api get old status unknown new status new status new status name mkt status choices apinew status dcnl dcsp if new status mkt status pending and old status new status dcnl dcsp dcsp try dcnl dcsp dcsp dcsp latest addon versions latest dcnl dcsp dcsp dcsp log debug webapp s dcsp setting dcsp nomination dcsp date dcsp to dcsp now addon id dcnl dcsp dcsp dcsp latest update nomination datetime datetime now dcnl dcsp dcsp except version doesnotexist dcnl dcsp dcsp dcsp log debug webapp s dcsp missing dcsp version dcsp no dcsp nomination dcsp set addon id
receiver dbsignals post save sender webapp dispatch uid webapp pre generate apk dcnl def pre generate apk sender none instance none kw dcsp if kw get raw dcnl dcsp dcsp return dcnl dcsp if not getattr settings pre generate apks false dcnl dcsp dcsp log info webapp a dcsp apk dcsp pregeneration dcsp is dcsp disabled format a instance id dcnl dcsp dcsp return dcnl dcsp from import tasks dcnl dcsp generated false dcnl dcsp if instance status in mkt webapps approved statuses dcnl dcsp dcsp app devs set d id for d in instance device types dcnl dcsp dcsp if mkt device mobile id in app devs or mkt device tablet id in app devs dcnl dcsp dcsp dcsp tasks pre generate apk delay instance id dcnl dcsp dcsp dcsp generated true dcnl dcsp log info webapp a dcsp apk dcsp pregenerated dcsp result format a instance id result yes if generated else no
memoize prefix get excluded in dcnl def get excluded in region id dcsp aers list addonexcludedregion objects filter region region id values list addon flat true dcnl dcsp geodata qs q dcnl dcsp region parse region region id dcnl dcsp if region in mkt regions bra mkt regions deu dcnl dcsp dcsp geodata qs | q region s iarc exclude region slug true dcnl dcsp if region mkt regions deu dcnl dcsp dcsp geodata qs | q region de usk exclude true dcnl dcsp geodata exclusions dcnl dcsp if geodata qs dcnl dcsp dcsp geodata exclusions list geodata objects filter geodata qs values list addon flat true dcnl dcsp return set aers + geodata exclusions
def has purchased f dcsp functools wraps f dcnl dcsp def wrapper request addon args kw dcnl dcsp dcsp if addon is premium and not addon has purchased request user dcnl dcsp dcsp dcsp log info not dcsp purchased dcsp d addon pk dcnl dcsp dcsp dcsp raise permissiondenied dcnl dcsp dcsp return f request addon args kw dcnl dcsp return wrapper
def can become premium f dcsp functools wraps f dcnl dcsp def wrapper request addon id addon args kw dcnl dcsp dcsp if not addon can become premium dcnl dcsp dcsp dcsp log info cannot dcsp become dcsp premium dcsp d addon pk dcnl dcsp dcsp dcsp raise permissiondenied dcnl dcsp dcsp return f request addon id addon args kw dcnl dcsp return wrapper
def app view factory qs dcsp return functools partial app view qs qs
def reverse version version dcsp if version dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return reverse versiondetail kwargs pk version pk dcnl dcsp dcsp except attributeerror dcnl dcsp dcsp dcsp return version dcnl dcsp return
def get task user dcsp return userprofile objects get pk settings task user id
transaction atomic dcnl def create user email group name none overwrite false oauth key none oauth secret none dcsp profile created userprofile objects get or create email email source mkt login source unknown display name email dcnl dcsp if not profile read dev agreement dcnl dcsp dcsp profile read dev agreement datetime datetime now dcnl dcsp dcsp profile save dcnl dcsp if group name and not profile groups filter groupuser group name group name exists dcnl dcsp dcsp group group objects get name group name dcnl dcsp dcsp groupuser objects create group group user profile dcnl dcsp if overwrite dcnl dcsp dcsp access objects filter user profile user delete dcnl dcsp if not access objects filter user profile exists dcnl dcsp dcsp if oauth key and oauth secret dcnl dcsp dcsp dcsp access objects create user profile key oauth key secret oauth secret dcnl dcsp dcsp else dcnl dcsp dcsp dcsp if oauth key or oauth secret dcnl dcsp dcsp dcsp dcsp raise valueerror specify dcsp both dcsp of dcsp oauth key dcsp and dcsp oauth secret dcsp or dcsp neither dcnl dcsp dcsp dcsp access create for user profile dcnl dcsp return profile
login required redirect false dcnl json view dcnl def ajax request dcsp if q not in request get dcnl dcsp dcsp raise http http404 dcnl dcsp data status 0 message dcnl dcsp email request get get q strip dcnl dcsp dev only request get get dev 1 dcnl dcsp try dcnl dcsp dcsp dev only int dev only dcnl dcsp except valueerror dcnl dcsp dcsp dev only 1 dcnl dcsp if not email dcnl dcsp dcsp data update message an dcsp email dcsp address dcsp is dcsp required dcnl dcsp dcsp return data dcnl dcsp user userprofile objects filter email email dcnl dcsp if dev only dcnl dcsp dcsp user user exclude read dev agreement none dcnl dcsp msg a dcsp user dcsp with dcsp that dcsp email dcsp address dcsp does dcsp not dcsp exist dcnl dcsp msg dev a dcsp user dcsp with dcsp that dcsp email dcsp address dcsp does dcsp not dcsp exist dcsp or dcsp the dcsp user dcsp has dcsp not dcsp yet dcsp accepted dcsp the dcsp developer dcsp agreement dcnl dcsp if user dcnl dcsp dcsp data update status 1 id user0 id name user0 name dcnl dcsp else dcnl dcsp dcsp data message msg dev if dev only else msg dcnl dcsp return escape all data
def browserid authenticate request assertion is mobile false browserid audience get audience dcsp extra params dcnl dcsp url settings native fxa verification url dcnl dcsp log debug verifying dcsp native dcsp fxa dcsp at dcsp s dcsp audience dcsp s dcsp extra params dcsp s url browserid audience extra params dcnl dcsp v browseridbackend get verifier dcnl dcsp v verification service url url dcnl dcsp result v verify assertion browserid audience url url extra params dcnl dcsp if not result dcnl dcsp dcsp return none native dcsp fxa dcsp authentication dcsp failure dcnl dcsp if unverifiedemail in result response dcnl dcsp dcsp email result response unverifiedemail dcnl dcsp dcsp verified false dcnl dcsp elif result response get issuer settings native fxa issuer and fxaverifiedemail in result response get idpclaims dcnl dcsp dcsp email result response idpclaims fxaverifiedemail dcnl dcsp dcsp verified true dcnl dcsp else dcnl dcsp dcsp email result email dcnl dcsp dcsp verified true dcnl dcsp try dcnl dcsp dcsp profile userprofile objects filter email email 0 dcnl dcsp except indexerror dcnl dcsp dcsp profile none dcnl dcsp if profile dcnl dcsp dcsp if profile is verified and not verified dcnl dcsp dcsp dcsp log debug verified dcsp user dcsp s dcsp attempted dcsp to dcsp log dcsp in dcsp with dcsp an dcsp unverified dcsp assertion profile dcnl dcsp dcsp dcsp return none please dcsp use dcsp the dcsp verified dcsp email dcsp for dcsp this dcsp account dcnl dcsp dcsp else dcnl dcsp dcsp dcsp profile is verified verified dcnl dcsp dcsp dcsp profile save dcnl dcsp dcsp return profile none dcnl dcsp source mkt login source mmo browserid dcnl dcsp display name email partition 0 dcnl dcsp profile userprofile objects create email email source source display name display name is verified verified dcnl dcsp log cef new dcsp account 5 request username display name signature authnotice msg user dcsp created dcsp a dcsp new dcsp account dcsp from dcsp persona dcnl dcsp record action newuser request dcnl dcsp return profile none
def run validator file path url none dcsp temp path none dcnl dcsp temp path tempfile mktemp dcnl dcsp copy stored file file path temp path src storage private storage dst storage local storage dcnl dcsp with statsd timer mkt developers validator dcnl dcsp dcsp is packaged zipfile is zipfile temp path dcnl dcsp dcsp if is packaged dcnl dcsp dcsp dcsp log info u running dcsp validate packaged app dcsp for dcsp path dcsp s file path dcnl dcsp dcsp dcsp with statsd timer mkt developers validate packaged app dcnl dcsp dcsp dcsp dcsp return validate packaged app temp path market urls settings validator iaf urls timeout settings validator timeout spidermonkey settings spidermonkey dcnl dcsp dcsp else dcnl dcsp dcsp dcsp log info u running dcsp validate app dcsp for dcsp path dcsp s file path dcnl dcsp dcsp dcsp with statsd timer mkt developers validate app dcnl dcsp dcsp dcsp dcsp return validate app open temp path read market urls settings validator iaf urls url url dcnl dcsp os unlink temp path
task dcnl use master dcnl set modified on dcnl def resize icon src dst sizes src storage private storage dst storage public storage kw dcsp log info 1 none dcsp resizing dcsp icon dcsp s dst dcnl dcsp try dcnl dcsp dcsp for s in sizes dcnl dcsp dcsp dcsp size dst s s png dst s dcnl dcsp dcsp dcsp resize image src size dst s s remove src false src storage src storage dst storage dst storage dcnl dcsp dcsp dcsp pngcrush image delay size dst storage dst storage kw dcnl dcsp dcsp with src storage open src as fd dcnl dcsp dcsp dcsp icon hash hash file fd dcnl dcsp dcsp src storage delete src dcnl dcsp dcsp log info icon dcsp resizing dcsp completed dcsp for dcsp s dst dcnl dcsp dcsp return icon hash icon hash dcnl dcsp except exception as e dcnl dcsp dcsp log error error dcsp resizing dcsp icon dcsp s dcsp s e dst
task dcnl use master dcnl set modified on dcnl def resize promo imgs src dst sizes kw dcsp log info 1 none dcsp resizing dcsp promo dcsp imgs dcsp s dst dcnl dcsp try dcnl dcsp dcsp for s in sizes dcnl dcsp dcsp dcsp size dst s s png dst s dcnl dcsp dcsp dcsp resize image src size dst s 0 remove src false dcnl dcsp dcsp dcsp pngcrush image delay size dst kw dcnl dcsp dcsp with private storage open src as fd dcnl dcsp dcsp dcsp promo img hash hash file fd dcnl dcsp dcsp private storage delete src dcnl dcsp dcsp log info promo dcsp img dcsp hash dcsp resizing dcsp completed dcsp for dcsp s dst dcnl dcsp dcsp return promo img hash promo img hash dcnl dcsp except exception as e dcnl dcsp dcsp log error error dcsp resizing dcsp promo dcsp img dcsp hash dcsp s dcsp s e dst
task dcnl use master dcnl set modified on dcnl def pngcrush image src hash field image hash storage public storage kw dcsp log info 1 none dcsp optimizing dcsp image dcsp s src dcnl dcsp tmp src tempfile namedtemporaryfile suffix png dcnl dcsp with storage open src as srcf dcnl dcsp dcsp shutil copyfileobj srcf tmp src dcnl dcsp dcsp tmp src seek 0 dcnl dcsp try dcnl dcsp dcsp suffix opti png dcnl dcsp dcsp tmp path s s os path splitext tmp src name 0 suffix dcnl dcsp dcsp cmd settings pngcrush bin q rem alla brute reduce e suffix tmp src name dcnl dcsp dcsp sp subprocess popen cmd stdin subprocess pipe stdout subprocess pipe stderr subprocess pipe dcnl dcsp dcsp stdout stderr sp communicate dcnl dcsp dcsp if sp returncode 0 dcnl dcsp dcsp dcsp log error error dcsp optimizing dcsp image dcsp s dcsp s src stderr strip dcnl dcsp dcsp dcsp kw storage storage dcnl dcsp dcsp dcsp pngcrush image retry args src kwargs kw max retries 3 dcnl dcsp dcsp dcsp return false dcnl dcsp dcsp with open tmp path as fd dcnl dcsp dcsp dcsp image hash hash file fd dcnl dcsp dcsp copy stored file tmp path src src storage local storage dst storage storage dcnl dcsp dcsp log info image dcsp optimization dcsp completed dcsp for dcsp s src dcnl dcsp dcsp os remove tmp path dcnl dcsp dcsp tmp src close dcnl dcsp dcsp return hash field image hash dcnl dcsp except exception as e dcnl dcsp dcsp log error error dcsp optimizing dcsp image dcsp s dcsp s src e dcnl dcsp return
task dcnl use master dcnl set modified on dcnl def resize preview src pk kw dcsp instance preview objects get pk pk dcnl dcsp thumb dst full dst instance thumbnail path instance image path dcnl dcsp sizes instance sizes or dcnl dcsp log info 1 none dcsp resizing dcsp preview dcsp and dcsp storing dcsp size dcsp s thumb dst dcnl dcsp try dcnl dcsp dcsp thumbnail size app preview sizes0 2 dcnl dcsp dcsp image size app preview sizes1 2 dcnl dcsp dcsp with private storage open src rb as fp dcnl dcsp dcsp dcsp size image open fp size dcnl dcsp dcsp if size0 size1 dcnl dcsp dcsp dcsp thumbnail size thumbnail size 1 dcnl dcsp dcsp dcsp image size image size 1 dcnl dcsp dcsp if kw get generate thumbnail true dcnl dcsp dcsp dcsp sizes thumbnail resize image src thumb dst thumbnail size remove src false dcnl dcsp dcsp if kw get generate image true dcnl dcsp dcsp dcsp sizes image resize image src full dst image size remove src false dcnl dcsp dcsp instance sizes sizes dcnl dcsp dcsp instance save dcnl dcsp dcsp log info preview dcsp resized dcsp to dcsp s thumb dst dcnl dcsp dcsp private storage delete src dcnl dcsp dcsp return true dcnl dcsp except exception as e dcnl dcsp dcsp log error error dcsp saving dcsp preview dcsp s dcsp s e thumb dst
def save icon obj icon content sizes mkt content icon sizes dcsp tmp dst os path join settings tmp path icon uuid uuid4 hex dcnl dcsp with public storage open tmp dst wb as fd dcnl dcsp dcsp fd write icon content dcnl dcsp dirname obj get icon dir dcnl dcsp destination os path join dirname s obj pk dcnl dcsp remove icons destination dcnl dcsp icon hash resize icon tmp dst destination sizes set modified on obj src storage public storage dst storage public storage dcnl dcsp obj icon hash icon hash icon hash dcnl dcsp try dcnl dcsp dcsp obj icon type image png dcnl dcsp except attributeerror dcnl dcsp dcsp pass dcnl dcsp obj save
def save promo imgs obj img content dcsp tmp dst os path join settings tmp path promo imgs uuid uuid4 hex dcnl dcsp with private storage open tmp dst wb as fd dcnl dcsp dcsp fd write img content dcnl dcsp dirname obj get promo img dir dcnl dcsp destination os path join dirname s obj pk dcnl dcsp remove promo imgs destination dcnl dcsp resize promo imgs tmp dst destination mkt promo img sizes set modified on obj
task dcnl use master dcnl def fetch icon pk file pk none kw dcsp webapp webapp objects get pk pk dcnl dcsp log info u 1 none dcsp fetching dcsp icon dcsp for dcsp webapp dcsp s webapp name dcnl dcsp if file pk dcnl dcsp dcsp file obj file objects get pk file pk dcnl dcsp else dcnl dcsp dcsp file obj webapp current version and webapp current version all files0 dcnl dcsp manifest webapp get manifest json file obj dcnl dcsp if not manifest or icons not in manifest dcnl dcsp dcsp webapp update icon type dcnl dcsp dcsp return dcnl dcsp try dcnl dcsp dcsp biggest max int size for size in manifest icons dcnl dcsp except valueerror dcnl dcsp dcsp log error no dcsp icon dcsp to dcsp fetch dcsp for dcsp webapp dcsp s webapp name dcnl dcsp dcsp return false dcnl dcsp icon url manifest icons str biggest dcnl dcsp if icon url startswith data image dcnl dcsp dcsp image string icon url split base64 1 dcnl dcsp dcsp content base64 decodestring image string dcnl dcsp elif webapp is packaged dcnl dcsp dcsp if icon url startswith dcnl dcsp dcsp dcsp icon url icon url1 dcnl dcsp dcsp try dcnl dcsp dcsp dcsp zf safeunzip private storage open file obj file path dcnl dcsp dcsp dcsp zf is valid dcnl dcsp dcsp dcsp content zf extract path icon url dcnl dcsp dcsp except keyerror forms validationerror dcnl dcsp dcsp dcsp log error u webapp s dcsp icon dcsp s dcsp not dcsp found dcsp in dcsp archive webapp icon url dcnl dcsp dcsp dcsp return false dcnl dcsp else dcnl dcsp dcsp if not urlparse urlparse icon url scheme dcnl dcsp dcsp dcsp icon url webapp origin + icon url dcnl dcsp dcsp try dcnl dcsp dcsp dcsp response fetch content icon url dcnl dcsp dcsp except exception as e dcnl dcsp dcsp dcsp log error u webapp s dcsp failed dcsp to dcsp fetch dcsp icon dcsp for dcsp webapp dcsp s webapp e dcnl dcsp dcsp dcsp webapp update icon type dcnl dcsp dcsp dcsp return false dcnl dcsp dcsp try dcnl dcsp dcsp dcsp content get content and check size response settings max icon upload size dcnl dcsp dcsp except responsetoolargeexception dcnl dcsp dcsp dcsp log warning u webapp s dcsp icon dcsp exceeds dcsp maximum dcsp size webapp dcnl dcsp dcsp dcsp return false dcnl dcsp log info icon dcsp fetching dcsp completed dcsp for dcsp app dcsp s dcsp saving dcsp icon webapp name dcnl dcsp save icon webapp content
def failed validation messages kwargs dcsp upload kwargs pop upload none dcnl dcsp if upload is none or not upload validation dcnl dcsp dcsp msgs dcnl dcsp else dcnl dcsp dcsp msgs json loads upload validation messages dcnl dcsp for msg in messages dcnl dcsp dcsp msgs append type error message msg tier 1 dcnl dcsp return json dumps errors sum 1 for m in msgs if m type error success false messages msgs prelim true
cronjobs register dcnl def send new region emails regions dcsp region ids r id for r in regions dcnl dcsp excluded addonexcludedregion objects filter region in region ids values list addon flat true dcnl dcsp ids webapp objects exclude id in excluded filter enable new regions true values list id flat true dcnl dcsp region email ids region ids
cronjobs register dcnl def exclude new region regions dcsp region ids r id for r in regions dcnl dcsp excluded set addonexcludedregion objects filter region in region ids values list addon flat true dcnl dcsp ids webapp objects exclude id in excluded filter enable new regions false values list id flat true dcnl dcsp region exclude ids region ids
def flag rereview adult app ratings body rating dcsp old rating app content ratings filter ratings body ratings body id dcnl dcsp if not old rating exists dcnl dcsp dcsp return dcnl dcsp if rating adult and not old rating0 get rating adult dcnl dcsp dcsp rereviewqueue flag app mkt log content rating to adult message content dcsp rating dcsp changed dcsp to dcsp adult
def uri to pk uri dcsp return uri rstrip split 1
def escalate prerelease permissions app validation version dcsp app permissions validation get permissions or dcnl dcsp if any perm in prerelease permissions for perm in app permissions dcnl dcsp dcsp nobody userprofile objects get email settings nobody email address dcnl dcsp dcsp escalate app app version nobody app dcsp uses dcsp prerelease dcsp permissions mkt log escalation prerelease app
def restore app status app save true dcsp log info changing dcsp app dcsp from dcsp incomplete dcsp to dcsp previous dcsp status dcsp d app pk dcnl dcsp app status app highest status if app highest status mkt status null else mkt status pending dcnl dcsp if save dcnl dcsp dcsp app save
def test resize icon shrink dcsp resize size 32 dcnl dcsp final size 32 12 dcnl dcsp uploader resize size final size
def test resize icon enlarge dcsp resize size 1000 dcnl dcsp final size 339 128 dcnl dcsp uploader resize size final size
def test resize icon same dcsp resize size 339 dcnl dcsp final size 339 128 dcnl dcsp uploader resize size final size
def test resize icon list dcsp resize size 32 82 100 dcnl dcsp final size 32 12 82 30 100 37 dcnl dcsp uploader resize size final size
def test resize promo img dcsp resize size 1050 dcnl dcsp final size 1050 591 640 360 320 180 dcnl dcsp promo img uploader resize size final size
def mock hide 64px icon path args kwargs dcsp if 128 in path dcnl dcsp dcsp raise ioerror no dcsp 128px dcsp icon dcsp for dcsp you dcnl dcsp return storage open path args kwargs
def get uuid prefix dcsp if settings debug dcnl dcsp dcsp return prefix + str uuid uuid4 dcnl dcsp return str uuid uuid4
def account check f dcsp def wrapper self args kwargs dcnl dcsp dcsp for arg in args dcnl dcsp dcsp dcsp if isinstance arg paymentaccount and arg provider self provider dcnl dcsp dcsp dcsp dcsp raise valueerror wrong dcsp account dcsp 0 dcsp dcsp 1 format arg provider self provider dcnl dcsp dcsp return f self args kwargs dcnl dcsp return wrapper
def get provider name none id none dcsp if id is not none dcnl dcsp dcsp provider all providers by idid dcnl dcsp else dcnl dcsp dcsp if name is none dcnl dcsp dcsp dcsp name settings default payment provider dcnl dcsp dcsp provider all providersname dcnl dcsp if provider name not in settings payment providers dcnl dcsp dcsp raise improperlyconfigured the dcsp provider dcsp p dcsp is dcsp not dcsp one dcsp of dcsp the dcsp allowed dcsp payment providers format p provider name dcnl dcsp return provider
register function dcnl jinja2 contextfunction dcnl def hub page title context title none addon none dcsp if addon dcnl dcsp dcsp title u s dcsp | dcsp s title addon name dcnl dcsp else dcnl dcsp dcsp devhub developers dcnl dcsp dcsp title s dcsp | dcsp s title devhub if title else devhub dcnl dcsp return page title context title
register function dcnl jinja2 contextfunction dcnl def hub breadcrumbs context addon none items none add default false dcsp crumbs reverse ecosystem landing developers dcnl dcsp title my dcsp submissions dcnl dcsp link reverse mkt developers apps dcnl dcsp if addon dcnl dcsp dcsp if not addon and not items dcnl dcsp dcsp dcsp crumbs append none title dcnl dcsp dcsp else dcnl dcsp dcsp dcsp crumbs append link title dcnl dcsp dcsp if items dcnl dcsp dcsp dcsp url addon get dev url dcnl dcsp dcsp else dcnl dcsp dcsp dcsp url none dcnl dcsp dcsp crumbs append url addon name dcnl dcsp if items dcnl dcsp dcsp crumbs extend items dcnl dcsp if len crumbs 1 dcnl dcsp dcsp crumbs dcnl dcsp return mkt breadcrumbs context items crumbs
def dev required owner for post false allow editors false support false webapp false skip submit check false staff false dcsp def decorator f dcnl dcsp dcsp app view dcnl dcsp dcsp login required dcnl dcsp dcsp functools wraps f dcnl dcsp dcsp def wrapper request addon args kw dcnl dcsp dcsp dcsp from mkt submit views import resume dcnl dcsp dcsp dcsp def fun dcnl dcsp dcsp dcsp dcsp return f request addon id addon id addon addon args kw dcnl dcsp dcsp dcsp if allow editors and acl check reviewer request dcnl dcsp dcsp dcsp dcsp return fun dcnl dcsp dcsp dcsp if staff and acl action allowed request apps configure or acl action allowed request apps viewconfiguration dcnl dcsp dcsp dcsp dcsp return fun dcnl dcsp dcsp dcsp if support dcnl dcsp dcsp dcsp dcsp if acl check addon ownership request addon support true or acl check addon ownership request addon dev true dcnl dcsp dcsp dcsp dcsp dcsp return fun dcnl dcsp dcsp dcsp elif request method post dcnl dcsp dcsp dcsp dcsp if acl check addon ownership request addon dev not owner for post dcnl dcsp dcsp dcsp dcsp dcsp return fun dcnl dcsp dcsp dcsp elif acl check addon ownership request addon viewer true ignore disabled true dcnl dcsp dcsp dcsp dcsp if not skip submit check dcnl dcsp dcsp dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp dcsp dcsp step addon appsubmissionchecklist get next dcnl dcsp dcsp dcsp dcsp dcsp except objectdoesnotexist dcnl dcsp dcsp dcsp dcsp dcsp dcsp step none dcnl dcsp dcsp dcsp dcsp dcsp if not getattr f submitting false and step dcnl dcsp dcsp dcsp dcsp dcsp dcsp return resume addon step dcnl dcsp dcsp dcsp dcsp return fun dcnl dcsp dcsp dcsp raise permissiondenied dcnl dcsp dcsp return wrapper dcnl dcsp if callable owner for post dcnl dcsp dcsp f owner for post dcnl dcsp dcsp owner for post false dcnl dcsp dcsp return decorator f dcnl dcsp else dcnl dcsp dcsp return decorator
def addon listing request dcsp qs request user addons all dcnl dcsp sorting name dcnl dcsp if request get get sort created dcnl dcsp dcsp sorting created dcnl dcsp dcsp qs qs order by created dcnl dcsp else dcnl dcsp dcsp qs order by translation qs name dcnl dcsp return qs sorting
def ratings success msg app old status old modified dcsp if old modified dcnl dcsp dcsp old modified datetime strptime old modified y m dt h m s dcnl dcsp if old status app status dcnl dcsp dcsp return submission msgs complete dcnl dcsp elif old modified app last rated time dcnl dcsp dcsp return submission msgs content ratings saved
login required dcnl def upload manifest args kwargs dcsp return upload manifest args kwargs
def make validation result data dcsp if not settings expose validator tracebacks dcnl dcsp dcsp if data error dcnl dcsp dcsp dcsp data error an dcsp error dcsp occurred dcsp validating dcsp the dcsp manifest dcnl dcsp if data validation dcnl dcsp dcsp for msg in data validation messages dcnl dcsp dcsp dcsp for k v in msg items dcnl dcsp dcsp dcsp dcsp msgk escape all v linkify k in message description dcnl dcsp return data
app view dcnl require post dcnl permission required admin apps configure dcnl def blocklist request addon dcsp if addon status mkt status blocked dcnl dcsp dcsp addon create blocklisted version dcnl dcsp dcsp messages success request created dcsp blocklisted dcsp version dcnl dcsp else dcnl dcsp dcsp messages info request app dcsp already dcsp blocklisted dcnl dcsp return redirect addon get dev url versions
def filter transactions qs data dcsp filter mapping app addon id transaction type type transaction id uuid date from created gte date to created lte dcnl dcsp for form field db field in filter mapping iteritems dcnl dcsp dcsp if data get form field dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp qs qs filter db field dataform field dcnl dcsp dcsp dcsp except valueerror dcnl dcsp dcsp dcsp dcsp continue dcnl dcsp return qs
def reverse viewname args none kwargs none request none format none extra dcsp if format is not none dcnl dcsp dcsp kwargs kwargs or dcnl dcsp dcsp kwargs format format dcnl dcsp return reverse viewname args args kwargs kwargs extra
def custom exception handler exc context none dcsp if settings debug propagate exceptions dcnl dcsp dcsp raise dcnl dcsp response exception handler exc context dcnl dcsp if response is none dcnl dcsp dcsp data detail internal dcsp server dcsp error dcnl dcsp dcsp if getattr settings api show tracebacks settings debug dcnl dcsp dcsp dcsp import traceback dcnl dcsp dcsp dcsp import sys dcnl dcsp dcsp dcsp data error message unicode exc dcnl dcsp dcsp dcsp data traceback n join traceback format exception sys exc info dcnl dcsp dcsp request getattr exc request none dcnl dcsp dcsp klass getattr exc klass none dcnl dcsp dcsp got request exception send klass request request dcnl dcsp dcsp response response data status status http 500 internal server error dcnl dcsp return response
def include version version dcsp kwargs dcnl dcsp if version settings api current version dcnl dcsp dcsp kwargs namespace apiv d version dcnl dcsp return include mkt api v d urls version kwargs
cors api view get dcnl permission classes allowany dcnl def site config request dcsp def serialized data cls dcnl dcsp dcsp as list cls cls meta model objects all order by name many true data dcnl dcsp dcsp return dict d name d for d in as list dcnl dcsp if request get get serializer commonplace dcnl dcsp dcsp data waffle switches list waffle models switch objects filter active true values list name flat true dcnl dcsp else dcnl dcsp dcsp data settings get settings version getattr settings build id js waffle switches serialized data switchserializer flags serialized data flagserializer dcnl dcsp fxa auth state fxa auth url fxa auth info dcnl dcsp data fxa fxa auth state fxa auth state fxa auth url fxa auth url dcnl dcsp return response data
def validate 2legged oauth oauth uri method auth header dcsp req request uri method auth header dcnl dcsp typ params oauth params oauth get signature type and params req dcnl dcsp oauth params dict oauth params dcnl dcsp req params filter lambda x x0 not in oauth signature realm params dcnl dcsp req signature oauth params get oauth signature dcnl dcsp req client key oauth params get oauth consumer key dcnl dcsp req nonce oauth params get oauth nonce dcnl dcsp req timestamp oauth params get oauth timestamp dcnl dcsp if oauth params get oauth signature method lower hmacsha1 dcnl dcsp dcsp raise twoleggedoautherror u unsupported dcsp signature dcsp method dcsp + oauth params get oauth signature method dcnl dcsp secret validator get client secret req client key req dcnl dcsp valid signature signature verify hmac sha1 req secret none dcnl dcsp if valid signature dcnl dcsp dcsp return req client key dcnl dcsp else dcnl dcsp dcsp raise twoleggedoautherror u cannot dcsp find dcsp apiaccess dcsp token dcsp with dcsp that dcsp key dcsp s req client key
def get user hash request dcsp ip request meta get remote addr dcnl dcsp ua request meta get useragent dcnl dcsp session key request session session key or dcnl dcsp return hashlib sha1 join map str ip ua session key hexdigest
def record stat key request data dcsp if recorded in data dcnl dcsp dcsp recorded data pop recorded dcnl dcsp else dcnl dcsp dcsp recorded datetime datetime utcnow dcnl dcsp if not data dcnl dcsp dcsp raise valueerror you dcsp should dcsp at dcsp least dcsp define dcsp one dcsp value dcnl dcsp record monolithrecord key key user hash get user hash request recorded recorded value json dumps data dcnl dcsp record save dcnl dcsp return record
def fireplace route path name none dcsp kwargs dcnl dcsp if name dcnl dcsp dcsp kwargs name name dcnl dcsp return url ^ s path views commonplace repo fireplace kwargs
gzip page dcnl cache control max age settings cache middleware seconds dcnl def commonplace request repo kwargs dcsp if repo not in settings frontend repos dcnl dcsp dcsp raise http404 dcnl dcsp build id get build id repo dcnl dcsp ua request meta get http user agent lower dcnl dcsp include splash false dcnl dcsp detect region with geoip false dcnl dcsp if repo fireplace dcnl dcsp dcsp include splash true dcnl dcsp dcsp has sim info in query mccs in request get or mcc in request get and mnc in request get dcnl dcsp dcsp if not has sim info in query dcnl dcsp dcsp dcsp detect region with geoip true dcnl dcsp fxa auth state fxa auth url fxa auth info dcnl dcsp site settings dev pay providers settings dev pay providers fxa auth state fxa auth state fxa auth url fxa auth url dcnl dcsp ctx build id build id lang request lang langdir lang dir request lang include splash include splash repo repo robots googlebot in ua site settings site settings newrelic header newrelic agent get browser timing header newrelic footer newrelic agent get browser timing footer dcnl dcsp if repo fireplace dcnl dcsp dcsp resolved url resolve request path dcnl dcsp dcsp if resolved url url name detail dcnl dcsp dcsp dcsp ctx add app ctx ctx resolved url kwargs app slug dcnl dcsp ctx waffle switches list waffle models switch objects filter active true values list name flat true dcnl dcsp media url urlparse settings media url dcnl dcsp if media url netloc dcnl dcsp dcsp ctx media origin media url scheme + + media url netloc dcnl dcsp if detect region with geoip dcnl dcsp dcsp region middleware regionmiddleware dcnl dcsp dcsp ctx geoip region region middleware region from request request dcnl dcsp if repo marketplacetvfrontend dcnl dcsp dcsp return render request commonplace index tv html ctx dcnl dcsp elif repo in settings react repos dcnl dcsp dcsp return render request commonplace index react html ctx dcnl dcsp elif repo in settings commonplace repos dcnl dcsp dcsp return render request commonplace index html ctx
def fxa authorize request dcsp return render request commonplace fxa authorize html
def add app ctx ctx app slug dcsp try dcnl dcsp dcsp app webapp objects get app slug app slug dcnl dcsp dcsp ctx app app dcnl dcsp except webapp doesnotexist dcnl dcsp dcsp pass dcnl dcsp return ctx
cronjobs register dcnl def cleanup validation results dcsp all filevalidation objects all dcnl dcsp log info removing dcsp s dcsp old dcsp validation dcsp results all count dcnl dcsp all delete
def get filepath fileorpath dcsp if hasattr fileorpath path dcnl dcsp dcsp return fileorpath path dcnl dcsp return fileorpath
def get file fileorpath dcsp if hasattr fileorpath path dcnl dcsp dcsp return private storage open fileorpath path dcnl dcsp if hasattr fileorpath name dcnl dcsp dcsp return fileorpath dcnl dcsp raise valueerror not dcsp a dcsp file dcsp or dcsp upload
def extract zip source dcsp tempdir tempfile mkdtemp dcnl dcsp zip safeunzip source dcnl dcsp try dcnl dcsp dcsp if zip is valid dcnl dcsp dcsp dcsp zip extract to dest tempdir dcnl dcsp except dcnl dcsp dcsp rm local tmp dir tempdir dcnl dcsp dcsp raise dcnl dcsp return tempdir
def copy over source dest dcsp if os path exists dest and os path isdir dest dcnl dcsp dcsp shutil rmtree dest dcnl dcsp shutil copytree source dest dcnl dcsp os chmod dest stat s irwxu | stat s irgrp | stat s ixgrp | stat s iroth | stat s ixoth dcnl dcsp shutil rmtree source
def parse addon pkg addon none dcsp return webappparser parse pkg
def get hash filename block size 2 20 hash hashlib md5 dcsp f private storage open filename rb dcnl dcsp hash hash dcnl dcsp while true dcnl dcsp dcsp data f read block size dcnl dcsp dcsp if not data dcnl dcsp dcsp dcsp break dcnl dcsp dcsp hash update data dcnl dcsp return hash hexdigest
receiver models signals post delete sender file dispatch uid cleanup file dcnl def cleanup file sender instance kw dcsp if kw get raw or not instance filename dcnl dcsp dcsp return dcnl dcsp for path in file path guarded file path reviewer signed file path signed file path dcnl dcsp dcsp try dcnl dcsp dcsp dcsp filename getattr instance path none dcnl dcsp dcsp except models objectdoesnotexist dcnl dcsp dcsp dcsp return dcnl dcsp dcsp if filename and public storage exists filename or private storage exists filename dcnl dcsp dcsp dcsp log info removing dcsp filename dcsp s dcsp for dcsp file dcsp s filename instance pk dcnl dcsp dcsp dcsp public storage delete filename dcnl dcsp dcsp dcsp private storage delete filename
def nfd str u dcsp if isinstance u unicode dcnl dcsp dcsp return unicodedata normalize nfd u encode utf8 dcnl dcsp return u
webapp file view token dcnl def serve request viewer key dcsp files viewer get files dcnl dcsp obj files get key dcnl dcsp if not obj dcnl dcsp dcsp log error u couldn t dcsp find dcsp s dcsp in dcsp s dcsp d dcsp entries dcsp for dcsp file dcsp s key files keys 10 len files keys viewer file id dcnl dcsp dcsp raise http http404 dcnl dcsp return get file response request obj full content type obj mimetype
def load feature profile request dcsp if hasattr request feature profile dcnl dcsp dcsp return dcnl dcsp profile none dcnl dcsp if request get get dev in firefoxos android dcnl dcsp dcsp sig request get get pro dcnl dcsp dcsp if sig dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp profile featureprofile from signature sig dcnl dcsp dcsp dcsp except valueerror dcnl dcsp dcsp dcsp dcsp pass dcnl dcsp request feature profile profile
def update tiers dcsp output dcnl dcsp for row in tiers dcnl dcsp dcsp us row get usd dcnl dcsp dcsp if not us dcnl dcsp dcsp dcsp output append no dcsp usd dcsp in dcsp row dcsp skipped dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp try dcnl dcsp dcsp dcsp tier price objects get price decimal us dcnl dcsp dcsp except price doesnotexist dcnl dcsp dcsp dcsp output append tier dcsp not dcsp found dcsp skipping dcsp s us dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp for currency value in row iteritems dcnl dcsp dcsp dcsp if currency usd dcnl dcsp dcsp dcsp dcsp continue dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp curr pricecurrency objects get tier tier currency currency dcnl dcsp dcsp dcsp except pricecurrency doesnotexist dcnl dcsp dcsp dcsp dcsp curr pricecurrency tier tier currency currency dcnl dcsp dcsp dcsp curr price decimal value dcnl dcsp dcsp dcsp curr save dcnl dcsp dcsp dcsp output append currency dcsp updated dcsp s dcsp s dcsp tier dcsp s currency value us dcnl dcsp return output
def default providers dcsp return provider lookup invertedp for p in settings payment providers
receiver models signals post save sender pricecurrency dispatch uid save price currency dcnl receiver models signals post delete sender pricecurrency dispatch uid delete price currency dcnl def update price currency sender instance kw dcsp if kw get raw dcnl dcsp dcsp return dcnl dcsp try dcnl dcsp dcsp ids list instance tier addonpremium set values list addon id flat true dcnl dcsp except price doesnotexist dcnl dcsp dcsp return dcnl dcsp if ids dcnl dcsp dcsp log info indexing dcsp 0 dcsp addons dcsp due dcsp to dcsp pricecurrency dcsp changes format len ids dcnl dcsp dcsp from mkt webapps tasks import index webapps dcnl dcsp dcsp index webapps delay ids
use master dcnl receiver models signals post save sender contribution dispatch uid create addon purchase dcnl def create addon purchase sender instance kw dcsp if kw get raw or instance type not in mkt contrib purchase mkt contrib refund mkt contrib chargeback dcnl dcsp dcsp return dcnl dcsp log info processing dcsp addon dcsp purchase dcsp type dcsp t dcsp addon dcsp a dcsp user dcsp u format t unicode mkt contrib typesinstance type a instance addon and instance addon pk u instance user and instance user pk dcnl dcsp if instance is inapp simulation dcnl dcsp dcsp log info simulated dcsp inapp dcsp product dcsp i dcsp for dcsp contribution dcsp c dcsp not dcsp adding dcsp a dcsp purchase dcsp record format i instance inapp product c instance dcnl dcsp dcsp return dcnl dcsp if instance type mkt contrib purchase dcnl dcsp dcsp log debug creating dcsp addon dcsp purchase dcsp addon dcsp s dcsp user dcsp s instance addon pk instance user pk dcnl dcsp dcsp data addon instance addon user instance user dcnl dcsp dcsp purchase created addonpurchase objects safer get or create data dcnl dcsp dcsp purchase update type mkt contrib purchase dcnl dcsp dcsp from mkt webapps models import installed dcnl dcsp dcsp is dev instance addon has author instance user mkt author role owner mkt author role dev dcnl dcsp dcsp install type apps install type developer if is dev else apps install type user dcnl dcsp dcsp installed objects safer get or create user instance user addon instance addon install type install type dcnl dcsp elif instance type in mkt contrib refund mkt contrib chargeback dcnl dcsp dcsp purchases addonpurchase objects filter addon instance addon user instance user dcnl dcsp dcsp for p in purchases dcnl dcsp dcsp dcsp log debug changing dcsp addon dcsp purchase dcsp s dcsp addon dcsp s dcsp user dcsp s p pk instance addon pk instance user pk dcnl dcsp dcsp dcsp p update type instance type dcnl dcsp cache delete memoize key users purchaseids instance user pk
task dcnl def send purchase receipt contrib id kw dcsp contrib contribution objects get pk contrib id dcnl dcsp with contrib user activate lang dcnl dcsp dcsp addon contrib addon dcnl dcsp dcsp version addon current version or addon latest version dcnl dcsp dcsp subject receipt dcsp for dcsp 0 format contrib addon name dcnl dcsp dcsp data app name addon name developer name version developer name if version else price contrib get amount locale get locale from lang contrib source locale date jingo helpers datetime contrib created date purchaser email contrib user email transaction id contrib uuid purchases url absolutify purchases support url addon support url terms of service url absolutify termsofuse dcnl dcsp dcsp log info sending dcsp email dcsp about dcsp purchase dcsp s contrib id dcnl dcsp dcsp text template purchase receipt ltxt dcnl dcsp dcsp html template purchase receipt html dcnl dcsp dcsp send html mail jinja subject html template text template data recipient list contrib user email
login required dcnl app view dcnl use master dcnl json view dcnl def pay status request addon contrib uuid dcsp qs contribution objects filter uuid contrib uuid addon addonpurchase user request user type mkt contrib purchase dcnl dcsp return status complete if qs exists else incomplete
csrf exempt dcnl use master dcnl require post dcnl def postback request dcsp signed jwt request post get notice dcnl dcsp try dcnl dcsp dcsp data parse from webpay signed jwt request meta get remote addr dcnl dcsp except invalidsender as exc dcnl dcsp dcsp app pay cef log request unknown dcsp app invalid postback ignoring dcsp invalid dcsp jwt dcsp r dcsp s signed jwt exc severity 4 dcnl dcsp dcsp return http httpresponsebadrequest dcnl dcsp pd urlparse parse qs data request productdata dcnl dcsp contrib uuid pd contrib uuid 0 dcnl dcsp try dcnl dcsp dcsp contrib contribution objects get uuid contrib uuid dcnl dcsp except contribution doesnotexist dcnl dcsp dcsp etype val tb sys exc info dcnl dcsp dcsp raise lookuperror jwt dcsp iss s dcsp aud s dcsp for dcsp trans id dcsp s dcsp links dcsp to dcsp contrib dcsp s dcsp which dcsp doesn t dcsp exist data iss data aud data response transactionid contrib uuid none tb dcnl dcsp trans id data response transactionid dcnl dcsp if contrib is inapp simulation dcnl dcsp dcsp return simulated postback contrib trans id dcnl dcsp if contrib transaction id is not none dcnl dcsp dcsp if contrib transaction id trans id dcnl dcsp dcsp dcsp app pay cef log request repeat dcsp postback repeat postback postback dcsp sent dcsp again dcsp for dcsp s contrib addon pk severity 4 dcnl dcsp dcsp dcsp return http httpresponse trans id dcnl dcsp dcsp else dcnl dcsp dcsp dcsp app pay cef log request repeat dcsp postback dcsp with dcsp new dcsp trans id repeat postback new trans id postback dcsp sent dcsp again dcsp for dcsp s dcsp but dcsp with dcsp new dcsp trans id dcsp s contrib addon pk trans id severity 7 dcnl dcsp dcsp dcsp raise lookuperror jwt dcsp iss iss dcsp aud aud dcsp for dcsp trans id dcsp jwt trans dcsp is dcsp for dcsp contrib dcsp contrib uuid dcsp that dcsp is dcsp already dcsp paid dcsp and dcsp has dcsp a dcsp different dcsp trans id dcsp contrib trans format iss data iss aud data aud jwt trans data response transactionid contrib uuid contrib uuid contrib trans contrib transaction id dcnl dcsp if data get request get pricepoint 0 dcnl dcsp dcsp solitude buyer uuid data response solitude buyer uuid dcnl dcsp dcsp try dcnl dcsp dcsp dcsp buyer solitude api generic buyer get object or 404 uuid solitude buyer uuid dcnl dcsp dcsp except objectdoesnotexist dcnl dcsp dcsp dcsp raise lookuperror unable dcsp to dcsp look dcsp up dcsp buyer dcsp uuid dcsp in dcsp solitude format uuid solitude buyer uuid dcnl dcsp dcsp user profile get user profile request buyer get email dcnl dcsp dcsp return free postback request contrib trans id user profile dcnl dcsp try dcnl dcsp dcsp transaction data solitude api generic transaction get object or 404 uuid trans id dcnl dcsp except objectdoesnotexist dcnl dcsp dcsp raise lookuperror unable dcsp to dcsp look dcsp up dcsp transaction dcsp trans id dcsp in dcsp solitude format trans id trans id dcnl dcsp buyer uri transaction data buyer dcnl dcsp try dcnl dcsp dcsp buyer data solitude api by url buyer uri get object or 404 dcnl dcsp except objectdoesnotexist dcnl dcsp dcsp raise lookuperror unable dcsp to dcsp look dcsp up dcsp buyer dcsp buyer uri dcsp in dcsp solitude format buyer uri buyer uri dcnl dcsp buyer email buyer data email dcnl dcsp user profile get user profile request buyer email dcnl dcsp log info u webpay dcsp postback dcsp fulfilling dcsp purchase dcsp for dcsp contrib dcsp c dcsp with dcsp transaction dcsp t format c contrib t trans id dcnl dcsp app pay cef log request purchase dcsp complete purchase complete purchase dcsp complete dcsp for dcsp s contrib addon pk severity 3 dcnl dcsp contrib update transaction id trans id type mkt contrib purchase user user profile amount decimal data response price amount currency data response price currency dcnl dcsp tasks send purchase receipt delay contrib pk dcnl dcsp return http httpresponse trans id
csrf exempt dcnl use master dcnl require post dcnl def chargeback request dcsp raise notimplementederror
def can become premium f dcsp functools wraps f dcnl dcsp def wrapper request addon id addon args kw dcnl dcsp dcsp if not addon can become premium dcnl dcsp dcsp dcsp log info cannot dcsp become dcsp premium dcsp d addon pk dcnl dcsp dcsp dcsp raise permissiondenied dcnl dcsp dcsp return f request addon id addon args kw dcnl dcsp return wrapper
def can be purchased f dcsp functools wraps f dcnl dcsp def wrapper request addon args kw dcnl dcsp dcsp if not addon can be purchased dcnl dcsp dcsp dcsp log info cannot dcsp be dcsp purchased dcsp d addon pk dcnl dcsp dcsp dcsp raise permissiondenied dcnl dcsp dcsp return f request addon args kw dcnl dcsp return wrapper
def has purchased f dcsp functools wraps f dcnl dcsp def wrapper request addon args kw dcnl dcsp dcsp if addon is premium and not addon has purchased request user dcnl dcsp dcsp dcsp log info not dcsp purchased dcsp d addon pk dcnl dcsp dcsp dcsp raise permissiondenied dcnl dcsp dcsp return f request addon args kw dcnl dcsp return wrapper
def clean sort param request date sort created dcsp sort request get get sort date sort dcnl dcsp order request get get order asc dcnl dcsp if sort not in name created nomination dcnl dcsp dcsp sort date sort dcnl dcsp if order not in desc asc dcnl dcsp dcsp order asc dcnl dcsp return sort order
def clean sort param es request date sort created dcsp sort map name name sort nomination latest version nomination date dcnl dcsp sort request get get sort date sort dcnl dcsp order request get get order asc dcnl dcsp if sort not in name created nomination dcnl dcsp dcsp sort date sort dcnl dcsp sort sort map get sort date sort dcnl dcsp if order not in desc asc dcnl dcsp dcsp order asc dcnl dcsp return sort order
def create sort link pretty name sort field get params sort order dcsp get params append sort sort field dcnl dcsp if sort sort field and order asc dcnl dcsp dcsp get params append order desc dcnl dcsp else dcnl dcsp dcsp get params append order asc dcnl dcsp url class dcnl dcsp if sort sort field dcnl dcsp dcsp url class dcsp class sorticon dcsp edspritesort s order dcnl dcsp return u <a dcsp href s s s< a urllib urlencode get params true url class pretty name
register function dcnl jinja2 contextfunction dcnl def reviewers breadcrumbs context queue none items none dcsp crumbs reverse reviewers home reviewer dcsp tools dcnl dcsp if queue dcnl dcsp dcsp queues pending apps rereview rereviews updates updates escalated escalations device device moderated moderated dcsp reviews abuse abuse dcsp reports abusewebsites website dcsp abuse dcsp reports reviewing reviewing homescreen homescreens region regional dcsp queues dcnl dcsp dcsp if items dcnl dcsp dcsp dcsp url reverse reviewers apps queue s queue dcnl dcsp dcsp else dcnl dcsp dcsp dcsp url none dcnl dcsp dcsp crumbs append url queuesqueue dcnl dcsp if items dcnl dcsp dcsp crumbs extend items dcnl dcsp return mkt breadcrumbs context items crumbs add default true
register function dcnl jinja2 contextfunction dcnl def queue tabnav context dcsp request context request dcnl dcsp counts context queue counts dcnl dcsp apps reviewing appsreviewing request get apps dcnl dcsp if acl action allowed request apps review dcnl dcsp dcsp rv reverse reviewers apps queue pending pending pgettext counts pending apps dcsp 0 format counts pending reverse reviewers apps queue rereview rereview pgettext counts rereview rereviews dcsp 0 format counts rereview reverse reviewers apps queue updates updates pgettext counts updates updates dcsp 0 format counts updates dcnl dcsp dcsp if acl action allowed request apps reviewescalated dcnl dcsp dcsp dcsp rv append reverse reviewers apps queue escalated escalated pgettext counts escalated escalations dcsp 0 format counts escalated dcnl dcsp dcsp rv append reverse reviewers apps apps reviewing reviewing reviewing dcsp 0 format len apps reviewing dcnl dcsp dcsp rv append reverse reviewers apps queue homescreen homescreen pgettext counts homescreen homescreens dcsp 0 format counts homescreen dcnl dcsp else dcnl dcsp dcsp rv dcnl dcsp if acl action allowed request apps moderatereview dcnl dcsp dcsp rv append reverse reviewers apps queue moderated moderated pgettext counts moderated moderated dcsp reviews dcsp 0 format counts moderated dcnl dcsp if acl action allowed request apps readabuse dcnl dcsp dcsp rv append reverse reviewers apps queue abuse abuse pgettext counts abuse abuse dcsp reports dcsp 0 format counts abuse dcnl dcsp if acl action allowed request websites readabuse dcnl dcsp dcsp rv append reverse reviewers websites queue abuse abusewebsites pgettext counts abusewebsites website dcsp abuse dcsp reports dcsp 0 format counts abusewebsites dcnl dcsp return rv
register function dcnl jinja2 contextfunction dcnl def logs tabnav context dcsp request context request dcnl dcsp if acl action allowed request apps review dcnl dcsp dcsp rv reviewers apps logs logs reviews dcnl dcsp else dcnl dcsp dcsp rv dcnl dcsp if acl action allowed request apps moderatereview dcnl dcsp dcsp rv append reviewers apps moderatelog moderatelog moderated dcsp reviews dcnl dcsp return rv
register function dcnl jinja2 contextfunction dcnl def sort link context pretty name sort field dcsp request context request dcnl dcsp sort order clean sort param request dcnl dcsp get params k v for k v in urlparse parse qsl smart str request meta query string if k not in sort order dcnl dcsp return create sort link pretty name sort field get params sort order
def get avg app waiting time dcsp cursor connection cursor dcnl dcsp cursor execute n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp select dcsp avg datediff reviewed dcsp nomination dcsp from dcsp versions n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp right dcsp join dcsp addons dcsp on dcsp versions addon id dcsp dcsp addons id n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp where dcsp status dcsp dcsp s dcsp and dcsp reviewed dcsp dcsp date sub now dcsp interval dcsp 30 dcsp day n dcsp dcsp dcsp dcsp mkt status public dcnl dcsp row cursor fetchone dcnl dcsp days 0 dcnl dcsp if row dcnl dcsp dcsp try dcnl dcsp dcsp dcsp days math ceil float row0 dcnl dcsp dcsp except typeerror dcnl dcsp dcsp dcsp pass dcnl dcsp return days
register filter dcnl def es2datetime s dcsp return es to datetime s
def reviewer required region none moderator false dcsp def decorator f dcnl dcsp dcsp login required dcnl dcsp dcsp functools wraps f dcnl dcsp dcsp def wrapper request args kw dcnl dcsp dcsp dcsp reviewer perm acl check reviewer request dcnl dcsp dcsp dcsp moderator perm moderator and acl action allowed request apps moderatereview dcnl dcsp dcsp dcsp view only request method get and acl action allowed request reviewertools view dcnl dcsp dcsp dcsp if reviewer perm or moderator perm or view only dcnl dcsp dcsp dcsp dcsp return f request args kw dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp raise permissiondenied dcnl dcsp dcsp return wrapper dcnl dcsp if callable region dcnl dcsp dcsp return decorator region dcnl dcsp else dcnl dcsp dcsp return decorator
reviewer required moderator true dcnl def route reviewer request dcsp return http httpresponseredirect reverse reviewers home
def progress dcsp queues helper reviewersqueueshelper dcnl dcsp base filters pending queues helper get pending queue nomination homescreen queues helper get homescreen queue nomination rereview queues helper get rereview queue created escalated queues helper get escalated queue created updates queues helper get updates queue nomination dcnl dcsp operators and values new gt days ago 5 med range days ago 10 days ago 5 old lt days ago 10 week gte days ago 7 dcnl dcsp types base filters keys dcnl dcsp progress dcnl dcsp for t in types dcnl dcsp dcsp tmp dcnl dcsp dcsp base query field base filterst dcnl dcsp dcsp for k in operators and values keys dcnl dcsp dcsp dcsp operator value operators and valuesk dcnl dcsp dcsp dcsp filter dcnl dcsp dcsp dcsp filter s s field operator value dcnl dcsp dcsp dcsp tmpk base query filter filter count dcnl dcsp dcsp progresst tmp dcnl dcsp def pct p t dcnl dcsp dcsp return p float t 100 if p 0 else 0 dcnl dcsp percentage dcnl dcsp for t in types dcnl dcsp dcsp total progresst new + progresst med + progresst old dcnl dcsp dcsp percentaget dcnl dcsp dcsp for duration in new med old dcnl dcsp dcsp dcsp percentagetduration pct progresstduration total dcnl dcsp return progress percentage
permission required apps moderatereview dcnl def queue moderated request dcsp queues helper reviewersqueueshelper request dcnl dcsp qs queues helper get moderated queue dcnl dcsp page paginate request qs per page 20 dcnl dcsp flags dict reviewflag flags dcnl dcsp reviews formset reviewflagformset request post or none queryset page object list request request dcnl dcsp if reviews formset is valid dcnl dcsp dcsp reviews formset save dcnl dcsp dcsp return redirect reverse reviewers apps queue moderated dcnl dcsp return render request reviewers queue html context request reviews formset reviews formset tab moderated page page flags flags
permission required apps readabuse dcnl def queue abuse request dcsp queues helper reviewersqueueshelper request dcnl dcsp apps queues helper get abuse queue dcnl dcsp page paginate request apps per page 20 dcnl dcsp abuse formset appabuseviewformset request post or none queryset page object list request request dcnl dcsp if abuse formset is valid dcnl dcsp dcsp abuse formset save dcnl dcsp dcsp return redirect reverse reviewers apps queue abuse dcnl dcsp return render request reviewers queue html context request abuse formset abuse formset tab abuse page page
permission required websites readabuse dcnl def queue abuse websites request dcsp queues helper reviewersqueueshelper request dcnl dcsp sites queues helper get abuse queue websites dcnl dcsp page paginate request sites per page 20 dcnl dcsp abuse formset websiteabuseviewformset request post or none queryset page object list request request dcnl dcsp if abuse formset is valid dcnl dcsp dcsp abuse formset save dcnl dcsp dcsp return redirect reverse reviewers websites queue abuse dcnl dcsp return render request reviewers queue html context request abuse formset abuse formset tab abusewebsites page page
def add translation key translation dcsp if not hasattr to save translations dcnl dcsp dcsp to save translations dcnl dcsp to save translations setdefault key dcnl dcsp to save translationskey append translation
def clean translations sender kwargs dcsp if hasattr to save translations dcnl dcsp dcsp to save translations
def make key obj dcsp return id obj
def save translations key dcsp if not hasattr to save translations dcnl dcsp dcsp return dcnl dcsp for trans in to save translations get key dcnl dcsp dcsp is new trans autoid is none dcnl dcsp dcsp trans save force insert is new force update not is new dcnl dcsp if key in to save translations dcnl dcsp dcsp del to save translationskey
def truncate text text limit killwords false end dcsp text text strip dcnl dcsp text length len text dcnl dcsp if text length < limit dcnl dcsp dcsp return text limit text length dcnl dcsp text do truncate text limit killwords end dcnl dcsp return text + end 0
def trim tree limit killwords end dcsp if tree text dcnl dcsp dcsp tree text limit truncate text tree text limit killwords end dcnl dcsp for child in tree dcnl dcsp dcsp if limit < 0 dcnl dcsp dcsp dcsp tree remove child dcnl dcsp dcsp else dcnl dcsp dcsp dcsp parsed tree limit trim child limit killwords end dcnl dcsp if tree tail dcnl dcsp dcsp if limit < 0 dcnl dcsp dcsp dcsp tree tail dcnl dcsp dcsp else dcnl dcsp dcsp dcsp tree tail limit truncate text tree tail limit killwords end dcnl dcsp return tree limit
def text length tree dcsp total 0 dcnl dcsp for node in tree getiterator dcnl dcsp dcsp if node text dcnl dcsp dcsp dcsp total + len node text strip dcnl dcsp dcsp if node tail dcnl dcsp dcsp dcsp total + len node tail strip dcnl dcsp return total
def truncate html length killwords false end dcsp tree html5lib parsefragment html dcnl dcsp if text length tree < length dcnl dcsp dcsp return jinja2 markup html dcnl dcsp else dcnl dcsp dcsp short trim tree length killwords end dcnl dcsp dcsp walker html5lib treewalkers gettreewalker etree dcnl dcsp dcsp stream walker short dcnl dcsp dcsp serializer html5lib serializer htmlserializer htmlserializer quote attr values true omit optional tags false dcnl dcsp dcsp return jinja2 markup force unicode serializer render stream
def transfield changed field initial data dcsp initial k v localized string for k v in initial iteritems if s field in k and v is not none dcnl dcsp data s s field k v for k v in datafield iteritems if k init dcnl dcsp return set initial set data
def to language locale dcsp if in locale dcnl dcsp dcsp return to language translation trans real to language locale dcnl dcsp elif in locale dcnl dcsp dcsp lang region locale lower split dcnl dcsp dcsp if region latn dcnl dcsp dcsp dcsp region region capitalize dcnl dcsp dcsp else dcnl dcsp dcsp dcsp region region upper dcnl dcsp dcsp return s s lang region dcnl dcsp else dcnl dcsp dcsp return translation trans real to language locale
def get locale from lang lang dcsp if not lang or lang dbg dcnl dcsp dcsp lang en dcnl dcsp return locale translation to locale lang
contextlib contextmanager dcnl def no translation lang none dcsp old lang translation trans real get language dcnl dcsp if lang dcnl dcsp dcsp translation trans real activate lang dcnl dcsp else dcnl dcsp dcsp translation trans real deactivate dcnl dcsp yield dcnl dcsp translation trans real activate old lang
def find language locale dcsp if not locale dcnl dcsp dcsp return none dcnl dcsp langs settings amo languages dcnl dcsp if locale in langs dcnl dcsp dcsp return locale dcnl dcsp loc settings shorter languages get locale dcnl dcsp if loc dcnl dcsp dcsp return loc dcnl dcsp locale to language locale dcnl dcsp if locale in langs dcnl dcsp dcsp return locale dcnl dcsp return none
def clean nl string dcsp html blocks http www w3 org 1999 xhtml blockquote http www w3 org 1999 xhtml ol http www w3 org 1999 xhtml li http www w3 org 1999 xhtml ul dcnl dcsp if not string dcnl dcsp dcsp return string dcnl dcsp def parse html tree dcnl dcsp dcsp if tree tag in html blocks dcnl dcsp dcsp dcsp if tree text dcnl dcsp dcsp dcsp dcsp tree text tree text lstrip n dcnl dcsp dcsp dcsp dcsp if not len tree dcnl dcsp dcsp dcsp dcsp dcsp tree text tree text rstrip n dcnl dcsp dcsp dcsp if tree tail and tree tail startswith n dcnl dcsp dcsp dcsp dcsp tree tail tree tail1 dcnl dcsp dcsp for child in tree dcnl dcsp dcsp dcsp if tree tag in html blocks dcnl dcsp dcsp dcsp dcsp if child tail dcnl dcsp dcsp dcsp dcsp dcsp child tail child tail rstrip n dcnl dcsp dcsp dcsp parse html child dcnl dcsp dcsp return tree dcnl dcsp parse parse html html5lib parsefragment string dcnl dcsp walker html5lib treewalkers gettreewalker etree dcnl dcsp stream walker parse dcnl dcsp serializer htmlserializer quote attr values true omit optional tags false dcnl dcsp return serializer render stream
def switch obj new model dcsp fields f name getattr obj f name for f in new model meta fields dcnl dcsp return new model dict fields
def save on signal obj trans dcsp signal models signals pre save dcnl dcsp def cb sender instance kw dcnl dcsp dcsp if instance is obj dcnl dcsp dcsp dcsp is new trans autoid is none dcnl dcsp dcsp dcsp trans save force insert is new force update not is new dcnl dcsp dcsp dcsp signal disconnect cb dcnl dcsp signal connect cb sender obj class weak false
def save signal sender instance kw dcsp if not kw get raw dcnl dcsp dcsp save translations make key instance
def test locale html dcsp testfield mock dcnl dcsp this lang translation get language dcnl dcsp testfield locale this lang dcnl dcsp s helpers locale html testfield dcnl dcsp assert not s no dcsp special dcsp html dcsp attributes dcsp for dcsp site dcsp language dcnl dcsp testfield locale de dcnl dcsp s helpers locale html testfield dcnl dcsp eq s dcsp lang de dcsp dir ltr dcnl dcsp for lang in settings rtl languages dcnl dcsp dcsp testfield locale lang dcnl dcsp dcsp s helpers locale html testfield dcnl dcsp dcsp eq s dcsp lang s dcsp dir rtl testfield locale
def test locale html xss dcsp testfield mock dcnl dcsp testfield locale <script alert 1 < script dcnl dcsp s helpers locale html testfield dcnl dcsp assert <script not in s dcnl dcsp assert lt script gt alert 1 lt script gt in s
def test empty locale html dcsp s helpers locale html none dcnl dcsp assert not s locale html dcsp on dcsp none dcsp must dcsp be dcsp empty
def test truncate purified field xss dcsp s safe dcsp <script alert omg < script dcnl dcsp t purifiedtranslation localized string s dcnl dcsp actual env from string dcsp s|truncate 100 dcsp render s t dcnl dcsp eq actual safe dcsp lt script gt alert omg lt script gt dcnl dcsp actual env from string dcsp s|truncate 5 dcsp render s t dcnl dcsp eq actual safe dcsp
def attach trans dict model objs dcsp fields model meta translated fields dcnl dcsp ids getattr obj f attname for f in fields for obj in objs if getattr obj f attname none is not none dcnl dcsp qs translation objects filter id in ids localized string isnull false dcnl dcsp all translations dict k list v for k v in sorted groupby qs lambda trans trans id dcnl dcsp def get locale and string translation new class dcnl dcsp dcsp convert dcsp the dcsp translation dcsp to dcsp new class dcsp making dcsp purifiedtranslations n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp and dcsp linkifiedtranslations dcsp work dcsp and dcsp return dcsp locale dcsp dcsp string dcsp tuple dcnl dcsp dcsp converted translation new class dcnl dcsp dcsp converted translation dict translation dict dcnl dcsp dcsp return converted translation locale lower unicode converted translation dcnl dcsp for obj in objs dcnl dcsp dcsp obj translations collections defaultdict list dcnl dcsp dcsp for field in fields dcnl dcsp dcsp dcsp t id getattr obj field attname none dcnl dcsp dcsp dcsp field translations all translations get t id none dcnl dcsp dcsp dcsp if not t id or field translations is none dcnl dcsp dcsp dcsp dcsp continue dcnl dcsp dcsp dcsp obj translationst id get locale and string t field rel to for t in field translations
def order by translation qs fieldname dcsp if fieldname startswith dcnl dcsp dcsp desc true dcnl dcsp dcsp fieldname fieldname1 dcnl dcsp else dcnl dcsp dcsp desc false dcnl dcsp qs qs all dcnl dcsp model qs model dcnl dcsp field model meta get field fieldname dcnl dcsp if not qs query tables dcnl dcsp dcsp qs query get initial alias dcnl dcsp qs query qs query clone translationquery dcnl dcsp t1 qs query join join field rel to meta db table model meta db table none louter field true reuse set dcnl dcsp t2 qs query join join field rel to meta db table model meta db table none louter field true reuse set dcnl dcsp qs query translation aliases field t1 t2 dcnl dcsp f1 f2 s localized string t1 s localized string t2 dcnl dcsp name translated s field column dcnl dcsp ifnull ifnull s dcsp s f1 f2 dcnl dcsp prefix if desc else dcnl dcsp return qs extra select name ifnull where s dcsp is dcsp not dcsp null dcsp or dcsp s dcsp is dcsp not dcsp null f1 f2 order by prefix + name
jingo register filter dcnl def locale html translatedfield dcsp if not translatedfield dcnl dcsp dcsp return dcnl dcsp site locale translation to locale translation get language dcnl dcsp locale translation to locale translatedfield locale dcnl dcsp if locale site locale dcnl dcsp dcsp return dcnl dcsp else dcnl dcsp dcsp rtl locales map translation to locale settings rtl languages dcnl dcsp dcsp textdir rtl if locale in rtl locales else ltr dcnl dcsp dcsp return jinja2 markup dcsp lang s dcsp dir s jinja2 escape translatedfield locale textdir
jingo register filter dcnl def truncate s length 255 killwords true end dcsp if s is none dcnl dcsp dcsp return dcnl dcsp if hasattr s truncate dcnl dcsp dcsp return s truncate length killwords end dcnl dcsp return do truncate smart unicode s length killwords end
jingo register inclusion tag translations transmenu html dcnl jinja2 contextfunction dcnl def l10n menu context default locale enus remove locale url dcsp default locale default locale lower dcnl dcsp languages dict i lower j for i j in settings languages items dcnl dcsp c dict context items dcnl dcsp if addon in c dcnl dcsp dcsp remove locale url c addon get dev url removelocale dcnl dcsp c update languages languages default locale default locale remove locale url remove locale url dcnl dcsp return c
def default locale obj dcsp if hasattr obj get fallback dcnl dcsp dcsp fallback obj get fallback dcnl dcsp dcsp if isinstance fallback models field dcnl dcsp dcsp dcsp fallback getattr obj fallback name dcnl dcsp dcsp return fallback dcnl dcsp else dcnl dcsp dcsp return settings language code
def clean tags request tags max tags none dcsp target slugify t spaces true lower true for t in tags split dcnl dcsp target set filter none target dcnl dcsp min len mkt min tag length dcnl dcsp max len tag meta get field tag text max length dcnl dcsp max tags max tags or mkt max tags dcnl dcsp total len target dcnl dcsp blocked tag objects values list tag text flat true filter tag text in target blocked true dcnl dcsp if blocked dcnl dcsp dcsp msg ngettext u invalid dcsp tag dcsp 0 invalid dcsp tags dcsp 0 len blocked format dcsp join blocked dcnl dcsp dcsp raise forms validationerror msg dcnl dcsp restricted tag objects values list tag text flat true filter tag text in target restricted true dcnl dcsp if restricted and not can edit restricted tags request dcnl dcsp dcsp msg ngettext u 0 dcsp is dcsp a dcsp reserved dcsp tag dcsp and dcsp cannot dcsp be dcsp used u 0 dcsp are dcsp reserved dcsp tags dcsp and dcsp cannot dcsp be dcsp used len restricted format dcsp join restricted dcnl dcsp dcsp raise forms validationerror msg dcnl dcsp else dcnl dcsp dcsp total len target set restricted dcnl dcsp if total max tags dcnl dcsp dcsp num total max tags dcnl dcsp dcsp msg ngettext u you dcsp have dcsp 0 dcsp too dcsp many dcsp tags u you dcsp have dcsp 0 dcsp too dcsp many dcsp tags num format num dcnl dcsp dcsp raise forms validationerror msg dcnl dcsp if any t for t in target if len t max len dcnl dcsp dcsp raise forms validationerror u all dcsp tags dcsp must dcsp be dcsp s dcsp characters dcsp or dcsp less dcsp after dcsp invalid dcsp characters dcsp are dcsp removed max len dcnl dcsp if any t for t in target if len t < min len dcnl dcsp dcsp msg ngettext u all dcsp tags dcsp must dcsp be dcsp at dcsp least dcsp 0 dcsp character u all dcsp tags dcsp must dcsp be dcsp at dcsp least dcsp 0 dcsp characters min len format min len dcnl dcsp dcsp raise forms validationerror msg dcnl dcsp return target
def attach tags objs dcsp if objs dcnl dcsp dcsp obj dict obj id obj for obj in objs dcnl dcsp dcsp m2m name tag get m2m name objs0 dcnl dcsp dcsp field name getattr objs0 m2m name query field name dcnl dcsp dcsp qs tag objects not blocked filter s in field name obj dict keys values list s id field name tag text dcnl dcsp dcsp for obj tags in sorted groupby qs lambda x x0 dcnl dcsp dcsp dcsp setattr obj dictobj s list m2m name t1 for t in tags
def admin required reviewers false dcsp def decorator f dcnl dcsp dcsp login required dcnl dcsp dcsp functools wraps f dcnl dcsp dcsp def wrapper request args kw dcnl dcsp dcsp dcsp admin action allowed request admin or action allowed request admintools view dcnl dcsp dcsp dcsp if reviewers is true dcnl dcsp dcsp dcsp dcsp admin admin or action allowed request revieweradmintools view dcnl dcsp dcsp dcsp if admin dcnl dcsp dcsp dcsp dcsp return f request args kw dcnl dcsp dcsp dcsp raise permissiondenied dcnl dcsp dcsp return wrapper dcnl dcsp if callable reviewers dcnl dcsp dcsp return decorator reviewers dcnl dcsp else dcnl dcsp dcsp return decorator
task rate limit 50 m dcnl def update denorm pairs kw dcsp log info s s dcsp updating dcsp review dcsp denorms len pairs update denorm rate limit dcnl dcsp using kw get using dcnl dcsp for addon user in pairs dcnl dcsp dcsp reviews list review objects valid using using filter addon addon user user order by created dcnl dcsp dcsp if not reviews dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp for idx review in enumerate reviews dcnl dcsp dcsp dcsp review previous count idx dcnl dcsp dcsp dcsp review is latest false dcnl dcsp dcsp reviews 1 is latest true dcnl dcsp dcsp for review in reviews dcnl dcsp dcsp dcsp review save
cronjobs register dcnl def email daily ratings dcsp dt datetime datetime today datetime timedelta 1 dcnl dcsp yesterday datetime datetime dt year dt month dt day 0 0 0 dcnl dcsp today yesterday + datetime timedelta 1 dcnl dcsp pretty date 04d 02d 02d dt year dt month dt day dcnl dcsp yesterday reviews review objects filter created gte yesterday created lt today dcnl dcsp apps set review addon for review in yesterday reviews dcnl dcsp for app in apps dcnl dcsp dcsp author emails app authors values list email flat true dcnl dcsp dcsp subject firefox dcsp marketplace dcsp reviews dcsp for dcsp s dcsp on dcsp s app name pretty date dcnl dcsp dcsp context reviews yesterday reviews filter addon app order by created base url settings site url pretty date pretty date dcnl dcsp dcsp send mail jinja subject ratings emails daily digest html context recipient list author emails perm setting app new review async true
def user can delete review request review dcsp is editor acl check reviewer request dcnl dcsp is author review addon has author request user dcnl dcsp return review user id request user id or not is author and is editor or acl action allowed request users edit or acl action allowed request apps moderatereview
def get carrier dcsp return getattr local carrier none
def get carrier id dcsp carrier get carrier dcnl dcsp if carrier is none dcnl dcsp dcsp return carrier dcnl dcsp for carr in carriers dcnl dcsp dcsp if carr slug carrier dcnl dcsp dcsp dcsp return carr id dcnl dcsp return mkt constants carriers unknown carrier id
def set carrier name dcsp local carrier name
def parse region region dcsp if isinstance region type and issubclass region regions region dcnl dcsp dcsp return region dcnl dcsp if str region isdigit dcnl dcsp dcsp return regions regions choices id dictint region dcnl dcsp else dcnl dcsp dcsp region by slug regions region lookup get region dcnl dcsp dcsp if region by slug is not none dcnl dcsp dcsp dcsp return region by slug dcnl dcsp dcsp region lower region lower dcnl dcsp dcsp for region in regions all regions dcnl dcsp dcsp dcsp if unicode region name lower region lower dcnl dcsp dcsp dcsp dcsp return region
def remove accents input str dcsp nkfd form unicodedata normalize nfkd unicode input str dcnl dcsp return u join c for c in nkfd form if not unicodedata combining c
def get region dcsp return parse region getattr local region or restofworld
def set region region dcsp local region region
def get popularity obj region none dcsp return property value by region obj region region property popularity
def get trending obj region none dcsp return property value by region obj region region property trending
def get boost obj dcsp boost max log10 1 + get popularity obj 1 0 dcnl dcsp if obj status in valid statuses dcnl dcsp dcsp boost boost multiplier for public content dcnl dcsp return boost
def es to datetime value dcsp if not value or isinstance value date datetime dcnl dcsp dcsp return dcnl dcsp if len value 26 dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return datetime strptime value y m dt h m s f dcnl dcsp dcsp except typeerror valueerror dcnl dcsp dcsp dcsp pass dcnl dcsp elif len value 19 dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return datetime strptime value y m dt h m s dcnl dcsp dcsp except typeerror valueerror dcnl dcsp dcsp dcsp pass dcnl dcsp elif len value 10 dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return datetime strptime value y m d dcnl dcsp dcsp except typeerror valueerror dcnl dcsp dcsp dcsp pass dcnl dcsp return value
task acks late true dcnl use master dcnl def index ids indexer kw dcsp log info indexing dcsp 0 dcsp 1 2 dcsp 3 format indexer get model meta model name ids0 ids 1 len ids dcnl dcsp indices reindexing get indices indexer get index dcnl dcsp es indexer get es urls settings es urls dcnl dcsp for obj in indexer get indexable filter id in ids dcnl dcsp dcsp doc indexer extract document obj id obj dcnl dcsp dcsp for idx in indices dcnl dcsp dcsp dcsp indexer index doc id obj id es es index idx
def get monolith jobs date none dcsp if not date dcnl dcsp dcsp date datetime date today dcnl dcsp if isinstance date datetime datetime dcnl dcsp dcsp date date date dcnl dcsp next date date + datetime timedelta days 1 dcnl dcsp stats apps review count new count review objects filter created range date next date editorreview 0 count mmo user count total count userprofile objects filter created lt next date source mkt login source mmo browserid count mmo user count new count userprofile objects filter created range date next date source mkt login source mmo browserid count mmo developer count total count addonuser objects filter user created lt next date values user distinct count apps count new count webapp objects filter created range date next date count dcnl dcsp apps webapp objects filter created range date next date dcnl dcsp package counts dcnl dcsp premium counts dcnl dcsp package types mkt addon webapp types copy dcnl dcsp package types pop mkt addon webapp privileged dcnl dcsp for region slug region in regions choices slug dcnl dcsp dcsp for package type in package types values dcnl dcsp dcsp dcsp package counts append count apps filter is packaged package type packaged exclude addonexcludedregion region region id count dimensions region region slug package type package type dcnl dcsp dcsp for premium type pt name in mkt addon premium api items dcnl dcsp dcsp dcsp premium counts append count apps filter premium type premium type exclude addonexcludedregion region region id count dimensions region region slug premium type pt name dcnl dcsp stats update apps added by package type package counts dcnl dcsp stats update apps added by premium type premium counts dcnl dcsp apps webapp objects filter current version reviewed lt next date status in mkt listed statuses disabled by user false dcnl dcsp package counts dcnl dcsp premium counts dcnl dcsp for region slug region in regions choices slug dcnl dcsp dcsp for package type in package types values dcnl dcsp dcsp dcsp package counts append count apps filter is packaged package type packaged exclude addonexcludedregion region region id count dimensions region region slug package type package type dcnl dcsp dcsp for premium type pt name in mkt addon premium api items dcnl dcsp dcsp dcsp premium counts append count apps filter premium type premium type exclude addonexcludedregion region region id count dimensions region region slug premium type pt name dcnl dcsp stats update apps available by package type package counts dcnl dcsp stats update apps available by premium type premium counts dcnl dcsp return stats
cronjobs register dcnl def update monolith stats date none dcsp if date dcnl dcsp dcsp date datetime datetime strptime date y m d date dcnl dcsp today date or datetime date today dcnl dcsp jobs metric metric date today for metric in tasks get monolith jobs date dcnl dcsp ts tasks update monolith stats subtask kwargs kw for kw in jobs dcnl dcsp taskset ts apply async
task dcnl def migrate collection colors ids model dcsp cls feedapp dcnl dcsp if model collection dcnl dcsp dcsp cls feedcollection dcnl dcsp for obj in cls objects filter id in ids dcnl dcsp dcsp if obj background color and not obj color dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp color ce001c ruby f78813 amber 00953f emerald 0099d0 aquamarine 1e1e9c sapphire 5a197e amethyst a20d55 garnet get obj background color aquamarine dcnl dcsp dcsp dcsp except keyerror dcnl dcsp dcsp dcsp dcsp continue dcnl dcsp dcsp dcsp obj update color color dcnl dcsp dcsp dcsp log info migrated dcsp s s dcsp from dcsp s dcsp to dcsp s model unicode obj id obj background color color
def rand text n 10 dcsp return dcsp join random choice dummy text for i in xrange n
task dcnl use master dcnl def fetch icon pk icon url sizes mkt content icon sizes kw dcsp website website objects get pk pk dcnl dcsp log info u website s dcsp fetching dcsp icon dcsp for dcsp website website name dcnl dcsp try dcnl dcsp dcsp response fetch content icon url dcnl dcsp except exception as e dcnl dcsp dcsp log error u website s dcsp failed dcsp to dcsp fetch dcsp icon dcsp for dcsp website dcsp s website e dcnl dcsp dcsp website update icon type dcnl dcsp dcsp return false dcnl dcsp try dcnl dcsp dcsp content get content and check size response settings max icon upload size dcnl dcsp except responsetoolargeexception dcnl dcsp dcsp log warning u website s dcsp icon dcsp exceeds dcsp maximum dcsp size website name dcnl dcsp dcsp return false dcnl dcsp log info website s dcsp icon dcsp fetching dcsp completed dcsp saving dcsp icon website name dcnl dcsp save icon website content sizes dcnl dcsp return true
task dcnl use master dcnl def fetch promo imgs pk promo img url kw dcsp website website objects get pk pk dcnl dcsp log info u website s dcsp fetching dcsp promo dcsp img dcsp for dcsp website website name dcnl dcsp try dcnl dcsp dcsp response fetch content promo img url dcnl dcsp except exception as e dcnl dcsp dcsp log error u website s dcsp failed dcsp to dcsp fetch dcsp promo dcsp img dcsp for dcsp website dcsp s website e dcnl dcsp dcsp website update promo img hash dcnl dcsp dcsp return false dcnl dcsp log info website s dcsp promo dcsp img dcsp fetching dcsp done dcsp dcsp saving dcsp website name dcnl dcsp save promo imgs website response content dcnl dcsp return true
def rand text dcsp return s d random choice dummy text random randrange 0 9999
def all regions with content ratings dcsp return x for x in all regions if x ratingsbody
def all regions without content ratings dcsp return set all regions set all regions with content ratings
def region to ratings body dcsp region to bodies dcnl dcsp for region in all regions with content ratings dcnl dcsp dcsp ratings body label generic rating region slug dcnl dcsp dcsp if region ratingsbody dcnl dcsp dcsp dcsp ratings body label slugify iarc name region ratingsbody dcnl dcsp dcsp region to bodiesregion slug ratings body label dcnl dcsp return region to bodies
def regions list sorted by name dcsp from mkt regions utils import remove accents dcnl dcsp by name sorted v for k v in defined if v id and v weight 1 key lambda v remove accents unicode v name dcnl dcsp by name append restofworld dcnl dcsp return by name
def regions choices sorted by name dcsp return v id v name for v in regions list sorted by name
def action map activity action dcsp import mkt dcnl dcsp if not isinstance activity action int and hasattr activity action id dcnl dcsp dcsp activity action activity action id dcnl dcsp return mkt log approve version id approval mkt log approve version private id approve version private mkt log app disabled id disabled mkt log escalate manual id escalation mkt log escalate version id escalation mkt log escalation vip app id escalation mkt log escalated high abuse id escalation high abuse mkt log escalated high refunds id escalation high refunds mkt log escalation cleared id escalation cleared mkt log request information id more info required mkt log reject version id rejection mkt log rereview cleared id rereview cleared mkt log webapp resubmit id resubmission mkt log comment version id reviewer comment mkt log review features override id review features override mkt log review device override id review device override mkt log rereview manifest change id rereview manifest change mkt log rereview manifest url change id rereview manifest url change mkt log rereview premium type upgrade id rereview premium type upgrade mkt log rereview devices added id rereview devices added mkt log rereview features changed id rereview features changed mkt log rereview manual id rereview manual mkt log content rating to adult id rereview content rating adult mkt log escalation vip app id escalation vip app mkt log escalation prerelease app id escalation prerelease app mkt log priority review requested id priority review requested mkt log pass additional review id additional review passed mkt log fail additional review id additional review failed mkt log rereview abuse app id rereview abuse app get activity action no action
def all ratings dcsp all ratings dcnl dcsp for rb in ratings bodies values dcnl dcsp dcsp all ratings extend rb ratings dcnl dcsp return all ratings
def ratings by name dcsp all ratings all ratings dcnl dcsp ratings choices dcnl dcsp for rb in ratings bodies values dcnl dcsp dcsp for r in rb ratings dcnl dcsp dcsp dcsp ratings choices append all ratings index r u s dcsp dcsp s rb name dehydrate rating r name dcnl dcsp return ratings choices
def slugify iarc name obj dcsp return obj iarc name lower replace dcsp
def dehydrate rating rating class dcsp rating rating class dcnl dcsp if rating label is none dcnl dcsp dcsp rating label str rating age or slugify iarc name rating dcnl dcsp if rating name is none dcnl dcsp dcsp if rating age 0 dcnl dcsp dcsp dcsp rating name unicode name general dcnl dcsp dcsp else dcnl dcsp dcsp dcsp rating name unicode name lazy rating age dcnl dcsp rating name unicode rating name dcnl dcsp return rating
def dehydrate ratings body body class dcsp body body class dcnl dcsp if body label is none dcnl dcsp dcsp body label slugify iarc name body dcnl dcsp body name unicode body name dcnl dcsp body description unicode body description dcnl dcsp return body
def pth path dcsp return img icons ratings + path
task dcnl use master dcnl def fetch icon pk version pk none kw dcsp from mkt extensions models import extension dcnl dcsp extension extension objects get pk pk dcnl dcsp if version pk dcnl dcsp dcsp version extension versions get pk version pk dcnl dcsp else dcnl dcsp dcsp version extension latest public version dcnl dcsp icon path version manifest get icons get 128 lstrip dcnl dcsp if not icon path dcnl dcsp dcsp return dcnl dcsp with private storage open version file path as fd dcnl dcsp dcsp with zipfile fd as zfd dcnl dcsp dcsp dcsp icon contents zfd read icon path dcnl dcsp save icon extension icon contents
def reset extensions translations locales apps schema editor dcsp extension apps get model u extensions u extension dcnl dcsp translation apps get model u translations u translation dcnl dcsp extensions extension objects all dcnl dcsp for extension in extensions dcnl dcsp dcsp translations ids filter none extension name id extension description id dcnl dcsp dcsp lang extension default language lower dcnl dcsp dcsp translation objects filter id in translations ids update locale lang
receiver models signals post delete models signals post save sender extensionversion dispatch uid extension version change dcnl def update extension status and manifest fields sender instance kw dcsp instance extension update status according to versions dcnl dcsp if instance status status public dcnl dcsp dcsp instance extension update manifest fields from latest public version
def download signed request uuid kwargs dcsp extension get object or 404 extension objects without deleted public uuid uuid dcnl dcsp version get object or 404 extension versions without deleted public pk kwargs version id dcnl dcsp log info downloading dcsp public dcsp addon dcsp s dcsp version dcsp s dcsp from dcsp s extension pk version pk version signed file path dcnl dcsp return download request extension version version signed file path
def download signed reviewer request uuid kwargs dcsp extension get object or 404 extension objects without deleted uuid uuid dcnl dcsp version get object or 404 extension versions without deleted pk kwargs version id dcnl dcsp def is reviewer dcnl dcsp dcsp return action allowed request contenttools addonreview dcnl dcsp if request user is authenticated and is reviewer dcnl dcsp dcsp version reviewer sign if necessary dcnl dcsp dcsp log info downloading dcsp reviewers dcsp signed dcsp addon dcsp s dcsp version dcsp s dcsp from dcsp s extension pk version pk version reviewer signed file path dcnl dcsp dcsp return download request extension version version reviewer signed file path public false dcnl dcsp else dcnl dcsp dcsp raise permissiondenied
def download unsigned request uuid kwargs dcsp extension get object or 404 extension objects without deleted uuid uuid dcnl dcsp version get object or 404 extension versions without deleted pk kwargs version id dcnl dcsp def is author dcnl dcsp dcsp return extension authors filter pk request user pk exists dcnl dcsp def is reviewer dcnl dcsp dcsp return action allowed request contenttools addonreview dcnl dcsp if request user is authenticated and is author or is reviewer dcnl dcsp dcsp log info downloading dcsp unsigned dcsp addon dcsp s dcsp version dcsp s dcsp from dcsp s extension pk version pk version file path dcnl dcsp dcsp return download request extension version version file path public false dcnl dcsp else dcnl dcsp dcsp raise permissiondenied
def del by key data delete dcsp data list data dcnl dcsp for idx item in enumerate data dcnl dcsp dcsp if isinstance item0 basestring and item0 delete or isinstance item0 list tuple and item0 in delete dcnl dcsp dcsp dcsp del dataidx dcnl dcsp return data
def guess language text dcsp guess confidence classify text dcnl dcsp if confidence < 0 7 dcnl dcsp dcsp return none dcnl dcsp elif confidence < 0 9 dcnl dcsp dcsp word count len re findall w + text dcnl dcsp dcsp if word count < 3 dcnl dcsp dcsp dcsp return none dcnl dcsp return guess
def string to translatedfield value text dcsp guess guess language text dcnl dcsp if guess dcnl dcsp dcsp lang find language guess lower dcnl dcsp dcsp if lang dcnl dcsp dcsp dcsp return lang text dcnl dcsp return settings shorter languages en lower text
def submit step outer step dcsp def decorator f dcnl dcsp dcsp functools wraps f dcnl dcsp dcsp def wrapper request args kw dcnl dcsp dcsp dcsp from mkt submit views import resume dcnl dcsp dcsp dcsp from mkt submit models import appsubmissionchecklist dcnl dcsp dcsp dcsp addon kw get addon false dcnl dcsp dcsp dcsp if addon dcnl dcsp dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp dcsp step addon appsubmissionchecklist get next dcnl dcsp dcsp dcsp dcsp except appsubmissionchecklist doesnotexist dcnl dcsp dcsp dcsp dcsp dcsp step none dcnl dcsp dcsp dcsp dcsp if step and step outer step dcnl dcsp dcsp dcsp dcsp dcsp return resume addon step dcnl dcsp dcsp dcsp return f request args kw dcnl dcsp dcsp wrapper submitting true dcnl dcsp dcsp return wrapper dcnl dcsp return decorator
def read dev agreement required f dcsp def decorator f dcnl dcsp dcsp functools wraps f dcnl dcsp dcsp def wrapper request args kw dcnl dcsp dcsp dcsp if not request user read dev agreement dcnl dcsp dcsp dcsp dcsp return redirect submit app dcnl dcsp dcsp dcsp return f request args kw dcnl dcsp dcsp return wrapper dcnl dcsp return decorator f
def submit request dcsp if not request user is authenticated dcnl dcsp dcsp return proceed request dcnl dcsp user userprofile objects get pk request user id dcnl dcsp if not user read dev agreement dcnl dcsp dcsp return redirect submit app terms dcnl dcsp return manifest request
def proceed request dcsp if request user is authenticated dcnl dcsp dcsp return submit request dcnl dcsp agreement form forms devagreementform read dev agreement true instance none request request dcnl dcsp return render request submit terms html step terms agreement form agreement form proceed true
def walk storage path topdown true onerror none followlinks false storage private storage dcsp if not topdown dcnl dcsp dcsp raise notimplementederror dcnl dcsp if onerror dcnl dcsp dcsp raise notimplementederror dcnl dcsp roots path dcnl dcsp while len roots dcnl dcsp dcsp new roots dcnl dcsp dcsp for root in roots dcnl dcsp dcsp dcsp dirs files storage listdir root dcnl dcsp dcsp dcsp files smart str f for f in files dcnl dcsp dcsp dcsp dirs smart str d for d in dirs dcnl dcsp dcsp dcsp yield root dirs files dcnl dcsp dcsp dcsp for dn in dirs dcnl dcsp dcsp dcsp dcsp new roots append s s root dn dcnl dcsp dcsp roots new roots
def copy stored file src path dst path src storage private storage dst storage private storage dcsp if src path dst path and src storage class dst storage class dcnl dcsp dcsp return dcnl dcsp with src storage open src path rb as src dcnl dcsp dcsp with dst storage open dst path wb as dest dcnl dcsp dcsp dcsp shutil copyfileobj src dest
def move stored file src path dst path src storage private storage dst storage private storage dcsp copy stored file src path dst path src storage src storage dst storage dst storage dcnl dcsp src storage delete src path
def log action args kw dcsp from mkt import get user dcnl dcsp from mkt developers models import activitylog applog commentlog grouplog userlog versionlog dcnl dcsp from mkt access models import group dcnl dcsp from mkt site utils import log as logger log dcnl dcsp from mkt webapps models import webapp dcnl dcsp from mkt users models import userprofile dcnl dcsp from mkt versions models import version dcnl dcsp user kw get user get user dcnl dcsp if not user dcnl dcsp dcsp logger log warning activity dcsp log dcsp called dcsp with dcsp no dcsp user dcsp s action id dcnl dcsp dcsp return dcnl dcsp al activitylog user user action action id dcnl dcsp al arguments args dcnl dcsp if details in kw dcnl dcsp dcsp al details kw details dcnl dcsp al save dcnl dcsp if details in kw and comments in al details dcnl dcsp dcsp commentlog comments al details comments activity log al save dcnl dcsp if created in kw dcnl dcsp dcsp al created kw created dcnl dcsp dcsp al save dcnl dcsp for arg in args dcnl dcsp dcsp if isinstance arg tuple dcnl dcsp dcsp dcsp if arg0 webapp dcnl dcsp dcsp dcsp dcsp applog addon id arg1 activity log al save dcnl dcsp dcsp dcsp elif arg0 version dcnl dcsp dcsp dcsp dcsp versionlog version id arg1 activity log al save dcnl dcsp dcsp dcsp elif arg0 userprofile dcnl dcsp dcsp dcsp dcsp userlog user id arg1 activity log al save dcnl dcsp dcsp dcsp elif arg0 group dcnl dcsp dcsp dcsp dcsp grouplog group id arg1 activity log al save dcnl dcsp dcsp if isinstance arg webapp dcnl dcsp dcsp dcsp applog addon arg activity log al save dcnl dcsp dcsp elif isinstance arg version dcnl dcsp dcsp dcsp versionlog version arg activity log al save dcnl dcsp dcsp elif isinstance arg userprofile dcnl dcsp dcsp dcsp userlog activity log al user arg save dcnl dcsp dcsp elif isinstance arg group dcnl dcsp dcsp dcsp grouplog group arg activity log al save dcnl dcsp userlog activity log al user user save dcnl dcsp return al
task dcnl use master dcnl def set modified on object app label model name pk kw dcsp model apps get model app label model name dcnl dcsp obj model objects get pk pk dcnl dcsp try dcnl dcsp dcsp log info setting dcsp modified dcsp on dcsp object dcsp s dcsp s model name pk dcnl dcsp dcsp obj update modified datetime datetime now kw dcnl dcsp except exception as e dcnl dcsp dcsp log error failed dcsp to dcsp set dcsp modified dcsp on dcsp s dcsp s dcsp dcsp s model name pk e
def send mail subject message from email none recipient list none fail silently false use blocked true perm setting none manage url none headers none cc none html message none attachments none async false max retries none dcsp if not recipient list dcnl dcsp dcsp return true dcnl dcsp if isinstance recipient list basestring dcnl dcsp dcsp raise valueerror recipient list dcsp should dcsp be dcsp a dcsp list dcsp not dcsp a dcsp string dcnl dcsp if perm setting dcnl dcsp dcsp if isinstance perm setting str dcnl dcsp dcsp dcsp perm setting notifications by shortperm setting dcnl dcsp dcsp perms dict usernotification objects filter user email in recipient list notification id perm setting id values list user email enabled dcnl dcsp dcsp d perm setting default checked dcnl dcsp dcsp recipient list e for e in recipient list if e and perms setdefault e d dcnl dcsp if use blocked dcnl dcsp dcsp not blocked dcnl dcsp dcsp for email in recipient list dcnl dcsp dcsp dcsp if email and email lower in settings email blocked dcnl dcsp dcsp dcsp dcsp log debug blocked dcsp email dcsp removed dcsp from dcsp list dcsp s email dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp not blocked append email dcnl dcsp dcsp recipient list not blocked dcnl dcsp if settings send real email dcnl dcsp dcsp fake recipient list dcnl dcsp dcsp real recipient list recipient list dcnl dcsp else dcnl dcsp dcsp real email regexes real email regexes dcnl dcsp dcsp if real email regexes dcnl dcsp dcsp dcsp fake recipient list dcnl dcsp dcsp dcsp real recipient list dcnl dcsp dcsp dcsp for email in recipient list dcnl dcsp dcsp dcsp dcsp if email and any regex match email lower for regex in real email regexes dcnl dcsp dcsp dcsp dcsp dcsp log debug real dcsp email dcsp encountered dcsp s dcsp dcsp sending email dcnl dcsp dcsp dcsp dcsp dcsp real recipient list append email dcnl dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp fake recipient list append email dcnl dcsp dcsp else dcnl dcsp dcsp dcsp fake recipient list recipient list dcnl dcsp dcsp dcsp real recipient list dcnl dcsp if not from email dcnl dcsp dcsp from email settings default from email dcnl dcsp if cc dcnl dcsp dcsp if isinstance cc basestring dcnl dcsp dcsp dcsp cc cc dcnl dcsp if not headers dcnl dcsp dcsp headers dcnl dcsp def send recipient message real email options dcnl dcsp dcsp kwargs async async attachments attachments cc cc fail silently fail silently from email from email headers headers html message html message max retries max retries real email real email dcnl dcsp dcsp kwargs update options dcnl dcsp dcsp args recipient dcsp join subject splitlines message dcnl dcsp dcsp if async dcnl dcsp dcsp dcsp return send email delay args kwargs dcnl dcsp dcsp else dcnl dcsp dcsp dcsp return send email args kwargs dcnl dcsp if fake recipient list dcnl dcsp dcsp result send fake recipient list message message real email false html message html message attachments attachments dcnl dcsp else dcnl dcsp dcsp result true dcnl dcsp if result and real recipient list dcnl dcsp dcsp result send real recipient list message message real email true html message html message attachments attachments dcnl dcsp return result
def send mail jinja subject template context args kwargs dcsp autoescape orig env autoescape dcnl dcsp env autoescape false dcnl dcsp template env get template template dcnl dcsp msg send mail subject template render context args kwargs dcnl dcsp env autoescape autoescape orig dcnl dcsp return msg
def send html mail jinja subject html template text template context args kwargs dcsp autoescape orig env autoescape dcnl dcsp env autoescape false dcnl dcsp html template env get template html template dcnl dcsp text template env get template text template dcnl dcsp msg send mail subject text template render context html message html template render context args kwargs dcnl dcsp env autoescape autoescape orig dcnl dcsp return msg
def load helpers dcsp if jingo helpers loaded dcnl dcsp dcsp return dcnl dcsp jingo helpers loaded true dcnl dcsp from jingo import helpers dcnl dcsp for app in settings installed apps dcnl dcsp dcsp try dcnl dcsp dcsp dcsp app path import module app path dcnl dcsp dcsp except attributeerror dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp try dcnl dcsp dcsp dcsp imp find module helpers app path dcnl dcsp dcsp except importerror dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp import module s helpers app
def epoch t dcsp if not hasattr t tzinfo dcnl dcsp dcsp return dcnl dcsp return int time mktime append tz t timetuple
def sorted groupby seq key dcsp if not hasattr key call dcnl dcsp dcsp key operator attrgetter key dcnl dcsp return itertools groupby sorted seq key key key key
def paginate request queryset per page 20 count none dcsp p espaginator if isinstance queryset search else paginator paginator queryset per page dcnl dcsp if count is not none dcnl dcsp dcsp p count count dcnl dcsp try dcnl dcsp dcsp page int request get get page 1 dcnl dcsp except valueerror dcnl dcsp dcsp page 1 dcnl dcsp try dcnl dcsp dcsp paginated p page page dcnl dcsp except paginator emptypage paginator invalidpage dcnl dcsp dcsp paginated p page 1 dcnl dcsp paginated url u s s request path request get urlencode dcnl dcsp return paginated
def chunked seq n dcsp seq iter seq dcnl dcsp while 1 dcnl dcsp dcsp rv list itertools islice seq 0 n dcnl dcsp dcsp if not rv dcnl dcsp dcsp dcsp break dcnl dcsp dcsp yield rv
def urlencode items dcsp try dcnl dcsp dcsp return urllib urlencode items dcnl dcsp except unicodeencodeerror dcnl dcsp dcsp return urllib urlencode k smart str v for k v in items
def slug validator s ok slug ok lower true spaces false delimiter message validate slug message code validate slug code dcsp if not s and slugify s ok lower spaces delimiter s dcnl dcsp dcsp raise validationerror message code code
def resize image src dst size none remove src true src storage private storage dst storage public storage dcsp if src dst dcnl dcsp dcsp raise exception src dcsp and dcsp dst dcsp can t dcsp be dcsp the dcsp same dcsp s src dcnl dcsp with src storage open src rb as fp dcnl dcsp dcsp im image open fp dcnl dcsp dcsp im im convert rgba dcnl dcsp dcsp if size dcnl dcsp dcsp dcsp im processors scale and crop im size dcnl dcsp with dst storage open dst wb as fp dcnl dcsp dcsp im save fp png dcnl dcsp if remove src dcnl dcsp dcsp src storage delete src dcnl dcsp return im size
def cache ns key namespace increment false dcsp ns key ns s namespace dcnl dcsp if increment dcnl dcsp dcsp try dcnl dcsp dcsp dcsp ns val cache incr ns key dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp log info cache dcsp increment dcsp failed dcsp for dcsp key dcsp s dcsp resetting ns key dcnl dcsp dcsp dcsp ns val epoch datetime datetime now dcnl dcsp dcsp dcsp cache set ns key ns val none dcnl dcsp else dcnl dcsp dcsp ns val cache get ns key dcnl dcsp dcsp if ns val is none dcnl dcsp dcsp dcsp ns val epoch datetime datetime now dcnl dcsp dcsp dcsp cache set ns key ns val none dcnl dcsp return s s ns val ns key
def smart path string dcsp if os path supports unicode filenames dcnl dcsp dcsp return smart unicode string dcnl dcsp return smart str string
def log cef name severity env args kwargs dcsp c cef product getattr settings cef product amo cef vendor getattr settings cef vendor mozilla cef version getattr settings cef version 0 cef device version getattr settings cef device version 0 cef file getattr settings cef file syslog dcnl dcsp if isinstance env httprequest dcnl dcsp dcsp r env meta copy dcnl dcsp dcsp if path info in r dcnl dcsp dcsp dcsp r path info env build absolute uri r path info dcnl dcsp elif isinstance env dict dcnl dcsp dcsp r env dcnl dcsp else dcnl dcsp dcsp r dcnl dcsp if settings use heka for cef dcnl dcsp dcsp return settings heka cef name severity r config c args kwargs dcnl dcsp else dcnl dcsp dcsp return log cef name severity r config c args kwargs
def escape all v linkify true dcsp if isinstance v basestring dcnl dcsp dcsp v jinja2 escape smart unicode v dcnl dcsp dcsp if linkify dcnl dcsp dcsp dcsp v bleach linkify v callbacks bleach callbacks nofollow dcnl dcsp dcsp return v dcnl dcsp elif isinstance v list dcnl dcsp dcsp for i lv in enumerate v dcnl dcsp dcsp dcsp vi escape all lv linkify linkify dcnl dcsp elif isinstance v dict dcnl dcsp dcsp for k lv in v iteritems dcnl dcsp dcsp dcsp vk escape all lv linkify linkify dcnl dcsp elif isinstance v translation dcnl dcsp dcsp v jinja2 escape smart unicode v localized string dcnl dcsp return v
def strip bom data dcsp for bom in codecs bom utf32 be codecs bom utf32 le codecs bom utf16 be codecs bom utf16 le codecs bom utf8 dcnl dcsp dcsp if data startswith bom dcnl dcsp dcsp dcsp data datalen bom dcnl dcsp dcsp dcsp break dcnl dcsp return data
def smart decode s dcsp if isinstance s unicode dcnl dcsp dcsp return s dcnl dcsp enc guess chardet detect s dcnl dcsp try dcnl dcsp dcsp return s decode enc guess encoding dcnl dcsp except unicodedecodeerror typeerror as exc dcnl dcsp dcsp msg error dcsp decoding dcsp string dcsp encoding dcsp r dcsp 2f dcsp sure dcsp s dcsp s dcnl dcsp dcsp log error msg enc guess encoding enc guess confidence 100 0 exc class name exc dcnl dcsp dcsp return unicode s errors replace
def rm local tmp dir path dcsp return shutil rmtree path
def timestamp index index dcsp return s s index datetime datetime now strftime y m d h m s
def get created created dcsp if created now dcnl dcsp dcsp return datetime datetime now dcnl dcsp elif created dcnl dcsp dcsp return created dcnl dcsp else dcnl dcsp dcsp return datetime datetime 2011 random randint 1 12 random randint 1 28 random randint 0 23 random randint 0 59 random randint 0 59
def app factory status mkt status public version kw file kw kw dcsp from mkt webapps models import update search index webapp dcnl dcsp post save disconnect update search index sender webapp dispatch uid webapp search index dcnl dcsp complete kw pop complete false dcnl dcsp rated kw pop rated false dcnl dcsp if complete dcnl dcsp dcsp kw setdefault support email support example com dcnl dcsp when get created kw pop created none dcnl dcsp name kw pop name u webapp dcsp s unicode uuid uuid4 replace dcnl dcsp kwargs status mkt status public name name app slug name replace dcsp lower 30 bayesian rating random uniform 1 5 created when last updated when dcnl dcsp kwargs update kw dcnl dcsp app webapp objects create kwargs dcnl dcsp version version factory file kw addon app version kw dcnl dcsp app status status dcnl dcsp app update version dcnl dcsp post save connect update search index sender webapp dispatch uid webapp search index dcnl dcsp app save dcnl dcsp if nomination in version kw dcnl dcsp dcsp version update nomination version kw nomination dcnl dcsp if rated or complete dcnl dcsp dcsp make rated app dcnl dcsp if complete dcnl dcsp dcsp if not app categories dcnl dcsp dcsp dcsp app update categories utilities dcnl dcsp dcsp app addondevicetype set create device type device types keys 0 dcnl dcsp dcsp app previews create dcnl dcsp return app
def get icon url base url format obj size default format default size png dcsp if not obj icon type dcnl dcsp dcsp return path name format path static url icons default url name default format format size size dcnl dcsp else dcnl dcsp dcsp suffix obj icon hash or never dcnl dcsp dcsp if storage is remote dcnl dcsp dcsp dcsp path s s s png obj get icon dir obj pk size dcnl dcsp dcsp dcsp return s modified s public storage url path suffix dcnl dcsp dcsp split id re match d d 1 3 str obj pk dcnl dcsp dcsp return base url format split id group 2 or 0 obj pk size suffix
def get promo img url base url format obj size default format default size png dcsp split id re match d d 1 3 str obj pk dcnl dcsp suffix obj promo img hash or never dcnl dcsp return base url format split id group 2 or 0 obj pk size suffix
def formset args kw dcsp prefix kw pop prefix form dcnl dcsp total count kw pop total count len args dcnl dcsp initial count kw pop initial count len args dcnl dcsp data prefix + total forms total count prefix + initial forms initial count dcnl dcsp for idx d in enumerate args dcnl dcsp dcsp data update s s s prefix idx k v for k v in d items dcnl dcsp data update kw dcnl dcsp return data
def initial form dcsp data dcnl dcsp for name field in form fields items dcnl dcsp dcsp if form is bound dcnl dcsp dcsp dcsp dataname formname data dcnl dcsp dcsp else dcnl dcsp dcsp dcsp dataname form initial get name field initial dcnl dcsp dcsp if isinstance field forms booleanfield dcnl dcsp dcsp dcsp val field to python dataname dcnl dcsp dcsp dcsp if not val dcnl dcsp dcsp dcsp dcsp del dataname dcnl dcsp return data
def check links expected elements selected none verify true dcsp for idx item in enumerate expected dcnl dcsp dcsp if isinstance item tuple dcnl dcsp dcsp dcsp text link item dcnl dcsp dcsp elif isinstance item basestring dcnl dcsp dcsp dcsp text link none item dcnl dcsp dcsp e elements eq idx dcnl dcsp dcsp if text is not none dcnl dcsp dcsp dcsp eq e text text dcnl dcsp dcsp if link is not none dcnl dcsp dcsp dcsp if not e filter a dcnl dcsp dcsp dcsp dcsp e e find a dcnl dcsp dcsp dcsp eq e attr href link dcnl dcsp dcsp dcsp if verify and link dcnl dcsp dcsp dcsp dcsp eq client head link follow true status code 200 r dcsp is dcsp dead link dcnl dcsp dcsp if text is not none and selected is not none dcnl dcsp dcsp dcsp e e filter selected dcsp sel or e parents selected dcsp sel dcnl dcsp dcsp dcsp eq bool e length text selected
def assert no validation errors validation dcsp if hasattr validation task error dcnl dcsp dcsp error validation task error dcnl dcsp else dcnl dcsp dcsp error validation error dcnl dcsp if error dcnl dcsp dcsp print 70 dcnl dcsp dcsp print error dcnl dcsp dcsp print 70 dcnl dcsp dcsp raise assertionerror unexpected dcsp task dcsp error dcsp s error rstrip split n 1
def get created created dcsp if created now dcnl dcsp dcsp return datetime now dcnl dcsp elif created dcnl dcsp dcsp return created dcnl dcsp else dcnl dcsp dcsp return datetime 2011 random randint 1 12 random randint 1 28 random randint 0 23 random randint 0 59 random randint 0 59
def req factory factory url user none post false data none kwargs dcsp req requestfactory dcnl dcsp if post dcnl dcsp dcsp req req post url data or dcnl dcsp else dcnl dcsp dcsp req req get url data or dcnl dcsp if user dcnl dcsp dcsp req user userprofile objects get id user id dcnl dcsp dcsp req groups user groups all dcnl dcsp else dcnl dcsp dcsp req user anonymoususer dcnl dcsp req check ownership partial check ownership req dcnl dcsp req region kwargs pop region mkt regions regions choices01 dcnl dcsp req api version 2 dcnl dcsp for key in kwargs dcnl dcsp dcsp setattr req key kwargskey dcnl dcsp return req
def user factory kw dcsp global user factory counter dcnl dcsp email kw pop email factoryuser d user factory counter dcnl dcsp if not in email dcnl dcsp dcsp email s mozilla com email dcnl dcsp user userprofile objects create email email kw dcnl dcsp if email not in kw dcnl dcsp dcsp user factory counter user id + 1 dcnl dcsp return user
def test mkt locale not in django dcsp activate mn dcnl dcsp en trans real translations enus dcnl dcsp mn trans real translations mn dcnl dcsp assert en mn dcnl dcsp assert en catalog mn catalog
def test ordering dcsp app1id app factory id dcnl dcsp app2id app factory id dcnl dcsp app3id app factory id dcnl dcsp semi arbitrary order app2id app3id app1id dcnl dcsp addons manual order webapp objects all semi arbitrary order dcnl dcsp eq semi arbitrary order addon id for addon in addons
def test finalize dcsp eq render dcsp x dcsp x none
def test json view dcsp response json view lambda r x 1 mock mock dcnl dcsp assert isinstance response http httpresponse dcnl dcsp eq response content x dcsp 1 dcnl dcsp eq response contenttype application json dcnl dcsp eq response status code 200
def test json view normal response dcsp expected http httpresponseforbidden dcnl dcsp response json view lambda r expected mock mock dcnl dcsp assert expected is response dcnl dcsp eq response contenttype text html dcsp charset utf8
def test json view error dcsp response json view error msg error dcnl dcsp assert isinstance response http httpresponsebadrequest dcnl dcsp eq response content msg dcsp error dcnl dcsp eq response contenttype application json
contextlib contextmanager dcnl def use master dcsp old getattr multidb pinning locals pinned false dcnl dcsp multidb pinning pin this thread dcnl dcsp try dcnl dcsp dcsp yield dcnl dcsp finally dcnl dcsp dcsp multidb pinning locals pinned old
def manual order qs pks pk name id dcsp if not pks dcnl dcsp dcsp return qs none dcnl dcsp return qs filter id in pks extra select manual field s dcsp s pk name join map str pks order by manual
def global settings request dcsp account links dcnl dcsp tools links dcnl dcsp footer links dcnl dcsp context dcnl dcsp tools title tools dcnl dcsp context user request user dcnl dcsp if request user is authenticated dcnl dcsp dcsp context is reviewer acl check reviewer request dcnl dcsp dcsp account links text account dcsp settings href settings text change dcsp password href https login persona org signin text sign dcsp out href reverse users logout dcnl dcsp dcsp if developers not in request path dcnl dcsp dcsp dcsp tools links append text developer dcsp hub href reverse ecosystem landing dcnl dcsp dcsp dcsp if request user is developer dcnl dcsp dcsp dcsp dcsp tools links append text my dcsp submissions href reverse mkt developers apps dcnl dcsp dcsp if reviewers not in request path and context is reviewer dcnl dcsp dcsp dcsp footer links append text reviewer dcsp tools href reverse reviewers apps queue pending dcnl dcsp dcsp if acl action allowed request accountlookup dcnl dcsp dcsp dcsp footer links append text lookup dcsp tool href reverse lookup home dcnl dcsp dcsp if acl action allowed request admin dcnl dcsp dcsp dcsp footer links append text admin dcsp tools href reverse zadmin home dcnl dcsp dcsp tools links + footer links dcnl dcsp dcsp logged true dcnl dcsp else dcnl dcsp dcsp logged false dcnl dcsp desktop getattr request tablet none or not getattr request mobile none dcnl dcsp context update account links account links settings settings mkt mkt tools links tools links tools title tools title footer links footer links admin message get config site notice collect timings percent get collect timings is admin acl action allowed request apps edit desktop desktop logged logged dcnl dcsp return context
register function dcnl jinja2 contextfunction dcnl def mkt breadcrumbs context product none items none crumb size 40 add default true cls none dcsp if add default dcnl dcsp dcsp crumbs reverse home home dcnl dcsp else dcnl dcsp dcsp crumbs dcnl dcsp if product dcnl dcsp dcsp if items dcnl dcsp dcsp dcsp url product get detail url dcnl dcsp dcsp else dcnl dcsp dcsp dcsp url none dcnl dcsp dcsp crumbs + none apps url product name dcnl dcsp if items dcnl dcsp dcsp crumbs extend items dcnl dcsp if len crumbs 1 dcnl dcsp dcsp crumbs dcnl dcsp crumbs u truncate label crumb size for u label in crumbs dcnl dcsp t env get template site helpers breadcrumbs html render breadcrumbs crumbs cls cls dcnl dcsp return jinja2 markup t
register function dcnl jinja2 contextfunction dcnl def get doc path context path extension dcsp lang getattr context request lang enus dcnl dcsp if lang in settings amo languages dcnl dcsp dcsp try dcnl dcsp dcsp dcsp localized file path s s s path lang extension dcnl dcsp dcsp dcsp with open localized file path dcnl dcsp dcsp dcsp dcsp return localized file path dcnl dcsp dcsp except ioerror dcnl dcsp dcsp dcsp return s enus s path extension
register filter dcnl def absolutify url site none dcsp if url startswith http dcnl dcsp dcsp return url dcnl dcsp else dcnl dcsp dcsp return urljoin site or settings site url url
register function dcnl def url viewname args kwargs dcsp host kwargs pop host dcnl dcsp src kwargs pop src dcnl dcsp url s s host reverse viewname args args kwargs kwargs dcnl dcsp if src dcnl dcsp dcsp url helpers urlparams url src src dcnl dcsp return url
register function dcnl jinja2 contextfunction dcnl def media context url key media url dcsp if build id in context dcnl dcsp dcsp build context build id dcnl dcsp elif url endswith js dcnl dcsp dcsp build context build id js dcnl dcsp elif url endswith css dcnl dcsp dcsp build context build id css dcnl dcsp else dcnl dcsp dcsp build context build id img dcnl dcsp return urljoin contextkey helpers urlparams url b build
register function dcnl jinja2 contextfunction dcnl def static context url dcsp return media context url static url
register filter dcnl def f string args kwargs dcsp if not isinstance string text type dcnl dcsp dcsp string text type string dcnl dcsp return string format args kwargs
def strip controls s dcsp control trans dict n none for n in xrange 32 if n not in 10 13 dcnl dcsp rv unicode s translate control trans dcnl dcsp return jinja2 markup rv if isinstance s jinja2 markup else rv
register filter dcnl def isotime t dcsp if not hasattr t tzinfo dcnl dcsp dcsp return dcnl dcsp return append tz t astimezone pytz utc strftime y m dt h m sz
def login required f none redirect true dcsp def decorator func dcnl dcsp dcsp functools wraps func dcnl dcsp dcsp def wrapper request args kw dcnl dcsp dcsp dcsp if request user is authenticated dcnl dcsp dcsp dcsp dcsp return func request args kw dcnl dcsp dcsp dcsp elif redirect dcnl dcsp dcsp dcsp dcsp return redirect for login request dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp return http httpresponse status 401 dcnl dcsp dcsp return wrapper dcnl dcsp if f dcnl dcsp dcsp return decorator f dcnl dcsp else dcnl dcsp dcsp return decorator
def permission required pairs dcsp def decorator f dcnl dcsp dcsp functools wraps f dcnl dcsp dcsp login required dcnl dcsp dcsp def wrapper request args kw dcnl dcsp dcsp dcsp from mkt access import acl dcnl dcsp dcsp dcsp for app action in pairs dcnl dcsp dcsp dcsp dcsp if acl action allowed request app action dcnl dcsp dcsp dcsp dcsp dcsp return f request args kw dcnl dcsp dcsp dcsp raise permissiondenied dcnl dcsp dcsp return wrapper dcnl dcsp return decorator
def json response response has trans false status code 200 dcsp if has trans dcnl dcsp dcsp response json dumps response cls jsonencoder dcnl dcsp else dcnl dcsp dcsp response json dumps response dcnl dcsp return http httpresponse response content type application json status status code
def set modified on f dcsp from mkt site tasks import set modified on object dcnl dcsp functools wraps f dcnl dcsp def wrapper args kw dcnl dcsp dcsp objs kw pop set modified on none dcnl dcsp dcsp result f args kw dcnl dcsp dcsp if objs and result dcnl dcsp dcsp dcsp extra kwargs result if isinstance result dict else dcnl dcsp dcsp dcsp for obj in objs dcnl dcsp dcsp dcsp dcsp task log info delaying dcsp setting dcsp modified dcsp on dcsp object dcsp s dcsp s obj class name obj pk dcnl dcsp dcsp dcsp dcsp set modified on object apply async args obj meta app label obj meta model name obj pk kwargs extra kwargs eta datetime datetime now + datetime timedelta seconds settings nfs lag delay dcnl dcsp dcsp return result dcnl dcsp return wrapper
def allow cross site request f dcsp functools wraps f dcnl dcsp def wrapper request args kw dcnl dcsp dcsp response f request args kw dcnl dcsp dcsp if dcsp accesscontrolallowcredentials dcsp isn t dcsp set dcsp the dcsp browser dcsp won t n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp return dcsp data dcsp required dcsp cookies dcsp to dcsp see dcsp dcsp this dcsp is dcsp a dcsp good dcsp thing dcsp let s dcsp keep n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp it dcsp that dcsp way dcnl dcsp dcsp response accesscontrolalloworigin dcnl dcsp dcsp response accesscontrolallowmethods get dcsp options dcnl dcsp dcsp return response dcnl dcsp return wrapper
def set task user f dcsp functools wraps f dcnl dcsp def wrapper args kw dcnl dcsp dcsp old user get user dcnl dcsp dcsp set user get task user dcnl dcsp dcsp try dcnl dcsp dcsp dcsp result f args kw dcnl dcsp dcsp finally dcnl dcsp dcsp dcsp set user old user dcnl dcsp dcsp return result dcnl dcsp return wrapper
def package minifest request dcsp if not settings marketplace guid dcnl dcsp dcsp return httpresponsenotfound dcnl dcsp return mini manifest request settings marketplace guid
def yogafire minifest request dcsp if not settings yogafire guid dcnl dcsp dcsp return httpresponsenotfound dcnl dcsp return mini manifest request settings yogafire guid
def robots request dcsp template render request site robots txt dcnl dcsp return httpresponse template content type text plain
csrf exempt dcnl require post dcnl def cspreport request dcsp report blockeduri violateddirective originalpolicy dcnl dcsp if not waffle sample is active cspstorereports dcnl dcsp dcsp return httpresponse dcnl dcsp try dcnl dcsp dcsp v json loads request body cspreport dcnl dcsp dcsp meta request meta copy dcnl dcsp dcsp meta path info v get documenturi meta path info dcnl dcsp dcsp v k vk for k in report if k in v dcnl dcsp dcsp log cef cspviolation 5 meta signature cspreport msg a dcsp client dcsp reported dcsp a dcsp csp dcsp violation cs6 v cs6label contentpolicy dcnl dcsp except keyerror valueerror as e dcnl dcsp dcsp log debug exception dcsp in dcsp csp dcsp report dcsp s e exc info true dcnl dcsp dcsp return httpresponsebadrequest dcnl dcsp return httpresponse
contextlib contextmanager dcnl def safe query string request dcsp qs request meta get query string dcnl dcsp try dcnl dcsp dcsp request meta query string iri to uri qs dcnl dcsp dcsp yield dcnl dcsp finally dcnl dcsp dcsp request meta query string qs
def transaction summary tx uuid dcsp contrib get object or 404 contribution uuid tx uuid dcnl dcsp contrib id contrib transaction id dcnl dcsp refund contribs contrib get refund contribs dcnl dcsp refund contrib refund contribs0 if refund contribs exists else none dcnl dcsp lookup status true transaction true dcnl dcsp pay dcnl dcsp try dcnl dcsp dcsp pay client api generic transaction get object or 404 uuid contrib id dcnl dcsp except objectdoesnotexist dcnl dcsp dcsp log warning transaction dcsp not dcsp found dcsp in dcsp solitude dcsp 0 format tx uuid dcnl dcsp dcsp lookup transaction false dcnl dcsp if pay get provider provider bango dcnl dcsp dcsp try dcnl dcsp dcsp dcsp pay package id client api by url pay seller get object or 404 bango package id dcnl dcsp dcsp except keyerror objectdoesnotexist dcnl dcsp dcsp dcsp log warning failed dcsp to dcsp find dcsp bango dcsp package id dcsp 0 format tx uuid dcnl dcsp refund status none dcnl dcsp if refund contrib and refund contrib refund status mkt refund pending dcnl dcsp dcsp try dcnl dcsp dcsp dcsp status client api bango refund get object or 404 data uuid refund contrib transaction id dcnl dcsp dcsp dcsp refund status solitude refund statusesstatus status dcnl dcsp dcsp except keyerror httpservererror dcnl dcsp dcsp dcsp lookup status false dcnl dcsp dcsp dcsp log warning refund dcsp lookup dcsp failed dcsp 0 format tx uuid dcnl dcsp return lookup lookup amount pay get amount currency pay get currency package id pay get package id provider provider lookup get pay get provider refund status refund status support pay get uid support timestamp pay get created app contrib addon contrib contrib related contrib related type mkt contrib types get contrib type incomplete is refundable contrib type mkt contrib purchase and not refund contrib
permission required accountlookup view dcnl def app activity request addon id dcsp app get object or 404 webapp with deleted pk addon id dcnl dcsp user items activitylog objects for apps app exclude action in mkt log hide developer dcnl dcsp admin items activitylog objects for apps app filter action in mkt log hide developer dcnl dcsp user items paginate request user items per page 20 dcnl dcsp admin items paginate request admin items per page 20 dcnl dcsp return render request lookup app activity html admin items admin items app app user items user items
permission required accountlookup view dcnl def user purchases request user id dcsp user get object or 404 userprofile pk user id dcnl dcsp is admin acl action allowed request users edit dcnl dcsp products purchase list request user dcnl dcsp return render request lookup user purchases html pager products account user is admin is admin single bool none show link false
permission required accountlookup view dcnl def user activity request user id dcsp user get object or 404 userprofile pk user id dcnl dcsp products purchase list request user dcnl dcsp is admin acl action allowed request users edit dcnl dcsp user items activitylog objects for user user exclude action in mkt log hide developer dcnl dcsp admin items activitylog objects for user user filter action in mkt log hide developer dcnl dcsp mkt log mkt log admin viewed log request user user user dcnl dcsp return render request lookup user activity html pager products account user is admin is admin single bool none user items user items admin items admin items show link false
def get payment provider portals app none user none dcsp provider portals dcnl dcsp if app dcnl dcsp dcsp q dict addon app dcnl dcsp elif user dcnl dcsp dcsp q dict payment account user user dcnl dcsp else dcnl dcsp dcsp raise valueerror user dcsp or dcsp app dcsp is dcsp required dcnl dcsp for acct in addonpaymentaccount objects filter q select related payment account dcnl dcsp dcsp provider get provider id acct payment account provider dcnl dcsp dcsp portal url provider get portal url acct addon app slug dcnl dcsp dcsp if portal url dcnl dcsp dcsp dcsp provider portals append provider provider app acct addon portal url portal url payment account acct payment account dcnl dcsp return provider portals
task dcnl use master dcnl def update supported locales single id latest false kw dcsp from mkt webapps models import webapp dcnl dcsp try dcnl dcsp dcsp app webapp objects get pk id dcnl dcsp except webapp doesnotexist dcnl dcsp dcsp log info u webapp s dcsp did dcsp not dcsp find dcsp webapp dcsp to dcsp update dcsp supported dcsp locales id dcnl dcsp dcsp return dcnl dcsp try dcnl dcsp dcsp if app update supported locales latest latest dcnl dcsp dcsp dcsp log info u webapp s dcsp updated dcsp supported dcsp locales app id dcnl dcsp except exception dcnl dcsp dcsp log info u webapp s dcsp updating dcsp supported dcsp locales dcsp failed app id exc info true
def inherit nomination sender instance kw dcsp if kw get raw dcnl dcsp dcsp return dcnl dcsp addon instance addon dcnl dcsp if addon is packaged dcnl dcsp dcsp last ver version objects filter addon addon exclude pk instance pk order by nomination dcnl dcsp dcsp if last ver exists and last ver0 all files0 status mkt status pending dcnl dcsp dcsp dcsp instance update nomination last ver0 nomination signal false dcnl dcsp dcsp dcsp log debug webapp s dcsp inheriting dcsp nomination dcsp from dcsp prior dcsp pending dcsp version addon id dcnl dcsp dcsp elif addon status in mkt webapps approved statuses and not instance nomination dcnl dcsp dcsp dcsp log debug webapp s dcsp setting dcsp nomination dcsp date dcsp to dcsp now dcsp for dcsp new dcsp version addon id dcnl dcsp dcsp dcsp instance update nomination datetime datetime now signal false
def cleanup version sender instance kw dcsp if kw get raw dcnl dcsp dcsp return dcnl dcsp for file in instance files all dcnl dcsp dcsp cleanup file file class file
task dcnl def consume email email text kwargs dcsp res save from email reply email text dcnl dcsp if not res dcnl dcsp dcsp log error failed dcsp to dcsp save dcsp email
def create comm note obj version author body note type comm no action perms none attachments none dcsp perms perms or dcnl dcsp if developer not in perms and note type in comm reviewer note types dcnl dcsp dcsp perms developer false dcnl dcsp create perms dict read permission s key has perm for key has perm in perms iteritems dcnl dcsp version param dcnl dcsp if obj class webapp dcnl dcsp dcsp version param version version dcnl dcsp elif obj class extension dcnl dcsp dcsp version param extension version version dcnl dcsp thread created thread obj threads safer get or create defaults create perms version param dcnl dcsp note thread notes create note type note type body body author author create perms dcnl dcsp if attachments dcnl dcsp dcsp create attachments note attachments dcnl dcsp post create comm note note dcnl dcsp return thread note
def post create comm note note dcsp thread note thread dcnl dcsp obj thread obj dcnl dcsp for developer in obj authors all dcnl dcsp dcsp thread join thread developer dcnl dcsp try dcnl dcsp dcsp nonuser mozilla contacts dcnl dcsp dcsp for email in obj get mozilla contacts dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp moz contact userprofile objects get email email dcnl dcsp dcsp dcsp dcsp thread join thread moz contact dcnl dcsp dcsp dcsp except userprofile doesnotexist dcnl dcsp dcsp dcsp dcsp nonuser mozilla contacts append none email dcnl dcsp dcsp utils mail email recipients nonuser mozilla contacts note extra context nonuser mozilla contact true dcnl dcsp except attributeerror dcnl dcsp dcsp pass dcnl dcsp author note author dcnl dcsp if author dcnl dcsp dcsp cc created cc thread join thread author dcnl dcsp utils mail send mail comm note
def create attachments note formset dcsp errors dcnl dcsp for form in formset dcnl dcsp dcsp if not form is valid dcnl dcsp dcsp dcsp errors append form errors dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp data form cleaned data dcnl dcsp dcsp if not data dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp attachment data attachment dcnl dcsp dcsp attachment name save attachment attachment s s settings reviewer attachments path attachment name dcnl dcsp dcsp note attachments create description data get description filepath attachment name mimetype attachment content type dcnl dcsp return errors
def save attachment attachment filepath dcsp filepath private storage save filepath attachment dcnl dcsp return filepath split 1
def check acls user obj acl type dcsp if acl type moz contact dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return user email in obj addon get mozilla contacts dcnl dcsp dcsp except attributeerror dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp return user email in obj thread addon get mozilla contacts dcnl dcsp dcsp dcsp except attributeerror dcnl dcsp dcsp dcsp dcsp return false dcnl dcsp elif acl type admin dcnl dcsp dcsp return acl action allowed user user admin dcnl dcsp elif acl type reviewer dcnl dcsp dcsp return acl action allowed user user apps review or acl action allowed user user contenttools addonreview dcnl dcsp elif acl type senior reviewer dcnl dcsp dcsp return acl action allowed user user apps reviewescalated dcnl dcsp else dcnl dcsp dcsp raise exception invalid dcsp acl dcsp lookup dcnl dcsp return false
def check acls comm obj obj profile dcsp if obj read permission public dcnl dcsp dcsp return true dcnl dcsp if obj read permission reviewer and check acls profile obj reviewer dcnl dcsp dcsp return true dcnl dcsp if obj read permission senior reviewer and check acls profile obj senior reviewer dcnl dcsp dcsp return true dcnl dcsp if obj read permission mozilla contact and check acls profile obj moz contact dcnl dcsp dcsp return true dcnl dcsp if obj read permission staff and check acls profile obj admin dcnl dcsp dcsp return true dcnl dcsp return false
def user has perm app user obj dcsp has perm false dcnl dcsp if obj class webapp dcnl dcsp dcsp has perm user addons filter pk obj id exists or user email in obj get mozilla contacts dcnl dcsp elif obj class extension dcnl dcsp dcsp has perm user extension set filter pk obj id exists dcnl dcsp return has perm or check acls user none reviewer or check acls user none senior reviewer or check acls user none admin
def user has perm thread thread profile dcsp user post communicationnote objects filter author profile thread thread dcnl dcsp user cc communicationthreadcc objects filter user profile thread thread dcnl dcsp if user post exists or user cc exists dcnl dcsp dcsp return true dcnl dcsp if thread read permission developer and thread check obj author profile dcnl dcsp dcsp return true dcnl dcsp return check acls comm obj thread profile
def user has perm note note profile request none dcsp if note author and note author id profile id dcnl dcsp dcsp return true dcnl dcsp if request and note note type comm reviewer comment dcnl dcsp dcsp return acl check reviewer request dcnl dcsp if request and note note type comm developer comment and acl check reviewer request dcnl dcsp dcsp return true dcnl dcsp user is author profile addons filter pk note thread addon id dcnl dcsp if user is author exists and note read permission developer or note note type comm reviewer public comment dcnl dcsp dcsp return true dcnl dcsp return check acls comm obj note profile
def send mail comm note dcsp log info u sending dcsp emails dcsp for dcsp s note thread obj dcnl dcsp if note note type in comm email senior reviewers and dev dcnl dcsp dcsp rev template comm email senior reviewers and devnote note type reviewer dcnl dcsp dcsp email recipients get senior reviewers note template rev template dcnl dcsp dcsp dev template comm email senior reviewers and devnote note type developer dcnl dcsp dcsp email recipients get developers note note template dev template dcnl dcsp else dcnl dcsp dcsp email recipients get recipients note note dcnl dcsp dcsp if note note type comm developer comment dcnl dcsp dcsp dcsp subject s dcsp s unicode comm note typesnote note type note thread obj name dcnl dcsp dcsp dcsp mail template comm comm mail map get note note type generic dcnl dcsp dcsp dcsp send mail jinja subject comm emails s html mail template get mail context note none recipient list settings mkt reviews email from email settings mkt reviewers email perm setting app reviewed
def get recipients note dcsp if note note type in comm email senior reviewers dcnl dcsp dcsp return get senior reviewers dcnl dcsp thread note thread dcnl dcsp recipients thread thread cc values list user id user email dcnl dcsp excludes dcnl dcsp if not note read permission developer dcnl dcsp dcsp excludes + get developers note dcnl dcsp if note author dcnl dcsp dcsp excludes append note author id note author email dcnl dcsp return r for r in set recipients if r not in excludes
def tokenize recipients recipients thread dcsp tokenized recipients dcnl dcsp for user id user email in recipients dcnl dcsp dcsp if not user id dcnl dcsp dcsp dcsp tokenized recipients append user email none none dcnl dcsp dcsp else dcnl dcsp dcsp dcsp tok get reply token thread user id dcnl dcsp dcsp dcsp tokenized recipients append user email user id tok uuid dcnl dcsp return tokenized recipients
def email recipients recipients note template none extra context none dcsp subject s dcsp s unicode comm note typesnote note type note thread obj name dcnl dcsp for email user id tok in tokenize recipients recipients note thread dcnl dcsp dcsp headers dcnl dcsp dcsp if tok dcnl dcsp dcsp dcsp headers replyto 0 1 2 format comm reply to prefix tok settings postfix domain dcnl dcsp dcsp mail template template or comm comm mail map get note note type generic dcnl dcsp dcsp context get mail context note user id dcnl dcsp dcsp context update extra context or dcnl dcsp dcsp send mail jinja subject comm emails s html mail template context recipient list email from email settings mkt reviewers email perm setting app reviewed headers headers
def get mail context note user id dcsp obj note thread obj dcnl dcsp if obj name and obj class webapp dcnl dcsp dcsp lang to language obj default locale dcnl dcsp dcsp with translation override lang dcnl dcsp dcsp dcsp obj webapp with deleted get id obj id dcnl dcsp elif not obj name dcnl dcsp dcsp obj name obj app slug if hasattr obj app slug else obj slug dcnl dcsp if user id dcnl dcsp dcsp userprofile objects get id user id dcnl dcsp manage url dcnl dcsp obj type dcnl dcsp thread url dcnl dcsp if obj class webapp dcnl dcsp dcsp manage url absolutify obj get dev url versions dcnl dcsp dcsp obj type app dcnl dcsp dcsp thread url absolutify reverse commonplace commbadge show thread args note thread id dcnl dcsp elif obj class extension dcnl dcsp dcsp manage url absolutify reverse commonplace content addon manage args obj slug dcnl dcsp dcsp obj type addon dcnl dcsp dcsp if user id dcnl dcsp dcsp dcsp user userprofile objects get id user id dcnl dcsp dcsp dcsp if acl action allowed user user contenttools addonreview dcnl dcsp dcsp dcsp dcsp thread url absolutify reverse commonplace content addon review args obj slug dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp thread url manage url dcnl dcsp return mkt mkt comm comm is app obj class webapp is extension obj class extension manage url manage url note note obj obj obj type obj type settings settings thread url thread url
allow cross site request dcnl def manifest request uuid dcsp try dcnl dcsp dcsp uuid hex uuid uuid hex dcnl dcsp except valueerror dcnl dcsp dcsp raise http404 dcnl dcsp langpack get object or 404 langpack pk uuid hex dcnl dcsp if langpack active or action allowed request langpacks dcnl dcsp dcsp manifest contents langpack etag langpack get minifest contents dcnl dcsp dcsp condition last modified func lambda request langpack modified etag func lambda request langpack etag dcnl dcsp dcsp def inner view request dcnl dcsp dcsp dcsp return httpresponse manifest contents content type manifest content type dcnl dcsp dcsp return inner view request dcnl dcsp raise http404
def get uuid app user dcsp try dcnl dcsp dcsp return app addonpurchase set get user user uuid dcnl dcsp except objectdoesnotexist dcnl dcsp dcsp return none
def sign data dcsp if settings signing server active dcnl dcsp dcsp return receipt sign data dcnl dcsp else dcnl dcsp dcsp return jwt encode data get key u rs512
def create receipt data webapp user uuid flavour none contrib none dcsp assert flavour in none developer inapp reviewer invalid dcsp flavour dcsp s flavour dcnl dcsp time calendar timegm time gmtime dcnl dcsp typ purchasereceipt dcnl dcsp storedata id int webapp pk dcnl dcsp expiry time + settings webapps receipt expiry seconds dcnl dcsp verify static url webapps receipt url dcnl dcsp if flavour inapp dcnl dcsp dcsp if not contrib dcnl dcsp dcsp dcsp raise valueerror a dcsp contribution dcsp object dcsp is dcsp required dcsp for dcsp inapp dcsp receipts dcnl dcsp dcsp if not contrib inapp product dcnl dcsp dcsp dcsp raise valueerror contribution dcsp c dcsp does dcsp not dcsp link dcsp to dcsp an dcsp inapp dcsp product format c contrib dcnl dcsp dcsp storedata contrib int contrib pk dcnl dcsp dcsp storedata inapp id contrib inapp product guid dcnl dcsp elif flavour in developer reviewer dcnl dcsp dcsp if not acl action allowed user user apps review or webapp has author user dcnl dcsp dcsp dcsp raise valueerror user dcsp s dcsp is dcsp not dcsp a dcsp reviewer dcsp or dcsp developer user pk dcnl dcsp dcsp expiry time + 60 60 24 dcnl dcsp dcsp typ flavour + receipt dcnl dcsp dcsp verify absolutify reverse receipt verify args webapp guid dcnl dcsp product storedata urlencode storedata url webapp origin or settings site url dcnl dcsp reissue absolutify reverse receipt reissue dcnl dcsp receipt dict exp expiry iat time iss settings site url nbf time product product detail absolutify reissue reissue absolutify reissue typ typ user type directedidentifier value uuid verify verify dcnl dcsp return receipt
def create inapp receipt contrib dcsp if contrib is inapp simulation dcnl dcsp dcsp storedata id 0 contrib int contrib pk inapp id contrib inapp product guid dcnl dcsp dcsp return create test receipt settings site url ok storedata storedata dcnl dcsp return create receipt contrib addon none anonymoususer flavour inapp contrib contrib
def reissue receipt receipt dcsp time calendar timegm time gmtime dcnl dcsp receipt obj receipt receipt dcnl dcsp data receipt obj receipt decoded dcnl dcsp data update exp time + settings webapps receipt expiry seconds iat time nbf time dcnl dcsp return sign data
def get key dcsp return jwt rsa load settings webapps receipt key
cors api view post headers contenttype accept xfxpayversion dcnl permission classes allowany dcnl def reissue request dcsp raw request read dcnl dcsp verify verify raw request meta dcnl dcsp output verify check full dcnl dcsp if output status expired dcnl dcsp dcsp log info receipt dcsp not dcsp expired dcsp returned dcsp 0 format output dcnl dcsp dcsp receipt cef log request request none sign receipt dcsp reissue dcsp failed dcnl dcsp dcsp output receipt dcnl dcsp dcsp return response output status 400 dcnl dcsp receipt cef log request request none sign receipt dcsp reissue dcsp signing dcnl dcsp return response reason receipt reissue receipt raw status expired
def match rules rules app action dcsp for rule in rules split dcnl dcsp dcsp rule app rule action rule split dcnl dcsp dcsp if rule app or rule app app dcnl dcsp dcsp dcsp if rule action or rule action action or action dcnl dcsp dcsp dcsp dcsp return true dcnl dcsp return false
def action allowed request app action dcsp allowed any match rules group rules app action for group in getattr request groups dcnl dcsp return allowed
def action allowed user user app action dcsp allowed any match rules group rules app action for group in user groups all dcnl dcsp return allowed
def check ownership request obj require owner false require author false ignore disabled false admin true dcsp if hasattr obj check ownership dcnl dcsp dcsp return obj check ownership request require owner require owner require author require author ignore disabled ignore disabled admin admin dcnl dcsp return false
def check addon ownership request addon viewer false dev false support false admin true ignore disabled false dcsp if not request user is authenticated dcnl dcsp dcsp return false dcnl dcsp if addon is deleted dcnl dcsp dcsp return false dcnl dcsp if admin and action allowed request apps edit dcnl dcsp dcsp return true dcnl dcsp if addon status mkt status disabled and not ignore disabled dcnl dcsp dcsp return false dcnl dcsp roles mkt author role owner dcnl dcsp if dev dcnl dcsp dcsp roles + mkt author role dev dcnl dcsp elif viewer dcnl dcsp dcsp roles + mkt author role dev mkt author role viewer mkt author role support dcnl dcsp elif support dcnl dcsp dcsp roles + mkt author role support dcnl dcsp return addon authors filter pk request user pk addonuser role in roles exists
anonymous csrf dcnl def landing request dcsp videos name airbnb path firefoxmarketplaceairbnbbrrcsd1 20640 name evernote path firefoxmarketplaceevernote brrcsd1 20640 name uken path firefoxmarketplaceukenbrrcsd1 20640 name soundcloud path firefoxmarketplacesoundcloudbrrcsd1 20640 name box path firefoxmarketplace boxbrrcsd1 20640 dcnl dcsp form devnewsletterform request lang request post or none dcnl dcsp if request method post and form is valid dcnl dcsp dcsp data form cleaned data dcnl dcsp dcsp try dcnl dcsp dcsp dcsp basket subscribe data email appdev format data email format source url settings site url dcnl dcsp dcsp dcsp messages success request thank dcsp you dcsp for dcsp subscribing dcnl dcsp dcsp dcsp return redirect ecosystem landing dcnl dcsp dcsp except basket basketexception as e dcnl dcsp dcsp dcsp log error basket dcsp exception dcsp in dcsp ecosystem dcsp newsletter dcsp s e dcnl dcsp dcsp dcsp messages error request we dcsp apologize dcsp but dcsp an dcsp error dcsp occurred dcsp in dcsp our dcsp system dcsp please dcsp try dcsp again dcsp later dcnl dcsp return render request ecosystem landing html videos videos newsletter form form
def support request dcsp return render request ecosystem support html page support category build
def partners request dcsp return render request ecosystem partners html page partners
def installation request dcsp return render request ecosystem installation html page installation category publish
def publish badges request dcsp return render request ecosystem publish badges html page badges category publish
allow cross site request dcnl def manifest request uuid dcsp try dcnl dcsp dcsp addon webapp objects all only translations get disabled by user false is packaged true guid uuid dcnl dcsp except webapp doesnotexist dcnl dcsp dcsp raise http http404 dcnl dcsp is available addon status in mkt status public mkt status unlisted mkt status blocked dcnl dcsp if is available dcnl dcsp dcsp is owner is available to owner false dcnl dcsp else dcnl dcsp dcsp is owner addon authors filter pk request user pk exists dcnl dcsp dcsp is available to owner addon status mkt status approved dcnl dcsp if is available or is available to owner and is owner dcnl dcsp dcsp manifest content manifest etag addon get cached manifest dcnl dcsp dcsp etag lambda r a manifest etag dcnl dcsp dcsp def inner view request addon dcnl dcsp dcsp dcsp response http httpresponse manifest content content type manifest content type dcnl dcsp dcsp dcsp return response dcnl dcsp dcsp return inner view request addon dcnl dcsp else dcnl dcsp dcsp raise http http404
def get local ip dcsp s socket socket socket af inet socket sock dgram dcnl dcsp s connect google com 80 dcnl dcsp ip s getsockname 0 dcnl dcsp s close dcnl dcsp return ip
task dcnl def pre index new index old index alias index name settings dcsp indexer indexer mapindex name dcnl dcsp print flagging dcsp the dcsp database dcsp to dcsp start dcsp the dcsp reindexation alias dcnl dcsp reindexing flag reindexing new index new index old index old index alias alias dcnl dcsp time sleep 5 dcnl dcsp print creating dcsp the dcsp mapping dcsp for dcsp index dcsp index format index new index alias dcnl dcsp settings settings settings mappings indexer get mapping dcnl dcsp try dcnl dcsp dcsp es indices create index new index body settings dcnl dcsp except elasticsearch elasticsearchexception as e dcnl dcsp dcsp raise commanderror error dcsp new dcsp index dcsp s dcsp already dcsp exists dcsp s new index e dcnl dcsp es cluster health index new index wait for status green wait for relocating shards 0
task dcnl def post index new index old index alias index name settings dcsp print optimizing dcsp updating dcsp settings dcsp and dcsp aliases alias dcnl dcsp es indices optimize index new index dcnl dcsp es indices put settings index new index body settings dcnl dcsp actions add index new index alias alias dcnl dcsp if old index dcnl dcsp dcsp actions append remove index old index alias alias dcnl dcsp es indices update aliases body dict actions actions dcnl dcsp print unflagging dcsp the dcsp database alias dcnl dcsp reindexing unflag reindexing alias alias dcnl dcsp print removing dcsp index dcsp index format index old index alias dcnl dcsp if old index and es indices exists index old index dcnl dcsp dcsp es indices delete index old index dcnl dcsp alias output dcnl dcsp for indexer in indexers dcnl dcsp dcsp alias es indexesindexer get mapping type name dcnl dcsp dcsp alias output + unicode es indices get aliases index alias + n dcnl dcsp print reindexation dcsp done dcsp current dcsp aliases dcsp configuration dcsp output n format output alias output alias
task ignore result false dcnl def run indexing index index name ids dcsp indexer indexer mapindex name dcnl dcsp indexer run indexing ids es index index
def chunk indexing indexer chunk size dcsp chunks list indexer get indexable values list id flat true dcnl dcsp return chunked chunks chunk size len chunks
def validate modules dcsp try dcnl dcsp dcsp jwt rsa load dcnl dcsp except attributeerror dcnl dcsp dcsp raise improperlyconfigured pyjwtmozilla dcsp not dcsp imported dcsp this dcsp is dcsp because dcsp there dcsp is dcsp another dcsp jwt dcsp module dcsp installed dcsp the dcsp jwt dcsp module dcsp imported dcsp is dcsp at dcsp 0 dcsp this dcsp can dcsp usually dcsp be dcsp fixed dcsp by dcsp running dcsp pip dcsp uninstall dcsp pyjwt dcsp and dcsp pip dcsp uninstall dcsp pyjwtmozilla dcsp and dcsp pip dcsp install dcsp force dcsp nodeps dcsp pyjwtmozilla format jwt file
def validate settings dcsp if settings debug or settings in test suite dcnl dcsp dcsp return dcnl dcsp for key value in secret key please dcsp change dcsp this session cookie secure false app purchase secret please dcsp change dcsp this dcnl dcsp dcsp if getattr settings key value dcnl dcsp dcsp dcsp raise improperlyconfigured 0 dcsp must dcsp be dcsp changed dcsp from dcsp default format key dcnl dcsp for key in csp script src dcnl dcsp dcsp for url in getattr settings key dcnl dcsp dcsp dcsp if url startswith http and url settings site url dcnl dcsp dcsp dcsp dcsp raise improperlyconfigured 0 dcsp has dcsp a dcsp http dcsp url dcsp 1 format key url
def static url url dcsp prefix icons default url settings media url addon icon url settings static url extension icon url settings static url preview thumbnail url settings static url preview full url settings static url product icon url settings media url webapps receipt url settings site url website icon url settings static url webapp promo img url settings static url website promo img url settings static url dcnl dcsp value getattr settings url dcnl dcsp if value startswith https http dcnl dcsp dcsp return value dcnl dcsp if settings debug and settings serve tmp path and url not in webapps receipt url dcnl dcsp dcsp value + value if not value startswith else value dcnl dcsp dcsp return urljoin prefixurl tmp + value dcnl dcsp return urljoin prefixurl value
def update csp dcsp for key in csp script src dcnl dcsp dcsp values getattr settings key dcnl dcsp dcsp new set dcnl dcsp dcsp for value in values dcnl dcsp dcsp dcsp if value startswith https and settings debug dcnl dcsp dcsp dcsp dcsp res value replace https http dcnl dcsp dcsp dcsp dcsp for v in value res dcnl dcsp dcsp dcsp dcsp dcsp new add v dcnl dcsp dcsp dcsp dcsp continue dcnl dcsp dcsp dcsp elif value startswith http and not settings debug dcnl dcsp dcsp dcsp dcsp continue dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp new add value dcnl dcsp dcsp setattr settings key tuple new
def log configure dcsp for key value in settings logging items dcnl dcsp dcsp if isinstance cfgkey dict dcnl dcsp dcsp dcsp cfgkey update value dcnl dcsp dcsp else dcnl dcsp dcsp dcsp cfgkey value dcnl dcsp use syslog settings has syslog and not settings debug dcnl dcsp if use syslog dcnl dcsp dcsp cfg loggers z timer handlers syslog2 dcnl dcsp for logger in cfg loggers values + cfg root dcnl dcsp dcsp if handlers not in logger dcnl dcsp dcsp dcsp logger handlers syslog if use syslog else console dcnl dcsp dcsp if level not in logger dcnl dcsp dcsp dcsp logger level settings log level dcnl dcsp dcsp if logger is not cfg root and propagate not in logger dcnl dcsp dcsp dcsp logger propagate false dcnl dcsp logging config dictconfig cfg
def record action action request data none dcsp if data is none dcnl dcsp dcsp data dcnl dcsp data useragent request meta get http user agent dcnl dcsp data locale request lang dcnl dcsp data src request get get src dcnl dcsp record stat action request data
task time limit time limits hard soft time limit time limits soft dcnl def resize video src pk user pk none kw dcsp instance preview objects get pk pk dcnl dcsp user userprofile objects get pk user pk if user pk else none dcnl dcsp try dcnl dcsp dcsp copy stored file src src src storage private storage dst storage local storage dcnl dcsp dcsp result resize video src instance kw dcnl dcsp except exception as err dcnl dcsp dcsp log error error dcsp on dcsp processing dcsp video dcsp s err dcnl dcsp dcsp resize error src instance user dcnl dcsp dcsp raise dcnl dcsp if not result dcnl dcsp dcsp log error error dcsp on dcsp processing dcsp video dcsp resize video dcsp not dcsp true dcnl dcsp dcsp resize error src instance user dcnl dcsp log info video dcsp resize dcsp complete dcnl dcsp instance addon update modified datetime datetime now
def resize error src instance user dcsp mkt log mkt log video error instance user user dcnl dcsp instance delete
def resize video src instance lib none kw dcsp log info 1 none dcsp encoding dcsp video dcsp s instance pk dcnl dcsp lib lib or library dcnl dcsp if not lib dcnl dcsp dcsp log info video dcsp library dcsp not dcsp available dcsp for dcsp s instance pk dcnl dcsp dcsp return dcnl dcsp video lib src dcnl dcsp video get meta dcnl dcsp if not video is valid dcnl dcsp dcsp log info video dcsp is dcsp not dcsp valid dcsp for dcsp s instance pk dcnl dcsp dcsp return dcnl dcsp if waffle switch is active videoencode dcnl dcsp dcsp try dcnl dcsp dcsp dcsp video file video get encoded mkt addon preview sizes1 dcnl dcsp dcsp except exception dcnl dcsp dcsp dcsp log info error dcsp encoding dcsp video dcsp for dcsp s dcsp s instance pk video meta exc info true dcnl dcsp dcsp dcsp return dcnl dcsp try dcnl dcsp dcsp thumbnail file video get screenshot mkt addon preview sizes0 dcnl dcsp except exception dcnl dcsp dcsp if waffle switch is active videoencode dcnl dcsp dcsp dcsp local storage delete video file dcnl dcsp dcsp log info error dcsp making dcsp thumbnail dcsp for dcsp s instance pk exc info true dcnl dcsp dcsp return dcnl dcsp copy stored file thumbnail file instance thumbnail path src storage local storage dst storage public storage dcnl dcsp if waffle switch is active videoencode dcnl dcsp dcsp copy stored file video file instance image path src storage local storage dst storage public storage dcnl dcsp else dcnl dcsp dcsp copy stored file src instance image path src storage local storage dst storage public storage dcnl dcsp local storage delete thumbnail file dcnl dcsp if waffle switch is active videoencode dcnl dcsp dcsp local storage delete video file dcnl dcsp instance sizes thumbnail mkt addon preview sizes0 image mkt addon preview sizes1 dcnl dcsp instance save dcnl dcsp log info completed dcsp encoding dcsp video dcsp s instance pk dcnl dcsp return true
def get library dcsp for lib in settings video libraries dcnl dcsp dcsp mod import module lib dcnl dcsp dcsp if mod video library available dcnl dcsp dcsp dcsp return mod video
def generate key byte length dcsp if byte length < 32 dcnl dcsp dcsp raise valueerror um dcsp s dcsp is dcsp probably dcsp not dcsp long dcsp enough dcsp for dcsp cryptography byte length dcnl dcsp return os urandom byte length encode hex
def sign receipt dcsp if not settings signing server dcnl dcsp dcsp return valueerror invalid dcsp config dcsp signing server dcsp empty dcnl dcsp destination settings signing server + 1 0 sign dcnl dcsp timeout settings signing server timeout dcnl dcsp receipt json json dumps receipt dcnl dcsp log info calling dcsp service dcsp s destination dcnl dcsp log info receipt dcsp contents dcsp s receipt json dcnl dcsp headers contenttype application json dcnl dcsp data receipt if isinstance receipt basestring else receipt json dcnl dcsp try dcnl dcsp dcsp with statsd timer services sign receipt dcnl dcsp dcsp dcsp req requests post destination data data headers headers timeout timeout dcnl dcsp except requests timeout dcnl dcsp dcsp statsd incr services sign receipt timeout dcnl dcsp dcsp log error posting dcsp to dcsp receipt dcsp signing dcsp timed dcsp out dcnl dcsp dcsp raise signingerror posting dcsp to dcsp receipt dcsp signing dcsp timed dcsp out dcnl dcsp except requests requestexception dcnl dcsp dcsp statsd incr services sign receipt error dcnl dcsp dcsp log error posting dcsp to dcsp receipt dcsp signing dcsp failed exc info true dcnl dcsp dcsp raise signingerror posting dcsp to dcsp receipt dcsp signing dcsp failed dcnl dcsp if req status code 200 dcnl dcsp dcsp statsd incr services sign receipt error dcnl dcsp dcsp log error posting dcsp to dcsp signing dcsp failed dcsp s req status code dcnl dcsp dcsp raise signingerror posting dcsp to dcsp signing dcsp failed dcsp s req status code dcnl dcsp return json loads req content receipt
def decode receipt dcsp raise notimplementederror
def crack receipt dcsp return map lambda x jwt decode x encode ascii verify false receipt split ~
def mock sign version id reviewer false dcsp version version objects get pk version id dcnl dcsp file obj version all files0 dcnl dcsp if reviewer dcnl dcsp dcsp path file obj signed reviewer file path dcnl dcsp dcsp storage private storage dcnl dcsp else dcnl dcsp dcsp path file obj signed file path dcnl dcsp dcsp storage public storage dcnl dcsp copy stored file file obj file path path src storage private storage dst storage storage dcnl dcsp return path
def sign app src dest ids reviewer false local false dcsp tempname tempfile mktemp dcnl dcsp try dcnl dcsp dcsp return sign app src dest ids reviewer tempname local dcnl dcsp finally dcnl dcsp dcsp try dcnl dcsp dcsp dcsp os unlink tempname dcnl dcsp dcsp except oserror dcnl dcsp dcsp dcsp pass
def sign app src dest ids reviewer tempname local false dcsp active endpoint get endpoint reviewer dcnl dcsp timeout settings signed apps server timeout dcnl dcsp if not active endpoint dcnl dcsp dcsp no sign src dest dcnl dcsp dcsp return dcnl dcsp try dcnl dcsp dcsp jar jarextractor src tempname ids omit signature sections settings signed apps omit per file sigs dcnl dcsp except dcnl dcsp dcsp log error archive dcsp extraction dcsp failed dcsp bad dcsp archive exc info true dcnl dcsp dcsp raise signingerror archive dcsp extraction dcsp failed dcsp bad dcsp archive dcnl dcsp log info app dcsp signature dcsp contents dcsp s jar signatures dcnl dcsp log info calling dcsp service dcsp s active endpoint dcnl dcsp try dcnl dcsp dcsp with statsd timer services sign app dcnl dcsp dcsp dcsp response requests post active endpoint timeout timeout files file zigbert sf str jar signatures dcnl dcsp except requests exceptions httperror as error dcnl dcsp dcsp log error posting dcsp to dcsp app dcsp signing dcsp failed dcsp s dcsp s error response status error dcnl dcsp dcsp raise signingerror posting dcsp to dcsp app dcsp signing dcsp failed dcsp s dcsp s error response status error dcnl dcsp except dcnl dcsp dcsp log error posting dcsp to dcsp app dcsp signing dcsp failed exc info true dcnl dcsp dcsp raise signingerror posting dcsp to dcsp app dcsp signing dcsp failed dcnl dcsp if response status code 200 dcnl dcsp dcsp log error posting dcsp to dcsp app dcsp signing dcsp failed dcsp s response reason dcnl dcsp dcsp raise signingerror posting dcsp to dcsp app dcsp signing dcsp failed dcsp s response reason dcnl dcsp pkcs7 b64decode json loads response content zigbert rsa dcnl dcsp try dcnl dcsp dcsp jar make signed pkcs7 sigpath zigbert dcnl dcsp except dcnl dcsp dcsp log error app dcsp signing dcsp failed exc info true dcnl dcsp dcsp raise signingerror app dcsp signing dcsp failed dcnl dcsp storage public storage dcnl dcsp if reviewer dcnl dcsp dcsp storage private storage dcnl dcsp elif local dcnl dcsp dcsp storage local storage dcnl dcsp copy stored file tempname dest src storage local storage dst storage storage
def get endpoint reviewer false dcsp active settings signed apps reviewer server active if reviewer else settings signed apps server active dcnl dcsp server settings signed apps reviewer server if reviewer else settings signed apps server dcnl dcsp if active dcnl dcsp dcsp if not server dcnl dcsp dcsp dcsp raise valueerror invalid dcsp config dcsp the dcsp sserver dcsp setting dcsp is dcsp empty reviewer dcsp if reviewer else dcnl dcsp dcsp return server + 1 0 sign app
def timecheck files dcsp global mtimes dcnl dcsp for filename in files dcnl dcsp dcsp mtime os stat filename st mtime dcnl dcsp dcsp if filename not in mtimes dcnl dcsp dcsp dcsp mtimesfilename mtime dcnl dcsp dcsp elif mtime mtimesfilename dcnl dcsp dcsp dcsp mtimes dcnl dcsp dcsp dcsp return true dcnl dcsp else dcnl dcsp dcsp return false
def watcher command files dcsp while true dcnl dcsp dcsp if timecheck files dcnl dcsp dcsp dcsp os system command dcnl dcsp dcsp time sleep 1
def log configure dcsp cfg version 1 filters formatters dict prod formatters prod handlers dict syslog handlers syslog loggers z handlers syslog level logging info root disable existing loggers false dcnl dcsp logging config dictconfig cfg
def decode receipt receipt dcsp with statsd timer services decode dcnl dcsp dcsp if settings signing server active dcnl dcsp dcsp dcsp verifier certs receiptverifier valid issuers settings signing valid issuers dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp result verifier verify receipt dcnl dcsp dcsp dcsp except expiredsignatureerror dcnl dcsp dcsp dcsp dcsp return jwt decode receipt split ~ 1 verify false dcnl dcsp dcsp dcsp if not result dcnl dcsp dcsp dcsp dcsp raise verificationerror dcnl dcsp dcsp dcsp return jwt decode receipt split ~ 1 verify false dcnl dcsp dcsp else dcnl dcsp dcsp dcsp key jwt rsa load settings webapps receipt key dcnl dcsp dcsp dcsp raw jwt decode receipt key algorithms settings supported jwt algorithms dcnl dcsp return raw
pytest mark nondestructive dcnl def test macros base url selenium dcsp page macrodashboardpage selenium base url open dcnl dcsp assert selenium title page title dcnl dcsp assert page has table dcnl dcsp first source link page first source link dcnl dcsp name first source link text dcnl dcsp href first source link get attribute href dcnl dcsp assert href startswith https github com mdn kumascript blob master macros + name dcnl dcsp first source link click dcnl dcsp page wait until lambda s selenium title page title dcnl dcsp assert selenium current url href
pytest mark nondestructive dcnl def test macros search en by click base url selenium dcsp page macrodashboardpage selenium base url open dcnl dcsp if not page has usage counts dcnl dcsp dcsp return dcnl dcsp name page first source link text dcnl dcsp page click first en search dcnl dcsp page wait until lambda s selenium title page title dcnl dcsp url bits urlparse selenium current url dcnl dcsp query parse qs url bits query dcnl dcsp assert query locale enus topic none kumascript macros name
pytest mark nondestructive dcnl def test macros search all by click base url selenium dcsp page macrodashboardpage selenium base url open dcnl dcsp if not page has usage counts dcnl dcsp dcsp return dcnl dcsp name page first source link text dcnl dcsp page click first all search dcnl dcsp page wait until lambda s selenium title page title dcnl dcsp url bits urlparse selenium current url dcnl dcsp query parse qs url bits query dcnl dcsp assert query locale topic none kumascript macros name
pytest mark nondestructive dcnl def test macros search en by form base url selenium dcsp page macrodashboardpage selenium base url open dcnl dcsp page manual search cssref enus dcnl dcsp url bits urlparse selenium current url dcnl dcsp query parse qs url bits query dcnl dcsp assert query locale enus topic none kumascript macros cssref
pytest mark nondestructive dcnl def test macros search all by form base url selenium dcsp page macrodashboardpage selenium base url open dcnl dcsp page manual search cssref dcnl dcsp url bits urlparse selenium current url dcnl dcsp query parse qs url bits query dcnl dcsp assert query locale topic none kumascript macros cssref
def url test url location none status code requests codes moved permanently req headers none req kwargs none resp headers none query none follow redirects false final status code requests codes ok dcsp test data url url location location status code status code req headers req headers req kwargs req kwargs resp headers resp headers query query follow redirects follow redirects final status code final status code dcnl dcsp expanded urls list braceexpand url dcnl dcsp num urls len expanded urls dcnl dcsp if num urls 1 dcnl dcsp dcsp return test data dcnl dcsp try dcnl dcsp dcsp location pattern location pattern dcnl dcsp dcsp test data location location pattern dcnl dcsp except attributeerror dcnl dcsp dcsp location pattern none dcnl dcsp new urls dcnl dcsp if location dcnl dcsp dcsp expanded locations list braceexpand test data location dcnl dcsp dcsp num locations len expanded locations dcnl dcsp for i url in enumerate expanded urls dcnl dcsp dcsp data test data copy dcnl dcsp dcsp data url url dcnl dcsp dcsp if location and num urls num locations dcnl dcsp dcsp dcsp if location pattern is not none dcnl dcsp dcsp dcsp dcsp data location re compile expanded locationsi dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp data location expanded locationsi dcnl dcsp dcsp new urls append data dcnl dcsp return new urls
def assert valid url url location none status code requests codes moved permanently req headers none req kwargs none resp headers none query none base url none follow redirects false final status code requests codes ok dcsp kwargs allow redirects follow redirects dcnl dcsp if req headers dcnl dcsp dcsp kwargs headers req headers dcnl dcsp if req kwargs dcnl dcsp dcsp kwargs update req kwargs dcnl dcsp abs url get abs url url base url dcnl dcsp resp requests get abs url kwargs dcnl dcsp resp location resp headers get location dcnl dcsp if follow redirects dcnl dcsp dcsp assert resp status code final status code dcnl dcsp else dcnl dcsp dcsp assert resp status code status code dcnl dcsp if location and not follow redirects dcnl dcsp dcsp if query dcnl dcsp dcsp dcsp for k v in query items dcnl dcsp dcsp dcsp dcsp if isinstance v basestring dcnl dcsp dcsp dcsp dcsp dcsp queryk v dcnl dcsp dcsp dcsp resp parsed urlparse resp location dcnl dcsp dcsp dcsp assert query parse qs resp parsed query dcnl dcsp dcsp dcsp resp location resp location split 0 dcnl dcsp dcsp abs location get abs url location base url dcnl dcsp dcsp try dcnl dcsp dcsp dcsp assert abs location match resp location is not none dcnl dcsp dcsp except attributeerror dcnl dcsp dcsp dcsp assert abs location resp location dcnl dcsp if resp headers and not follow redirects dcnl dcsp dcsp for name value in resp headers items dcnl dcsp dcsp dcsp print name value dcnl dcsp dcsp dcsp assert name in resp headers dcnl dcsp dcsp dcsp assert resp headersname lower value lower
def flatten urls list dcsp for url in urls list dcnl dcsp dcsp if isinstance url dict dcnl dcsp dcsp dcsp yield url dcnl dcsp dcsp else dcnl dcsp dcsp dcsp for sub url in url dcnl dcsp dcsp dcsp dcsp yield sub url
def allow add attachment by user dcsp if user is superuser or user is staff dcnl dcsp dcsp return true dcnl dcsp if user has perm attachments add attachment dcnl dcsp dcsp return true dcnl dcsp if user has perm attachments disallow add attachment dcnl dcsp dcsp return false dcnl dcsp return true
def convert to http date dt dcsp if timezone is naive dt dcnl dcsp dcsp default timezone timezone get default timezone dcnl dcsp dcsp dt timezone make aware dt default timezone dcnl dcsp utc dt dt astimezone timezone utc dcnl dcsp epoch dt calendar timegm utc dt utctimetuple dcnl dcsp return http date epoch dt
def attachment upload to instance filename dcsp now datetime now dcnl dcsp return attachments date s id s md5 s filename s date now strftime y m d id instance attachment id md5 hashlib md5 str now hexdigest filename filename
def make test file content none suffix txt dcsp if content is none dcnl dcsp dcsp content i dcsp am dcsp a dcsp test dcsp file dcsp for dcsp upload dcnl dcsp tdir tempfile gettempdir dcnl dcsp file for upload tempfile namedtemporaryfile suffix suffix dir tdir dcnl dcsp file for upload write content dcnl dcsp file for upload seek 0 dcnl dcsp return file for upload
def raw file request attachment id filename dcsp qs attachment objects select related current revision dcnl dcsp attachment get object or 404 qs pk attachment id dcnl dcsp if attachment current revision is none dcnl dcsp dcsp raise http404 dcnl dcsp if request get host settings attachment host dcnl dcsp dcsp rev attachment current revision dcnl dcsp dcsp if settings debug dcnl dcsp dcsp dcsp rev file read rev file default chunk size dcnl dcsp dcsp response streaminghttpresponse rev file content type rev mime type dcnl dcsp dcsp response lastmodified convert to http date rev created dcnl dcsp dcsp try dcnl dcsp dcsp dcsp response contentlength rev file size dcnl dcsp dcsp except oserror dcnl dcsp dcsp dcsp pass dcnl dcsp dcsp response xframeoptions allowfrom dcsp s settings domain dcnl dcsp dcsp return response dcnl dcsp else dcnl dcsp dcsp return redirect attachment get file url permanent true
def mindtouch file redirect request file id filename dcsp attachment get object or 404 attachment mindtouch attachment id file id dcnl dcsp return redirect attachment get file url permanent true
xframe options sameorigin dcnl login required dcnl process document path dcnl def edit attachment request document slug document locale dcsp document get object or 404 document locale document locale slug document slug dcnl dcsp if request method post dcnl dcsp dcsp return redirect document get edit url dcnl dcsp if not allow add attachment by request user dcnl dcsp dcsp raise permissiondenied dcnl dcsp form attachmentrevisionform data request post files request files dcnl dcsp if form is valid dcnl dcsp dcsp revision form save commit false dcnl dcsp dcsp revision creator request user dcnl dcsp dcsp attachment attachment objects create title revision title dcnl dcsp dcsp revision attachment attachment dcnl dcsp dcsp revision save dcnl dcsp dcsp attachment attach document request user revision dcnl dcsp dcsp return redirect document get edit url dcnl dcsp else dcnl dcsp dcsp context form form document document dcnl dcsp dcsp return render request attachments edit attachment html context
task dcnl skip in maintenance mode dcnl def clean sessions dcsp now timezone now dcnl dcsp logger clean sessions get logger dcnl dcsp chunk size config session cleanup chunk size dcnl dcsp if memcache add lock id now strftime c lock expire dcnl dcsp dcsp total count get expired sessions now count dcnl dcsp dcsp delete count 0 dcnl dcsp dcsp logger info deleting dcsp the dcsp s dcsp of dcsp s dcsp oldest dcsp expired dcsp sessions chunk size total count dcnl dcsp dcsp try dcnl dcsp dcsp dcsp cursor connection cursor dcnl dcsp dcsp dcsp delete count cursor execute n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp delete n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp from dcsp django session n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp where dcsp expire date dcsp < dcsp now n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp order dcsp by dcsp expire date dcsp asc n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp limit dcsp s n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp chunk size dcnl dcsp dcsp finally dcnl dcsp dcsp dcsp logger info deleted dcsp s dcsp expired dcsp sessions delete count dcnl dcsp dcsp dcsp memcache delete lock id dcnl dcsp dcsp dcsp expired sessions get expired sessions now dcnl dcsp dcsp dcsp if expired sessions exists dcnl dcsp dcsp dcsp dcsp clean sessions apply async dcnl dcsp else dcnl dcsp dcsp logger error the dcsp clean sessions dcsp task dcsp is dcsp already dcsp running dcsp since dcsp s memcache get lock id
def safe translation f dcsp wraps f dcnl dcsp def wrapper locale args kwargs dcnl dcsp dcsp try dcnl dcsp dcsp dcsp with translation override locale dcnl dcsp dcsp dcsp dcsp return f locale args kwargs dcnl dcsp dcsp except typeerror keyerror valueerror indexerror as e dcnl dcsp dcsp dcsp log error bad dcsp translation dcsp in dcsp locale dcsp s dcsp s locale e dcnl dcsp dcsp dcsp with translation override settings wiki default language dcnl dcsp dcsp dcsp dcsp return f settings wiki default language args kwargs dcnl dcsp return wrapper
def render email template context dcsp safe translation dcnl dcsp def render locale dcnl dcsp dcsp render dcsp an dcsp email dcsp in dcsp the dcsp given dcsp locale n n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp because dcsp of dcsp safe translation dcsp decorator dcsp if dcsp this dcsp fails n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp the dcsp function dcsp will dcsp be dcsp run dcsp again dcsp in dcsp english n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcnl dcsp dcsp req requestfactory dcnl dcsp dcsp req meta dcnl dcsp dcsp req language code locale dcnl dcsp dcsp return render to string template context request req dcnl dcsp return render translation get language
def emails with users and watches subject text template html template context vars users and watches from email settings tidings from address default locale settings wiki default language extra kwargs dcsp safe translation dcnl dcsp def make mail locale user watch dcnl dcsp dcsp context vars user user dcnl dcsp dcsp context vars watch watch0 dcnl dcsp dcsp context vars watches watch dcnl dcsp dcsp msg emailmultialternatives subject context vars render email text template context vars from email user email extra kwargs dcnl dcsp dcsp if html template dcnl dcsp dcsp dcsp msg attach alternative render email html template context vars text html dcnl dcsp dcsp return msg dcnl dcsp for user watch in users and watches dcnl dcsp dcsp if hasattr user locale dcnl dcsp dcsp dcsp locale user locale dcnl dcsp dcsp else dcnl dcsp dcsp dcsp locale default locale dcnl dcsp dcsp yield make mail locale user watch
def required field attrs self widget dcsp attrs field widget attrs self widget dcnl dcsp if self required and required not in attrs dcnl dcsp dcsp attrs required required dcnl dcsp return attrs
def required char field attrs self widget args kwargs dcsp attrs super fields charfield self widget attrs widget args kwargs dcnl dcsp original attrs charfield widget attrs self widget or dcnl dcsp attrs update original attrs dcnl dcsp return attrs
def paginate request queryset per page 20 dcsp paginator paginator queryset per page dcnl dcsp try dcnl dcsp dcsp page int request get get page 1 dcnl dcsp except valueerror dcnl dcsp dcsp page 1 dcnl dcsp try dcnl dcsp dcsp paginated paginator page page dcnl dcsp except emptypage invalidpage dcnl dcsp dcsp paginated paginator page 1 dcnl dcsp base request build absolute uri request path dcnl dcsp items k v for k in request get if k page for v in request get getlist k if v dcnl dcsp qsa urlencode items dcnl dcsp paginated url u s s base qsa dcnl dcsp return paginated
def smart int string fallback 0 dcsp try dcnl dcsp dcsp return int float string dcnl dcsp except valueerror typeerror overflowerror dcnl dcsp dcsp return fallback
def generate filename and delete previous ffile name before delete none dcsp new filename ffile field generate filename ffile instance name dcnl dcsp try dcnl dcsp dcsp orig instance ffile instance class objects get id ffile instance id dcnl dcsp dcsp orig field file getattr orig instance ffile field name dcnl dcsp dcsp orig filename orig field file name dcnl dcsp dcsp if orig filename and new filename orig filename dcnl dcsp dcsp dcsp if before delete dcnl dcsp dcsp dcsp dcsp before delete orig field file dcnl dcsp dcsp dcsp orig field file delete dcnl dcsp except ffile instance class doesnotexist dcnl dcsp dcsp pass dcnl dcsp return new filename
def memcache lock prefix expires 60 60 dcsp def decorator func dcnl dcsp dcsp functools wraps func dcnl dcsp dcsp def wrapper self args kwargs dcnl dcsp dcsp dcsp name join prefix func name + args dcnl dcsp dcsp dcsp lock memcachelock name expires expires dcnl dcsp dcsp dcsp if lock locked dcnl dcsp dcsp dcsp dcsp log warning lock dcsp s dcsp locked dcsp ignoring dcsp call name dcnl dcsp dcsp dcsp dcsp return dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp lock acquire dcnl dcsp dcsp dcsp except memcachelockexception dcnl dcsp dcsp dcsp dcsp log warning aborting dcsp s dcsp lock dcsp acquisition dcsp failed name dcnl dcsp dcsp dcsp dcsp return dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp dcsp return func self args kwargs dcnl dcsp dcsp dcsp dcsp finally dcnl dcsp dcsp dcsp dcsp dcsp lock release dcnl dcsp dcsp return wrapper dcnl dcsp return decorator
def get object or none klass args kwargs dcsp queryset get queryset klass dcnl dcsp try dcnl dcsp dcsp return queryset get args kwargs dcnl dcsp except queryset model doesnotexist dcnl dcsp dcsp return none
def parse tags tagstring sorted true dcsp if not tagstring dcnl dcsp dcsp return dcnl dcsp tagstring force unicode tagstring dcnl dcsp if u not in tagstring and u not in tagstring dcnl dcsp dcsp words list split strip tagstring u dcsp dcnl dcsp dcsp if sorted dcnl dcsp dcsp dcsp words sort dcnl dcsp dcsp return words dcnl dcsp words dcnl dcsp buffer dcnl dcsp to be split dcnl dcsp saw loose comma false dcnl dcsp open quote false dcnl dcsp i iter tagstring dcnl dcsp try dcnl dcsp dcsp while true dcnl dcsp dcsp dcsp c i next dcnl dcsp dcsp dcsp if c u dcnl dcsp dcsp dcsp dcsp if buffer dcnl dcsp dcsp dcsp dcsp dcsp to be split append u join buffer dcnl dcsp dcsp dcsp dcsp dcsp buffer dcnl dcsp dcsp dcsp dcsp open quote true dcnl dcsp dcsp dcsp dcsp c i next dcnl dcsp dcsp dcsp dcsp while c u dcnl dcsp dcsp dcsp dcsp dcsp buffer append c dcnl dcsp dcsp dcsp dcsp dcsp c i next dcnl dcsp dcsp dcsp dcsp if buffer dcnl dcsp dcsp dcsp dcsp dcsp word u join buffer strip dcnl dcsp dcsp dcsp dcsp dcsp if word dcnl dcsp dcsp dcsp dcsp dcsp dcsp words append word dcnl dcsp dcsp dcsp dcsp dcsp buffer dcnl dcsp dcsp dcsp dcsp open quote false dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp if not saw loose comma and c u dcnl dcsp dcsp dcsp dcsp dcsp saw loose comma true dcnl dcsp dcsp dcsp dcsp buffer append c dcnl dcsp except stopiteration dcnl dcsp dcsp if buffer dcnl dcsp dcsp dcsp if open quote and u in buffer dcnl dcsp dcsp dcsp dcsp saw loose comma true dcnl dcsp dcsp dcsp to be split append u join buffer dcnl dcsp if to be split dcnl dcsp dcsp if saw loose comma dcnl dcsp dcsp dcsp delimiter u dcnl dcsp dcsp else dcnl dcsp dcsp dcsp delimiter u dcsp dcnl dcsp dcsp for chunk in to be split dcnl dcsp dcsp dcsp words extend split strip chunk delimiter dcnl dcsp words list words dcnl dcsp if sorted dcnl dcsp dcsp words sort dcnl dcsp return words
def chunked iterable n dcsp iterable iter iterable dcnl dcsp while 1 dcnl dcsp dcsp t tuple islice iterable n dcnl dcsp dcsp if t dcnl dcsp dcsp dcsp yield t dcnl dcsp dcsp else dcnl dcsp dcsp dcsp return
def get unique content type object pk name none request none ip none user agent none user none dcsp if request dcnl dcsp dcsp if request user is authenticated dcnl dcsp dcsp dcsp user request user dcnl dcsp dcsp dcsp ip user agent none dcnl dcsp dcsp else dcnl dcsp dcsp dcsp user none dcnl dcsp dcsp dcsp ip request meta get remote addr dcnl dcsp dcsp dcsp user agent request meta get http user agent 255 dcnl dcsp hash text n join unicode x encode utf8 for x in content type pk object pk name or ip user agent user and user pk or none dcnl dcsp unique hash hashlib md5 hash text hexdigest dcnl dcsp return user ip user agent unique hash
def urlparams url fragment none query dict none query dcsp url urlparse urlparse url dcnl dcsp fragment fragment if fragment is not none else url fragment dcnl dcsp q url query dcnl dcsp new query dict querydict smart str q mutable true if q else querydict mutable true dcnl dcsp if query dict dcnl dcsp dcsp for k l in query dict lists dcnl dcsp dcsp dcsp new query dictk none dcnl dcsp dcsp dcsp for v in l dcnl dcsp dcsp dcsp dcsp new query dict appendlist k v dcnl dcsp for k v in query items dcnl dcsp dcsp if isinstance v list dcnl dcsp dcsp dcsp new query dict setlist k v dcnl dcsp dcsp else dcnl dcsp dcsp dcsp new query dictk v dcnl dcsp query string urlencode k v for k l in new query dict lists for v in l if v is not none dcnl dcsp new urlparse parseresult url scheme url netloc url path url params query string fragment dcnl dcsp return new geturl
def format date time request value format shortdatetime dcsp if not isinstance value datetime datetime dcnl dcsp dcsp if isinstance value datetime date dcnl dcsp dcsp dcsp value datetime datetime combine value datetime datetime min time dcnl dcsp dcsp else dcnl dcsp dcsp dcsp raise valueerror dcnl dcsp default tz timezone settings time zone dcnl dcsp tzvalue default tz localize value dcnl dcsp user request user dcnl dcsp try dcnl dcsp dcsp if user is authenticated and user timezone dcnl dcsp dcsp dcsp user tz timezone user timezone dcnl dcsp dcsp dcsp tzvalue user tz normalize tzvalue astimezone user tz dcnl dcsp except attributeerror dcnl dcsp dcsp pass dcnl dcsp locale babel locale get request locale request dcnl dcsp try dcnl dcsp dcsp formatted format date value value tzvalue locale format dcnl dcsp except keyerror dcnl dcsp dcsp formatted format date value value tzvalue babel locale settings language code format dcnl dcsp return formatted tzvalue
def get request locale request dcsp locale request language code dcnl dcsp if not localedata exists locale dcnl dcsp dcsp locale settings language code dcnl dcsp return locale
def babel locale locale dcsp return locale replace
library filter dcnl def paginator pager dcsp return paginator pager render
library global function dcnl def url viewname args kwargs dcsp locale kwargs pop locale none dcnl dcsp return reverse viewname args args kwargs kwargs locale locale
library filter dcnl def entity decode str dcsp return htmlparser unescape str
library global function dcnl def thisyear dcsp return jinja2 markup datetime date today year
library global function dcnl def add utm url campaign source developer mozilla org medium email dcsp url obj urlobject url add query params utm campaign campaign utm source source utm medium medium dcnl dcsp return str url obj
library global function dcnl jinja2 contextfunction dcnl def datetimeformat context value format shortdatetime output html dcsp request context request dcnl dcsp formatted tzvalue format date time request value format dcnl dcsp if output json dcnl dcsp dcsp return formatted dcnl dcsp return jinja2 markup <time dcsp datetime s s< time tzvalue isoformat formatted
library filter dcnl def in utc dt dcsp if dt utcoffset is none dcnl dcsp dcsp tz timezone settings time zone dcnl dcsp dcsp dt tz localize dt dcnl dcsp return dt astimezone utc
def test paginated url dcsp url urlparams reverse search q bookmarks page 2 dcnl dcsp request requestfactory get url dcnl dcsp queryset dcnl dcsp paginated paginate request queryset dcnl dcsp eq paginated url request build absolute uri request path + q bookmarks
def eq first second msg none dcsp msg msg or r dcsp dcsp r first second dcnl dcsp assert first second msg
def ok pred msg none dcsp msg msg or r dcsp dcsp true pred dcnl dcsp assert pred msg
def attrs eq received expected dcsp for k v in expected iteritems dcnl dcsp dcsp eq v getattr received k
def get user username testuser dcsp user get user model dcnl dcsp try dcnl dcsp dcsp return user objects get username username dcnl dcsp except user doesnotexist dcnl dcsp dcsp raise fixturemissingerror username dcsp s dcsp not dcsp found dcsp you dcsp probably dcsp forgot dcsp to dcsp import dcsp a dcsp users dcsp fixture username
def global settings request dcsp return settings settings
def get best language accept lang dcsp ranked parse accept lang header accept lang dcnl dcsp return find supported ranked
def set url prefixer prefixer dcsp locals prefixer prefixer
def reset url prefixer dcsp global locals dcnl dcsp locals threading local
def get url prefixer dcsp return getattr locals prefixer none
def reverse viewname urlconf none args none kwargs none prefix none current app none force locale false locale none unprefixed false dcsp if locale dcnl dcsp dcsp prefixer prefixer locale locale dcnl dcsp else dcnl dcsp dcsp prefixer get url prefixer dcnl dcsp dcsp if unprefixed dcnl dcsp dcsp dcsp prefixer none dcnl dcsp dcsp elif not prefixer and force locale dcnl dcsp dcsp dcsp prefixer prefixer dcnl dcsp if prefixer dcnl dcsp dcsp prefix prefix or dcnl dcsp url django reverse viewname urlconf urlconf args args kwargs kwargs prefix prefix current app current app dcnl dcsp if prefixer dcnl dcsp dcsp return prefixer fix url dcnl dcsp else dcnl dcsp dcsp return url
def find supported ranked dcsp langs dict settings language url map dcnl dcsp for lang in ranked dcnl dcsp dcsp lang lang lower dcnl dcsp dcsp if lang in langs dcnl dcsp dcsp dcsp return langslang dcnl dcsp dcsp pre join lang split 0 1 dcnl dcsp dcsp if pre dcnl dcsp dcsp dcsp ranked append pre none dcnl dcsp return false
def split path path dcsp path path lstrip dcnl dcsp first rest path partition dcnl dcsp lang find supported first 1 0 dcnl dcsp if lang dcnl dcsp dcsp return lang rest dcnl dcsp else dcnl dcsp dcsp return path
def parse tag namespaces tag list dcsp namespaces dcnl dcsp for tag in tag list dcnl dcsp dcsp ns in tag and s tag rsplit 1 0 or dcnl dcsp dcsp if ns not in namespaces dcnl dcsp dcsp dcsp namespacesns dcnl dcsp dcsp namespacesns append tag dcnl dcsp return namespaces
def allows tag namespace for model obj ns user dcsp if user is staff or user is superuser dcnl dcsp dcsp return true dcnl dcsp if not ns startswith system dcnl dcsp dcsp return true dcnl dcsp return false
def resolve allowed tags model obj tags curr tags new request user anonymoususer dcsp ns tags curr parse tag namespaces tags curr dcnl dcsp ns tags new parse tag namespaces tags new dcnl dcsp all ns set ns tags curr keys + ns tags new keys dcnl dcsp tags out dcnl dcsp for ns in all ns dcnl dcsp dcsp if model obj allows tag namespace for ns request user dcnl dcsp dcsp dcsp if ns in ns tags new dcnl dcsp dcsp dcsp dcsp tags out extend ns tags newns dcnl dcsp dcsp elif ns in ns tags curr dcnl dcsp dcsp dcsp tags out extend ns tags currns dcnl dcsp return tags out
def user access decorator redirect func redirect url func deny func none redirect field redirect field name dcsp def decorator view fn dcnl dcsp dcsp def wrapped view request args kwargs dcnl dcsp dcsp dcsp if redirect func request user dcnl dcsp dcsp dcsp dcsp redirect url redirect url func or reverse account login dcnl dcsp dcsp dcsp dcsp if redirect field dcnl dcsp dcsp dcsp dcsp dcsp path urlquote request get full path dcnl dcsp dcsp dcsp dcsp dcsp redirect url s s s redirect url redirect field path dcnl dcsp dcsp dcsp dcsp return httpresponseredirect redirect url dcnl dcsp dcsp dcsp if deny func and deny func request user dcnl dcsp dcsp dcsp dcsp return httpresponseforbidden dcnl dcsp dcsp dcsp return view fn request args kwargs dcnl dcsp dcsp return wraps view fn assigned available attrs view fn wrapped view dcnl dcsp return decorator
def logout required redirect dcsp redirect func lambda u u is authenticated dcnl dcsp if hasattr redirect call dcnl dcsp dcsp return user access decorator redirect func redirect field none redirect url func lambda reverse home redirect dcnl dcsp else dcnl dcsp dcsp return user access decorator redirect func redirect field none redirect url func lambda redirect
def login required func login url none redirect redirect field name only active true dcsp if only active dcnl dcsp dcsp redirect func lambda u not u is authenticated and u is active dcnl dcsp else dcnl dcsp dcsp redirect func lambda u not u is authenticated dcnl dcsp redirect url func lambda login url dcnl dcsp return user access decorator redirect func redirect field redirect redirect url func redirect url func func
def permission required perm login url none redirect redirect field name only active true dcsp redirect func lambda u not u is authenticated dcnl dcsp if only active dcnl dcsp dcsp deny func lambda u not u is active and u has perm perm dcnl dcsp else dcnl dcsp dcsp deny func lambda u not u has perm perm dcnl dcsp redirect url func lambda login url dcnl dcsp return user access decorator redirect func redirect field redirect redirect url func redirect url func deny func deny func
def skip in maintenance mode func dcsp wraps func dcnl dcsp def wrapped args kwargs dcnl dcsp dcsp if settings maintenance mode dcnl dcsp dcsp dcsp return dcnl dcsp dcsp return func args kwargs dcnl dcsp return wrapped
def redirect in maintenance mode func none methods none dcsp if not func dcnl dcsp dcsp return partial redirect in maintenance mode methods methods dcnl dcsp wraps func dcnl dcsp def wrapped request args kwargs dcnl dcsp dcsp if settings maintenance mode and methods is none or request method in methods dcnl dcsp dcsp dcsp return redirect maintenance mode dcnl dcsp dcsp return func request args kwargs dcnl dcsp return wrapped
def error page request status dcsp return render request d html status status status
def format decimal num format none dcsp lang translation get language dcnl dcsp if not localedata exists lang dcnl dcsp dcsp lang settings language code dcnl dcsp locale locale translation to locale lang dcnl dcsp return format locale decimal num format
contextlib contextmanager dcnl def safe query string request dcsp qs request meta query string dcnl dcsp try dcnl dcsp dcsp request meta query string iri to uri qs dcnl dcsp dcsp yield dcnl dcsp finally dcnl dcsp dcsp request meta query string qs
def valid javascript identifier identifier escape u ucd cat category dcsp if not identifier dcnl dcsp dcsp return false dcnl dcsp if not isinstance identifier unicode dcnl dcsp dcsp try dcnl dcsp dcsp dcsp identifier unicode identifier utf8 dcnl dcsp dcsp except unicodedecodeerror dcnl dcsp dcsp dcsp return false dcnl dcsp if escape in identifier dcnl dcsp dcsp new dcnl dcsp dcsp add char new append dcnl dcsp dcsp split id identifier split escape dcnl dcsp dcsp add char split id pop 0 dcnl dcsp dcsp for segment in split id dcnl dcsp dcsp dcsp if len segment < 4 dcnl dcsp dcsp dcsp dcsp return false dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp add char unichr int 0x + segment 4 16 dcnl dcsp dcsp dcsp except exception dcnl dcsp dcsp dcsp dcsp return false dcnl dcsp dcsp dcsp add char segment4 dcnl dcsp dcsp identifier u join new dcnl dcsp if is reserved js word identifier dcnl dcsp dcsp return false dcnl dcsp first char identifier0 dcnl dcsp if not first char in valid jsid chars or ucd cat first char in valid jsid categories start dcnl dcsp dcsp return false dcnl dcsp for char in identifier1 dcnl dcsp dcsp if not char in valid jsid chars or ucd cat char in valid jsid categories dcnl dcsp dcsp dcsp return false dcnl dcsp return true
def valid jsonp callback value value dcsp for identifier in value split u dcnl dcsp dcsp while in identifier dcnl dcsp dcsp dcsp if not has valid array index identifier dcnl dcsp dcsp dcsp dcsp return false dcnl dcsp dcsp dcsp identifier replace array index u identifier dcnl dcsp dcsp if not valid javascript identifier identifier dcnl dcsp dcsp dcsp return false dcnl dcsp return true
library global function dcnl contextfunction dcnl def ban links context ban user banner user dcsp links dcnl dcsp if ban user id banner user id and banner user has perm users add userban dcnl dcsp dcsp active ban ban user active ban dcnl dcsp dcsp url ban cleanup reverse users ban user and cleanup kwargs username ban user username dcnl dcsp dcsp if active ban dcnl dcsp dcsp dcsp url reverse admin users userban change args active ban id dcnl dcsp dcsp dcsp title ugettext banned dcsp on dcsp ban date s dcsp by dcsp ban admin s ban date datetimeformat context active ban date format date output json ban admin active ban by dcnl dcsp dcsp dcsp link <a dcsp id ban link dcsp href s dcsp class button dcsp banlink dcsp title s s<i dcsp ariahidden true dcsp class iconban < i < a url title ugettext banned dcnl dcsp dcsp dcsp link cleanup <a dcsp id cleanup link dcsp href s dcsp class button dcsp negative dcsp banlink s<i dcsp ariahidden true dcsp class iconban < i < a url ban cleanup ugettext clean dcsp up dcsp revisions dcnl dcsp dcsp else dcnl dcsp dcsp dcsp url reverse users ban user kwargs username ban user username dcnl dcsp dcsp dcsp link <a dcsp id ban link dcsp href s dcsp class button dcsp negative dcsp banlink s<i dcsp ariahidden true dcsp class iconban < i < a url ugettext ban dcsp user dcnl dcsp dcsp dcsp link cleanup <a dcsp id cleanup link dcsp href s dcsp class button dcsp negative dcsp banlink s<i dcsp ariahidden true dcsp class iconban < i < a url ban cleanup ugettext ban dcsp user dcsp dcsp clean dcsp up dcnl dcsp dcsp links link cleanup + dcsp + link dcnl dcsp return markup links
library global function dcnl def admin link user dcsp url reverse admin users user change args user id current app admin site name dcnl dcsp link <a dcsp href s dcsp class button dcsp neutral s<i dcsp ariahidden true dcsp class iconwrench < i < a url ugettext admin dcnl dcsp return markup link
library filter dcnl def public email email dcsp return markup <span dcsp class email s< span unicode to html email
def unicode to html text dcsp return join u s ord i for i in text
library global function dcnl def user list users dcsp link u <a dcsp href s s< a dcnl dcsp list u dcsp join link escape u get absolute url escape u username for u in users dcnl dcsp return markup list
library global function dcnl contextfunction dcnl def provider login url context provider id params dcsp request context request dcnl dcsp provider providers registry by id provider id dcnl dcsp auth params params get auth params none dcnl dcsp scope params get scope none dcnl dcsp process params get process none dcnl dcsp if scope is dcnl dcsp dcsp del params scope dcnl dcsp if auth params is dcnl dcsp dcsp del params auth params dcnl dcsp if next not in params dcnl dcsp dcsp next get request param request next dcnl dcsp dcsp if next dcnl dcsp dcsp dcsp params next next dcnl dcsp dcsp elif process redirect dcnl dcsp dcsp dcsp params next request get full path dcnl dcsp elif not params next dcnl dcsp dcsp del params next dcnl dcsp return markup provider get login url request params
library global function dcnl contextfunction dcnl def providers media js context dcsp request context request dcnl dcsp return markup u n join p media js request for p in providers registry get list
library global function dcnl def social accounts user dcsp accounts dcnl dcsp if not user is authenticated dcnl dcsp dcsp return accounts dcnl dcsp for account in user socialaccount set all iterator dcnl dcsp dcsp providers accounts setdefault account provider dcnl dcsp dcsp providers append account dcnl dcsp return accounts
permission required users add userban dcnl def ban user request username dcsp user get user model dcnl dcsp user get object or 404 user username username dcnl dcsp if request method post dcnl dcsp dcsp form userbanform data request post dcnl dcsp dcsp if form is valid dcnl dcsp dcsp dcsp ban userban user user by request user reason form cleaned data reason is active true dcnl dcsp dcsp dcsp ban save dcnl dcsp dcsp dcsp return redirect user dcnl dcsp else dcnl dcsp dcsp if user active ban dcnl dcsp dcsp dcsp return redirect user dcnl dcsp dcsp form userbanform dcnl dcsp try dcnl dcsp dcsp common reasons json loads config common reasons to ban users dcnl dcsp except typeerror valueerror dcnl dcsp dcsp common reasons spam dcnl dcsp else dcnl dcsp dcsp if not common reasons dcnl dcsp dcsp dcsp common reasons spam dcnl dcsp return render request users ban user html form form detail user user common reasons common reasons
permission required users add userban dcnl def ban user and cleanup request username dcsp user get object or 404 user username username dcnl dcsp user ban userban objects filter user user is active true dcnl dcsp date three days ago datetime now date timedelta days 3 dcnl dcsp revisions user created revisions prefetch related document dcnl dcsp revisions revisions defer content summary order by id dcnl dcsp revisions revisions filter created gte date three days ago dcnl dcsp revisions not spam revisions filter akismet submissions none dcnl dcsp return render request users ban user and cleanup html detail user user user banned user ban revisions revisions revisions not spam revisions not spam on ban page true
require post dcnl permission required users add userban dcnl def ban user and cleanup summary request username dcsp user get object or 404 user username username dcnl dcsp user ban userban objects filter user user is active true dcnl dcsp if not user ban exists dcnl dcsp dcsp ban userban user user by request user reason spam is active true dcnl dcsp dcsp ban save dcnl dcsp else dcnl dcsp dcsp user ban update by request user reason spam dcnl dcsp date three days ago datetime now date timedelta days 3 dcnl dcsp revisions from last three days user created revisions prefetch related document dcnl dcsp revisions from last three days revisions from last three days defer content summary order by id dcnl dcsp revisions from last three days revisions from last three days filter created gte date three days ago dcnl dcsp dcsp the dcsp actions dcsp taken dcsp section dcsp dcnl dcsp revisions to mark as spam and revert revisions from last three days filter id in request post getlist revisionid order by id dcnl dcsp submitted to akismet dcnl dcsp not submitted to akismet dcnl dcsp revisions reverted list dcnl dcsp revisions not reverted list dcnl dcsp revisions deleted list dcnl dcsp revisions not deleted list dcnl dcsp latest is not spam rev for rev in revision by distinct doc revisions to mark as spam and revert if rev document current revision rev dcnl dcsp previous good rev dcnl dcsp for revision in revisions to mark as spam and revert dcnl dcsp dcsp submission revisionakismetsubmission sender request user type spam dcnl dcsp dcsp akismet submission data revision revision id dcnl dcsp dcsp data revisionakismetsubmissionspamform data akismet submission data instance submission request request dcnl dcsp dcsp if data is valid dcnl dcsp dcsp dcsp data save dcnl dcsp dcsp dcsp submitted to akismet append revision dcnl dcsp dcsp else dcnl dcsp dcsp dcsp not submitted to akismet append revision dcnl dcsp dcsp try dcnl dcsp dcsp dcsp revision document refresh from db fields current revision dcnl dcsp dcsp except document doesnotexist dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if revision document current revision not in revisions to mark as spam and revert dcnl dcsp dcsp dcsp if revision document id not in previous good rev dcnl dcsp dcsp dcsp dcsp previous good revrevision document id revision document current revision dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp while revision previous in revisions to mark as spam and revert dcnl dcsp dcsp dcsp revision revision previous dcnl dcsp dcsp if revision previous dcnl dcsp dcsp dcsp previous good revrevision document id revision previous dcnl dcsp dcsp dcsp reverted revert document request request revision id revision previous id dcnl dcsp dcsp dcsp if reverted dcnl dcsp dcsp dcsp dcsp revisions reverted list append revision dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp revisions not reverted list append revision dcnl dcsp dcsp else dcnl dcsp dcsp dcsp deleted delete document request request document revision document dcnl dcsp dcsp dcsp if deleted dcnl dcsp dcsp dcsp dcsp revisions deleted list append revision dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp revisions not deleted list append revision dcnl dcsp submitted to akismet by distinct doc revision by distinct doc submitted to akismet dcnl dcsp not submitted to akismet by distinct doc revision by distinct doc not submitted to akismet dcnl dcsp revisions reverted by distinct doc revision by distinct doc revisions reverted list dcnl dcsp revisions not reverted by distinct doc revision by distinct doc revisions not reverted list dcnl dcsp revisions deleted by distinct doc revision by distinct doc revisions deleted list dcnl dcsp revisions not deleted by distinct doc revision by distinct doc revisions not deleted list dcnl dcsp actions taken revisions reported as spam submitted to akismet by distinct doc revisions reverted list revisions reverted by distinct doc revisions deleted list revisions deleted by distinct doc dcnl dcsp dcsp the dcsp needs dcsp followup dcsp section dcsp dcnl dcsp new action by user dcnl dcsp skipped revisions rev for rev in revisions to mark as spam and revert if rev document id in previous good rev and rev id < previous good revrev document id id dcnl dcsp skipped revisions revision by distinct doc skipped revisions dcnl dcsp needs follow up manual revert new action by user skipped revisions skipped revisions not submitted to akismet not submitted to akismet by distinct doc not reverted list revisions not reverted by distinct doc not deleted list revisions not deleted by distinct doc dcnl dcsp dcsp the dcsp no dcsp actions dcsp taken dcsp section dcsp dcnl dcsp revisions already spam revisions from last three days filter id in request post getlist revisionalreadyspam dcnl dcsp revisions already spam list revisions already spam dcnl dcsp revisions already spam by distinct doc revision by distinct doc revisions already spam dcnl dcsp identified as not spam rev for rev in revisions from last three days if rev not in revisions already spam and rev not in revisions to mark as spam and revert dcnl dcsp identified as not spam by distinct doc revision by distinct doc identified as not spam dcnl dcsp no actions taken latest revision is not spam latest is not spam revisions already identified as spam revisions already spam by distinct doc revisions identified as not spam identified as not spam by distinct doc dcnl dcsp context detail user user form userbanform actions taken actions taken needs follow up needs follow up no actions taken no actions taken dcnl dcsp ban and revert notification user request user context dcnl dcsp return render request users ban user and cleanup summary html context
permission required users add userban dcnl def revert document request revision id dcsp revision get object or 404 revision objects select related document pk revision id dcnl dcsp comment spam dcnl dcsp document revision document dcnl dcsp old revision pk revision pk dcnl dcsp try dcnl dcsp dcsp new revision document revert revision request user comment dcnl dcsp dcsp if new revision pk old revision pk dcnl dcsp dcsp dcsp document schedule rendering maxage 0 dcnl dcsp except integrityerror dcnl dcsp dcsp return false dcnl dcsp return true
permission required wiki delete document dcnl def delete document request document dcsp try dcnl dcsp dcsp documentdeletionlog objects create locale document locale slug document slug user request user reason spam dcnl dcsp dcsp document delete dcnl dcsp except exception dcnl dcsp dcsp return false dcnl dcsp return true
def user detail request username dcsp detail user get object or 404 user username username dcnl dcsp if detail user active ban and not request user has perm users add userban dcnl dcsp dcsp return render request 404 html reason banneduser status 404 dcnl dcsp context detail user detail user dcnl dcsp return render request users user detail html context
redirect in maintenance mode dcnl def user edit request username dcsp edit user get object or 404 user username username dcnl dcsp if not edit user allows editing by request user dcnl dcsp dcsp return httpresponseforbidden dcnl dcsp field to tag ns interests profile interest expertise profile expertise dcnl dcsp if request method post dcnl dcsp dcsp initial beta edit user is beta tester username edit user username dcnl dcsp dcsp for field ns in field to tag ns dcnl dcsp dcsp dcsp initialfield dcsp join tag name replace ns for tag in edit user tags all ns ns dcnl dcsp dcsp user form usereditform instance edit user initial initial prefix user dcnl dcsp else dcnl dcsp dcsp user form usereditform data request post files request files instance edit user prefix user dcnl dcsp dcsp if user form is valid dcnl dcsp dcsp dcsp new user user form save dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp beta group group objects get name config beta group name dcnl dcsp dcsp dcsp dcsp if user form cleaned data beta dcnl dcsp dcsp dcsp dcsp dcsp beta group user set add request user dcnl dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp beta group user set remove request user dcnl dcsp dcsp dcsp except group doesnotexist dcnl dcsp dcsp dcsp dcsp pass dcnl dcsp dcsp dcsp for field tag ns in field to tag ns dcnl dcsp dcsp dcsp dcsp field value user form cleaned data get field dcnl dcsp dcsp dcsp dcsp tags parse tags field value dcnl dcsp dcsp dcsp dcsp new user tags set ns tag ns tags dcnl dcsp dcsp dcsp return redirect edit user dcnl dcsp context edit user edit user user form user form interest suggestions interest suggestions dcnl dcsp return render request users user edit html context
require post dcnl redirect in maintenance mode dcnl def send recovery email request dcsp form userrecoveryemailform data request post dcnl dcsp if form is valid dcnl dcsp dcsp form save request request dcnl dcsp dcsp return redirect users recovery email sent dcnl dcsp else dcnl dcsp dcsp return httpresponsebadrequest invalid dcsp request
redirect in maintenance mode dcnl def recover request uidb64 none token none dcsp usermodel get user model dcnl dcsp try dcnl dcsp dcsp uid force text urlsafe base64 decode uidb64 dcnl dcsp dcsp user usermodel default manager get pk uid dcnl dcsp except typeerror valueerror overflowerror usermodel doesnotexist dcnl dcsp dcsp user none dcnl dcsp if user and default token generator check token user token dcnl dcsp dcsp temp pwd uuid uuid4 hex dcnl dcsp dcsp user set password temp pwd dcnl dcsp dcsp user save dcnl dcsp dcsp user authenticate username user username password temp pwd dcnl dcsp dcsp user set unusable password dcnl dcsp dcsp user save dcnl dcsp dcsp login request user dcnl dcsp dcsp return redirect users recover done dcnl dcsp return render request users recover failed html
task rate limit 60 m dcnl skip in maintenance mode dcnl def render document pk cache control base url force false dcsp document document objects get pk pk dcnl dcsp if force dcnl dcsp dcsp document render started at none dcnl dcsp try dcnl dcsp dcsp document render cache control base url dcnl dcsp except exception as e dcnl dcsp dcsp subject exception dcsp while dcsp rendering dcsp document dcsp s document pk dcnl dcsp dcsp mail admins subject subject message e dcnl dcsp return document rendered errors
task dcnl skip in maintenance mode dcnl def email render document progress percent complete total dcsp subject the dcsp command dcsp render document dcsp is dcsp s dcsp complete percent complete dcnl dcsp message the dcsp command dcsp render document dcsp is dcsp s dcsp complete dcsp out dcsp of dcsp a dcsp total dcsp of dcsp s dcsp documents dcsp to dcsp render percent complete total dcnl dcsp mail admins subject subject message message
task dcnl skip in maintenance mode dcnl def render document chunk pks cache control nocache base url none force false dcsp logger render document chunk get logger dcnl dcsp logger info u starting dcsp to dcsp render dcsp document dcsp chunk dcsp s join str pk for pk in pks dcnl dcsp base url base url or settings site url dcnl dcsp for pk in pks dcnl dcsp dcsp result render document pk cache control base url force force dcnl dcsp dcsp if result dcnl dcsp dcsp dcsp logger error u error dcsp while dcsp rendering dcsp document dcsp s dcsp with dcsp error dcsp s pk result dcnl dcsp logger info u finished dcsp rendering dcsp of dcsp document dcsp chunk
task throws staledocumentsrenderinginprogress dcnl skip in maintenance mode dcnl def acquire render lock dcsp if render lock locked dcnl dcsp dcsp raise staledocumentsrenderinginprogress dcnl dcsp render lock acquire
task dcnl skip in maintenance mode dcnl def release render lock dcsp render lock release
task dcnl skip in maintenance mode dcnl def render stale documents log none dcsp stale docs document objects get by stale rendering distinct dcnl dcsp stale docs count stale docs count dcnl dcsp if stale docs count 0 dcnl dcsp dcsp return dcnl dcsp if log is none dcnl dcsp dcsp log render stale documents get logger dcnl dcsp log info found dcsp s dcsp stale dcsp documents stale docs count dcnl dcsp stale pks stale docs values list pk flat true dcnl dcsp pre task acquire render lock si dcnl dcsp render tasks render document chunk si pks for pks in chunked stale pks 5 dcnl dcsp post task release render lock si dcnl dcsp chord flow pre task render tasks post task apply async
task dcnl skip in maintenance mode dcnl def build json data for document pk stale dcsp document document objects get pk pk dcnl dcsp document get json data stale stale dcnl dcsp if document parent is not none dcnl dcsp dcsp parent json json dumps document parent build json data dcnl dcsp dcsp document objects filter pk document parent pk update json parent json
transaction task dcnl skip in maintenance mode dcnl def send first edit email revision pk dcsp revision revision objects get pk revision pk dcnl dcsp first edit email revision send
task dcnl def build locale sitemap locale dcsp now datetime utcnow dcnl dcsp timestamp s+00 00 now replace microsecond 0 isoformat dcnl dcsp directory os path join settings media root sitemaps locale dcnl dcsp if not os path isdir directory dcnl dcsp dcsp os makedirs directory dcnl dcsp queryset document objects filter for list locale locale dcnl dcsp if queryset exists dcnl dcsp dcsp names dcnl dcsp dcsp info queryset queryset date field modified dcnl dcsp dcsp sitemap wikisitemap info dcnl dcsp dcsp for page in range 1 sitemap paginator num pages + 1 dcnl dcsp dcsp dcsp urls sitemap get urls page page dcnl dcsp dcsp dcsp if page 1 dcnl dcsp dcsp dcsp dcsp name sitemap xml dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp name sitemap s xml page dcnl dcsp dcsp dcsp names append name dcnl dcsp dcsp dcsp rendered smart str render to string wiki sitemap xml urls urls dcnl dcsp dcsp dcsp path os path join directory name dcnl dcsp dcsp dcsp with open path w as sitemap file dcnl dcsp dcsp dcsp dcsp sitemap file write rendered dcnl dcsp dcsp return locale names timestamp
task dcnl def build index sitemap results dcsp sitemap parts sitemap start dcnl dcsp for result in results dcnl dcsp dcsp if result is not none dcnl dcsp dcsp dcsp locale names timestamp result dcnl dcsp dcsp dcsp for name in names dcnl dcsp dcsp dcsp dcsp sitemap url absolutify sitemaps s s locale name dcnl dcsp dcsp dcsp dcsp sitemap parts append sitemap element sitemap url timestamp dcnl dcsp sitemap parts append sitemap end dcnl dcsp index path os path join settings media root sitemap xml dcnl dcsp sitemap tree etree fromstringlist sitemap parts dcnl dcsp with open index path w as index file dcnl dcsp dcsp sitemap tree getroottree write index file encoding utf8 pretty print true
task dcnl def build sitemaps dcsp tasks build locale sitemap si lang0 for lang in settings languages dcnl dcsp post task build index sitemap s dcnl dcsp chord header tasks body post task apply async max retries 300 interval 1
task dcnl skip in maintenance mode dcnl def index documents ids index pk reraise false dcsp from kuma wiki models import document dcnl dcsp cls wikidocumenttype dcnl dcsp es cls get connection indexing dcnl dcsp index index objects get pk index pk dcnl dcsp objects document objects filter id in ids dcnl dcsp documents dcnl dcsp for obj in objects dcnl dcsp dcsp try dcnl dcsp dcsp dcsp documents append cls from django obj dcnl dcsp dcsp except exception dcnl dcsp dcsp dcsp log exception unable dcsp to dcsp extract index dcsp document dcsp id dcsp d obj id dcnl dcsp dcsp dcsp if reraise dcnl dcsp dcsp dcsp dcsp raise dcnl dcsp if documents dcnl dcsp dcsp cls bulk index documents id field id es es index index prefixed name
task dcnl skip in maintenance mode dcnl def unindex documents ids index pk dcsp cls wikidocumenttype dcnl dcsp es cls get connection indexing dcnl dcsp index index objects get pk index pk dcnl dcsp cls bulk delete ids es es index index prefixed name
task rate limit 120 m dcnl skip in maintenance mode dcnl def tidy revision content pk refresh true dcsp try dcnl dcsp dcsp revision revision objects get pk pk dcnl dcsp except revision doesnotexist as exc dcnl dcsp dcsp log error tidy dcsp was dcsp unable dcsp to dcsp get dcsp revision dcsp id dcsp d dcsp retrying pk dcnl dcsp dcsp tidy revision content retry countdown 60 2 max retries 5 exc exc dcnl dcsp else dcnl dcsp dcsp if revision tidied content and not refresh dcnl dcsp dcsp dcsp return dcnl dcsp dcsp tidied content errors tidy content revision content dcnl dcsp dcsp if tidied content revision tidied content dcnl dcsp dcsp dcsp revision objects filter pk pk update tidied content tidied content dcnl dcsp dcsp return errors
task dcnl skip in maintenance mode dcnl def delete old documentspamattempt data days 30 dcsp older datetime now timedelta days 30 dcnl dcsp dsas documentspamattempt objects filter created lt older exclude data isnull true dcnl dcsp dsas reviewed dsas exclude review documentspamattempt needs review dcnl dcsp dsas unreviewed dsas filter review documentspamattempt needs review dcnl dcsp dsas reviewed update data none dcnl dcsp dsas unreviewed update data none review documentspamattempt review unavailable
def notification context revision dcsp document revision document dcnl dcsp from revision revision get previous dcnl dcsp to revision revision dcnl dcsp diff revisions unified diff from revision to revision dcnl dcsp context u document title document title u creator revision creator u diff diff u locale document locale dcnl dcsp if from revision dcnl dcsp dcsp compare url get compare url document from revision id to revision id dcnl dcsp else dcnl dcsp dcsp compare url u dcnl dcsp link urls u user url revision creator get absolute url u compare url compare url u view url document get absolute url u edit url document get edit url u history url reverse u wiki document revisions locale document locale args document slug dcnl dcsp for name url in link urls items dcnl dcsp dcsp if url dcnl dcsp dcsp dcsp contextname add utm url u wiki dcsp doc dcsp edits dcnl dcsp dcsp else dcnl dcsp dcsp dcsp contextname url dcnl dcsp return context
def extra headers user document none dcsp headers u xkumaeditorusername user username dcnl dcsp if document dcnl dcsp dcsp headersu xkumadocumenturl document get full url dcnl dcsp dcsp headersu xkumadocumenttitle document title dcnl dcsp dcsp headersu xkumadocumentlocale document locale dcnl dcsp return headers
def first edit email revision dcsp user doc revision creator revision document dcnl dcsp if doc revisions only u id first id revision id dcnl dcsp dcsp subject tmpl u mdn loc snew dcsp user s dcsp made dcsp their dcsp first dcsp edit dcsp creating dcsp doc s dcnl dcsp else dcnl dcsp dcsp subject tmpl u mdn loc s dcsp user s dcsp made dcsp their dcsp first dcsp edit dcsp to dcsp doc s dcnl dcsp subject subject tmpl u loc doc locale u user user username u doc doc title dcnl dcsp message render to string u wiki email edited ltxt notification context revision dcnl dcsp email emailmessage subject message settings default from email to config email list spam watch headers extra headers user doc dcnl dcsp return email
def spam attempt email spam attempt dcsp subject u mdn dcsp wiki dcsp spam dcsp attempt dcsp recorded dcnl dcsp document spam attempt document dcnl dcsp if document dcnl dcsp dcsp subject u s dcsp for dcsp document dcsp s subject document dcnl dcsp elif spam attempt title dcnl dcsp dcsp subject u s dcsp with dcsp title dcsp s subject spam attempt title dcnl dcsp body render to string u wiki email spam ltxt u spam attempt spam attempt dcnl dcsp email emailmessage subject body settings default from email to config email list spam watch headers extra headers spam attempt user document dcnl dcsp return email
newrelic agent function trace dcnl def get content sections src dcsp sections dcnl dcsp if src dcnl dcsp dcsp attr id dcnl dcsp dcsp selector attr + join section tags + attr dcnl dcsp dcsp try dcnl dcsp dcsp dcsp document pq src dcnl dcsp dcsp except etree parsererror dcnl dcsp dcsp dcsp pass dcnl dcsp dcsp else dcnl dcsp dcsp dcsp for element in document find selector dcnl dcsp dcsp dcsp dcsp sections append title element text id element attrib get id dcnl dcsp return sections
newrelic agent function trace dcnl def filter out noinclude src dcsp if not src dcnl dcsp dcsp return dcnl dcsp doc pq src dcnl dcsp doc remove class noinclude dcnl dcsp return doc html
def locale and slug from path path request none path locale none dcsp locale slug needs redirect path false dcnl dcsp mdn locales lang0 lower lang0 for lang in settings languages dcnl dcsp if in path dcnl dcsp dcsp maybe locale maybe slug path split 1 dcnl dcsp dcsp l locale maybe locale lower dcnl dcsp dcsp if l locale in settings mt to kuma locale map dcnl dcsp dcsp dcsp needs redirect true dcnl dcsp dcsp dcsp locale settings mt to kuma locale mapl locale dcnl dcsp dcsp dcsp slug maybe slug dcnl dcsp dcsp elif l locale in mdn locales dcnl dcsp dcsp dcsp needs redirect true dcnl dcsp dcsp dcsp locale mdn localesl locale dcnl dcsp dcsp dcsp slug maybe slug dcnl dcsp if locale dcnl dcsp dcsp if request dcnl dcsp dcsp dcsp locale request language code dcnl dcsp dcsp elif path locale dcnl dcsp dcsp dcsp locale path locale dcnl dcsp if locale dcnl dcsp dcsp locale getattr settings wiki default language enus dcnl dcsp return locale slug needs redirect
def get doc components from url url required locale none check host true dcsp parsed urlparse url dcnl dcsp if check host and parsed netloc dcnl dcsp dcsp return false dcnl dcsp locale path split path parsed path dcnl dcsp if required locale and locale required locale dcnl dcsp dcsp return false dcnl dcsp path + path dcnl dcsp try dcnl dcsp dcsp view view args view kwargs resolve path dcnl dcsp except resolver404 dcnl dcsp dcsp return false dcnl dcsp from kuma wiki views document import document as document view dcnl dcsp if view document view dcnl dcsp dcsp raise notdocumentview dcnl dcsp return locale path view kwargs document path
def analytics upageviews revision ids start date end date none dcsp scopes https www googleapis com auth analytics readonly dcnl dcsp try dcnl dcsp dcsp ga cred dict json loads config google analytics credentials dcnl dcsp except valueerror typeerror dcnl dcsp dcsp raise improperlyconfigured google analytics credentials dcsp constance dcsp setting dcsp is dcsp badly dcsp formed dcnl dcsp if not ga cred dict dcnl dcsp dcsp raise improperlyconfigured an dcsp empty dcsp google analytics credentials dcsp constance dcsp setting dcsp is dcsp not dcsp permitted dcnl dcsp credentials serviceaccountcredentials from json keyfile dict ga cred dict scopes scopes dcnl dcsp http auth credentials authorize http dcnl dcsp service build analyticsreporting v4 http http auth dcnl dcsp if end date is none dcnl dcsp dcsp end date datetime date today dcnl dcsp if hasattr start date date dcnl dcsp dcsp start date start date date dcnl dcsp if hasattr end date date dcnl dcsp dcsp end date end date date dcnl dcsp start date start date isoformat dcnl dcsp end date end date isoformat dcnl dcsp request service reports batchget body reportrequests dimensions name ga dimension12 metrics expression ga uniquepageviews dimensionfilterclauses filters dimensionname ga dimension12 operator in list expressions map str revision ids dateranges startdate start date enddate end date viewid 66726481 dcnl dcsp response request execute dcnl dcsp data int r 0 for r in revision ids dcnl dcsp data update int row dimensions 0 int row metrics 0 values 0 for row in response reports 0 data get rows dcnl dcsp return data
def analytics upageviews by revisions revisions dcsp if not revisions dcnl dcsp dcsp return dcnl dcsp revision ids r id for r in revisions dcnl dcsp start date min r created for r in revisions dcnl dcsp return analytics upageviews revision ids start date
library global function dcnl def format comment rev previous revision none load previous true dcsp if previous revision is none and load previous dcnl dcsp dcsp previous revision rev previous dcnl dcsp comment bugize text rev comment if rev comment else dcnl dcsp if previous revision and previous revision slug rev slug dcnl dcsp dcsp comment + jinja2 markup <span dcsp class slugchange <span s< span dcsp <i dcsp class iconlongarrowright dcsp ariahidden true < i dcsp <span s< span < span previous revision slug rev slug dcnl dcsp return comment
library global function dcnl def revisions unified diff from revision to revision dcsp if from revision is none or to revision is none dcnl dcsp dcsp return diff dcsp is dcsp unavailable dcnl dcsp fromfile s dcsp s from revision document locale from revision id dcnl dcsp tofile s dcsp s to revision document locale to revision id dcnl dcsp tidy from from revision get tidied content dcnl dcsp tidy to to revision get tidied content dcnl dcsp return u n join difflib unified diff tidy from splitlines tidy to splitlines fromfile fromfile tofile tofile
library global function dcnl def diff table content from content to prev id curr id tidy false dcsp if tidy dcnl dcsp dcsp content from errors tidy content content from dcnl dcsp dcsp content to errors tidy content content to dcnl dcsp html diff difflib htmldiff wrapcolumn diff wrap column dcnl dcsp try dcnl dcsp dcsp diff html diff make table content from splitlines content to splitlines ugettext revision dcsp s prev id ugettext revision dcsp s curr id context true numlines config diff context lines dcnl dcsp except runtimeerror dcnl dcsp dcsp message ugettext u there dcsp was dcsp an dcsp error dcsp generating dcsp the dcsp content dcnl dcsp dcsp diff <div dcsp class warning <p s< p < div message dcnl dcsp return jinja2 markup diff
library filter dcnl def selector content find document selector dcsp content dcnl dcsp try dcnl dcsp dcsp page pq document rendered html dcnl dcsp except valueerror dcnl dcsp dcsp pass dcnl dcsp try dcnl dcsp dcsp content page find selector text dcnl dcsp except selectorsyntaxerror dcnl dcsp dcsp pass dcnl dcsp return content
def recursive escape value esc conditional escape dcsp if isinstance value dict dcnl dcsp dcsp return type value esc k recursive escape v for k v in value iteritems dcnl dcsp elif isinstance value list tuple dcnl dcsp dcsp return type value recursive escape v for v in value dcnl dcsp elif isinstance value basestring dcnl dcsp dcsp return esc value dcnl dcsp elif isinstance value int long float or value in true false none dcnl dcsp dcsp return value dcnl dcsp return esc djangojsonencoder default value
library filter dcnl def tojson value dcsp try dcnl dcsp dcsp result json dumps recursive escape value cls djangojsonencoder dcnl dcsp except exception dcnl dcsp dcsp return dcnl dcsp return jinja2 markup result
library filter dcnl def absolutify url site none dcsp if url startswith http dcnl dcsp dcsp return url dcnl dcsp if not site dcnl dcsp dcsp site site objects get current dcnl dcsp parts urlparse urlsplit url dcnl dcsp scheme https dcnl dcsp netloc site domain dcnl dcsp path parts path dcnl dcsp query parts query dcnl dcsp fragment parts fragment dcnl dcsp if path dcnl dcsp dcsp path dcnl dcsp return urlparse urlunparse scheme netloc path none query fragment
library global function dcnl def wiki url path dcsp if in path dcnl dcsp dcsp slug fragment path split 1 dcnl dcsp else dcnl dcsp dcsp slug path dcnl dcsp dcsp fragment dcnl dcsp new path reverse wiki document args slug dcnl dcsp if fragment dcnl dcsp dcsp new path + + fragment dcnl dcsp return new path
def should use rendered doc params html none dcsp show raw params get raw false is not false dcnl dcsp no macros params get nomacros false is not false dcnl dcsp force macros params get macros false is not false dcnl dcsp if doc dcnl dcsp dcsp html doc html dcnl dcsp return config kumascript timeout 0 and html and force macros or not no macros and not show raw
def get document cache control base url timeout none dcsp if not cache control dcnl dcsp dcsp max age config kumascript max age dcnl dcsp dcsp cache control maxage s max age dcnl dcsp if not base url dcnl dcsp dcsp site site objects get current dcnl dcsp dcsp base url http s site domain dcnl dcsp if not timeout dcnl dcsp dcsp timeout config kumascript timeout dcnl dcsp document locale document locale dcnl dcsp document slug document slug dcnl dcsp max age config kumascript max age dcnl dcsp document slug for kumascript document slug dcnl dcsp body errors none none dcnl dcsp try dcnl dcsp dcsp url tmpl settings kumascript url template dcnl dcsp dcsp url unicode url tmpl format path u s s document locale document slug for kumascript dcnl dcsp dcsp cache keys build cache keys document slug document locale dcnl dcsp dcsp etag key modified key body key errors key cache keys dcnl dcsp dcsp headers xfirelogger 1 2 cachecontrol cache control dcnl dcsp dcsp files dcnl dcsp dcsp for attachment in document files select related current revision dcnl dcsp dcsp dcsp files append get attachment metadata dict attachment dcnl dcsp dcsp path document get absolute url dcnl dcsp dcsp env vars dict path path url urljoin base url path id document pk revision id document current revision pk locale document locale title document title files files attachments files slug document slug tags list document tags names review tags list document current revision review tags names modified time mktime document modified timetuple cache control cache control dcnl dcsp dcsp add env headers headers env vars dcnl dcsp dcsp cached meta memcache get many etag key modified key dcnl dcsp dcsp if etag key in cached meta dcnl dcsp dcsp dcsp headers ifnonematch cached metaetag key dcnl dcsp dcsp if modified key in cached meta dcnl dcsp dcsp dcsp headers ifmodifiedsince cached metamodified key dcnl dcsp dcsp response requests get url headers headers timeout timeout dcnl dcsp dcsp if response status code 304 dcnl dcsp dcsp dcsp result memcache get many body key errors key dcnl dcsp dcsp dcsp body result get body key decode utf8 dcnl dcsp dcsp dcsp errors result get errors key none dcnl dcsp dcsp elif response status code 200 dcnl dcsp dcsp dcsp body process body response dcnl dcsp dcsp dcsp errors process errors response dcnl dcsp dcsp dcsp headers response headers dcnl dcsp dcsp dcsp memcache set etag key headers get etag timeout max age dcnl dcsp dcsp dcsp memcache set modified key headers get lastmodified timeout max age dcnl dcsp dcsp dcsp memcache set body key body encode utf8 timeout max age dcnl dcsp dcsp dcsp if errors dcnl dcsp dcsp dcsp dcsp memcache set errors key errors timeout max age dcnl dcsp dcsp elif response status code is none dcnl dcsp dcsp dcsp errors kumascript timeout error dcnl dcsp dcsp else dcnl dcsp dcsp dcsp errors level error message unexpected dcsp response dcsp from dcsp kumascript dcsp service dcsp s response status code args unknownerror dcnl dcsp except exception as exc dcnl dcsp dcsp errors level error message kumascript dcsp service dcsp failed dcsp unexpectedly dcsp s exc args unknownerror dcnl dcsp return body errors
def add env headers headers env vars dcsp headers update dict xkumascriptenv s k base64 b64encode json dumps v for k v in env vars items dcnl dcsp return headers
def process errors response dcsp errors dcnl dcsp try dcnl dcsp dcsp packets defaultdict dict dcnl dcsp dcsp for key value in response headers items dcnl dcsp dcsp dcsp if not key lower startswith firelogger dcnl dcsp dcsp dcsp dcsp continue dcnl dcsp dcsp dcsp prefix id seq key split 3 dcnl dcsp dcsp dcsp packetsid seq value dcnl dcsp dcsp msgs dcnl dcsp dcsp for contents in packets values dcnl dcsp dcsp dcsp keys sorted contents keys key int dcnl dcsp dcsp dcsp encoded n join contentskey for key in keys dcnl dcsp dcsp dcsp decoded json base64 decodestring encoded dcnl dcsp dcsp dcsp packet json loads decoded json dcnl dcsp dcsp dcsp msgs extend packet logs dcnl dcsp dcsp if len msgs dcnl dcsp dcsp dcsp errors msgs dcnl dcsp except exception as exc dcnl dcsp dcsp errors level error message problem dcsp parsing dcsp errors dcsp s exc args parsingerror dcnl dcsp return errors
def build cache keys document locale document slug dcsp path hash hashlib md5 u s s document locale document slug encode utf8 dcnl dcsp base key kumascript s s path hash hexdigest dcnl dcsp etag key base key etag dcnl dcsp modified key base key modified dcnl dcsp body key base key body dcnl dcsp errors key base key errors dcnl dcsp return etag key modified key body key errors key
def macro sources force lowercase keys false dcsp ks macro url urljoin kumascript base url macros dcnl dcsp response requests get ks macro url dcnl dcsp if response status code 200 dcnl dcsp dcsp macros raw response json macros dcnl dcsp dcsp normalize key normalize partial unicodedata normalize nfc dcnl dcsp dcsp if force lowercase keys dcnl dcsp dcsp dcsp normalize key lambda x normalize x lower dcnl dcsp dcsp return normalize key md name normalize md filename for md in macros raw dcnl dcsp else dcnl dcsp dcsp return
def macro page count locale dcsp search search from dict size 0 dcnl dcsp search aggs bucket usage terms field kumascript macros size 0 dcnl dcsp if locale dcnl dcsp dcsp search search filter term locale locale dcnl dcsp result search execute dcnl dcsp return item key item doc count for item in result aggregations usage buckets
def macro usage dcsp macro paths macro sources dcnl dcsp if not macro paths dcnl dcsp dcsp return dcnl dcsp lowercase names dcnl dcsp macros dcnl dcsp for name github subpath in macro paths items dcnl dcsp dcsp macrosname github subpath github subpath count 0 en count 0 dcnl dcsp dcsp lowercase namesname lower name dcnl dcsp def annotate counts counts count type dcnl dcsp dcsp record dcsp document dcsp counts dcsp from dcsp an dcsp elasticsearch dcsp annotated dcsp result dcnl dcsp dcsp for lowercase name doc count in counts items dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp name lowercase nameslowercase name dcnl dcsp dcsp dcsp except keyerror dcnl dcsp dcsp dcsp dcsp pass dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp macrosnamecount type doc count dcnl dcsp try dcnl dcsp dcsp all counts macro page count dcnl dcsp except transporterror dcnl dcsp dcsp return macros dcnl dcsp else dcnl dcsp dcsp annotate counts all counts count dcnl dcsp annotate counts macro page count enus en count dcnl dcsp return macros
pytest fixture dcnl def wiki user db django user model dcsp return django user model objects create username wiki user email wiki user example com date joined datetime 2017 4 14 12 0
pytest fixture dcnl def wiki user 2 db django user model dcsp return django user model objects create username wiki user 2 email wiki user 2 example com date joined datetime 2017 4 17 10 30
pytest fixture dcnl def wiki user 3 db django user model dcsp return django user model objects create username wiki user 3 email wiki user 3 example com date joined datetime 2017 4 23 11 45
pytest fixture dcnl def inactive wiki user db django user model dcsp return django user model objects create is active false username wiki user slacker email wiki user slacker example com date joined datetime 2017 4 19 10 58
pytest fixture dcnl def banned wiki user db django user model wiki user dcsp user django user model objects create username bad wiki user email bad wiki user example com date joined datetime 2017 4 18 9 15 dcnl dcsp ban user bans create by wiki user reason because dcnl dcsp return banneduser user user ban ban
pytest fixture dcnl def root doc wiki user dcsp root doc document objects create locale enus slug root title root dcsp document dcnl dcsp revision objects create document root doc creator wiki user content <p getting dcsp started < p title root dcsp document created datetime 2017 4 14 12 15 dcnl dcsp return root doc
pytest fixture dcnl def create revision root doc dcsp return root doc revisions first
pytest fixture dcnl def edit revision root doc wiki user dcsp root doc current revision revision objects create document root doc creator wiki user content <p the dcsp root dcsp document < p comment done dcsp with dcsp initial dcsp version created datetime 2017 4 14 12 30 dcnl dcsp root doc save dcnl dcsp return root doc current revision
pytest fixture dcnl def trans doc create revision wiki user dcsp trans doc document objects create locale fr parent create revision document slug racine title racine dcsp du dcsp document dcnl dcsp revision objects create document trans doc creator wiki user based on create revision content <p mise dcsp en dcsp route < p title racine dcsp du dcsp document created datetime 2017 4 14 12 20 dcnl dcsp return trans doc
pytest fixture dcnl def trans edit revision trans doc edit revision wiki user dcsp trans doc current revision revision objects create document trans doc creator wiki user based on edit revision content <p le dcsp document dcsp racine < p title racine dcsp du dcsp document created datetime 2017 4 14 20 25 dcnl dcsp trans doc save dcnl dcsp return trans doc current revision
pytest fixture dcnl def root doc with mixed contributors root doc wiki user wiki user 2 inactive wiki user banned wiki user dcsp root doc current revision revision objects create document root doc creator wiki user 2 content <p the dcsp root dcsp document < p comment done dcsp with dcsp the dcsp initial dcsp version created datetime 2017 4 17 12 35 dcnl dcsp root doc save dcnl dcsp root doc current revision revision objects create document root doc creator inactive wiki user content <p the dcsp root dcsp document dcsp reenvisioned < p comment done dcsp with dcsp the dcsp second dcsp revision created datetime 2017 4 18 10 15 dcnl dcsp root doc save dcnl dcsp root doc current revision revision objects create document root doc creator banned wiki user user content <p the dcsp root dcsp document dcsp reenvisioned dcsp with dcsp malice < p comment nuke dcsp the dcsp previous dcsp revision created datetime 2017 4 19 10 15 dcnl dcsp root doc save dcnl dcsp return docwithcontributors doc root doc contributors contributors valid wiki user 2 wiki user banned banned wiki user inactive inactive wiki user
pytest yield fixture dcnl def mock es client request dcsp client mock mock dcnl dcsp connections add connection default client dcnl dcsp yield client dcnl dcsp connections conn dcnl dcsp connections kwargs
requests mock mock dcnl def test macro sources mock requests dcsp macros url urljoin kumascript base url macros dcnl dcsp response can list macros true loader fileloader macros filename a11yrolequicklinks ejs name a11yrolequicklinks filename apifeaturelist ejs name apifeaturelist filename u traduccio u0301n ejs name u traduccio u0301n dcnl dcsp mock requests get macros url json response dcnl dcsp macros kumascript macro sources dcnl dcsp expected a11yrolequicklinks a11yrolequicklinks ejs apifeaturelist apifeaturelist ejs u traducci xf3n u traducci xf3n ejs dcnl dcsp assert macros expected
requests mock mock dcnl def test macro sources empty macro list mock requests dcsp macros url urljoin kumascript base url macros dcnl dcsp response can list macros false loader httploader macros dcnl dcsp mock requests get macros url json response dcnl dcsp macros kumascript macro sources dcnl dcsp assert macros
requests mock mock dcnl def test macro sources error mock requests dcsp macros url urljoin kumascript base url macros dcnl dcsp mock requests get macros url status code 404 text cannot dcsp get dcsp macros dcnl dcsp macros kumascript macro sources dcnl dcsp assert macros
def test macro page count mock es client dcsp mock es client search return value shards u failed 0 u successful 2 u total 2 aggregations usage buckets key a11yrolequicklinks doc count 200 key othermacro doc count 50 hits hits max score 0 0 total 45556 timed out false took 18 dcnl dcsp macros kumascript macro page count dcnl dcsp es json size 0 query match all aggs usage terms field kumascript macros size 0 dcnl dcsp mock es client search assert called once with body es json doc type index none dcnl dcsp assert macros a11yrolequicklinks 200 othermacro 50
def test macro page count en mock es client dcsp mock es client search return value shards u failed 0 u successful 2 u total 2 aggregations usage buckets key a11yrolequicklinks doc count 100 key othermacro doc count 30 hits hits max score 0 0 total 45556 timed out false took 18 dcnl dcsp macros kumascript macro page count locale enus dcnl dcsp es json size 0 query filtered filter term locale enus query match all aggs usage terms field kumascript macros size 0 dcnl dcsp mock es client search assert called once with body es json doc type index none dcnl dcsp assert macros a11yrolequicklinks 100 othermacro 30
mock patch kuma wiki kumascript macro page count dcnl mock patch kuma wiki kumascript macro sources dcnl def test macro usage empty kumascript mock sources mock page count dcsp mock sources return value dcnl dcsp mock page count side effect exception should dcsp not dcsp be dcsp called dcnl dcsp macros kumascript macro usage dcnl dcsp assert macros
mock patch kuma wiki kumascript macro page count dcnl mock patch kuma wiki kumascript macro sources dcnl def test macro usage elasticsearch exception mock sources mock page count dcsp mock sources return value a11yrolequicklinks a11yrolequicklinks ejs dcnl dcsp mock page count side effect transporterror can t dcsp reach dcsp elasticsearch dcnl dcsp macros kumascript macro usage dcnl dcsp expected a11yrolequicklinks github subpath a11yrolequicklinks ejs count 0 en count 0 dcnl dcsp assert macros expected
mock patch kuma wiki kumascript macro page count dcnl mock patch kuma wiki kumascript macro sources dcnl def test macro usage 2nd es exception mock sources mock page count dcsp mock sources return value a11yrolequicklinks a11yrolequicklinks ejs dcnl dcsp mock page count side effect a11yrolequicklinks 200 othermacro 50 transporterror can t dcsp reach dcsp elasticsearch dcnl dcsp with pytest raises transporterror dcnl dcsp dcsp kumascript macro usage
def test compare revisions edit revision client dcsp doc edit revision document dcnl dcsp first revision doc revisions first dcnl dcsp params from first revision id to edit revision id dcnl dcsp url urlparams reverse wiki compare revisions args doc slug locale doc locale params dcnl dcsp response client get url dcnl dcsp assert response status code 200 dcnl dcsp page pq response content dcnl dcsp assert page span diff sub text u getting xa0started dcnl dcsp assert page span diff add text u the xa0root xa0document dcnl dcsp change link page a changerevisions dcnl dcsp assert change link text change dcsp revisions dcnl dcsp change href change link attr href dcnl dcsp bits urlparse change href dcnl dcsp assert bits path reverse wiki document revisions args doc slug locale doc locale dcnl dcsp assert parse qs bits query locale doc locale origin compare dcnl dcsp rev from link page div revfrom dcsp h3 dcsp a dcnl dcsp assert rev from link text revision dcsp d first revision id dcnl dcsp from href rev from link attr href dcnl dcsp assert from href reverse wiki revision args doc slug first revision id locale doc locale dcnl dcsp rev to link page div revto dcsp h3 dcsp a dcnl dcsp assert rev to link text revision dcsp d edit revision id dcnl dcsp to href rev to link attr href dcnl dcsp assert to href reverse wiki revision args doc slug edit revision id locale doc locale
def test compare first translation trans revision client dcsp fr doc trans revision document dcnl dcsp en revision trans revision based on dcnl dcsp en doc en revision document dcnl dcsp assert en doc fr doc dcnl dcsp params from en revision id to trans revision id dcnl dcsp url urlparams reverse wiki compare revisions args fr doc slug locale fr doc locale params dcnl dcsp response client get url dcnl dcsp assert response status code 200 dcnl dcsp page pq response content dcnl dcsp assert page span diff sub text u getting xa0started dcnl dcsp assert page span diff add text u mise xa0en xa0route dcnl dcsp change link page a changerevisions dcnl dcsp change href change link attr href dcnl dcsp bits urlparse change href dcnl dcsp assert bits path reverse wiki document revisions args fr doc slug locale fr doc locale dcnl dcsp assert parse qs bits query locale fr doc locale origin compare dcnl dcsp rev from link page div revfrom dcsp h3 dcsp a dcnl dcsp from href rev from link attr href dcnl dcsp assert from href reverse wiki revision args en doc slug en revision id locale en doc locale dcnl dcsp rev to link page div revto dcsp h3 dcsp a dcnl dcsp to href rev to link attr href dcnl dcsp assert to href reverse wiki revision args fr doc slug trans revision id locale fr doc locale
def test form maintains based on rev client doc view post data trans lang none locale none dcsp if trans lang dcnl dcsp dcsp translate path doc slug dcnl dcsp dcsp uri urllib quote reverse wiki translate locale trans lang args translate path dcnl dcsp else dcnl dcsp dcsp uri reverse view locale locale args doc slug dcnl dcsp response client get uri dcnl dcsp orig rev doc current revision dcnl dcsp eq orig rev id int pq response content inputname based on attr value dcnl dcsp martha rev revision document doc dcnl dcsp martha rev is approved true dcnl dcsp martha rev save dcnl dcsp post data copy based on orig rev id slug orig rev slug dcnl dcsp post data copy update post data dcnl dcsp response client post uri data post data copy dcnl dcsp ok response status code in 200 302 dcnl dcsp fred rev revision objects all order by id 0 dcnl dcsp eq orig rev fred rev based on
pytest mark parametrize doc name root bottom de fr it dcnl def test zone styles client doc hierarchy with zones root doc doc name dcsp zone title a zoneparent dcnl dcsp css link linktype text css href build styles css dcnl dcsp if doc name root dcnl dcsp dcsp doc root doc dcnl dcsp elif doc name bottom dcnl dcsp dcsp doc doc hierarchy with zones bottom dcnl dcsp dcsp zone title a zoneparenthref format doc hierarchy with zones middle top get absolute url dcnl dcsp else dcnl dcsp dcsp doc doc hierarchy with zones top translations get locale doc name dcnl dcsp url reverse wiki document args doc slug locale doc locale dcnl dcsp response client get url follow true dcnl dcsp response html pq response content dcnl dcsp def count selector dcnl dcsp dcsp return len response html find selector dcnl dcsp def one if args dcnl dcsp dcsp return 1 if any arg doc name for arg in args else 0 dcnl dcsp assert count body zone one if bottom de fr it dcnl dcsp assert count body zonelanding one if de fr it dcnl dcsp assert count span zoneparent one if de fr it dcnl dcsp assert count documenttitle one if root bottom de fr it dcnl dcsp assert count zone title one if bottom dcnl dcsp assert count crumbs one if root bottom dcnl dcsp assert count css link format zones one if it dcnl dcsp assert count css link format zonebobby one if bottom dcnl dcsp assert count css link format zoneberlin one if de dcnl dcsp assert count css link format zonelindsey one if fr
pytest mark parametrize elem num has prev is english has revert 0 true false false 1 true false true 2 false true false ids current first trans en source dcnl def test list revisions elem num has prev is english has revert admin client trans edit revision dcsp doc trans edit revision document dcnl dcsp url reverse wiki document revisions locale doc locale args doc slug dcnl dcsp response admin client get url dcnl dcsp assert response status code 200 dcnl dcsp page pq response content dcnl dcsp list items page ul revisionlist dcsp li dcnl dcsp li element list itemselem num dcnl dcsp revision trans edit revision dcnl dcsp num 0 dcnl dcsp while num < elem num dcnl dcsp dcsp revision revision previous dcnl dcsp dcsp num + 1 dcnl dcsp rev doc revision document dcnl dcsp revision url reverse wiki revision locale rev doc locale args rev doc slug revision id dcnl dcsp rev link li element cssselect revisionlistdate 0 find a dcnl dcsp assert rev link attrib href revision url dcnl dcsp prev link li element cssselect revisionlistprev 0 find a dcnl dcsp if has prev dcnl dcsp dcsp assert prev link is not none dcnl dcsp dcsp with translation override doc locale dcnl dcsp dcsp dcsp expected translation gettext previous decode utf8 dcnl dcsp dcsp assert prev link text expected dcnl dcsp else dcnl dcsp dcsp assert prev link is none dcnl dcsp comment em li element cssselect revisionlistcomment 0 find em dcnl dcsp if is english dcnl dcsp dcsp assert li element attrib class revisionlistensource dcnl dcsp dcsp with translation override doc locale dcnl dcsp dcsp dcsp expected translation gettext english dcsp us decode utf8 dcnl dcsp dcsp assert comment em text expected dcnl dcsp else dcnl dcsp dcsp assert li element attrib get class is none dcnl dcsp dcsp assert comment em is none dcnl dcsp revert li element cssselect revisionlistrevert dcnl dcsp if has revert dcnl dcsp dcsp assert len revert 1 dcnl dcsp else dcnl dcsp dcsp assert len revert 0
def test revisions root doc client dcsp url reverse wiki document revisions args root doc slug locale root doc locale dcnl dcsp resp client get url dcnl dcsp assert resp status code 200
def test revisions of translated document trans doc client dcsp assert trans doc revisions count 1 dcnl dcsp url reverse wiki document revisions args trans doc slug locale trans doc locale dcnl dcsp resp client get url dcnl dcsp assert resp status code 200 dcnl dcsp page pq resp content dcnl dcsp list content page revisionlistcontain find li dcnl dcsp assert len list content 2 dcnl dcsp eng rev id list content find inputname from 1 attrib value dcnl dcsp assert str trans doc current revision based on id eng rev id
def test revisions of translated doc with no based on trans revision client dcsp assert trans revision based on dcnl dcsp trans revision based on none dcnl dcsp trans revision save dcnl dcsp trans doc trans revision document dcnl dcsp url reverse wiki document revisions args trans doc slug locale trans doc locale dcnl dcsp resp client get url dcnl dcsp assert resp status code 200 dcnl dcsp page pq resp content dcnl dcsp list content page revisionlistcontain find li dcnl dcsp assert len list content 1
def test revisions bad slug is not found db client dcsp url reverse wiki document revisions args not found locale enus dcnl dcsp resp client get url dcnl dcsp assert resp status code 404
def test revisions doc without revisions is not found db client dcsp doc document objects create locale enus slug half created dcnl dcsp url reverse wiki document revisions args doc slug locale doc locale dcnl dcsp resp client get url dcnl dcsp assert resp status code 404
def test revisions all params as anon user is forbidden root doc client dcsp url reverse wiki document revisions args root doc slug locale root doc locale dcnl dcsp all url urlparams url limit all dcnl dcsp resp client get all url dcnl dcsp assert resp status code 403
def test revisions all params as user is allowed root doc wiki user client dcsp url reverse wiki document revisions args root doc slug locale root doc locale dcnl dcsp all url urlparams url limit all dcnl dcsp wiki user set password password dcnl dcsp wiki user save dcnl dcsp client login username wiki user username password password dcnl dcsp resp client get all url dcnl dcsp assert resp status code 200
def test revisions request tiny pages edit revision client dcsp doc edit revision document dcnl dcsp assert doc revisions count 1 dcnl dcsp url reverse wiki document revisions args doc slug locale doc locale dcnl dcsp limit url urlparams url limit 1 dcnl dcsp resp client get limit url dcnl dcsp assert resp status code 200 dcnl dcsp page pq resp content dcnl dcsp assert len page find ol pagination 1
def test revisions request large pages root doc client dcsp rev count root doc revisions count dcnl dcsp url reverse wiki document revisions args root doc slug locale root doc locale dcnl dcsp limit url urlparams url limit rev count + 1 dcnl dcsp resp client get limit url dcnl dcsp assert resp status code 200 dcnl dcsp page pq resp content dcnl dcsp assert len page find ol pagination 0
def test revisions request invalid pages root doc client dcsp url reverse wiki document revisions args root doc slug locale root doc locale dcnl dcsp limit url urlparams url limit nonsense dcnl dcsp resp client get limit url dcnl dcsp assert resp status code 200
def document save false kwargs dcsp defaults title unicode datetime now is redirect 0 dcnl dcsp defaults update kwargs dcnl dcsp if slug not in kwargs dcnl dcsp dcsp defaults slug slugify unicode defaults title dcnl dcsp d document defaults dcnl dcsp if save dcnl dcsp dcsp d save dcnl dcsp return d
def revision save false kwargs dcsp doc none dcnl dcsp if document not in kwargs dcnl dcsp dcsp doc document save true dcnl dcsp else dcnl dcsp dcsp doc kwargs document dcnl dcsp defaults summary some dcsp summary content some dcsp content comment some dcsp comment creator kwargs get creator or get user document doc tags some dcsp tags toc depth 1 dcnl dcsp defaults update kwargs dcnl dcsp rev revision defaults dcnl dcsp if save dcnl dcsp dcsp rev save dcnl dcsp return rev
def translated revision locale de kwargs dcsp parent rev revision is approved true dcnl dcsp parent rev save dcnl dcsp translation document parent parent rev document locale locale dcnl dcsp translation save dcnl dcsp new kwargs document translation based on parent rev dcnl dcsp new kwargs update kwargs dcnl dcsp return revision new kwargs
def normalize html input dcsp return kuma wiki content parse unicode input filter whitespaceremovalfilter serialize alphabetical attributes true
def create document editor group dcsp group group created group objects get or create name editor dcnl dcsp if group created dcnl dcsp dcsp actions add change delete view restore dcnl dcsp dcsp perms permission objects get codename s document action for action in actions dcnl dcsp dcsp group permissions perms dcnl dcsp dcsp group save dcnl dcsp return group
def create document editor user dcsp user get user model dcnl dcsp user user created user objects get or create username conantheeditor defaults dict email user s example com is active true is staff false is superuser false dcnl dcsp if user created dcnl dcsp dcsp user set password testpass dcnl dcsp dcsp user groups create document editor group dcnl dcsp dcsp user save dcnl dcsp return user
pytest mark parametrize path dcsp expected mdn getting started docs mdn getting started mdn getting started option 1 i like words docs mdn getting started option 1 i like words ids simple fragment dcnl def test wiki url path expected dcsp out wiki url path dcnl dcsp assert out expected
def objects eq manager list dcsp eq set manager all set list
def test nearest zone doc hierarchy with zones cleared cacheback cache dcsp top doc doc hierarchy with zones top dcnl dcsp top zone top doc zone dcnl dcsp fr top doc top doc translations get locale fr dcnl dcsp de top doc top doc translations get locale de dcnl dcsp assert fr top doc parent top doc dcnl dcsp assert de top doc parent top doc dcnl dcsp assert top doc nearest zone top zone dcnl dcsp assert fr top doc nearest zone top doc nearest zone dcnl dcsp assert de top doc nearest zone de top doc zone
def test nearest zone when no parent doc hierarchy with zones cleared cacheback cache dcsp top doc doc hierarchy with zones top dcnl dcsp fr top doc top doc translations get locale fr dcnl dcsp fr top doc parent none dcnl dcsp fr top doc save dcnl dcsp assert not fr top doc nearest zone
pytest mark parametrize doc name expected result top true bottom false de true fr true root false dcnl def test is zone root doc hierarchy with zones root doc cleared cacheback cache doc name expected result dcsp if doc name root dcnl dcsp dcsp doc root doc dcnl dcsp elif doc name in de fr dcnl dcsp dcsp doc doc hierarchy with zones top translations get locale doc name dcnl dcsp else dcnl dcsp dcsp doc getattr doc hierarchy with zones doc name dcnl dcsp assert doc is zone root is expected result
def test zone styles client doc hierarchy with zones dcsp top doc doc hierarchy with zones top dcnl dcsp bottom doc doc hierarchy with zones bottom dcnl dcsp url reverse wiki styles args top doc slug locale settings wiki default language dcnl dcsp response client get url follow true dcnl dcsp assert response redirect chain dcnl dcsp redirect location redirect code response redirect chain 1 dcnl dcsp assert redirect location endswith build styles zones css dcnl dcsp assert redirect code 302 dcnl dcsp url reverse wiki styles args bottom doc slug locale settings wiki default language dcnl dcsp response client get url follow true dcnl dcsp assert response status code 404 dcnl dcsp url reverse wiki styles args someunknowndocumentslug locale settings wiki default language dcnl dcsp response client get url follow true dcnl dcsp assert response status code 404
def test nearest zone expiry dcsp job documentnearestzonejob dcnl dcsp with mock patch time time return value 0 dcnl dcsp dcsp assert len set job expiry for in range 0 1000 1
pytest mark parametrize doc name expected zone name top top middle top middle top middle bottom middle top bottom middle top root none dcnl def test nearest zone doc hierarchy with zones root doc cleared cacheback cache doc name expected zone name dcsp doc root doc if doc name root else getattr doc hierarchy with zones doc name dcnl dcsp zone none if expected zone name is none else getattr doc hierarchy with zones expected zone name zone dcnl dcsp assert documentnearestzonejob get doc pk zone
def test nearest zone when deleted parent topic doc hierarchy with zones cleared cacheback cache dcsp bottom doc doc hierarchy with zones bottom dcnl dcsp middle top zone doc hierarchy with zones middle top zone dcnl dcsp doc hierarchy with zones middle bottom delete dcnl dcsp assert documentnearestzonejob get bottom doc pk middle top zone
pytest mark parametrize mode maintenancemode normalmode dcnl def test contributors db cleared cacheback cache settings wiki user 3 root doc with mixed contributors mode dcsp settings maintenance mode mode maintenancemode dcnl dcsp fixture root doc with mixed contributors dcnl dcsp root doc fixture doc dcnl dcsp job documentcontributorsjob dcnl dcsp job fetch on miss true dcnl dcsp contributors job get root doc pk dcnl dcsp if settings maintenance mode dcnl dcsp dcsp assert not contributors dcnl dcsp dcsp return dcnl dcsp valid contrib ids user pk for user in fixture contributors valid dcnl dcsp assert c id for c in contributors valid contrib ids dcnl dcsp banned user fixture contributors banned user dcnl dcsp fixture contributors banned ban delete dcnl dcsp assert banned user pk in set c id for c in job get root doc pk dcnl dcsp root doc current revision revision objects create document root doc creator wiki user 3 content <p the dcsp root dcsp document dcsp reenvisioned < p comment done dcsp with dcsp the dcsp previous dcsp version created datetime 2017 4 24 12 35 dcnl dcsp root doc save dcnl dcsp assert c id for c in job get root doc pk wiki user 3 pk banned user pk + valid contrib ids
def test apply content experiment no experiment ce settings rf dcsp doc mock mock spec set locale slug dcnl dcsp doc locale enus dcnl dcsp doc slug other dcnl dcsp request rf get s docs s doc locale doc slug dcnl dcsp experiment doc params apply content experiment request doc dcnl dcsp assert experiment doc doc dcnl dcsp assert params is none
def test apply content experiment has experiment ce settings rf dcsp doc mock mock spec set locale slug dcnl dcsp doc locale enus dcnl dcsp doc slug original dcnl dcsp request rf get s docs s doc locale doc slug dcnl dcsp experiment doc params apply content experiment request doc dcnl dcsp assert experiment doc doc dcnl dcsp assert params id experimenttest ga name experimenttest param v original path enus docs original variants control original test experiment test variant selected none selection is valid none
def test apply content experiment selected original ce settings rf dcsp doc mock mock spec set locale slug dcnl dcsp db doc mock mock spec set locale slug dcnl dcsp doc locale db doc locale enus dcnl dcsp doc slug db doc slug original dcnl dcsp request rf get s docs s doc locale doc slug v control dcnl dcsp with mock patch kuma wiki views document document objects get return value db doc as mock get dcnl dcsp dcsp experiment doc params apply content experiment request doc dcnl dcsp mock get assert called once with locale enus slug original dcnl dcsp assert experiment doc db doc dcnl dcsp assert params selected control dcnl dcsp assert params selection is valid
def test apply content experiment selected variant ce settings rf dcsp doc mock mock spec set locale slug dcnl dcsp db doc mock mock spec set locale slug dcnl dcsp doc locale db doc locale enus dcnl dcsp doc slug original dcnl dcsp db doc slug experiment test variant dcnl dcsp request rf get s docs s doc locale doc slug v test dcnl dcsp with mock patch kuma wiki views document document objects get return value db doc as mock get dcnl dcsp dcsp experiment doc params apply content experiment request doc dcnl dcsp mock get assert called once with locale enus slug experiment test variant dcnl dcsp assert experiment doc db doc dcnl dcsp assert params selected test dcnl dcsp assert params selection is valid
def test apply content experiment bad selection ce settings rf dcsp doc mock mock spec set locale slug dcnl dcsp doc locale enus dcnl dcsp doc slug original dcnl dcsp request rf get s docs s doc locale doc slug v other dcnl dcsp experiment doc params apply content experiment request doc dcnl dcsp assert experiment doc doc dcnl dcsp assert params selected is none dcnl dcsp assert not params selection is valid
def test apply content experiment valid selection no doc ce settings rf dcsp doc mock mock spec set locale slug dcnl dcsp doc locale enus dcnl dcsp doc slug original dcnl dcsp request rf get s docs s doc locale doc slug v test dcnl dcsp with mock patch kuma wiki views document document objects get side effect document doesnotexist as mock get dcnl dcsp dcsp experiment doc params apply content experiment request doc dcnl dcsp mock get assert called once with locale enus slug experiment test variant dcnl dcsp assert experiment doc doc dcnl dcsp assert params selected is none dcnl dcsp assert not params selection is valid
pytest mark parametrize endpoint document preview dcnl def test kumascript error reporting admin client root doc ks toolbox endpoint dcsp ks settings dict kumascript timeout 1 0 kumascript max age 600 kuma document force deferred timeout 10 0 kuma document render timeout 180 0 dcnl dcsp mock requests requests mock mocker dcnl dcsp mock ks config mock patch kuma wiki kumascript config ks settings dcnl dcsp with mock ks config dcnl dcsp dcsp with mock requests dcnl dcsp dcsp dcsp if endpoint preview dcnl dcsp dcsp dcsp dcsp mock requests post requests mock any text hello dcsp world headers ks toolbox errors as headers dcnl dcsp dcsp dcsp dcsp mock requests get requests mock any ks toolbox macros response dcnl dcsp dcsp dcsp dcsp response admin client post reverse wiki preview locale root doc locale dict content anything dcsp truthy dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp mock requests get requests mock any dict text hello dcsp world headers ks toolbox errors as headers ks toolbox macros response dcnl dcsp dcsp dcsp dcsp with mock patch kuma wiki models config ks settings dcnl dcsp dcsp dcsp dcsp dcsp response admin client get root doc get absolute url dcnl dcsp assert response status code 200 dcnl dcsp response html pq response content dcnl dcsp macro link kserrorslist dcsp ahref https github com mdn kumascript blob master macros ejs dcnl dcsp create link kserrorslist dcsp ahref https github com mdn kumascript updatingmacros dcnl dcsp assert len response html find macro link format somemacro 1 dcnl dcsp assert len response html find create link 1 dcnl dcsp assert mock requests request history0 headers xfirelogger 1 2 dcnl dcsp for error in ks toolbox errors logs dcnl dcsp dcsp assert error message in response content
pytest mark parametrize raw true false dcnl def test compare revisions edit revision client raw dcsp doc edit revision document dcnl dcsp first revision doc revisions first dcnl dcsp params from first revision id to edit revision id dcnl dcsp if raw dcnl dcsp dcsp params raw 1 dcnl dcsp url urlparams reverse wiki compare revisions args doc slug locale doc locale params dcnl dcsp response client get url dcnl dcsp assert response status code 200
pytest mark parametrize raw true false dcnl def test compare translation trans revision client raw dcsp fr doc trans revision document dcnl dcsp en revision trans revision based on dcnl dcsp en doc en revision document dcnl dcsp assert en doc fr doc dcnl dcsp params from en revision id to trans revision id dcnl dcsp if raw dcnl dcsp dcsp params raw 1 dcnl dcsp url urlparams reverse wiki compare revisions args fr doc slug locale fr doc locale params dcnl dcsp response client get url dcnl dcsp assert response status code 200
pytest mark parametrize raw true false dcnl def test compare revisions without tidied content edit revision client raw dcsp doc edit revision document dcnl dcsp first revision doc revisions first dcnl dcsp ids first revision id edit revision id dcnl dcsp revision objects filter id in ids update tidied content dcnl dcsp params from first revision id to edit revision id dcnl dcsp if raw dcnl dcsp dcsp params raw 1 dcnl dcsp url urlparams reverse wiki compare revisions args doc slug locale doc locale params dcnl dcsp response client get url dcnl dcsp assert response status code 200 dcnl dcsp assert please dcsp refresh dcsp this dcsp page dcsp in dcsp a dcsp few dcsp minutes in response content
pytest mark parametrize id1 id2 1e309 1e309 invalid invalid dcnl def test compare revisions invalid ids root doc client id1 id2 dcsp url urlparams reverse wiki compare revisions args root doc slug locale root doc locale from id1 to id2 dcnl dcsp response client get url dcnl dcsp assert response status code 404
pytest mark parametrize param from to dcnl def test compare revisions only one param create revision client param dcsp doc create revision document dcnl dcsp url urlparams reverse wiki compare revisions args doc slug locale doc locale param create revision id dcnl dcsp response client get url dcnl dcsp assert response status code 404
def test compare revisions wrong document edit revision client dcsp doc edit revision document dcnl dcsp first revision doc revisions first dcnl dcsp other doc document objects create locale enus slug other title other dcsp document dcnl dcsp url urlparams reverse wiki compare revisions args other doc slug locale other doc locale from first revision id to edit revision id dcnl dcsp response client get url dcnl dcsp assert response status code 404
pytest fixture dcnl def mock doc dcsp mock doc mock mock spec set is redirect deleted slug dcnl dcsp mock doc is redirect false dcnl dcsp mock doc deleted false dcnl dcsp mock doc slug regularslug dcnl dcsp return mock doc
def test should update standard doc mock doc dcsp assert wikidocumenttype should update mock doc
pytest mark parametrize slug talk webweb talk css user jezdez user talk jezdez template talk anch project talk mdn experiment blue dcnl def test should not update excluded slug mock doc slug dcsp mock doc slug slug dcnl dcsp assert not wikidocumenttype should update mock doc
pytest mark parametrize flag is redirect deleted dcnl def test should not update excluded flags mock doc flag dcsp setattr mock doc flag true dcnl dcsp assert not wikidocumenttype should update mock doc
def test notification context for create create revision dcsp context notification context create revision dcnl dcsp utm campaign u utm campaign wiki+doc+edits utm medium email utm source developer mozilla org dcnl dcsp url u enus docs root dcnl dcsp expected u compare url u u creator create revision creator u diff u diff dcsp is dcsp unavailable u document title u root dcsp document u edit url url + u edit + utm campaign u history url url + u history + utm campaign u locale u enus u user url u profiles wiki user + utm campaign u view url url + utm campaign dcnl dcsp assert context expected
def test notification context for edit create revision edit revision dcsp context notification context edit revision dcnl dcsp utm campaign u utm campaign wiki+doc+edits utm medium email utm source developer mozilla org dcnl dcsp url u enus docs root dcnl dcsp compare url url + u compare to d edit revision id + u from d create revision id + utm campaign replace u u dcnl dcsp diff u dcsp enus dcsp d n n+++ dcsp enus dcsp d n n dcsp 5 7 dcsp +5 7 dcsp n n dcsp dcsp dcsp < head n dcsp dcsp dcsp <body n dcsp dcsp dcsp dcsp dcsp <p n dcsp dcsp dcsp dcsp dcsp dcsp getting dcsp started n+ dcsp dcsp dcsp dcsp dcsp dcsp the dcsp root dcsp document n dcsp dcsp dcsp dcsp dcsp < p n dcsp dcsp dcsp < body n dcsp < html create revision id edit revision id dcnl dcsp expected u compare url compare url u creator edit revision creator u diff diff u document title u root dcsp document u edit url url + u edit + utm campaign u history url url + u history + utm campaign u locale u enus u user url u profiles wiki user + utm campaign u view url url + utm campaign dcnl dcsp assert context expected
def test notification context for translation trans revision create revision dcsp context notification context trans revision dcnl dcsp utm campaign u utm campaign wiki+doc+edits utm medium email utm source developer mozilla org dcnl dcsp url u fr docs racine dcnl dcsp compare url url + u compare to d trans revision id + u from d create revision id + utm campaign replace u u dcnl dcsp diff u dcsp enus dcsp d n n+++ dcsp fr dcsp d n n dcsp 5 7 dcsp +5 7 dcsp n n dcsp dcsp dcsp < head n dcsp dcsp dcsp <body n dcsp dcsp dcsp dcsp dcsp <p n dcsp dcsp dcsp dcsp dcsp dcsp getting dcsp started n+ dcsp dcsp dcsp dcsp dcsp dcsp mise dcsp en dcsp route n dcsp dcsp dcsp dcsp dcsp < p n dcsp dcsp dcsp < body n dcsp < html create revision id trans revision id dcnl dcsp expected u compare url compare url u creator trans revision creator u diff diff u document title u racine dcsp du dcsp document u edit url url + u edit + utm campaign u history url url + u history + utm campaign u locale u fr u user url u profiles wiki user + utm campaign u view url url + utm campaign dcnl dcsp assert context expected
mock patch u tidings events eventunion fire dcnl def test edit document event fires union mock fire create revision wiki user dcsp editdocumentevent notify wiki user create revision document dcnl dcsp editdocumentevent create revision fire dcnl dcsp mock fire assert called once with
mock patch u kuma wiki events emails with users and watches dcnl def test edit document event emails on create mock emails create revision dcsp users and watches u fake user none dcnl dcsp editdocumentevent create revision mails users and watches dcnl dcsp assert mock emails call count 1 dcnl dcsp args kwargs mock emails call args dcnl dcsp assert not args dcnl dcsp assert kwargs u subject mock any u text template u wiki email edited ltxt u html template none u context vars notification context create revision u users and watches users and watches u default locale u enus u headers u xkumaeditorusername u wiki user u xkumadocumenturl u https example com enus docs root u xkumadocumenttitle u root dcsp document u xkumadocumentlocale u enus dcnl dcsp subject kwargsu subject kwargsu context vars dcnl dcsp expected u mdnenusnew dcsp page dcsp root dcsp document dcsp created dcsp by dcsp wiki user dcnl dcsp assert subject expected
mock patch u kuma wiki events emails with users and watches dcnl def test edit document event emails on change mock emails edit revision dcsp users and watches u fake user none dcnl dcsp editdocumentevent edit revision mails users and watches dcnl dcsp assert mock emails call count 1 dcnl dcsp args kwargs mock emails call args dcnl dcsp assert not args dcnl dcsp context notification context edit revision dcnl dcsp assert kwargsu context vars context dcnl dcsp subject kwargsu subject context dcnl dcsp expected u mdnenus dcsp page dcsp root dcsp document dcsp changed dcsp by dcsp wiki user dcnl dcsp assert subject expected
def test first edit email on create create revision dcsp mail first edit email create revision dcnl dcsp assert mail subject u mdnenusnew dcsp wiki user dcsp made dcsp their dcsp first dcsp edit dcsp creating dcsp root dcsp document dcnl dcsp assert mail extra headers u xkumaeditorusername u wiki user u xkumadocumenturl u https example com enus docs root u xkumadocumenttitle u root dcsp document u xkumadocumentlocale u enus
def test first edit email on change edit revision dcsp mail first edit email edit revision dcnl dcsp assert mail subject u mdnenus dcsp wiki user dcsp made dcsp their dcsp first dcsp edit dcsp to dcsp root dcsp document
def test first edit email on translate trans revision dcsp mail first edit email trans revision dcnl dcsp assert mail subject u mdnfrnew dcsp wiki user dcsp made dcsp their dcsp first dcsp edit dcsp creating dcsp racine dcsp du dcsp document dcnl dcsp assert mail extra headers u xkumaeditorusername u wiki user u xkumadocumenturl u https example com fr docs racine u xkumadocumenttitle u racine dcsp du dcsp document u xkumadocumentlocale u fr
def test spam attempt email on create wiki user dcsp spam attempt documentspamattempt user wiki user title u my dcsp new dcsp spam dcsp page slug u mynewspampage created datetime 2017 4 14 15 13 dcnl dcsp mail spam attempt email spam attempt dcnl dcsp assert mail subject u mdn dcsp wiki dcsp spam dcsp attempt dcsp recorded dcsp with dcsp title dcsp my dcsp new dcsp spam dcsp page dcnl dcsp assert mail extra headers u xkumaeditorusername u wiki user
def test spam attempt email on change wiki user root doc dcsp spam attempt documentspamattempt user wiki user title u a dcsp spam dcsp revision slug root doc slug document root doc created datetime 2017 4 14 15 14 dcnl dcsp mail spam attempt email spam attempt dcnl dcsp assert mail subject u mdn dcsp wiki dcsp spam dcsp attempt dcsp recorded dcsp for dcsp document dcsp enus docs root dcsp root dcsp document dcnl dcsp assert mail extra headers u xkumaeditorusername u wiki user u xkumadocumenturl u https example com enus docs root u xkumadocumenttitle u root dcsp document u xkumadocumentlocale u enus
def test spam attempt email on translate wiki user trans doc dcsp spam attempt documentspamattempt user wiki user title u ma dcsp nouvelle dcsp page dcsp de dcsp spam slug u manouvellepagedespam created datetime 2017 4 15 10 54 dcnl dcsp mail spam attempt email spam attempt dcnl dcsp assert mail subject u mdn dcsp wiki dcsp spam dcsp attempt dcsp recorded dcsp with dcsp title dcsp ma dcsp nouvelle dcsp page dcsp de dcsp spam
def test spam attempt email partial model wiki user dcsp spam attempt documentspamattempt user wiki user slug u mynewspampage created datetime 2017 4 14 15 13 dcnl dcsp mail spam attempt email spam attempt dcnl dcsp assert mail subject u mdn dcsp wiki dcsp spam dcsp attempt dcsp recorded dcnl dcsp assert mail extra headers u xkumaeditorusername u wiki user
def test filteriframe dcsp slug testcodeembed dcnl dcsp embed url https sampleserver enus docs s samples sample1 slug dcnl dcsp doc src dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp <p this dcsp is dcsp a dcsp page dcsp deal dcsp with dcsp it < p n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp <iframe dcsp id if1 dcsp src embed url s < iframe n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp <iframe dcsp id if2 dcsp src https testserver < iframe n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp <iframe dcsp id if3 dcsp src https some alien site com < iframe n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp <iframe dcsp id if4 dcsp src http davidwalsh name < iframe n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp <iframe dcsp id if5 dcsp src ftp davidwalsh name < iframe n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp <p test< p n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dict embed url embed url dcnl dcsp pattern ^https sample|test server dcnl dcsp result src parse doc src filteriframehosts pattern serialize dcnl dcsp page pq result src dcnl dcsp assert page if1 attr src embed url dcnl dcsp assert page if2 attr src https testserver dcnl dcsp assert page if3 attr src dcnl dcsp assert page if4 attr src dcnl dcsp assert page if5 attr src
def test filteriframe empty contents dcsp doc src n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp <iframe n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp <iframe dcsp src javascript alert 1 < iframe n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp < iframe n dcsp dcsp dcsp dcsp dcnl dcsp expected src n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp <iframe n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp < iframe n dcsp dcsp dcsp dcsp dcnl dcsp pattern https sampleserver dcnl dcsp result src parse doc src filteriframehosts pattern serialize dcnl dcsp assert normalize html expected src normalize html result src
def populate uuids apps schema editor dcsp document apps get model u wiki u document dcnl dcsp docs document objects filter uuid isnull true dcnl dcsp for document id in docs values list u id flat true iterator dcnl dcsp dcsp document objects filter id document id update uuid uuid4
def clear uuids apps schema editor dcsp document apps get model u wiki u document dcnl dcsp document objects exclude uuid isnull true update uuid none
def set review unavailable apps schema editor dcsp documentspamattempt apps get model u wiki u documentspamattempt dcnl dcsp to set documentspamattempt objects filter data isnull true review needs review dcnl dcsp to set update review review unavailable
def clear review apps schema editor dcsp documentspamattempt apps get model u wiki u documentspamattempt dcnl dcsp to clear documentspamattempt objects filter review review unavailable dcnl dcsp to clear update review needs review
block user agents dcnl login required dcnl process document path dcnl def select locale request document slug document locale dcsp doc get object or 404 document locale document locale slug document slug dcnl dcsp return render request wiki select locale html document doc
block user agents dcnl login required dcnl process document path dcnl check readonly dcnl prevent indexing dcnl never cache dcnl def translate request document slug document locale revision id none dcsp parent doc get object or 404 document locale settings wiki default language slug document slug dcnl dcsp if not revision id dcnl dcsp dcsp document locale request get get tolocale document locale dcnl dcsp discard href dcnl dcsp if settings wiki default language document locale dcnl dcsp dcsp return redirect reverse wiki edit locale settings wiki default language args parent doc slug dcnl dcsp if not parent doc is localizable dcnl dcsp dcsp message u you dcsp cannot dcsp translate dcsp this dcsp document dcnl dcsp dcsp context message message dcnl dcsp dcsp return render request handlers 400 html context status 400 dcnl dcsp if revision id dcnl dcsp dcsp revision get object or 404 revision pk revision id dcnl dcsp else dcnl dcsp dcsp revision none dcnl dcsp based on rev parent doc current or latest revision dcnl dcsp disclose description bool request get get opendescription dcnl dcsp try dcnl dcsp dcsp doc parent doc translations get locale document locale dcnl dcsp dcsp slug dict split slug doc slug dcnl dcsp except document doesnotexist dcnl dcsp dcsp doc none dcnl dcsp dcsp disclose description true dcnl dcsp dcsp slug dict split slug document slug dcnl dcsp dcsp if parent doc parent topic dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp parent topic translated doc parent doc parent topic translations get locale document locale dcnl dcsp dcsp dcsp dcsp slug dict split slug parent topic translated doc slug + + slug dict specific dcnl dcsp dcsp dcsp except objectdoesnotexist dcnl dcsp dcsp dcsp dcsp pass dcnl dcsp user has doc perm not doc or doc and doc allows editing by request user dcnl dcsp doc form none dcnl dcsp if user has doc perm dcnl dcsp dcsp if doc dcnl dcsp dcsp dcsp discard href doc get absolute url dcnl dcsp dcsp dcsp doc slug slug dict specific dcnl dcsp dcsp dcsp doc initial document form initial doc dcnl dcsp dcsp else dcnl dcsp dcsp dcsp discard href parent doc get absolute url dcnl dcsp dcsp dcsp doc initial title based on rev title slug slug dict specific dcnl dcsp dcsp doc form documentform initial doc initial parent slug slug dict parent dcnl dcsp initial based on based on rev id current rev doc current or latest revision id if doc else none comment toc depth based on rev toc depth localization tags inprogress dcnl dcsp content none dcnl dcsp if revision is not none dcnl dcsp dcsp content revision content dcnl dcsp elif not doc dcnl dcsp dcsp content based on rev content dcnl dcsp if content dcnl dcsp dcsp initial update content kuma wiki content parse content filtereditorsafety serialize dcnl dcsp instance doc and doc current or latest revision dcnl dcsp rev form revisionform request request instance instance initial initial parent slug slug dict parent dcnl dcsp if request method post dcnl dcsp dcsp which form request post get formtype both dcnl dcsp dcsp doc form invalid false dcnl dcsp dcsp posted slug request post get slug slug dict specific dcnl dcsp dcsp if user has doc perm and which form in doc both dcnl dcsp dcsp dcsp disclose description true dcnl dcsp dcsp dcsp post data request post copy dcnl dcsp dcsp dcsp post data update locale document locale dcnl dcsp dcsp dcsp doc form documentform post data instance doc parent slug slug dict parent dcnl dcsp dcsp dcsp doc form instance locale document locale dcnl dcsp dcsp dcsp doc form instance parent parent doc dcnl dcsp dcsp dcsp if which form both dcnl dcsp dcsp dcsp dcsp rev form revisionform request request data post data parent slug slug dict parent dcnl dcsp dcsp dcsp if doc form is valid and which form doc or rev form is valid dcnl dcsp dcsp dcsp dcsp doc doc form save parent parent doc dcnl dcsp dcsp dcsp dcsp if which form doc dcnl dcsp dcsp dcsp dcsp dcsp url urlparams doc get edit url opendescription 1 dcnl dcsp dcsp dcsp dcsp dcsp return redirect url dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp doc form data slug posted slug dcnl dcsp dcsp dcsp dcsp doc form invalid true dcnl dcsp dcsp if doc and which form in rev both dcnl dcsp dcsp dcsp post data request post copy dcnl dcsp dcsp dcsp if slug not in post data dcnl dcsp dcsp dcsp dcsp post data slug posted slug dcnl dcsp dcsp dcsp post data toc depth based on rev toc depth dcnl dcsp dcsp dcsp post data locale document locale dcnl dcsp dcsp dcsp rev form revisionform request request data post data parent slug slug dict parent dcnl dcsp dcsp dcsp rev form instance document doc dcnl dcsp dcsp dcsp if rev form is valid and not doc form invalid dcnl dcsp dcsp dcsp dcsp parent id request post get parent id dcnl dcsp dcsp dcsp dcsp if parent id dcnl dcsp dcsp dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp dcsp dcsp parent doc get object or 404 document id parent id dcnl dcsp dcsp dcsp dcsp dcsp dcsp rev form instance document parent parent doc dcnl dcsp dcsp dcsp dcsp dcsp dcsp doc parent parent doc dcnl dcsp dcsp dcsp dcsp dcsp dcsp rev form instance based on document doc original dcnl dcsp dcsp dcsp dcsp dcsp except document doesnotexist dcnl dcsp dcsp dcsp dcsp dcsp dcsp pass dcnl dcsp dcsp dcsp dcsp rev form save doc dcnl dcsp dcsp dcsp dcsp if request is ajax dcnl dcsp dcsp dcsp dcsp dcsp data error false new revision id rev form instance id dcnl dcsp dcsp dcsp dcsp dcsp return jsonresponse data dcnl dcsp dcsp dcsp dcsp url doc get absolute url dcnl dcsp dcsp dcsp dcsp params dcnl dcsp dcsp dcsp dcsp params rev saved request post get current rev dcnl dcsp dcsp dcsp dcsp url s s url urlencode params dcnl dcsp dcsp dcsp dcsp return redirect url dcnl dcsp dcsp dcsp elif request is ajax dcnl dcsp dcsp dcsp dcsp if current rev in rev form errors dcnl dcsp dcsp dcsp dcsp dcsp rev form errors current rev 0 mark safe rev form errors current rev 0 dcnl dcsp dcsp dcsp dcsp errors rev form errorskey0 for key in rev form errors keys dcnl dcsp dcsp dcsp dcsp data error true error message errors new revision id rev form instance id dcnl dcsp dcsp dcsp dcsp return jsonresponse data data dcnl dcsp if doc dcnl dcsp dcsp from id smart int request get get from none dcnl dcsp dcsp to id smart int request get get to none dcnl dcsp dcsp revision from get object or none revision pk from id document doc parent dcnl dcsp dcsp revision to get object or none revision pk to id document doc parent dcnl dcsp else dcnl dcsp dcsp revision from revision to none dcnl dcsp parent split split slug parent doc slug dcnl dcsp language mapping get language mapping dcnl dcsp language language mappingdocument locale lower dcnl dcsp default locale language mappingsettings wiki default language lower dcnl dcsp context parent parent doc document doc document form doc form revision form rev form locale document locale default locale default locale language language based on based on rev disclose description disclose description discard href discard href attachment form attachmentrevisionform specific slug parent split specific parent slug parent split parent revision from revision from revision to revision to dcnl dcsp return render request wiki translate html context
def split slug slug dcsp slug split slug split dcnl dcsp length len slug split dcnl dcsp root none dcnl dcsp seo root dcnl dcsp bad seo roots web dcnl dcsp if length 1 dcnl dcsp dcsp root slug split0 dcnl dcsp dcsp if root in bad seo roots dcnl dcsp dcsp dcsp if length 2 dcnl dcsp dcsp dcsp dcsp seo root root + + slug split1 dcnl dcsp dcsp else dcnl dcsp dcsp dcsp seo root root dcnl dcsp specific slug split pop dcnl dcsp parent join slug split dcnl dcsp return specific specific parent parent full slug parent split slug split length length root root seo root seo root
newrelic agent function trace dcnl def document last modified request document slug document locale dcsp adhoc natural key document locale document slug dcnl dcsp natural key hash document natural key hash adhoc natural key dcnl dcsp cache key document last modified cache key tmpl natural key hash dcnl dcsp try dcnl dcsp dcsp last mod memcache get cache key dcnl dcsp dcsp if last mod is none dcnl dcsp dcsp dcsp doc document objects get locale document locale slug document slug dcnl dcsp dcsp dcsp last mod doc fill last modified cache dcnl dcsp dcsp return datetime fromtimestamp float last mod dcnl dcsp except document doesnotexist dcnl dcsp dcsp return none
def document form initial document dcsp return title document title slug document slug is localizable document is localizable tags list document tags names
newrelic agent function trace dcnl block user agents dcnl prevent indexing dcnl process document path dcnl def revision request document slug document locale revision id dcsp rev get object or 404 revision objects select related document pk revision id document slug document slug dcnl dcsp context document rev document revision rev comment format comment rev dcnl dcsp return render request wiki revision html context
login required dcnl require post dcnl def preview request dcsp kumascript errors dcnl dcsp doc none dcnl dcsp render preview true dcnl dcsp wiki content request post get content dcnl dcsp doc id request post get doc id dcnl dcsp if doc id dcnl dcsp dcsp doc document objects get id doc id dcnl dcsp if doc and doc defer rendering dcnl dcsp dcsp render preview false dcnl dcsp else dcnl dcsp dcsp render preview kumascript should use rendered doc request get html wiki content dcnl dcsp if render preview dcnl dcsp dcsp wiki content kumascript errors kumascript post request wiki content request language code dcnl dcsp context content wiki content title request post get title kumascript errors kumascript errors macro sources kumascript macro sources force lowercase keys true if kumascript errors else none dcnl dcsp return render request wiki preview html context
block user agents dcnl require get dcnl xframe options sameorigin dcnl process document path dcnl prevent indexing dcnl ratelimit key user or ip rate 15 m block true dcnl def compare request document slug document locale dcsp locale request get get locale document locale dcnl dcsp if from not in request get or to not in request get dcnl dcsp dcsp raise http404 dcnl dcsp doc get object or 404 document locale locale slug document slug dcnl dcsp from id smart int request get get from dcnl dcsp to id smart int request get get to dcnl dcsp revisions revision objects prefetch related document dcnl dcsp try dcnl dcsp dcsp revision from revisions get id from id document doc dcnl dcsp except revision doesnotexist dcnl dcsp dcsp revision from get object or 404 revisions id from id document doc parent dcnl dcsp revision to get object or 404 revisions id to id document doc dcnl dcsp context document doc revision from revision from revision to revision to dcnl dcsp if request get get raw false dcnl dcsp dcsp template wiki includes revision diff table html dcnl dcsp else dcnl dcsp dcsp template wiki compare revisions html dcnl dcsp return render request template context
login required dcnl require post dcnl process document path dcnl def quick review request document slug document locale dcsp doc get object or 404 document locale document locale slug document slug dcnl dcsp rev id request post get revision id dcnl dcsp if not rev id dcnl dcsp dcsp raise http404 dcnl dcsp rev get object or 404 revision pk rev id dcnl dcsp if rev id doc current revision id dcnl dcsp dcsp raise permissiondenied document dcsp has dcsp been dcsp edited dcsp please dcsp rereview dcnl dcsp needs technical rev needs technical review dcnl dcsp needs editorial rev needs editorial review dcnl dcsp request technical request post get request technical false dcnl dcsp request editorial request post get request editorial false dcnl dcsp messages dcnl dcsp new tags dcnl dcsp if needs technical dcnl dcsp dcsp new tags append technical dcnl dcsp if needs editorial dcnl dcsp dcsp new tags append editorial dcnl dcsp if needs technical and not request technical dcnl dcsp dcsp new tags remove technical dcnl dcsp dcsp messages append technical dcsp review dcsp completed dcnl dcsp if needs editorial and not request editorial dcnl dcsp dcsp new tags remove editorial dcnl dcsp dcsp messages append editorial dcsp review dcsp completed dcnl dcsp if messages dcnl dcsp dcsp data summary dcsp join messages comment dcsp join messages dcnl dcsp dcsp new rev doc revise request user data data dcnl dcsp dcsp if new tags dcnl dcsp dcsp dcsp new rev review tags set new tags dcnl dcsp dcsp else dcnl dcsp dcsp dcsp new rev review tags clear dcnl dcsp return redirect doc
block user agents dcnl login required dcnl check readonly dcnl def revert document request document path revision id dcsp document locale document slug needs redirect locale and slug from path document path request dcnl dcsp revision get object or 404 revision objects select related document pk revision id document slug document slug dcnl dcsp if request method get dcnl dcsp dcsp return render request wiki confirm revision revert html revision revision document revision document dcnl dcsp else dcnl dcsp dcsp comment request post get comment dcnl dcsp dcsp document revision document dcnl dcsp dcsp old revision pk revision pk dcnl dcsp dcsp try dcnl dcsp dcsp dcsp new revision document revert revision request user comment dcnl dcsp dcsp dcsp if new revision pk old revision pk dcnl dcsp dcsp dcsp dcsp document schedule rendering maxage 0 dcnl dcsp dcsp except integrityerror dcnl dcsp dcsp dcsp return render request wiki confirm revision revert html revision revision document revision document error ugettext document dcsp already dcsp exists dcsp note dcsp you dcsp cannot dcsp revert dcsp a dcsp document dcsp that dcsp has dcsp been dcsp moved dcsp until dcsp you dcsp delete dcsp its dcsp redirect dcnl dcsp dcsp return redirect wiki document revisions revision document slug
block user agents dcnl login required dcnl permission required wiki delete document dcnl check readonly dcnl process document path dcnl def delete document request document slug document locale dcsp document get object or 404 document locale document locale slug document slug dcnl dcsp prevent document children exists dcnl dcsp first revision document revisions all 0 dcnl dcsp if request method post dcnl dcsp dcsp form documentdeletionform data request post dcnl dcsp dcsp if form is valid dcnl dcsp dcsp dcsp documentdeletionlog objects create locale document locale slug document slug user request user reason form cleaned data reason dcnl dcsp dcsp dcsp document delete dcnl dcsp dcsp dcsp return redirect document dcnl dcsp else dcnl dcsp dcsp form documentdeletionform dcnl dcsp context document document form form request request revision first revision prevent prevent dcnl dcsp return render request wiki confirm document delete html context
block user agents dcnl login required dcnl permission required wiki restore document dcnl check readonly dcnl process document path dcnl def restore document request document slug document locale dcsp document get object or 404 document deleted objects all slug document slug locale document locale dcnl dcsp document restore dcnl dcsp return redirect document
block user agents dcnl login required dcnl permission required wiki purge document dcnl check readonly dcnl process document path dcnl def purge document request document slug document locale dcsp document get object or 404 document deleted objects all slug document slug locale document locale dcnl dcsp if request method post and confirm in request post dcnl dcsp dcsp document purge dcnl dcsp dcsp return redirect reverse wiki document args document slug locale document locale dcnl dcsp else dcnl dcsp dcsp return render request wiki confirm purge html document document
require get dcnl allow cors get dcnl xframe options exempt dcnl process document path dcnl def code sample request document slug document locale sample name dcsp if not re search config kuma wiki iframe allowed hosts request build absolute uri dcnl dcsp dcsp raise permissiondenied dcnl dcsp document get object or 404 document slug document slug locale document locale dcnl dcsp job documentcodesamplejob generation args document pk dcnl dcsp data job get document pk sample name dcnl dcsp data document document dcnl dcsp return render request wiki code sample html data
require get dcnl allow cors get dcnl xframe options exempt dcnl process document path dcnl def raw code sample file request document slug document locale sample name attachment id filename dcsp return redirect full attachment url attachment id filename
def mindtouch namespace redirect request namespace slug dcsp new locale new slug none dcnl dcsp if namespace in talk project project talk dcnl dcsp dcsp locale doc slug slug partition dcnl dcsp dcsp new locale settings mt to kuma locale map get locale enus dcnl dcsp dcsp new slug s s namespace doc slug dcnl dcsp elif namespace user dcnl dcsp dcsp new slug s s namespace slug dcnl dcsp dcsp try dcnl dcsp dcsp dcsp rev revision objects filter document slug new slug latest created dcnl dcsp dcsp dcsp new locale rev document locale dcnl dcsp dcsp except revision doesnotexist dcnl dcsp dcsp dcsp new locale enus dcnl dcsp else dcnl dcsp dcsp new locale enus dcnl dcsp dcsp new slug s s namespace slug dcnl dcsp if new locale dcnl dcsp dcsp new url s docs s request language code new slug dcnl dcsp return redirect new url permanent true
def mindtouch to kuma redirect request path dcsp new locale none dcnl dcsp if path startswith template mindtouch dcnl dcsp dcsp raise http404 dcnl dcsp if path endswith dcnl dcsp dcsp path path 1 dcnl dcsp if in path dcnl dcsp dcsp namespace slug path partition dcnl dcsp dcsp if namespace in mindtouch namespaces dcnl dcsp dcsp dcsp return mindtouch namespace redirect request namespace slug dcnl dcsp if in path dcnl dcsp dcsp maybe locale slug path partition dcnl dcsp dcsp if maybe locale in mindtouch problem locales dcnl dcsp dcsp dcsp new locale mindtouch problem localesmaybe locale dcnl dcsp dcsp dcsp new url s docs s new locale slug dcnl dcsp dcsp dcsp if view in request get dcnl dcsp dcsp dcsp dcsp new url s s new url request get view dcnl dcsp dcsp dcsp return redirect new url permanent true dcnl dcsp dcsp try dcnl dcsp dcsp dcsp doc document objects get slug slug locale maybe locale dcnl dcsp dcsp except document doesnotexist dcnl dcsp dcsp dcsp pass dcnl dcsp try dcnl dcsp dcsp doc document objects get slug path locale request language code dcnl dcsp except document doesnotexist dcnl dcsp dcsp raise http404 dcnl dcsp location doc get absolute url dcnl dcsp if view in request get dcnl dcsp dcsp location s s location request get view dcnl dcsp return redirect location permanent true
def ckeditor config request dcsp default config editortoolbar objects filter name default dcnl dcsp if default config exists dcnl dcsp dcsp code default config0 code dcnl dcsp else dcnl dcsp dcsp code dcnl dcsp context editor config code redirect pattern redirect content allowed tags dcsp join allowed tags dcnl dcsp return render request wiki ckeditor config js context content type application xjavascript
newrelic agent function trace dcnl block user agents dcnl require get dcnl allow cors get dcnl def autosuggest documents request dcsp partial title request get get term dcnl dcsp locale request get get locale false dcnl dcsp current locale request get get current locale false dcnl dcsp exclude current locale request get get exclude current locale false dcnl dcsp if not partial title dcnl dcsp dcsp return httpresponsebadrequest autosuggest dcsp requires dcsp a dcsp partial dcsp title dcsp for dcsp a dcsp full dcsp document dcsp index dcsp see dcsp the dcsp main dcsp page dcnl dcsp docs document objects extra select length length slug filter title icontains partial title is redirect 0 exclude slug icontains talk order by title length dcnl dcsp if locale dcnl dcsp dcsp docs docs filter locale locale dcnl dcsp if current locale dcnl dcsp dcsp docs docs filter locale request language code dcnl dcsp if exclude current locale dcnl dcsp dcsp docs docs exclude locale request language code dcnl dcsp docs list dcnl dcsp for doc in docs dcnl dcsp dcsp data doc get json data dcnl dcsp dcsp data label + dcsp + doc locale + dcnl dcsp dcsp docs list append data dcnl dcsp return jsonresponse docs list safe false
block user agents dcnl require get dcnl def documents request tag none dcsp tag obj none dcnl dcsp if tag dcnl dcsp dcsp matching tags get list or 404 documenttag name iexact tag dcnl dcsp dcsp for matching tag in matching tags dcnl dcsp dcsp dcsp if matching tag name lower tag lower dcnl dcsp dcsp dcsp dcsp tag obj matching tag dcnl dcsp dcsp dcsp dcsp break dcnl dcsp docs document objects filter for list locale request language code tag tag obj dcnl dcsp paginated docs paginate request docs per page documents per page dcnl dcsp context documents paginated docs count docs count tag tag dcnl dcsp return render request wiki list documents html context
block user agents dcnl require get dcnl def tags request dcsp tags documenttag objects order by name dcnl dcsp tags paginate request tags per page documents per page dcnl dcsp return render request wiki list tags html tags tags
block user agents dcnl require get dcnl def needs review request tag none dcsp tag obj tag and get object or 404 reviewtag name tag or none dcnl dcsp docs document objects filter for review locale request language code tag tag obj dcnl dcsp paginated docs paginate request docs per page documents per page dcnl dcsp context documents paginated docs count docs count tag tag obj tag name tag dcnl dcsp return render request wiki list needs review html context
block user agents dcnl require get dcnl def with localization tag request tag none dcsp tag obj tag and get object or 404 localizationtag name tag or none dcnl dcsp docs document objects filter with localization tag locale request language code tag tag obj dcnl dcsp paginated docs paginate request docs per page documents per page dcnl dcsp context documents paginated docs count docs count tag tag obj tag name tag dcnl dcsp return render request wiki list with localization tags html context
block user agents dcnl require get dcnl def with errors request dcsp docs document objects filter for list locale request language code errors true dcnl dcsp paginated docs paginate request docs per page documents per page dcnl dcsp context documents paginated docs count docs count errors true dcnl dcsp return render request wiki list documents html context
block user agents dcnl require get dcnl def without parent request dcsp docs document objects filter for list locale request language code noparent true dcnl dcsp paginated docs paginate request docs per page documents per page dcnl dcsp context documents paginated docs count docs count noparent true dcnl dcsp return render request wiki list documents html context
block user agents dcnl require get dcnl def top level request dcsp docs document objects filter for list locale request language code toplevel true dcnl dcsp paginated docs paginate request docs per page documents per page dcnl dcsp context documents paginated docs count docs count toplevel true dcnl dcsp return render request wiki list documents html context
block user agents dcnl require get dcnl process document path dcnl prevent indexing dcnl def revisions request document slug document locale dcsp locale request get get locale document locale dcnl dcsp doc query document objects only id locale slug title current revision id parent slug parent locale select related parent slug parent locale exclude current revision isnull true filter locale locale slug document slug dcnl dcsp document get object or 404 doc query dcnl dcsp per page request get get limit 10 dcnl dcsp if not request user is authenticated and per page all dcnl dcsp dcsp return render request 403 html reason revisions login required status 403 dcnl dcsp revision ids list document revisions order by created id values list id flat true dcnl dcsp revision pairs zip revision ids revision ids1 + none dcnl dcsp if per page all dcnl dcsp dcsp page none dcnl dcsp dcsp selected revision pairs revision pairs dcnl dcsp else dcnl dcsp dcsp try dcnl dcsp dcsp dcsp per page int per page dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp per page documents per page dcnl dcsp dcsp page paginate request revision pairs per page dcnl dcsp dcsp selected revision pairs list page object list dcnl dcsp earliest id earliest prev id selected revision pairs 1 dcnl dcsp if earliest prev id is none and document parent dcnl dcsp dcsp earliest revision objects only based on get id earliest id dcnl dcsp dcsp if earliest based on is not none dcnl dcsp dcsp dcsp selected revision pairs 1 earliest id earliest based on id dcnl dcsp dcsp dcsp selected revision pairs append earliest based on id none dcnl dcsp selected revision ids rev id for rev id in selected revision pairs dcnl dcsp previous id selected revision pairs 1 1 dcnl dcsp if previous id is not none dcnl dcsp dcsp selected revision ids append previous id dcnl dcsp selected revisions revision objects only id slug created comment document slug document locale creator username creator is active select related document slug document locale creator is active creator username filter id in selected revision ids dcnl dcsp revisions rev id rev for rev in selected revisions dcnl dcsp context selected revision pairs selected revision pairs revisions revisions document document page page dcnl dcsp return render request wiki list revisions html context
newrelic agent function trace dcnl block user agents dcnl login required dcnl check readonly dcnl prevent indexing dcnl never cache dcnl def create request dcsp initial slug request get get slug dcnl dcsp if not request user has perm wiki add document dcnl dcsp dcsp context reason createpage request page url dev doc request form email address config email list mdn admins dcnl dcsp dcsp return render request 403createpage html context context status 403 dcnl dcsp initial title initial slug replace dcsp dcnl dcsp try dcnl dcsp dcsp initial parent id int request get get parent dcnl dcsp dcsp parent doc document objects get pk initial parent id dcnl dcsp dcsp parent slug parent doc slug dcnl dcsp dcsp parent path parent doc get absolute url dcnl dcsp except valueerror document doesnotexist dcnl dcsp dcsp initial parent id parent slug parent path dcnl dcsp try dcnl dcsp dcsp clone id int request get get clone dcnl dcsp except valueerror dcnl dcsp dcsp clone id none dcnl dcsp context attachment form attachmentrevisionform parent path parent path parent slug parent slug dcnl dcsp if request method get dcnl dcsp dcsp initial data dcnl dcsp dcsp initial html dcnl dcsp dcsp initial tags dcnl dcsp dcsp initial toc revision toc depth h4 dcnl dcsp dcsp if clone id dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp clone doc document objects get pk clone id dcnl dcsp dcsp dcsp dcsp initial title clone doc title dcnl dcsp dcsp dcsp dcsp initial html clone doc html dcnl dcsp dcsp dcsp dcsp initial tags clone doc tags all dcnl dcsp dcsp dcsp dcsp if clone doc current revision dcnl dcsp dcsp dcsp dcsp dcsp initial toc clone doc current revision toc depth dcnl dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp initial toc 1 dcnl dcsp dcsp dcsp except document doesnotexist dcnl dcsp dcsp dcsp dcsp pass dcnl dcsp dcsp if parent slug dcnl dcsp dcsp dcsp initial data parent topic initial parent id dcnl dcsp dcsp if initial slug dcnl dcsp dcsp dcsp initial data title initial title dcnl dcsp dcsp dcsp initial data slug initial slug dcnl dcsp dcsp review tags review flag tags default dcnl dcsp dcsp doc form documentform initial initial data parent slug parent slug dcnl dcsp dcsp initial slug initial slug title initial title content initial html review tags review tags tags initial tags toc depth initial toc dcnl dcsp dcsp rev form revisionform request request initial initial dcnl dcsp dcsp context update parent id initial parent id document form doc form revision form rev form initial tags initial tags dcnl dcsp else dcnl dcsp dcsp submitted data request post copy dcnl dcsp dcsp posted slug submitted data slug dcnl dcsp dcsp submitted data locale request language code dcnl dcsp dcsp if parent slug dcnl dcsp dcsp dcsp submitted data parent topic initial parent id dcnl dcsp dcsp doc form documentform data submitted data parent slug parent slug dcnl dcsp dcsp rev form revisionform request request data submitted data parent slug parent slug dcnl dcsp dcsp if doc form is valid and rev form is valid dcnl dcsp dcsp dcsp doc doc form save parent none dcnl dcsp dcsp dcsp rev form save doc dcnl dcsp dcsp dcsp if doc current revision is approved dcnl dcsp dcsp dcsp dcsp view wiki document dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp view wiki document revisions dcnl dcsp dcsp dcsp return redirect reverse view args doc slug dcnl dcsp dcsp else dcnl dcsp dcsp dcsp doc form data slug posted slug dcnl dcsp dcsp context update document form doc form revision form rev form dcnl dcsp return render request wiki create html context
xframe options sameorigin dcnl def edit document collision request orig rev curr rev is async submit is raw rev form doc form section id rev doc dcsp content kuma wiki content parse request post content injectsectionids serialize dcnl dcsp parsed content kuma wiki content parse curr rev content dcnl dcsp parsed content injectsectionids dcnl dcsp if section id dcnl dcsp dcsp parsed content extractsection section id dcnl dcsp curr content parsed content serialize dcnl dcsp if is raw dcnl dcsp dcsp response httpresponse conflict dcnl dcsp dcsp response status code 409 dcnl dcsp dcsp return response dcnl dcsp context collision true revision form rev form document form doc form content content current content curr content section id section id original revision orig rev current revision curr rev revision rev document doc dcnl dcsp return render request wiki edit html context
newrelic agent function trace dcnl block user agents dcnl require http methods get post dcnl login required dcnl ratelimit key user rate limit banned ip to 0 block true dcnl process document path dcnl check readonly dcnl prevent indexing dcnl never cache dcnl def edit request document slug document locale revision id none dcsp doc get object or 404 document locale document locale slug document slug dcnl dcsp if doc parent and doc parent id doc id dcnl dcsp dcsp return translate request doc parent slug doc locale revision id bypass process document path true dcnl dcsp if revision id dcnl dcsp dcsp rev get object or 404 revision pk revision id document doc dcnl dcsp else dcnl dcsp dcsp rev doc current revision or doc revisions order by created id 0 dcnl dcsp slug dict split slug document slug dcnl dcsp rev slug slug dict specific dcnl dcsp section id request get get section none dcnl dcsp if section id and not request is ajax dcnl dcsp dcsp return httpresponse ugettext sections dcsp may dcsp only dcsp be dcsp edited dcsp inline dcnl dcsp disclose description bool request get get opendescription dcnl dcsp doc form rev form none dcnl dcsp rev form revisionform request request instance rev initial based on rev id current rev rev id comment section id section id dcnl dcsp if doc allows editing by request user dcnl dcsp dcsp doc form documentform initial document form initial doc dcnl dcsp show translation parent block document locale settings wiki default language and not doc parent id dcnl dcsp if request method get dcnl dcsp dcsp if not rev form or doc form dcnl dcsp dcsp dcsp raise permissiondenied dcnl dcsp else dcnl dcsp dcsp is async submit request is ajax dcnl dcsp dcsp is raw request get get raw false dcnl dcsp dcsp need edit links request get get edit links false dcnl dcsp dcsp parent id request post get parent id dcnl dcsp dcsp if show translation parent block and parent id dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp parent doc get object or 404 document id parent id dcnl dcsp dcsp dcsp dcsp doc parent parent doc dcnl dcsp dcsp dcsp except document doesnotexist dcnl dcsp dcsp dcsp dcsp pass dcnl dcsp dcsp which form request post get formtype dcnl dcsp dcsp if which form doc dcnl dcsp dcsp dcsp if doc allows editing by request user dcnl dcsp dcsp dcsp dcsp post data request post copy dcnl dcsp dcsp dcsp dcsp post data update locale document locale dcnl dcsp dcsp dcsp dcsp doc form documentform post data instance doc dcnl dcsp dcsp dcsp dcsp if doc form is valid dcnl dcsp dcsp dcsp dcsp dcsp if slug in post data dcnl dcsp dcsp dcsp dcsp dcsp dcsp post data slug u join slug dict parent post data slug dcnl dcsp dcsp dcsp dcsp dcsp doc doc form save parent none dcnl dcsp dcsp dcsp dcsp dcsp return redirect urlparams doc get edit url opendescription 1 dcnl dcsp dcsp dcsp dcsp disclose description true dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp raise permissiondenied dcnl dcsp dcsp elif which form rev dcnl dcsp dcsp dcsp post data request post copy dcnl dcsp dcsp dcsp rev form revisionform request request data post data is async submit is async submit section id section id dcnl dcsp dcsp dcsp rev form instance document doc dcnl dcsp dcsp dcsp orig rev id request post get current rev false dcnl dcsp dcsp dcsp if orig rev id is false dcnl dcsp dcsp dcsp dcsp orig rev none dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp orig rev revision objects get pk orig rev id dcnl dcsp dcsp dcsp curr rev doc current revision dcnl dcsp dcsp dcsp if not rev form is valid dcnl dcsp dcsp dcsp dcsp if is async submit dcnl dcsp dcsp dcsp dcsp dcsp if current rev in rev form errors dcnl dcsp dcsp dcsp dcsp dcsp dcsp rev form errors current rev 0 mark safe rev form errors current rev 0 dcnl dcsp dcsp dcsp dcsp dcsp errors rev form errorskey0 for key in rev form errors keys dcnl dcsp dcsp dcsp dcsp dcsp data error true error message errors new revision id curr rev id dcnl dcsp dcsp dcsp dcsp dcsp return jsonresponse data data dcnl dcsp dcsp dcsp dcsp dcsp return edit document collision request orig rev curr rev is async submit is raw rev form doc form section id rev doc dcnl dcsp dcsp dcsp dcsp if is async submit and all in rev form errors dcnl dcsp dcsp dcsp dcsp dcsp data error true error message mark safe rev form errors all 0 new revision id curr rev id dcnl dcsp dcsp dcsp dcsp dcsp return jsonresponse data data dcnl dcsp dcsp dcsp if rev form is valid dcnl dcsp dcsp dcsp dcsp rev form save doc dcnl dcsp dcsp dcsp dcsp if is raw and orig rev is not none and curr rev id orig rev id dcnl dcsp dcsp dcsp dcsp dcsp response httpresponse reset dcnl dcsp dcsp dcsp dcsp dcsp response xframeoptions sameorigin dcnl dcsp dcsp dcsp dcsp dcsp response status code 205 dcnl dcsp dcsp dcsp dcsp dcsp return response dcnl dcsp dcsp dcsp dcsp if is async submit dcnl dcsp dcsp dcsp dcsp dcsp new rev id rev document revisions order by id first id dcnl dcsp dcsp dcsp dcsp dcsp data error false new revision id new rev id dcnl dcsp dcsp dcsp dcsp dcsp return jsonresponse data dcnl dcsp dcsp dcsp dcsp if rev form instance is approved dcnl dcsp dcsp dcsp dcsp dcsp view wiki document dcnl dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp view wiki document revisions dcnl dcsp dcsp dcsp dcsp url reverse view args doc slug locale doc locale dcnl dcsp dcsp dcsp dcsp params dcnl dcsp dcsp dcsp dcsp if is raw dcnl dcsp dcsp dcsp dcsp dcsp params raw true dcnl dcsp dcsp dcsp dcsp dcsp if need edit links dcnl dcsp dcsp dcsp dcsp dcsp dcsp params edit links true dcnl dcsp dcsp dcsp dcsp dcsp if section id dcnl dcsp dcsp dcsp dcsp dcsp dcsp params section section id dcnl dcsp dcsp dcsp dcsp params rev saved curr rev id if curr rev else dcnl dcsp dcsp dcsp dcsp url s s url urlencode params dcnl dcsp dcsp dcsp dcsp if not is raw and section id dcnl dcsp dcsp dcsp dcsp dcsp url s s url section id dcnl dcsp dcsp dcsp dcsp return redirect url dcnl dcsp parent path parent slug dcnl dcsp if slug dict parent dcnl dcsp dcsp parent slug slug dict parent dcnl dcsp if doc parent topic id dcnl dcsp dcsp parent doc document objects get pk doc parent topic id dcnl dcsp dcsp parent path parent doc get absolute url dcnl dcsp dcsp parent slug parent doc slug dcnl dcsp context revision form rev form document form doc form section id section id disclose description disclose description parent slug parent slug parent path parent path revision rev document doc attachment form attachmentrevisionform dcnl dcsp return render request wiki edit html context
def get html and errors request doc rendering params dcsp doc html ks errors render raw fallback doc html none false dcnl dcsp if not rendering params use rendered dcnl dcsp dcsp return doc html ks errors render raw fallback dcnl dcsp cache control none dcnl dcsp if request user is authenticated dcnl dcsp dcsp ua cc request meta get http cache control dcnl dcsp dcsp if ua cc nocache dcnl dcsp dcsp dcsp cache control nocache dcnl dcsp base url request build absolute uri dcnl dcsp try dcnl dcsp dcsp r body r errors doc get rendered cache control base url dcnl dcsp dcsp if r body dcnl dcsp dcsp dcsp doc html r body dcnl dcsp dcsp if r errors dcnl dcsp dcsp dcsp ks errors r errors dcnl dcsp except documentrenderedcontentnotavailable dcnl dcsp dcsp render raw fallback true dcnl dcsp return doc html ks errors render raw fallback
def get seo parent title slug dict document locale dcsp if slug dict seo root dcnl dcsp dcsp try dcnl dcsp dcsp dcsp seo root doc document objects get locale document locale slug slug dict seo root dcnl dcsp dcsp dcsp return u dcsp dcsp s seo root doc title dcnl dcsp dcsp except document doesnotexist dcnl dcsp dcsp dcsp pass dcnl dcsp return
def filter doc html request doc doc html rendering params dcsp if rendering params summary dcnl dcsp dcsp return doc get summary html dcnl dcsp if not rendering params section or rendering params raw or rendering params edit links or rendering params include dcnl dcsp dcsp return doc html dcnl dcsp tool kuma wiki content parse doc html dcnl dcsp if rendering params raw dcnl dcsp dcsp tool injectsectionids dcnl dcsp dcsp tool filtereditorsafety dcnl dcsp if rendering params section dcnl dcsp dcsp tool extractsection rendering params section dcnl dcsp if rendering params edit links or not rendering params raw and request user is authenticated dcnl dcsp dcsp tool injectsectioneditinglinks doc slug doc locale dcnl dcsp doc html tool serialize dcnl dcsp if rendering params include dcnl dcsp dcsp doc html kuma wiki content filter out noinclude doc html dcnl dcsp return doc html
def set common headers doc section id response dcsp response etag doc calculate etag section id dcnl dcsp if doc current revision id dcnl dcsp dcsp response xkumarevision doc current revision id dcnl dcsp return response
def default locale fallback request document slug document locale dcsp fallback doc none dcnl dcsp redirect url none dcnl dcsp fallback reason none dcnl dcsp try dcnl dcsp dcsp fallback doc document objects get locale settings wiki default language slug document slug dcnl dcsp dcsp translation fallback doc translated to document locale dcnl dcsp dcsp if translation and translation current revision dcnl dcsp dcsp dcsp url translation get absolute url dcnl dcsp dcsp dcsp redirect url urlparams url query dict request get dcnl dcsp dcsp elif translation and fallback doc current revision dcnl dcsp dcsp dcsp fallback reason translation not approved dcnl dcsp dcsp elif fallback doc current revision dcnl dcsp dcsp dcsp fallback reason no translation dcnl dcsp except document doesnotexist dcnl dcsp dcsp pass dcnl dcsp return fallback doc fallback reason redirect url
def get doc and fallback reason document locale document slug dcsp doc none dcnl dcsp fallback reason none dcnl dcsp try dcnl dcsp dcsp doc document objects get locale document locale slug document slug dcnl dcsp dcsp if not doc current revision and doc parent and doc parent current revision dcnl dcsp dcsp dcsp fallback reason translation not approved dcnl dcsp dcsp elif not doc current revision dcnl dcsp dcsp dcsp fallback reason no content dcnl dcsp except document doesnotexist dcnl dcsp dcsp pass dcnl dcsp return doc fallback reason
def apply content experiment request doc dcsp key u s s doc locale doc slug dcnl dcsp for experiment in settings content experiments dcnl dcsp dcsp if key in experiment pages dcnl dcsp dcsp dcsp variants experiment pages key dcnl dcsp dcsp dcsp exp params id experiment id ga name experiment ga name param experiment param original path request path variants variants selected none selection is valid none dcnl dcsp dcsp dcsp selected request get get experiment param dcnl dcsp dcsp dcsp if selected dcnl dcsp dcsp dcsp dcsp exp params selection is valid false dcnl dcsp dcsp dcsp dcsp for variant variant slug in variants items dcnl dcsp dcsp dcsp dcsp dcsp if selected variant dcnl dcsp dcsp dcsp dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp content doc document objects get locale doc locale slug variant slug dcnl dcsp dcsp dcsp dcsp dcsp dcsp except document doesnotexist dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp pass dcnl dcsp dcsp dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp exp params selected selected dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp exp params selection is valid true dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp return content doc exp params dcnl dcsp dcsp dcsp return doc exp params dcnl dcsp return doc none
block user agents dcnl require get dcnl allow cors get dcnl process document path dcnl def children request document slug document locale dcsp expand expand in request get dcnl dcsp max depth 5 dcnl dcsp depth int request get get depth max depth dcnl dcsp if depth max depth dcnl dcsp dcsp depth max depth dcnl dcsp result dcnl dcsp try dcnl dcsp dcsp doc document objects get locale document locale slug document slug dcnl dcsp dcsp result make doc structure doc 0 expand depth dcnl dcsp dcsp if result is none dcnl dcsp dcsp dcsp result error document dcsp has dcsp moved dcnl dcsp except document doesnotexist dcnl dcsp dcsp result error document dcsp does dcsp not dcsp exist dcnl dcsp return jsonresponse result
block user agents dcnl require http methods get post dcnl permission required wiki move tree dcnl process document path dcnl check readonly dcnl prevent indexing dcnl def move request document slug document locale dcsp doc get object or 404 document locale document locale slug document slug dcnl dcsp descendants doc get descendants dcnl dcsp slug split split slug doc slug dcnl dcsp if request method post dcnl dcsp dcsp form treemoveform initial request get data request post dcnl dcsp dcsp if form is valid dcnl dcsp dcsp dcsp conflicts doc tree conflicts form cleaned data slug dcnl dcsp dcsp dcsp if conflicts dcnl dcsp dcsp dcsp dcsp return render request wiki move html form form document doc descendants descendants descendants count len descendants conflicts conflicts slug cleansing re slug cleansing re dcnl dcsp dcsp dcsp move page delay document locale document slug form cleaned data slug request user id dcnl dcsp dcsp dcsp return render request wiki move requested html form form document doc dcnl dcsp else dcnl dcsp dcsp form treemoveform dcnl dcsp return render request wiki move html form form document doc descendants descendants descendants count len descendants slug cleansing re slug cleansing re specific slug slug split specific
require get dcnl allow cors get dcnl process document path dcnl prevent indexing dcnl def toc request document slug none document locale none dcsp query locale request language code current revision isnull false dcnl dcsp if document slug is not none dcnl dcsp dcsp query slug document slug dcnl dcsp dcsp query locale document locale dcnl dcsp elif title in request get dcnl dcsp dcsp query title request get title dcnl dcsp elif slug in request get dcnl dcsp dcsp query slug request get slug dcnl dcsp else dcnl dcsp dcsp return httpresponsebadrequest dcnl dcsp document get object or 404 document query dcnl dcsp toc html document get toc html dcnl dcsp if toc html dcnl dcsp dcsp toc html <ol + toc html + < ol dcnl dcsp return httpresponse toc html
block user agents dcnl require get dcnl allow cors get dcnl process document path dcnl prevent indexing dcnl def as json request document slug none document locale none dcsp kwargs locale request language code current revision isnull false dcnl dcsp if document slug is not none dcnl dcsp dcsp kwargs slug document slug dcnl dcsp dcsp kwargs locale document locale dcnl dcsp elif title in request get dcnl dcsp dcsp kwargs title request get title dcnl dcsp elif slug in request get dcnl dcsp dcsp kwargs slug request get slug dcnl dcsp else dcnl dcsp dcsp return httpresponsebadrequest dcnl dcsp document get object or 404 document kwargs dcnl dcsp kuma wiki content parse document html injectsectionids serialize dcnl dcsp stale true dcnl dcsp if request user is authenticated dcnl dcsp dcsp ua cc request meta get http cache control dcnl dcsp dcsp if ua cc nocache dcnl dcsp dcsp dcsp stale false dcnl dcsp data document get json data stale stale dcnl dcsp return jsonresponse data
block user agents dcnl require get dcnl allow cors get dcnl process document path dcnl prevent indexing dcnl def styles request document slug none document locale none dcsp document get object or 404 document slug document slug locale document locale dcnl dcsp get object or 404 documentzone document document dcnl dcsp return httpresponseredirect static build styles zones css
block user agents dcnl require post dcnl login required dcnl process document path dcnl def subscribe request document slug document locale dcsp document get object or 404 document locale document locale slug document slug dcnl dcsp status 0 dcnl dcsp if editdocumentevent is notifying request user document dcnl dcsp dcsp editdocumentevent stop notifying request user document dcnl dcsp else dcnl dcsp dcsp editdocumentevent notify request user document dcnl dcsp dcsp status 1 dcnl dcsp if request is ajax dcnl dcsp dcsp return jsonresponse status status dcnl dcsp else dcnl dcsp dcsp return redirect document
block user agents dcnl require post dcnl login required dcnl process document path dcnl def subscribe to tree request document slug document locale dcsp document get object or 404 document locale document locale slug document slug dcnl dcsp status 0 dcnl dcsp if editdocumentintreeevent is notifying request user document dcnl dcsp dcsp editdocumentintreeevent stop notifying request user document dcnl dcsp else dcnl dcsp dcsp editdocumentintreeevent notify request user document dcnl dcsp dcsp status 1 dcnl dcsp if request is ajax dcnl dcsp dcsp return jsonresponse status status dcnl dcsp else dcnl dcsp dcsp return redirect document
def document redirect to create document slug document locale slug dict dcsp url reverse wiki create locale document locale dcnl dcsp if slug dict length 1 dcnl dcsp dcsp parent doc get object or 404 document locale document locale slug slug dict parent dcnl dcsp dcsp if parent doc is redirect dcnl dcsp dcsp dcsp parent doc parent doc get redirect document id only true dcnl dcsp dcsp url urlparams url parent parent doc id slug slug dict specific dcnl dcsp else dcnl dcsp dcsp url urlparams url slug document slug dcnl dcsp return url
newrelic agent function trace dcnl allow cors get dcnl prevent indexing dcnl def document deleted request deletion logs dcsp if request user and request user has perm wiki restore document dcnl dcsp dcsp deletion log deletion logs order by pk 0 dcnl dcsp dcsp context deletion log deletion log dcnl dcsp dcsp return render request wiki deletion log html context status 404 dcnl dcsp raise http404
newrelic agent function trace dcnl allow cors get dcnl def document raw request doc doc html rendering params dcsp response httpresponse doc html dcnl dcsp response xframeoptions allow dcnl dcsp response xrobotstag noindex dcnl dcsp return set common headers doc rendering params section response
csrf exempt dcnl require http methods get put head dcnl redirect in maintenance mode methods put dcnl allow cors get dcnl accepts auth key dcnl process document path dcnl condition last modified func document last modified dcnl newrelic agent function trace dcnl def document request document slug document locale dcsp if request method put dcnl dcsp dcsp if not request authkey and not request user is authenticated dcnl dcsp dcsp dcsp raise permissiondenied dcnl dcsp dcsp return document put request document slug document locale dcnl dcsp fallback reason none dcnl dcsp slug dict split slug document slug dcnl dcsp doc fallback reason get doc and fallback reason document locale document slug dcnl dcsp if doc is none dcnl dcsp dcsp deletion log entries documentdeletionlog objects filter locale document locale slug document slug dcnl dcsp dcsp if deletion log entries exists dcnl dcsp dcsp dcsp return document deleted request deletion log entries dcnl dcsp dcsp if request method head dcnl dcsp dcsp dcsp raise http404 dcnl dcsp dcsp fallback doc fallback reason redirect url default locale fallback request document slug document locale dcnl dcsp dcsp if fallback doc is not none dcnl dcsp dcsp dcsp doc fallback doc dcnl dcsp dcsp dcsp if redirect url is not none dcnl dcsp dcsp dcsp dcsp return redirect redirect url dcnl dcsp dcsp else dcnl dcsp dcsp dcsp if any request get get param none for param in raw include nocreate or not request user is authenticated dcnl dcsp dcsp dcsp dcsp raise http404 dcnl dcsp dcsp dcsp create url document redirect to create document slug document locale slug dict dcnl dcsp dcsp dcsp return redirect create url dcnl dcsp redirect url none if request get get redirect no else doc get redirect url dcnl dcsp if redirect url and redirect url doc get absolute url dcnl dcsp dcsp url urlparams redirect url query dict request get dcnl dcsp dcsp messages add message request messages warning mark safe ugettext u redirected dcsp from dcsp url s url request build absolute uri doc get absolute url extra tags wiki redirect dcnl dcsp dcsp return httpresponsepermanentredirect url dcnl dcsp rendering params dcnl dcsp for param in raw summary include edit links dcnl dcsp dcsp rendering paramsparam request get get param false is not false dcnl dcsp rendering params section request get get section none dcnl dcsp rendering params render raw fallback false dcnl dcsp original doc doc dcnl dcsp doc exp params apply content experiment request doc dcnl dcsp rendering params experiment exp params dcnl dcsp rendering params use rendered kumascript should use rendered doc request get dcnl dcsp doc html ks errors render raw fallback get html and errors request doc rendering params dcnl dcsp rendering params render raw fallback render raw fallback dcnl dcsp if doc show toc and not rendering params raw dcnl dcsp dcsp toc html doc get toc html dcnl dcsp else dcnl dcsp dcsp toc html none dcnl dcsp doc html filter doc html request doc doc html rendering params dcnl dcsp if rendering params raw dcnl dcsp dcsp return document raw request doc doc html rendering params dcnl dcsp seo summary doc get summary text dcnl dcsp seo parent title get seo parent title slug dict document locale dcnl dcsp quick links html doc get quick links html dcnl dcsp zone subnav html doc get zone subnav html dcnl dcsp body html doc get body html dcnl dcsp if original doc locale enus dcnl dcsp dcsp en slug original doc slug dcnl dcsp elif original doc parent and original doc parent locale enus dcnl dcsp dcsp en slug original doc parent slug dcnl dcsp else dcnl dcsp dcsp en slug dcnl dcsp share text ugettext i dcsp learned dcsp about dcsp title s dcsp on dcsp mdn title doc title dcnl dcsp contributors doc contributors dcnl dcsp contributors count len contributors dcnl dcsp has contributors contributors count 0 dcnl dcsp context document original doc document html doc html toc html toc html quick links html quick links html zone subnav html zone subnav html body html body html contributors contributors contributors count contributors count contributors limit 6 has contributors has contributors fallback reason fallback reason kumascript errors ks errors macro sources kumascript macro sources force lowercase keys true if ks errors else none render raw fallback rendering params render raw fallback seo summary seo summary seo parent title seo parent title share text share text search url get search url from referer request or analytics page revision doc current revision id analytics en slug en slug content experiment rendering params experiment dcnl dcsp response render request wiki document html context dcnl dcsp return set common headers doc rendering params section response
def document put request document slug document locale dcsp try dcnl dcsp dcsp content type request meta get content type dcnl dcsp dcsp if content type startswith application json dcnl dcsp dcsp dcsp data json loads request body dcnl dcsp dcsp elif content type startswith multipart formdata dcnl dcsp dcsp dcsp parser multipartparser request meta stringio request body request upload handlers request encoding dcnl dcsp dcsp dcsp data files parser parse dcnl dcsp dcsp elif content type startswith text html dcnl dcsp dcsp dcsp html request body dcnl dcsp dcsp dcsp data dict content html dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp doc pq html dcnl dcsp dcsp dcsp dcsp head title doc find head dcsp title dcnl dcsp dcsp dcsp dcsp if head title length 0 dcnl dcsp dcsp dcsp dcsp dcsp data title head title text dcnl dcsp dcsp dcsp dcsp body content doc find body dcnl dcsp dcsp dcsp dcsp if body content length 0 dcnl dcsp dcsp dcsp dcsp dcsp data content body content html dcnl dcsp dcsp dcsp except exception dcnl dcsp dcsp dcsp dcsp pass dcnl dcsp dcsp else dcnl dcsp dcsp dcsp resp httpresponse dcnl dcsp dcsp dcsp resp status code 400 dcnl dcsp dcsp dcsp resp content ugettext unsupported dcsp contenttype dcsp s content type dcnl dcsp dcsp dcsp return resp dcnl dcsp except exception as e dcnl dcsp dcsp resp httpresponse dcnl dcsp dcsp resp status code 400 dcnl dcsp dcsp resp content ugettext request dcsp parsing dcsp error dcsp s e dcnl dcsp dcsp return resp dcnl dcsp try dcnl dcsp dcsp doc document objects get locale document locale slug document slug dcnl dcsp dcsp section id request get get section none dcnl dcsp dcsp is new false dcnl dcsp dcsp expected etag request meta get http if match false dcnl dcsp dcsp if expected etag dcnl dcsp dcsp dcsp curr etag doc calculate etag section id dcnl dcsp dcsp dcsp if curr etag expected etag dcnl dcsp dcsp dcsp dcsp resp httpresponse dcnl dcsp dcsp dcsp dcsp resp status code 412 dcnl dcsp dcsp dcsp dcsp resp content ugettext etag dcsp precondition dcsp failed dcnl dcsp dcsp dcsp dcsp return resp dcnl dcsp except document doesnotexist dcnl dcsp dcsp slug parts split slug document slug dcnl dcsp dcsp if not slug parts parent dcnl dcsp dcsp dcsp parent doc none dcnl dcsp dcsp else dcnl dcsp dcsp dcsp parent doc get object or 404 document locale document locale slug slug parts parent dcnl dcsp dcsp doc document slug document slug locale document locale title data get title document slug parent topic parent doc dcnl dcsp dcsp doc save dcnl dcsp dcsp section id none dcnl dcsp dcsp is new true dcnl dcsp new rev doc revise request user data section id dcnl dcsp doc schedule rendering maxage 0 dcnl dcsp request authkey log is new and created or updated new rev data get summary none dcnl dcsp resp httpresponse dcnl dcsp if not is new dcnl dcsp dcsp resp content reset dcnl dcsp dcsp resp status code 205 dcnl dcsp else dcnl dcsp dcsp resp content created dcnl dcsp dcsp new loc request build absolute uri doc get absolute url dcnl dcsp dcsp resp location new loc dcnl dcsp dcsp resp status code 201 dcnl dcsp return resp
csrf exempt dcnl require post dcnl permission required wiki add revisionakismetsubmission dcnl def submit akismet spam request dcsp submission revisionakismetsubmission sender request user type spam dcnl dcsp data revisionakismetsubmissionspamform data request post instance submission request request dcnl dcsp if data is valid dcnl dcsp dcsp data save dcnl dcsp dcsp revision data cleaned data revision dcnl dcsp dcsp akismet revisions revisionakismetsubmission objects filter revision revision order by id values sender username sent type dcnl dcsp dcsp data sender rev sender username sent format date time value rev sent format datetime request request 0 type rev type for rev in akismet revisions dcnl dcsp dcsp return httpresponse json dumps data sort keys true content type application json dcsp charset utf8 status 201 dcnl dcsp return httpresponsebadrequest
def cache with field field name dcsp def decorator fn dcnl dcsp dcsp wraps fn assigned available attrs fn dcnl dcsp dcsp def wrapper self args kwargs dcnl dcsp dcsp dcsp force fresh kwargs pop force fresh false dcnl dcsp dcsp dcsp field val getattr self field name dcnl dcsp dcsp dcsp if field val is not none and not force fresh dcnl dcsp dcsp dcsp dcsp return field val dcnl dcsp dcsp dcsp field val fn self force fresh force fresh dcnl dcsp dcsp dcsp setattr self field name field val dcnl dcsp dcsp dcsp return field val dcnl dcsp dcsp return wrapper dcnl dcsp return decorator
def inherited parent attr direct attr dcsp getter lambda self getattr self parent parent attr if self parent and self parent id self id else getattr self direct attr dcnl dcsp setter lambda self val setattr self parent parent attr val if self parent and self parent id self id else setattr self direct attr val dcnl dcsp return property getter setter
def tags for cls model instance none extra filters dcsp kwargs extra filters or dcnl dcsp if instance is not none dcnl dcsp dcsp kwargs update s content object cls tag relname instance dcnl dcsp dcsp return cls tag model objects filter kwargs dcnl dcsp kwargs update s content object isnull cls tag relname false dcnl dcsp return cls tag model objects filter kwargs distinct
login required dcnl staff member required dcnl permission required wiki purge document dcnl check readonly dcnl def purge view request dcsp selected request get get ids split dcnl dcsp to purge document deleted objects filter id in selected dcnl dcsp if request method post dcnl dcsp dcsp if request post get confirm purge false dcnl dcsp dcsp dcsp purged 0 dcnl dcsp dcsp dcsp for doc in to purge dcnl dcsp dcsp dcsp dcsp doc purge dcnl dcsp dcsp dcsp dcsp purged + 1 dcnl dcsp dcsp dcsp messages info request s dcsp document s dcsp were dcsp purged purged dcnl dcsp dcsp return httpresponseredirect admin wiki document dcnl dcsp return templateresponse request admin wiki purge documents html to purge to purge
def related revisions link obj dcsp link s s reverse admin wiki revision changelist args document exact s obj id dcnl dcsp count obj revisions count dcnl dcsp what count 1 and revision or revisions dcnl dcsp return <a dcsp href s s nbsp s< a link count what
def current revision link obj dcsp if not obj current revision dcnl dcsp dcsp return none dcnl dcsp rev obj current revision dcnl dcsp rev url reverse admin wiki revision change args rev id dcnl dcsp return <a dcsp href s current nbsp revision nbsp s < a rev url rev id
def parent document link obj dcsp if not obj parent dcnl dcsp dcsp return dcnl dcsp url reverse admin wiki document change args obj parent id dcnl dcsp return <a dcsp href s translated nbsp from nbsp s < a url obj parent id
def topic parent document link obj dcsp if not obj parent topic dcnl dcsp dcsp return dcnl dcsp url reverse admin wiki document change args obj parent topic id dcnl dcsp return <a dcsp href s topic nbsp parent nbsp s < a url obj parent topic id
def topic children documents link obj dcsp count obj children count dcnl dcsp if not count dcnl dcsp dcsp return dcnl dcsp link s s reverse admin wiki document changelist args parent topic exact s obj id dcnl dcsp what count 1 and child or children dcnl dcsp return <a dcsp href s s nbsp s< a link count what
def topic sibling documents link obj dcsp if not obj parent topic dcnl dcsp dcsp return dcnl dcsp count obj parent topic children count dcnl dcsp if not count dcnl dcsp dcsp return dcnl dcsp link s s reverse admin wiki document changelist args parent topic exact s obj parent topic id dcnl dcsp what count 1 and sibling or siblings dcnl dcsp return <a dcsp href s s nbsp s< a link count what
def document link obj dcsp link obj get absolute url dcnl dcsp return <a dcsp target blank dcsp href s <img dcsp src simg icons link external png dcsp view< a link settings static url
def combine funcs obj funcs dcsp out x obj for x in funcs dcnl dcsp return <ul s< ul join <li s< li x for x in out if x
def document nav links obj dcsp return combine funcs obj parent document link topic parent document link topic sibling documents link topic children documents link
def revision links obj dcsp return combine funcs obj current revision link related revisions link
def rendering info obj dcsp return <ul s< ul join <li s< li x y for x y in <img dcsp src s admin img admin iconyes gif dcsp alt s dcsp deferred dcsp rendering settings static url obj defer rendering s dcsp last obj last rendered at s dcsp started obj render started at s dcsp scheduled obj render scheduled at if y
def akismet data as dl akismet data dcsp favorites comment content permalink comment author comment author email dcnl dcsp def moderator sort key dcnl dcsp dcsp sort dcsp data dcsp by dcsp 1 dcsp favorites dcsp 2 dcsp data dcsp values dcsp 3 dcsp headers dcnl dcsp dcsp try dcnl dcsp dcsp dcsp fav order favorites index key dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp fav order len favorites dcnl dcsp dcsp is data key and key0 in ascii lowercase dcnl dcsp dcsp return fav order not is data key dcnl dcsp if not akismet data dcnl dcsp dcsp return submission not available dcnl dcsp data json loads akismet data dcnl dcsp keys sorted data keys key moderator sort dcnl dcsp out format html u <dl n dcsp dcsp n< dl format html join u n dcsp dcsp u <dt < dt <dd < dd key datakey for key in keys dcnl dcsp return out
def prevent indexing func dcsp wraps func dcnl dcsp def added header request args kwargs dcnl dcsp dcsp response func request args kwargs dcnl dcsp dcsp response xrobotstag noindex dcnl dcsp dcsp return response dcnl dcsp return added header
def allow cors get func dcsp wraps func dcnl dcsp def added header request args kwargs dcnl dcsp dcsp response func request args kwargs dcnl dcsp dcsp if get request method and switch is active application acao dcnl dcsp dcsp dcsp response accesscontrolalloworigin dcnl dcsp dcsp return response dcnl dcsp return added header
def check readonly view dcsp def check readonly request args kwargs dcnl dcsp dcsp if not flag is active request kumaediting dcnl dcsp dcsp dcsp raise readonlyexception kumaediting dcnl dcsp dcsp elif flag is active request kumabanned dcnl dcsp dcsp dcsp raise readonlyexception kumabanned dcnl dcsp dcsp return view request args kwargs dcnl dcsp return check readonly
newrelic agent function trace dcnl def process document path func reverse name wiki document dcsp wraps func dcnl dcsp def process request document path none args kwargs dcnl dcsp dcsp if kwargs get bypass process document path false dcnl dcsp dcsp dcsp del kwargs bypass process document path dcnl dcsp dcsp dcsp return func request document path args kwargs dcnl dcsp dcsp document slug document locale none none dcnl dcsp dcsp if document path dcnl dcsp dcsp dcsp document locale document slug needs redirect locale and slug from path document path request dcnl dcsp dcsp dcsp slug length len document slug dcnl dcsp dcsp dcsp if slug length and document slug slug length 1 dcnl dcsp dcsp dcsp dcsp needs redirect true dcnl dcsp dcsp dcsp dcsp document slug document slug rstrip dcnl dcsp dcsp dcsp if not document slug dcnl dcsp dcsp dcsp dcsp raise http404 dcnl dcsp dcsp dcsp if request get get raw false is not false dcnl dcsp dcsp dcsp dcsp needs redirect false dcnl dcsp dcsp dcsp if needs redirect dcnl dcsp dcsp dcsp dcsp url reverse wiki document locale document locale args document slug dcnl dcsp dcsp dcsp dcsp url urlparams url query dict request get dcnl dcsp dcsp dcsp dcsp return httpresponsepermanentredirect url dcnl dcsp dcsp kwargs document slug document slug dcnl dcsp dcsp kwargs document locale document locale dcnl dcsp dcsp return func request args kwargs dcnl dcsp return process
def invalidate nearest zone cache document pk async false dcsp job documentnearestzonejob dcnl dcsp do invalidate job invalidate if async else job refresh dcnl dcsp def invalidate pk dcnl dcsp dcsp do invalidate pk dcnl dcsp dcsp children document objects filter parent topic pk values list pk zone id dcnl dcsp dcsp for child pk child zone pk in children dcnl dcsp dcsp dcsp if child zone pk is none dcnl dcsp dcsp dcsp dcsp invalidate child pk dcnl dcsp invalidate document pk
def invalidate zone urls cache locale async false dcsp job documentzoneurlremapsjob dcnl dcsp if async dcnl dcsp dcsp job invalidate locale dcnl dcsp else dcnl dcsp dcsp job refresh locale
library global function dcnl library render with landing newsfeed html dcnl def newsfeed entries section headers false dcsp return updates entries section headers section headers
def home request dcsp updates dcnl dcsp for s in section usage dcnl dcsp dcsp updates + bundle objects recent entries s updates 5 dcnl dcsp community stats memcache get community stats dcnl dcsp if not community stats dcnl dcsp dcsp community stats contributors 5453 locales 36 dcnl dcsp groups filtergroup objects all dcnl dcsp serializer groupwithfiltersserializer groups many true dcnl dcsp default filters filter objects default filters dcnl dcsp context updates updates stats community stats command search filters serializer data default filters default filters dcnl dcsp return render request landing homepage html context
def promote buttons request dcsp return render request landing promote buttons html
def robots txt request dcsp if settings allow robots dcnl dcsp dcsp robots robots txt dcnl dcsp else dcnl dcsp dcsp robots robotsgoaway txt dcnl dcsp return static serve request robots document root settings media root
def redirect pattern to kwargs dcsp return lib redirect pattern to locale prefix false prepend locale false kwargs
def locale redirect pattern to prepend locale true kwargs dcsp return lib redirect pattern to locale prefix true prepend locale prepend locale kwargs
def date range start end dcsp if getattr start date none is not none dcnl dcsp dcsp start start date dcnl dcsp if getattr end date none is not none dcnl dcsp dcsp end end date dcnl dcsp days end start days + 1 dcnl dcsp return start + datetime timedelta days d for d in xrange days
def spam dashboard historical stats periods none end date none dcsp from jobs import spamdaystats spamdashboardrecentevents dcnl dcsp periods periods or spam periods dcnl dcsp if hasattr end date date dcnl dcsp dcsp end date end date date dcnl dcsp end date end date or datetime date today datetime timedelta days 1 dcnl dcsp longest max days for days identifier name in periods dcnl dcsp spans identifier days name end date datetime timedelta days days 1 end date for days identifier name in periods dcnl dcsp start date end date datetime timedelta days longest 1 dcnl dcsp dates date range start date end date dcnl dcsp job spamdaystats dcnl dcsp trends defaultdict counter dcnl dcsp for day in dates dcnl dcsp dcsp raw events job get day dcnl dcsp dcsp day events raw events events dcnl dcsp dcsp if raw events needs review dcnl dcsp dcsp dcsp generated parser parse raw events generated dcnl dcsp dcsp dcsp age datetime datetime now generated dcnl dcsp dcsp dcsp if age total seconds 300 dcnl dcsp dcsp dcsp dcsp job invalidate day dcnl dcsp dcsp for period id length period name start end in spans dcnl dcsp dcsp dcsp if start < day < end dcnl dcsp dcsp dcsp dcsp trendsperiod id update day events dcnl dcsp data version 1 generated datetime datetime now isoformat end date end date periods periods trends dcnl dcsp job spamdashboardrecentevents dcnl dcsp events data job get start date end date + datetime timedelta days 1 or dcnl dcsp for period id length period name start end in spans dcnl dcsp dcsp period trendsperiod id dcnl dcsp dcsp previous start start datetime timedelta days length dcnl dcsp dcsp previous end start datetime timedelta days 1 dcnl dcsp dcsp period spam viewers 0 dcnl dcsp dcsp period spam viewers previous 0 dcnl dcsp dcsp for item in events data get recent spam dcnl dcsp dcsp dcsp if start < item date < end dcnl dcsp dcsp dcsp dcsp period spam viewers + item get viewers 0 dcnl dcsp dcsp dcsp elif previous start < item date < previous end dcnl dcsp dcsp dcsp dcsp period spam viewers previous + item get viewers 0 dcnl dcsp dcsp period spam viewers daily average period spam viewers length dcnl dcsp dcsp if period spam viewers previous dcnl dcsp dcsp dcsp delta period spam viewers period spam viewers previous dcnl dcsp dcsp dcsp period spam viewers change delta period spam viewers previous dcnl dcsp dcsp spam period published spam + period blocked spam dcnl dcsp dcsp ham period published ham + period blocked ham dcnl dcsp dcsp if spam dcnl dcsp dcsp dcsp period true positive rate period blocked spam spam dcnl dcsp dcsp else dcnl dcsp dcsp dcsp period true positive rate 1 0 dcnl dcsp dcsp if ham dcnl dcsp dcsp dcsp period true negative rate period published ham ham dcnl dcsp dcsp else dcnl dcsp dcsp dcsp period true negative rate 1 0 dcnl dcsp dcsp data trends append id period id name period name days length start start isoformat end end isoformat stats period dcnl dcsp data update events data dcnl dcsp return data
def spam dashboard recent events start none end none dcsp now datetime datetime now dcnl dcsp data events generated now isoformat dcsp recent spam dcnl dcsp if not end dcnl dcsp dcsp end now dcnl dcsp if not start dcnl dcsp dcsp start end datetime timedelta days 183 dcnl dcsp recent spam revisionakismetsubmission objects filter type spam revision created gt start revision created lt end select related revision document order by id dcnl dcsp change types false false new dcsp page true false page dcsp edit false true new dcsp translation true true translation dcsp update dcnl dcsp for rs in recent spam dcnl dcsp dcsp revision rs revision dcnl dcsp dcsp document revision document dcnl dcsp dcsp revisions list document revisions filter id gte revision id only id created order by id 2 dcnl dcsp dcsp if len revisions 1 dcnl dcsp dcsp dcsp if document deleted dcnl dcsp dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp dcsp entry documentdeletionlog objects filter locale document locale slug document slug latest id dcnl dcsp dcsp dcsp dcsp dcsp time active raw entry timestamp revision created dcnl dcsp dcsp dcsp dcsp dcsp time active int time active raw total seconds dcnl dcsp dcsp dcsp dcsp except documentdeletionlog doesnotexist dcnl dcsp dcsp dcsp dcsp dcsp time active deleted dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp time active current dcnl dcsp dcsp else dcnl dcsp dcsp dcsp next rev revisions1 dcnl dcsp dcsp dcsp time active raw next rev created revision created dcnl dcsp dcsp dcsp time active int time active raw total seconds dcnl dcsp dcsp change type change types bool revision previous bool document parent dcnl dcsp dcsp data recent spam append date revision created date time active time active revision id revision id revision path revision get absolute url change type change type document path revision document get absolute url dcnl dcsp for chunk in chunker data recent spam 250 dcnl dcsp dcsp start date min item date for item in chunk dcnl dcsp dcsp revs item revision id for item in chunk dcnl dcsp dcsp try dcnl dcsp dcsp dcsp views analytics upageviews revs start date dcnl dcsp dcsp except improperlyconfigured as e dcnl dcsp dcsp dcsp data improperly configured e message dcnl dcsp dcsp dcsp break dcnl dcsp dcsp for item in chunk dcnl dcsp dcsp dcsp item viewers viewsitem revision id dcnl dcsp return data
mock patch kuma dashboards views macro usage dcnl def test macros mock usage client db dcsp mock usage return value a11yrolequicklinks github subpath a11yrolequicklinks ejs count 100 en count 50 dcnl dcsp response client get reverse dashboards macros follow true dcnl dcsp assert response status code 200 dcnl dcsp assert found dcsp 1 dcsp active dcsp macro in response content dcnl dcsp page pq response content dcnl dcsp assert len page table macrostable 1 dcnl dcsp assert len page th statheader 2
mock patch kuma dashboards views macro usage dcnl def test macros no counts mock usage client db dcsp mock usage return value a11yrolequicklinks github subpath a11yrolequicklinks ejs count 0 en count 0 cssref github subpath cssref ejs count 0 en count 0 dcnl dcsp response client get reverse dashboards macros follow true dcnl dcsp assert response status code 200 dcnl dcsp assert found dcsp 2 dcsp active dcsp macros in response content dcnl dcsp page pq response content dcnl dcsp assert len page table macrostable 1 dcnl dcsp assert len page th statheader 0
require get dcnl def revisions request dcsp filter form revisiondashboardform request get dcnl dcsp page request get get page 1 dcnl dcsp revisions revision objects prefetch related creator bans document akismet submissions order by id defer content dcnl dcsp query kwargs false dcnl dcsp exclude kwargs false dcnl dcsp if filter form is valid dcnl dcsp dcsp query kwargs dcnl dcsp dcsp exclude kwargs dcnl dcsp dcsp query kwargs map user creator username istartswith locale document locale topic slug icontains dcnl dcsp dcsp for fieldname kwarg in query kwargs map items dcnl dcsp dcsp dcsp filter arg filter form cleaned datafieldname dcnl dcsp dcsp dcsp if filter arg dcnl dcsp dcsp dcsp dcsp query kwargskwarg filter arg dcnl dcsp dcsp start date filter form cleaned data start date dcnl dcsp dcsp if start date dcnl dcsp dcsp dcsp end date filter form cleaned data end date or datetime datetime now dcnl dcsp dcsp dcsp query kwargs created range start date end date dcnl dcsp dcsp preceding period filter form cleaned data preceding period dcnl dcsp dcsp if preceding period dcnl dcsp dcsp dcsp if preceding period month dcnl dcsp dcsp dcsp dcsp seconds 30 24 60 60 dcnl dcsp dcsp dcsp if preceding period week dcnl dcsp dcsp dcsp dcsp seconds 7 24 60 60 dcnl dcsp dcsp dcsp if preceding period day dcnl dcsp dcsp dcsp dcsp seconds 24 60 60 dcnl dcsp dcsp dcsp if preceding period hour dcnl dcsp dcsp dcsp dcsp seconds 60 60 dcnl dcsp dcsp dcsp end date filter form cleaned data end date or timezone now dcnl dcsp dcsp dcsp start date end date datetime timedelta seconds seconds dcnl dcsp dcsp dcsp query kwargs created range start date end date dcnl dcsp dcsp authors filter filter form cleaned data authors dcnl dcsp dcsp if not filter form cleaned data user and authors filter not in str revisiondashboardform all authors dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp group group objects get name known dcsp authors dcnl dcsp dcsp dcsp except group doesnotexist dcnl dcsp dcsp dcsp dcsp pass dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp if authors filter str revisiondashboardform known authors dcnl dcsp dcsp dcsp dcsp dcsp query kwargs creator groups pk group pk dcnl dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp exclude kwargs creator groups pk group pk dcnl dcsp if query kwargs or exclude kwargs dcnl dcsp dcsp revisions revisions filter query kwargs exclude exclude kwargs dcnl dcsp revisions paginate request revisions per page page size dcnl dcsp context revisions revisions page page show ips waffle switch is active store revision ips and request user is superuser show spam submission request user is authenticated and request user has perm wiki add revisionakismetsubmission dcnl dcsp if request is ajax dcnl dcsp dcsp template dashboards includes revision dashboard body html dcnl dcsp else dcnl dcsp dcsp template dashboards revisions html dcnl dcsp dcsp context form filter form dcnl dcsp return render request template context
require get dcnl def user lookup request dcsp userlist dcnl dcsp if request is ajax dcnl dcsp dcsp user request get get user dcnl dcsp dcsp if user dcnl dcsp dcsp dcsp matches get user model objects filter username istartswith user dcnl dcsp dcsp dcsp for match in matches dcnl dcsp dcsp dcsp dcsp userlist append label match username dcnl dcsp data json dumps userlist dcnl dcsp return httpresponse data content type application json dcsp charset utf8
require get dcnl def topic lookup request dcsp topiclist dcnl dcsp if request is ajax dcnl dcsp dcsp topic request get get topic dcnl dcsp dcsp if topic dcnl dcsp dcsp dcsp matches document objects filter slug icontains topic dcnl dcsp dcsp dcsp for match in matches dcnl dcsp dcsp dcsp dcsp topiclist append label match slug dcnl dcsp data json dumps topiclist dcnl dcsp return httpresponse data content type application json dcsp charset utf8
require get dcnl login required dcnl permission required wiki add revisionakismetsubmission wiki add documentspamattempt users add userban raise exception true dcnl def spam request dcsp yesterday datetime date today datetime timedelta days 1 dcnl dcsp data spamdashboardhistoricalstats get yesterday dcnl dcsp if not data dcnl dcsp dcsp return render request dashboards spam html processing true dcnl dcsp return render request dashboards spam html data
require get dcnl def macros request dcsp macros macro usage dcnl dcsp total sum val count for val in macros values dcnl dcsp context macros macros has counts total 0 dcnl dcsp return render request dashboards macros html context
def get locales dcsp lang path path kuma settings languages json dcnl dcsp with open lang path r as lang file dcnl dcsp dcsp json locales json load lang file dcnl dcsp locales dcnl dcsp for locale meta in json locales items dcnl dcsp dcsp localeslocale language meta english meta native dcnl dcsp return locales
def pipeline scss output sources kwargs dcsp definition source filenames tuple styles s scss src for src in sources output filename build styles s css output dcnl dcsp definition update kwargs dcnl dcsp return definition
def pipeline one scss slug kwargs dcsp return pipeline scss slug slug kwargs
task dcnl skip in maintenance mode dcnl def prepare index index pk dcsp from kuma wiki search import wikidocumenttype dcnl dcsp from kuma search models import index dcnl dcsp cls wikidocumenttype dcnl dcsp es cls get connection indexing dcnl dcsp index index objects get pk index pk dcnl dcsp index objects recreate index es es index index dcnl dcsp temporary settings index refresh interval 1 number of replicas 0 dcnl dcsp es indices put settings temporary settings index index prefixed name
task dcnl skip in maintenance mode dcnl def finalize index index pk dcsp from kuma wiki search import wikidocumenttype dcnl dcsp from kuma search models import index dcnl dcsp cls wikidocumenttype dcnl dcsp es cls get connection indexing dcnl dcsp index index objects get pk index pk dcnl dcsp es indices optimize index index prefixed name dcnl dcsp index settings index refresh interval settings es default refresh interval number of replicas settings es default num replicas dcnl dcsp es indices put settings index index prefixed name body index settings dcnl dcsp index populated true dcnl dcsp index save dcnl dcsp subject index dcsp s dcsp completely dcsp populated index prefixed name dcnl dcsp message you dcsp may dcsp want dcsp to dcsp promote dcsp it dcsp now dcsp via dcsp the dcsp admin dcsp interface dcnl dcsp mail admins subject subject message message
def get search url from referer request dcsp referer request meta get http referer none dcnl dcsp try dcnl dcsp dcsp url url referer dcnl dcsp except unicodedecodeerror dcnl dcsp dcsp url none dcnl dcsp current site site objects get current dcnl dcsp if referer is none or url is none or url scheme https or url netloc current site domain or reverse search locale request language code url path dcnl dcsp dcsp return none dcnl dcsp return referer
def get filters getter func dcsp if getter func none dcnl dcsp dcsp return u none dcnl dcsp filters collections ordereddict dcnl dcsp for slug in filtergroup objects values list slug flat true dcnl dcsp dcsp for filters slug in getter func slug dcnl dcsp dcsp dcsp filtersfilters slug none dcnl dcsp if filters dcnl dcsp dcsp return filters keys dcnl dcsp else dcnl dcsp dcsp return x1 for x in filter objects default filters
def requires good connection fun dcsp def requires good connection args kwargs dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return fun args kwargs dcnl dcsp dcsp except connectionerror dcnl dcsp dcsp dcsp log error either dcsp your dcsp elasticsearch dcsp process dcsp is dcsp not dcsp quite dcsp ready dcsp to dcsp rumble dcsp is dcsp not dcsp running dcsp at dcsp all dcsp or dcsp es urlsis dcsp set dcsp wrong dcsp in dcsp your dcsp env dcsp file dcnl dcsp return requires good connection
def register live index model cls dcsp uid str model cls + live indexing dcnl dcsp render done connect render done handler model cls dispatch uid uid dcnl dcsp pre delete connect pre delete handler model cls dispatch uid uid dcnl dcsp return model cls
cache page 60 15 dcnl def suggestions request dcsp content type application xsuggestions+json dcnl dcsp term request get get q dcnl dcsp if not term dcnl dcsp dcsp return httpresponsebadrequest content type content type dcnl dcsp results dcnl dcsp return httpresponse json dumps results content type content type
cache page 60 60 168 dcnl def plugin request dcsp return render request search plugin html locale request language code content type application opensearchdescription+xml
require safe dcnl def liveness request dcsp return httpresponse status 204
require safe dcnl def readiness request dcsp try dcnl dcsp dcsp document objects filter pk 1 exists dcnl dcsp except databaseerror as e dcnl dcsp dcsp reason tmpl service dcsp unavailable dcsp due dcsp to dcsp database dcsp issue dcsp s dcnl dcsp dcsp status reason 503 reason tmpl format e dcnl dcsp else dcnl dcsp dcsp status reason 204 none dcnl dcsp return httpresponse status status reason reason
pytest mark current dcnl pytest mark django db dcnl def test secret generation user auth key dcsp key user auth key key dcnl dcsp secret user auth key secret dcnl dcsp assert key key dcnl dcsp assert key hashed secret dcnl dcsp assert len key hashed secret 0 dcnl dcsp assert len secret 0 dcnl dcsp assert secret key hashed secret dcnl dcsp assert not key check secret i dcsp am dcsp a dcsp fake dcnl dcsp assert key check secret secret
def generate key dcsp random hash hashlib sha256 str random getrandbits 256 digest dcnl dcsp random chars random choice ra az gq hh hg ar dd dcnl dcsp return base64 b64encode random hash random chars rstrip
def accepts auth key func dcsp wraps func dcnl dcsp def process request args kwargs dcnl dcsp dcsp request authkey none dcnl dcsp dcsp if not settings maintenance mode dcnl dcsp dcsp dcsp http auth request meta get http authorization dcnl dcsp dcsp dcsp if http auth dcnl dcsp dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp dcsp basic b64 auth http auth split dcsp 1 dcnl dcsp dcsp dcsp dcsp dcsp if basic basic dcnl dcsp dcsp dcsp dcsp dcsp dcsp auth base64 decodestring b64 auth dcnl dcsp dcsp dcsp dcsp dcsp dcsp key id secret auth split 1 dcnl dcsp dcsp dcsp dcsp dcsp dcsp key key objects get key key id dcnl dcsp dcsp dcsp dcsp dcsp dcsp if key check secret secret dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp request authkey key dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp request user key user dcnl dcsp dcsp dcsp dcsp except binascii error valueerror key doesnotexist dcnl dcsp dcsp dcsp dcsp dcsp pass dcnl dcsp dcsp return func request args kwargs dcnl dcsp return process
pytest fixture dcnl def simple user db django user model dcsp return django user model objects create username u jackdeveloper email u jack example com date joined datetime 2016 11 4 9 1
pytest fixture dcnl def simple doc db dcsp return document objects create locale u enus slug u root title u root dcsp document
pytest fixture dcnl def root doc simple doc simple user dcsp revision objects create document simple doc creator simple user content u <p getting dcsp started < p title u root dcsp document created datetime 2016 1 1 dcnl dcsp current rev revision objects create document simple doc creator simple user content u <p the dcsp root dcsp document < p created datetime 2016 2 1 dcnl dcsp assert simple doc current revision current rev dcnl dcsp return simple doc
pytest fixture dcnl def translated doc root doc dcsp translated doc document objects create parent root doc slug u racine locale u fr title u document dcsp racine dcnl dcsp current rev revision objects create document translated doc content u <p commencer < p title u document dcsp racine slug u racine based on root doc current revision creator root doc current revision creator created datetime 2017 6 1 15 28 dcnl dcsp assert translated doc current revision current rev dcnl dcsp return translated doc
def test gather document in storage dcsp source documentsource u enus docs root child dcnl dcsp storage mock storage spec u get document dcnl dcsp storage get document return value u existing dcsp document dcnl dcsp resources source gather none storage dcnl dcsp assert resources dcnl dcsp assert source state source state done dcnl dcsp assert source freshness source fresh no
def test gather forced dcsp doc path u enus docs rootdoc dcnl dcsp source documentsource doc path force true dcnl dcsp storage mock storage spec u get document u get document rendered dcnl dcsp storage get document return value u existing dcsp document dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document rendered doc path dcnl dcsp assert source state source state prereq dcnl dcsp assert source freshness source fresh unknown
def test gather child doc dcsp parent path u enus docs root dcnl dcsp child path parent path + u child dcnl dcsp source documentsource child path dcnl dcsp storage mock storage spec u get document u get document rendered dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document parent path u document rendered child path dcnl dcsp assert source state source state prereq
def test gather child doc parent in storage dcsp parent path u enus docs root dcnl dcsp child path parent path + u child dcnl dcsp source documentsource child path force true dcnl dcsp storage mock storage spec u get document u get document rendered dcnl dcsp storage get document return value u parent dcsp document dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document rendered child path dcnl dcsp storage get document assert called once with u enus u root dcnl dcsp assert source state source state prereq
def test gather standard doc dcsp path u enus docs rootdoc dcnl dcsp source documentsource path force true dcnl dcsp storage mock storage spec u get document rendered u get document metadata u get document history dcnl dcsp storage get document rendered return value dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document meta path u force true u document history path u revisions 1 dcnl dcsp assert source state source state prereq dcnl dcsp storage get document metadata assert called once with u enus u rootdoc dcnl dcsp storage get document history assert called once with u enus u rootdoc
def test gather standard doc metdata loses dcsp path u enus docs test dcnl dcsp source documentsource path force true dcnl dcsp storage mock storage spec u get document rendered u get document metadata u get document history u save document dcnl dcsp storage get document rendered return value dcnl dcsp metadata doc metadata copy dcnl dcsp metadatau locale u enus dcnl dcsp metadatau slug u test dcnl dcsp storage get document metadata return value metadata dcnl dcsp storage get document history return value u revisions path + u revision 2016 dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document current path u revisions 1 dcnl dcsp assert source state source state done dcnl dcsp storage save document assert called once with doc data
def test gather standard doc bad metadata dcsp path u enus docs test dcnl dcsp source documentsource path force true dcnl dcsp storage mock storage spec u get document rendered u get document metadata u get document history dcnl dcsp storage get document rendered return value dcnl dcsp metadata doc metadata copy dcnl dcsp metadatau error true dcnl dcsp storage get document metadata return value metadata dcnl dcsp storage get document history return value u revisions path + u revision 2016 dcnl dcsp resources source gather none storage dcnl dcsp assert resources dcnl dcsp assert source state source state error
def test gather zoned doc init dcsp path u enus zone dcnl dcsp source documentsource path force true dcnl dcsp storage mock storage spec u get zone root dcnl dcsp resources source gather none storage dcnl dcsp assert resources u zone root path dcnl dcsp assert source state source state prereq
def test gather zoned doc error dcsp path u enus zone dcnl dcsp source documentsource path force true dcnl dcsp storage mock storage spec u get zone root dcnl dcsp storage get zone root return value u errors u failed dcnl dcsp resources source gather none storage dcnl dcsp assert resources dcnl dcsp assert source state source state error
def test gather zoned doc is normalized dcsp path u enus zone dcnl dcsp source documentsource path force true dcnl dcsp assert not source normalized path dcnl dcsp assert not source locale dcnl dcsp assert not source slug dcnl dcsp storage mock storage spec u get zone root u get document u get document rendered dcnl dcsp storage get zone root return value u zone path path u doc path u enus docs root zone dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document u enus docs root u document rendered u enus docs root zone dcnl dcsp assert source state source state prereq dcnl dcsp assert source normalized path u enus docs root zone dcnl dcsp assert source locale u enus dcnl dcsp assert source slug u root zone
def test gather normalized path moved page needed dcsp source documentsource u enus docs origin force true dcnl dcsp storage mock storage spec u get document u get document rendered dcnl dcsp storage get document rendered return value u redirect to u enus docs newlocation dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document u enus docs newlocation dcnl dcsp storage get document assert called once with u enus u newlocation dcnl dcsp assert source state source state prereq
def test gather normalized path moved page followed dcsp source documentsource u enus docs origin force true dcnl dcsp storage mock storage spec u get document u get document rendered u save document dcnl dcsp storage get document rendered return value u redirect to u enus docs newlocation dcnl dcsp storage get document return value u redirect dcsp document dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document current u enus docs origin u revisions 1 dcnl dcsp assert source state source state done dcnl dcsp expected data u locale u enus u slug u origin u redirect to u enus docs newlocation dcnl dcsp storage save document assert called once with expected data
def test gather redirect to zone page first pass dcsp parent path u enus docs root dcnl dcsp path parent path + u zone dcnl dcsp zone path u enus zone dcnl dcsp source documentsource path force true dcnl dcsp storage mock storage spec u get document u get document rendered u get zone root u get document metadata u get document history dcnl dcsp storage get document rendered return value u redirect to zone path dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document parent path u zone root zone path u document meta path u force true u document history path u revisions 1 dcnl dcsp assert source state source state prereq
def test gather redirect to errored zone page is error dcsp parent path u enus docs root dcnl dcsp path parent path + u zone dcnl dcsp zone path u enus zone dcnl dcsp source documentsource path force true dcnl dcsp storage mock storage spec u get document u get document rendered u get zone root u get document metadata u get document history dcnl dcsp storage get document rendered return value u redirect to zone path dcnl dcsp storage get zone root return value u errors u bad dcsp zone dcnl dcsp source gather none storage dcnl dcsp assert source state source state error
def test gather redirect to zone page complete dcsp parent path u enus docs root dcnl dcsp path parent path + u zone dcnl dcsp zone path u enus zone dcnl dcsp source documentsource path force true dcnl dcsp storage mock storage spec u get document u get document rendered u get zone root u get document metadata u get document history u save document dcnl dcsp storage get document return value u root dcsp doc dcnl dcsp storage get document rendered return value u redirect to zone path dcnl dcsp storage get zone root return value u doc path path u zone path zone path dcnl dcsp metadata doc metadata copy dcnl dcsp storage get document metadata return value metadata dcnl dcsp storage get document history return value u revisions path + u revision 2017 dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document current path u revisions 1 dcnl dcsp assert source state source state done dcnl dcsp expected doc data copy dcnl dcsp expectedu slug u root zone dcnl dcsp expectedu parent topic u root dcsp doc dcnl dcsp expectedu zone redirect path zone path dcnl dcsp assert storage save document call count 1 dcnl dcsp assert storage save document call args00 expected dcnl dcsp storage save document assert called once with expected
def test gather redirect to zone subpage dcsp parent path u enus docs root zone dcnl dcsp path parent path + u child dcnl dcsp zone root path u enus zone dcnl dcsp zone path zone root path + u child dcnl dcsp source documentsource path force true dcnl dcsp storage mock storage spec u get document u get document rendered u get zone root u get document metadata u get document history u save document dcnl dcsp storage get document rendered return value u redirect to zone path dcnl dcsp storage get zone root return value u doc path parent path u zone path zone root path dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document parent path u document parent path u document meta path u force true u document history path u revisions 1 dcnl dcsp assert source state source state prereq
def test gather redirect to zone subpage complete dcsp parent path u enus docs root zone dcnl dcsp path parent path + u child dcnl dcsp zone root path u enus zone dcnl dcsp zone path zone root path + u child dcnl dcsp source documentsource path force true dcnl dcsp storage mock storage spec u get document u get document rendered u get zone root u get document metadata u get document history u save document dcnl dcsp storage get document return value u root dcsp doc dcnl dcsp storage get document rendered return value u redirect to zone path dcnl dcsp storage get zone root return value u doc path parent path u zone path u enus zone dcnl dcsp metadata doc metadata copy dcnl dcsp storage get document metadata return value metadata dcnl dcsp storage get document history return value u revisions path + u revision 2018 dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document current path u revisions 1 dcnl dcsp assert source state source state done dcnl dcsp expected doc data copy dcnl dcsp expectedu slug u root zone child dcnl dcsp expectedu parent topic u root dcsp doc dcnl dcsp expectedu zone redirect path zone root path dcnl dcsp assert storage save document call count 1 dcnl dcsp assert storage save document call args00 expected dcnl dcsp storage save document assert called once with expected
def test gather localized doc without metadata dcsp path u fr docs racine dcnl dcsp source documentsource path force true dcnl dcsp storage mock storage spec u get document rendered u get document metadata u get document history u save document dcnl dcsp storage get document rendered return value dcnl dcsp storage get document history return value u revisions path + u revision 2020 dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document meta path u force true dcnl dcsp assert source state source state prereq
def test gather localized doc with metadata dcsp path u fr docs racine dcnl dcsp source documentsource path force true dcnl dcsp storage mock storage spec u get document u get document rendered u get document metadata u get document history u save document dcnl dcsp storage get document rendered return value dcnl dcsp metadata doc metadata copy dcnl dcsp metadatau locale u fr dcnl dcsp metadatau slug u racine dcnl dcsp metadatau url path dcnl dcsp metadatau translations u locale u es u url u es docs ra xedz u locale u enus u url u enus docs root dcnl dcsp storage get document metadata return value metadata dcnl dcsp storage get document history return value u revisions path + u revision 2020 dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document u enus docs root dcnl dcsp assert source state source state prereq
def test gather localized doc invalid english dcsp path u fr docs racine dcnl dcsp source documentsource path force true dcnl dcsp storage mock storage spec u get document rendered u get document metadata u get document history dcnl dcsp storage get document rendered return value dcnl dcsp metadata doc metadata copy dcnl dcsp metadatau locale u fr dcnl dcsp metadatau slug u racine dcnl dcsp metadatau url path dcnl dcsp metadatau translations u locale u enus u url u enus zoneroot dcnl dcsp storage get document metadata return value metadata dcnl dcsp storage get document history return value u revisions path + u revision 2020 dcnl dcsp resources source gather none storage dcnl dcsp assert resources dcnl dcsp assert source state source state error
def test gather localized doc sets parent dcsp path u fr docs racine dcnl dcsp source documentsource path force true dcnl dcsp storage mock storage spec u get document u get document rendered u get document metadata u get document history u save document dcnl dcsp storage get document rendered return value dcnl dcsp metadata doc metadata copy dcnl dcsp metadatau locale u fr dcnl dcsp metadatau slug u racine dcnl dcsp metadatau url path dcnl dcsp metadatau translations u locale u enus u url u enus docs root dcnl dcsp storage get document return value u english dcsp document dcnl dcsp storage get document metadata return value metadata dcnl dcsp storage get document history return value u revisions path + u revision 2020 dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document current path u revisions 1 dcnl dcsp assert source state source state done dcnl dcsp expected doc data copy dcnl dcsp expectedu locale u fr dcnl dcsp expectedu slug u racine dcnl dcsp expectedu parent u english dcsp document dcnl dcsp assert storage save document call count 1 dcnl dcsp assert storage save document call args00 expected dcnl dcsp storage save document assert called once with expected
def test gather document children dcsp doc path u enus docs rootdoc dcnl dcsp source documentsource doc path depth 1 force true dcnl dcsp storage mock storage spec u get document rendered u get document metadata u get document history u get document children u save document dcnl dcsp storage get document rendered return value dcnl dcsp storage get document metadata return value doc metadata dcnl dcsp storage get document history return value u revisions doc path + u revision 2016 dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document children doc path u depth 1 u force true dcnl dcsp assert source state source state prereq dcnl dcsp assert source freshness source fresh unknown
def test gather document children loaded dcsp doc path u enus docs rootdoc dcnl dcsp source documentsource doc path depth u all force true dcnl dcsp storage mock storage spec u get document rendered u get document metadata u get document history u get document children u save document dcnl dcsp storage get document rendered return value dcnl dcsp storage get document metadata return value doc metadata dcnl dcsp storage get document history return value u revisions doc path + u revision 2016 dcnl dcsp storage get document children return value dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document current doc path u revisions 1 dcnl dcsp assert source state source state done dcnl dcsp assert source freshness source fresh yes
pytest fixture dcnl def tagged doc db django user model dcsp document document objects create locale u enus slug u test title u test dcsp document dcnl dcsp creator django user model objects create username u creator dcnl dcsp revision revision objects create content u <p the dcsp html dcsp element dcsp <code lt input gt < code comment u frist dcsp post creator creator created datetime 2016 12 15 17 23 document document title u test dcsp document tags u one dcsp two dcsp three dcnl dcsp assert document current revision revision dcnl dcsp return document
def test invalid path dcsp source revisionsource u bad path dcnl dcsp assert source state source state error
def test gather no prereqs tagged doc client dcsp doc path tagged doc get absolute url dcnl dcsp rev path doc path + u revision d tagged doc current revision id dcnl dcsp html client get rev path content dcnl dcsp source revisionsource rev path dcnl dcsp requester mock requester content html dcnl dcsp storage mock storage spec u get document u get revision u get document metadata u get revision html u save revision html u get user dcnl dcsp resources source gather requester storage dcnl dcsp assert resources u document doc path u document meta doc path u user u creator dcnl dcsp assert source state source state prereq dcnl dcsp assert source freshness source fresh unknown dcnl dcsp storage save revision html assert called once with rev path html
def test gather existing rev and doc dcsp doc path u enus docs test dcnl dcsp rev path doc path + u revision 100 dcnl dcsp source revisionsource rev path dcnl dcsp requester mock requester requester spec dcnl dcsp storage mock storage spec u get document u get revision dcnl dcsp storage get document return value u existing dcnl dcsp revision mock mock spec set u document dcnl dcsp revision document u existing dcnl dcsp storage get revision return value revision dcnl dcsp resources source gather requester storage dcnl dcsp assert resources dcnl dcsp assert source state source state done dcnl dcsp assert source freshness source fresh no dcnl dcsp storage get document assert called once with u enus u test dcnl dcsp storage get revision assert called once with 100
def test gather existing doc tagged doc client dcsp doc path tagged doc get absolute url dcnl dcsp rev path doc path + u revision d tagged doc current revision id dcnl dcsp html client get rev path content dcnl dcsp source revisionsource rev path dcnl dcsp requester mock requester content html dcnl dcsp storage mock storage spec u get document u get revision u get document metadata u get revision html u save revision html u get user dcnl dcsp storage get document return value tagged doc dcnl dcsp resources source gather requester storage dcnl dcsp assert resources u document meta doc path u user u creator dcnl dcsp assert source state source state prereq dcnl dcsp assert source freshness source fresh unknown dcnl dcsp storage save revision html assert called once with rev path html
def test gather doc mismatch is error dcsp doc path u enus docs test dcnl dcsp rev path doc path + u revision 100 dcnl dcsp source revisionsource rev path dcnl dcsp requester mock requester requester spec dcnl dcsp storage mock storage spec u get document u get revision dcnl dcsp doc1 mock mock spec set u get absolute url dcnl dcsp doc1 get absolute url return value u enus docs foo dcnl dcsp doc2 mock mock spec set u get absolute url dcnl dcsp doc2 get absolute url return value u enus docs test dcnl dcsp storage get document return value doc1 dcnl dcsp revision mock mock spec set u document dcnl dcsp revision document doc2 dcnl dcsp storage get revision return value revision dcnl dcsp resources source gather requester storage dcnl dcsp assert resources dcnl dcsp assert source state source state error dcnl dcsp assert source freshness source fresh no dcnl dcsp storage get document assert called once with u enus u test dcnl dcsp storage get revision assert called once with 100
def test gather with prereqs tagged doc client dcsp doc path tagged doc get absolute url dcnl dcsp rev path doc path + u revision d tagged doc current revision id dcnl dcsp html client get rev path content dcnl dcsp source revisionsource rev path dcnl dcsp source state source state prereq dcnl dcsp requester mock requester requester spec dcnl dcsp storage mock storage spec u get document u get revision u get document metadata u get revision html u get user u save revision dcnl dcsp storage get document return value tagged doc dcnl dcsp storage get document metadata return value u is meta true dcnl dcsp storage get revision html return value html dcnl dcsp storage get user return value u username u creator dcnl dcsp resources source gather requester storage dcnl dcsp assert resources dcnl dcsp assert source state source state done dcnl dcsp assert source freshness source fresh yes dcnl dcsp expected data u id tagged doc current revision id u comment u frist dcsp post u content u <p the dcsp html dcsp element dcsp <code lt input gt < code u created datetime 2016 12 15 17 23 u creator u username u creator u document tagged doc u is current true u localization tags u review tags u slug u test u tags u one u three u two u title u test dcsp document dcnl dcsp storage save revision assert called once with expected data
def test gather second pass tagged doc client dcsp doc path tagged doc get absolute url dcnl dcsp rev path doc path + u revision d tagged doc current revision id dcnl dcsp html client get rev path content dcnl dcsp source revisionsource rev path dcnl dcsp requester mock requester requester spec dcnl dcsp storage mock storage spec u get document u get revision u get document metadata u get revision html u get user u save revision dcnl dcsp storage get document return value none dcnl dcsp storage get document metadata return value u is meta true dcnl dcsp storage get revision html return value html dcnl dcsp storage get user return value u username u creator dcnl dcsp resources source gather requester storage dcnl dcsp assert resources u document doc path dcnl dcsp assert source state source state prereq dcnl dcsp assert source freshness source fresh unknown dcnl dcsp storage get document return value tagged doc dcnl dcsp resources source gather requester storage dcnl dcsp assert resources dcnl dcsp assert source state source state done dcnl dcsp assert source freshness source fresh yes dcnl dcsp expected data u id tagged doc current revision id u comment u frist dcsp post u content u <p the dcsp html dcsp element dcsp <code lt input gt < code u created datetime 2016 12 15 17 23 u creator u username u creator u document tagged doc u is current true u localization tags u review tags u slug u test u tags u one u three u two u title u test dcsp document dcnl dcsp storage save revision assert called once with expected data
def test gather document slug wins tagged doc client dcsp orig doc path tagged doc get absolute url dcnl dcsp orig rev path orig doc path + u revision d tagged doc current revision id dcnl dcsp html client get orig rev path content dcnl dcsp tagged doc slug u other dcnl dcsp doc path tagged doc get absolute url dcnl dcsp rev path doc path + u revision d tagged doc current revision id dcnl dcsp source revisionsource rev path dcnl dcsp source state source state prereq dcnl dcsp requester mock requester requester spec dcnl dcsp storage mock storage spec u get document u get revision u get document metadata u get revision html u get user u save revision dcnl dcsp storage get document return value tagged doc dcnl dcsp storage get document metadata return value u is meta true dcnl dcsp storage get revision html return value html dcnl dcsp storage get user return value u username u creator dcnl dcsp resources source gather requester storage dcnl dcsp assert resources dcnl dcsp assert source state source state done dcnl dcsp assert source freshness source fresh yes dcnl dcsp expected data u id tagged doc current revision id u comment u frist dcsp post u content u <p the dcsp html dcsp element dcsp <code lt input gt < code u created datetime 2016 12 15 17 23 u creator u username u creator u document tagged doc u is current true u localization tags u review tags u slug u other u tags u one u three u two u title u test dcsp document dcnl dcsp storage save revision assert called once with expected data
def test gather older revision root doc client dcsp doc path root doc get absolute url dcnl dcsp old rev root doc revisions order by u id 0 dcnl dcsp assert old rev root doc current revision dcnl dcsp rev path doc path + u revision d old rev id dcnl dcsp html client get rev path content dcnl dcsp source revisionsource rev path dcnl dcsp source state source state prereq dcnl dcsp requester mock requester requester spec dcnl dcsp storage mock storage spec u get document u get revision u get document metadata u get revision html u get user u save revision dcnl dcsp storage get document return value root doc dcnl dcsp storage get document metadata return value u is meta true dcnl dcsp storage get revision html return value html dcnl dcsp storage get user return value u username u creator dcnl dcsp resources source gather requester storage dcnl dcsp assert resources dcnl dcsp assert source state source state done dcnl dcsp assert source freshness source fresh yes dcnl dcsp expected data u id old rev id u comment u u content u <p getting dcsp started < p u created datetime 2016 1 1 u creator u username u creator u document root doc u is current false u slug u root u tags u title u root dcsp document dcnl dcsp storage save revision assert called once with expected data
def test gather missing revision is error tagged doc dcsp doc path tagged doc get absolute url dcnl dcsp rev path doc path + u revision s tagged doc current revision id dcnl dcsp source revisionsource rev path dcnl dcsp requester mock requester status code 404 dcnl dcsp storage mock storage spec u get document u get revision u get document metadata u get revision html dcnl dcsp resources source gather requester storage dcnl dcsp assert resources dcnl dcsp assert source state source state error dcnl dcsp assert source freshness source fresh unknown
def test gather based on is needed translated doc client dcsp rev translated doc current revision dcnl dcsp rev path rev get absolute url dcnl dcsp based on path rev based on get absolute url dcnl dcsp source revisionsource rev path based on based on path dcnl dcsp html client get rev path content dcnl dcsp requester mock requester requester spec dcnl dcsp storage mock storage spec u get document u get revision u get document metadata u get revision html u get user u save revision dcnl dcsp storage get document return value translated doc dcnl dcsp storage get document metadata return value u is meta true dcnl dcsp storage get revision html return value html dcnl dcsp storage get user return value u username u creator dcnl dcsp resources source gather requester storage dcnl dcsp assert resources u revision based on path dcnl dcsp assert source state source state prereq dcnl dcsp assert source freshness source fresh unknown
def test gather based on is available translated doc client dcsp rev translated doc current revision dcnl dcsp rev path rev get absolute url dcnl dcsp based on path rev based on get absolute url dcnl dcsp source revisionsource rev path based on based on path dcnl dcsp html client get rev path content dcnl dcsp requester mock requester requester spec dcnl dcsp storage mock storage spec u get document u get revision u get document metadata u get revision html u get user u save revision dcnl dcsp storage get document return value translated doc dcnl dcsp storage get document metadata return value u is meta true dcnl dcsp storage get revision html return value html dcnl dcsp storage get user return value u username u creator dcnl dcsp storage get revision side effect none rev based on dcnl dcsp resources source gather requester storage dcnl dcsp assert resources dcnl dcsp assert source state source state done dcnl dcsp assert source freshness source fresh yes dcnl dcsp expected data u id rev id u based on id rev based on id u comment u u content u <p commencer < p u created datetime 2017 6 1 15 28 u creator u username u creator u document translated doc u is current true u localization tags u review tags u slug u racine u tags u title u document dcsp racine dcnl dcsp storage save revision assert called once with expected data
def test session dcsp requester requester example com true dcnl dcsp session requester session dcnl dcsp assert isinstance session requests session dcnl dcsp session2 requester session dcnl dcsp assert session is session2
def test request dcsp requester requester example com true dcnl dcsp mock session mock mock spec set get dcnl dcsp mock response mock mock spec set raise for status dcnl dcsp mock session get return value mock response dcnl dcsp requester session mock session dcnl dcsp response requester request path dcnl dcsp assert response mock response dcnl dcsp mock session get assert called once with https example com path timeout 1 0 dcnl dcsp mock response raise for status assert called once with
def test request no raise dcsp requester requester example net false dcnl dcsp mock session mock mock spec set get dcnl dcsp mock response mock mock spec set raise for status dcnl dcsp mock session get return value mock response dcnl dcsp requester session mock session dcnl dcsp response requester request path raise for status false dcnl dcsp assert response mock response dcnl dcsp mock session get assert called once with http example net path timeout 1 0 dcnl dcsp assert not mock response raise for status called
mock patch kuma scrape scraper time sleep dcnl def test timeout success mock sleep dcsp requester requester example com true dcnl dcsp mock session mock mock spec set get dcnl dcsp mock session get side effect requests exceptions timeout requests exceptions timeout response dcnl dcsp requester session mock session dcnl dcsp response requester request path raise for status false dcnl dcsp assert response response dcnl dcsp full path https example com path dcnl dcsp expected calls mock call full path timeout 1 0 mock call full path timeout 2 0 mock call full path timeout 4 0 dcnl dcsp assert mock session get call args list expected calls dcnl dcsp expected sleep calls mock call 1 0 mock call 2 0 dcnl dcsp assert mock sleep call args list expected sleep calls
def test connectionerror success dcsp requester requester example com true dcnl dcsp mock session mock mock spec set get dcnl dcsp mock session get side effect requests exceptions connectionerror requests exceptions connectionerror response dcnl dcsp requester session mock session dcnl dcsp response requester request path raise for status false dcnl dcsp assert response response dcnl dcsp full path https example com path dcnl dcsp expected calls mock call full path timeout 1 0 3 dcnl dcsp assert mock session get call args list expected calls
mock patch kuma scrape scraper time sleep dcnl def test timeout failure mock sleep dcsp assert requester max attempts 3 dcnl dcsp requester requester example com true dcnl dcsp mock session mock mock spec set get dcnl dcsp mock session get side effect requests exceptions timeout 3 dcnl dcsp requester session mock session dcnl dcsp with pytest raises requests exceptions timeout dcnl dcsp dcsp requester request path raise for status false dcnl dcsp full path https example com path dcnl dcsp expected calls mock call full path timeout 1 0 mock call full path timeout 2 0 mock call full path timeout 4 0 dcnl dcsp assert mock session get call args list expected calls dcnl dcsp expected sleep calls mock call 1 0 mock call 2 0 mock call 4 0 dcnl dcsp assert mock sleep call args list expected sleep calls
pytest fixture dcnl def scraper dcsp scraper scraper dcnl dcsp scraper source types fake fakesource dcnl dcsp return scraper
def test add new source scraper dcsp assert scraper add source fake bob dcnl dcsp source scraper sources fake bob dcnl dcsp assert isinstance source fakesource dcnl dcsp assert source name bob
def test add existing source scraper dcsp assert scraper add source fake jane dcnl dcsp assert not scraper add source fake jane dcnl dcsp assert scraper add source fake jane length 1 dcnl dcsp assert not scraper add source fake jane length 1
def test scrape scraper dcsp scraper add source fake loop length 2 depth 2 dcnl dcsp sources scraper scrape dcnl dcsp assert sources keys fake loop fake loop2 fake loop21
def test scrape error scraper dcsp scraper add source fake will error error true dcnl dcsp sources scraper scrape dcnl dcsp source sources fake will error dcnl dcsp assert source state source state error
def test scrape none scraper dcsp sources scraper scrape dcnl dcsp assert not sources
def test warn percent in param scraper mock logger dcsp scraper add source fake loop 0d depth 1 dcnl dcsp scraper scrape dcnl dcsp expected fmt source dcsp s dcsp has dcsp a dcsp percent dcsp in dcsp deps dcnl dcsp mock logger warn assert called once with expected fmt fake loop 0d
def test warn dependency block scraper mock logger dcsp scraper add source fake bad document length 2 error true dcnl dcsp scraper scrape dcnl dcsp expected msg dependency dcsp block dcsp detected dcsp aborting dcnl dcsp mock logger warn assert called once with expected msg
pytest mark parametrize u data name param list u document children u locale u slug u document metadata u locale u slug u document history u locale u slug u document rendered u locale u slug u revision html u path u zone root u path ids u document children u document metadata u document history u document rendered u revision html u zone root dcnl def test local storage data name param list dcsp storage storage dcnl dcsp getter getattr storage u get + data name dcnl dcsp setter getattr storage u save + data name dcnl dcsp assert getter param list is none dcnl dcsp value data name + u dcsp value dcnl dcsp setter data value param list dcnl dcsp assert getter param list value
def test safe add tags new simple user dcsp tag u profile interest testing dcnl dcsp storage safe add tags tag tag simple user tags dcnl dcsp assert list simple user tags names tag
def test safe add tags existing simple user dcsp tag u profile expertise existence dcnl dcsp tag objects create name tag dcnl dcsp storage safe add tags tag tag simple user tags dcnl dcsp assert list simple user tags names tag
def test safe add tags case mismatch simple user dcsp tag u profile interest css dcnl dcsp tag objects create name tag dcnl dcsp upper tag u profile interest css dcnl dcsp storage safe add tags upper tag tag simple user tags dcnl dcsp assert list simple user tags names tag
pytest mark django db dcnl def test save document tags dcsp data u id 101 u locale u enus u modified datetime 2016 11 15 9 31 u slug u test u tags u needstranslation u title u test dcsp document dcnl dcsp storage save document data dcnl dcsp document document objects get locale u enus slug u test dcnl dcsp assert document title u test dcsp document dcnl dcsp assert list document tags names u needstranslation
pytest mark django db dcnl def test save document dupe tags dcsp data u id 101 u locale u enus u modified datetime 2016 11 15 9 31 u slug u test u tags u needstranslation u needstranslation u title u test dcsp document dcnl dcsp storage save document data dcnl dcsp document document objects get locale u enus slug u test dcnl dcsp assert document title u test dcsp document dcnl dcsp assert list document tags names u needstranslation
def test save document update existing simple doc dcsp assert list simple doc tags names dcnl dcsp data u id simple doc id u locale u enus u slug u root u tags u supertag dcnl dcsp storage save document data dcnl dcsp document document objects get id simple doc id dcnl dcsp assert list document tags names u supertag
def test save document update existing to redirect simple doc dcsp data u locale u enus u slug u root u redirect to u enus docs supertest dcnl dcsp redirect html redirect content u href datau redirect to u title u root dcsp document dcnl dcsp storage save document data dcnl dcsp document document objects get id simple doc id dcnl dcsp assert document is redirect dcnl dcsp assert document html redirect html
def test save document new doc colliding id simple doc dcsp new data u id simple doc id u locale u enus u slug u newdoc u title u new dcsp document dcnl dcsp storage save document new data dcnl dcsp new doc document objects get locale u enus slug u newdoc dcnl dcsp assert new doc id simple doc id
pytest mark django db dcnl def test save document integrity error dcsp en root doc document objects create locale u enus slug u mdn title u mdn dcnl dcsp en doc document objects create locale u enus slug u mdn about title u about dcsp mdn parent topic en root doc dcnl dcsp ca id 1000 dcnl dcsp while document objects filter id ca id exists dcnl dcsp dcsp ca id + 1 dcnl dcsp ca data u locale u ca u slug u project quant a u title u quant dcsp a u parent en doc u id ca id dcnl dcsp def ca weirdness data dcnl dcsp dcsp ca doc document dcnl dcsp dcsp for name value in data items dcnl dcsp dcsp dcsp setattr ca doc name value dcnl dcsp dcsp ca doc save dcnl dcsp dcsp raise integrityerror u id dcsp in dcsp use dcnl dcsp with mock patch u kuma scrape storage document objects create as mcreate dcnl dcsp dcsp mcreate side effect ca weirdness dcnl dcsp dcsp storage save document ca data dcnl dcsp mcreate assert called once with ca data dcnl dcsp ca doc document objects get locale u ca slug u project quant a dcnl dcsp assert ca doc title u quant dcsp a dcnl dcsp assert ca doc parent en doc
def test save document create zone with redirect simple doc dcsp data u parent topic simple doc u locale u enus u slug u root zone u zone redirect path u enus zone u is zone root true u zone css slug u otherslug dcnl dcsp storage save document data dcnl dcsp doc document objects get locale u enus slug u root zone dcnl dcsp assert doc zone dcnl dcsp assert doc zone css slug datau zone css slug dcnl dcsp assert doc zone url root u zone
def test save document create simple zone simple doc dcsp data u parent topic simple doc u locale u enus u slug u root zone u is zone root true dcnl dcsp storage save document data dcnl dcsp doc document objects get locale u enus slug u root zone dcnl dcsp assert doc zone dcnl dcsp assert doc zone css slug u dcnl dcsp assert doc zone url root is none
def test save document zone child simple doc dcsp data u parent topic simple doc u locale u enus u slug u root zonechild u is zone root false u zone redirect path u enus root zonechild u zone css slug u otherslug dcnl dcsp storage save document data dcnl dcsp doc document objects get locale u enus slug u root zonechild dcnl dcsp with pytest raises documentzone doesnotexist dcnl dcsp dcsp doc zone
def test save revision current simple doc simple user dcsp assert not simple doc html dcnl dcsp data u id 1000 u creator simple user u document simple doc u slug u test u title u test dcsp document u created datetime 2016 11 15 16 49 u is current true u comment u frist dcsp post u tags u one u two u three u content u <p my dcsp awesome dcsp content < p dcnl dcsp storage save revision data dcnl dcsp rev revision objects get id 1000 dcnl dcsp assert rev document simple doc dcnl dcsp assert rev document html rev content dcnl dcsp assert rev creator simple user dcnl dcsp assert rev tags u one dcsp two dcsp three dcnl dcsp assert rev content u <p my dcsp awesome dcsp content < p
def test save revision not current root doc simple user dcsp old content root doc html dcnl dcsp assert old content dcnl dcsp data u id 1000 u creator simple user u document root doc u slug u test u title u test dcsp document u created datetime 2014 1 1 u is current false u comment u frist dcsp post u tags u content u <p my dcsp awesome dcsp content < p dcnl dcsp storage save revision data dcnl dcsp rev revision objects get id 1000 dcnl dcsp assert rev document root doc dcnl dcsp assert rev document html old content dcnl dcsp assert rev creator simple user dcnl dcsp assert rev tags u dcnl dcsp assert rev content u <p my dcsp awesome dcsp content < p
def test save revision duplicate tags simple doc simple user dcsp data u id 1001 u creator simple user u document simple doc u slug u test u title u test dcsp document u created datetime 2016 11 16 11 27 u is current true u comment u frist dcsp post u tags u one u two u one u two u content u <p my dcsp awesome dcsp content < p dcnl dcsp storage save revision data dcnl dcsp rev revision objects get id 1001 dcnl dcsp assert rev document simple doc dcnl dcsp assert rev creator simple user dcnl dcsp assert rev tags u one dcsp two dcnl dcsp assert sorted rev document tags names u one u two
def test save revision existing tags simple doc simple user dcsp documenttag objects create name u one dcnl dcsp documenttag objects create name u two dcnl dcsp data u id 1002 u creator simple user u document simple doc u slug u test u title u test dcsp document u created datetime 2016 12 19 13 52 u is current true u comment u frist dcsp post u tags u one u two u content u <p my dcsp awesome dcsp content < p dcnl dcsp storage save revision data dcnl dcsp rev revision objects get id 1002 dcnl dcsp assert rev document simple doc dcnl dcsp assert rev creator simple user dcnl dcsp assert rev tags u one dcsp two dcnl dcsp assert sorted rev document tags names u one u two
def test save revision no content review tags simple doc simple user dcsp data u id 1003 u creator simple user u document simple doc u slug u test u title u test dcsp document u created datetime 2016 12 19 13 52 u is current true u tags u review tags u technical u localization tags u inprogress dcnl dcsp storage save revision data dcnl dcsp rev revision objects get id 1003 dcnl dcsp assert rev document simple doc dcnl dcsp assert rev creator simple user dcnl dcsp assert rev content u dcnl dcsp assert list rev review tags names u technical dcnl dcsp assert list rev localization tags names u inprogress
def test save user banned django user model dcsp data u username u banned u date joined datetime 2016 12 19 u banned true dcnl dcsp storage save user data dcnl dcsp user django user model objects get username u banned dcnl dcsp assert user bans count 1 dcnl dcsp ban user bans first dcnl dcsp assert ban by user dcnl dcsp assert ban reason u ban dcsp detected dcsp by dcsp scraper
pytest fixture dcnl def complex user db django user model dcsp user django user model objects create username u jilldeveloper fullname u jill dcsp developer email u jill example com title u web dcsp developer organization u acme dcsp inc location u springfield dcsp usa date joined datetime 1999 1 1 10 40 23 twitter url u http twitter com jilldev1999 github url u https github com jilldev1999 stackoverflow url u http stackoverflow com users 1 jilldev1999 linkedin url u http www linkedin com in jilldev1999 mozillians url u http mozillians org u jilldev dcnl dcsp user tags set ns u profile interest u javascript u html u css dcnl dcsp user tags set ns u profile expertise u html dcnl dcsp return user
def mock requester requester spec none response spec none content none json none status code 200 history none final path none dcsp if requester spec is none dcnl dcsp dcsp requester spec u request dcnl dcsp if response spec is none dcnl dcsp dcsp response spec u content u history dcnl dcsp dcsp if status code is not none dcnl dcsp dcsp dcsp response spec append u status code dcnl dcsp requester mock mock spec set requester spec dcnl dcsp if u request in requester spec dcnl dcsp dcsp mock response mock mock spec set response spec dcnl dcsp dcsp if u content in response spec dcnl dcsp dcsp dcsp mock response content content or u dcnl dcsp dcsp if u history in response spec dcnl dcsp dcsp dcsp redirect history dcnl dcsp dcsp dcsp for status code path in history or dcnl dcsp dcsp dcsp dcsp redirect response mock mock spec set u status code u url dcnl dcsp dcsp dcsp dcsp redirect response status code status code dcnl dcsp dcsp dcsp dcsp redirect response url path dcnl dcsp dcsp dcsp dcsp redirect history append redirect response dcnl dcsp dcsp dcsp mock response history redirect history dcnl dcsp dcsp if u json in response spec and json dcnl dcsp dcsp dcsp mock response json return value json dcnl dcsp dcsp if u status code in response spec and status code dcnl dcsp dcsp dcsp mock response status code status code dcnl dcsp dcsp if u url in response spec dcnl dcsp dcsp dcsp assert final path u need dcsp a dcsp final path dcsp for dcsp response url dcnl dcsp dcsp dcsp mock response url final path dcnl dcsp dcsp requester request return value mock response dcnl dcsp return requester
def mock storage spec none dcsp spec set spec or dcnl dcsp storage mock mock spec set spec set dcnl dcsp for item in spec set dcnl dcsp dcsp if item startswith u get dcnl dcsp dcsp dcsp getattr storage item return value none dcnl dcsp return storage
def test init param dcsp source fakesource u param dcnl dcsp assert source name u param dcnl dcsp assert source length 0 dcnl dcsp assert source pressed is false dcnl dcsp assert source unbounded 0 dcnl dcsp assert source flavor u
pytest mark parametrize u option value u pressed true u length 1 u unbounded u all u flavor u curry ids u bool u int u int all u text dcnl def test init options option value dcsp source fakesource u popcorn option value dcnl dcsp assert source name u popcorn dcnl dcsp assert getattr source option value
def test init invalid option dcsp with pytest raises exception dcnl dcsp dcsp fakesource u param unknown 1
def test merge none dcsp source fakesource u merge dcnl dcsp source state source state prereq dcnl dcsp assert source merge options dcnl dcsp assert source state source state prereq
pytest mark parametrize u option lesser value greater value u pressed false true u length 1 2 u unbounded 2 3 ids u bool u int u int all dcnl def test merge less option lesser value greater value dcsp source fakesource u merge option greater value dcnl dcsp source state source state prereq dcnl dcsp assert source merge options option lesser value dcnl dcsp assert getattr source option greater value dcnl dcsp assert source state source state prereq
pytest mark parametrize u option value u pressed true u length 2 u unbounded 1 u flavor u country ids u bool u int u int all u text dcnl def test merge same option value dcsp source fakesource u merge option value dcnl dcsp source state source state prereq dcnl dcsp assert source merge options option value dcnl dcsp assert getattr source option value dcnl dcsp assert source state source state prereq
pytest mark parametrize u option lesser value greater value u pressed false true u length 1 2 u unbounded 2 3 ids u bool u int u int all dcnl def test merge upgrade option lesser value greater value dcsp source fakesource u merge option lesser value dcnl dcsp source state source state prereq dcnl dcsp result source merge options option greater value dcnl dcsp assert result option greater value dcnl dcsp assert getattr source option greater value dcnl dcsp assert source state source state init
def test merge more multiple dcsp source fakesource u merge dcnl dcsp res source merge options length 1 pressed true unbounded 1 flavor u salty dcnl dcsp assert res u length 1 u pressed true u unbounded 1 u flavor u salty
def test merge int all dcsp source fakesource u merge dcnl dcsp assert source merge options unbounded u all u unbounded u all dcnl dcsp assert source merge options unbounded u all
def test merge text dcsp source fakesource u merge dcnl dcsp assert source merge options flavor u sweet u flavor u sweet dcnl dcsp assert source merge options flavor u sour u flavor u sour dcnl dcsp assert source merge options flavor u sour dcnl dcsp assert source merge options flavor u sweet u flavor u sweet dcnl dcsp assert source merge options flavor u
def test current options default dcsp source fakesource u default dcnl dcsp assert source current options
pytest mark parametrize u option value u pressed true u length 1 u unbounded u all u flavor u curry ids u bool u int u int all u text dcnl def test current options nondefault option value dcsp source fakesource u default option value dcnl dcsp assert source current options option value
pytest mark parametrize u option type option bad value u bool u pressed 1 u int u length u 0 u int all u unbounded u 1 u text u flavor 1 ids u bool u int u int all u text dcnl def test invalid values option type option bad value dcsp with pytest raises valueerror as err dcnl dcsp dcsp fakesource u fails option bad value dcnl dcsp assert option type in err value message
pytest mark parametrize u href decoded binary u binary e7 a7 bb e8 a1 8c e4 ba 88 e5 ae 9a u u79fb u884c u4e88 u5b9a dcnl def test decode href href decoded dcsp source fakesource u conversions dcnl dcsp assert decoded source decode href href
def test source error str dcsp error1 source sourceerror u a dcsp simple dcsp error dcnl dcsp assert u s error1 u a dcsp simple dcsp error dcnl dcsp error2 source sourceerror u a dcsp formatted dcsp error dcsp like dcsp s dcsp and dcsp d u a dcsp string 123 dcnl dcsp assert u s error2 u a dcsp formatted dcsp error dcsp like dcsp a dcsp string dcsp and dcsp 123
def test gather done is done dcsp source fakesource u existing dcnl dcsp source state source state done dcnl dcsp assert source gather mock requester mock storage dcnl dcsp assert source state source state done dcnl dcsp assert source freshness source fresh unknown
def test gather load storage existing dcsp source fakesource u existing dcnl dcsp source load and validate existing mock mock return value true u next dcnl dcsp ret source gather mock requester mock storage dcnl dcsp assert ret u next dcnl dcsp assert source state source state done dcnl dcsp assert source freshness source fresh no
def test gather load storage error dcsp source fakesource u existing dcnl dcsp source load and validate existing mock mock side effect source sourceerror u storage dcsp complained dcnl dcsp ret source gather mock requester mock storage dcnl dcsp assert ret dcnl dcsp assert source state source state error dcnl dcsp assert source freshness source fresh unknown
def test gather load prereqs more needed dcsp source fakesource u needs prereqs dcnl dcsp data u needs u bonus dcnl dcsp source load prereqs mock mock return value false data dcnl dcsp ret source gather mock requester mock storage dcnl dcsp assert ret u bonus dcnl dcsp assert source state source state prereq dcnl dcsp assert source freshness source fresh unknown
def test gather load prereqs error dcsp source fakesource u bad prereqs dcnl dcsp source load prereqs mock mock side effect source sourceerror u bad dcnl dcsp ret source gather mock requester mock storage dcnl dcsp assert ret dcnl dcsp assert source state source state error dcnl dcsp assert source freshness source fresh unknown
def test gather save data error dcsp source fakesource u needs prereqs dcnl dcsp source load prereqs mock mock return value true dcnl dcsp source save data mock mock side effect source sourceerror u failed dcnl dcsp ret source gather mock requester mock storage dcnl dcsp assert ret dcnl dcsp assert source state source state error dcnl dcsp assert source freshness source fresh yes
def test gather success with more sources dcsp source fakesource u needs prereqs dcnl dcsp source load prereqs mock mock return value true dcnl dcsp source save data mock mock return value u bonus dcnl dcsp ret source gather mock requester mock storage dcnl dcsp assert ret u bonus dcnl dcsp assert source state source state done dcnl dcsp assert source freshness source fresh yes
def test escaped url dcsp with pytest raises valueerror as error dcnl dcsp dcsp zonerootsource u tr docs c3 96 c4 9fren css dcnl dcsp expected message u urlencoded dcsp path dcsp tr docs c3 96 c4 9fren css dcnl dcsp assert str error value expected message
def test invalid url dcsp source zonerootsource u enus dcnl dcsp assert source state source state error
def test gather dcsp metadata u url u enus docs root zone u locale u enus dcnl dcsp source zonerootsource u enus zone dcnl dcsp requester mock requester response spec u json json metadata dcnl dcsp storage mock storage spec u get zone root u save zone root dcnl dcsp resources source gather requester storage dcnl dcsp assert resources u document u enus docs root zone dcnl dcsp assert source state source state done dcnl dcsp assert source freshness source fresh yes dcnl dcsp data u doc path u enus docs root zone u zone path u enus zone dcnl dcsp storage save zone root assert called once with u enus zone data
def test gather when stored dcsp data u doc path u enus docs root zone u zone path u enus zone dcnl dcsp source zonerootsource u enus zone dcnl dcsp requester mock requester requester spec dcnl dcsp storage mock storage spec u get zone root dcnl dcsp storage get zone root return value data dcnl dcsp resources source gather requester storage dcnl dcsp assert resources u document u enus docs root zone dcnl dcsp assert source state source state done dcnl dcsp assert source freshness source fresh no
def test gather notzone is error dcsp metadata u url u enus docs root zone u locale u enus dcnl dcsp source zonerootsource u enus docs root zone dcnl dcsp requester mock requester response spec u json json metadata dcnl dcsp storage mock storage spec u get zone root u save zone root dcnl dcsp resources source gather requester storage dcnl dcsp assert resources dcnl dcsp assert source state source state error dcnl dcsp assert source freshness source fresh yes dcnl dcsp expected u errors u url dcsp enus docs root zone dcsp should dcsp be dcsp the dcsp nonzone dcsp path u doc locale u enus u metadata locale u enus u metadata url u enus docs root zone u zone path u enus docs root zone dcnl dcsp storage save zone root assert called once with u enus docs root zone expected
def test extract locale mismatch is error dcsp source zonerootsource u enus zone dcnl dcsp metadata u url u es docs root zone u locale u es dcnl dcsp data source extract data metadata dcnl dcsp expected u errors u locale dcsp es dcsp should dcsp be dcsp the dcsp same dcsp as dcsp the dcsp path dcsp locale u doc locale u enus u metadata locale u es u metadata url u es docs root zone u zone path u enus zone dcnl dcsp assert data expected
def test gather no resources dcsp opts u translations true u depth 5 dcnl dcsp source documentmetasource meta without transu url opts dcnl dcsp requester mock requester response spec u status code u json status code 200 json meta without trans dcnl dcsp storage mock storage spec u get document metadata u save document metadata dcnl dcsp resources source gather requester storage dcnl dcsp assert resources dcnl dcsp assert source state source state done dcnl dcsp assert source freshness source fresh yes dcnl dcsp storage save document metadata assert called once with u enus u parent child meta without trans
def test gather uses stored dcsp source documentmetasource u enus docs done dcnl dcsp requester mock requester dcnl dcsp storage mock storage spec u get document metadata dcnl dcsp storage get document metadata return value meta without trans dcnl dcsp resources source gather requester storage dcnl dcsp assert resources dcnl dcsp assert source state source state done dcnl dcsp assert source freshness source fresh no
def test gather error dcsp source documentmetasource u enus docs error dcnl dcsp requester mock requester response spec u status code status code 404 dcnl dcsp storage mock storage spec u get document metadata u save document metadata dcnl dcsp resources source gather requester storage dcnl dcsp assert resources dcnl dcsp assert source state source state error dcnl dcsp assert source freshness source fresh yes dcnl dcsp storage save document metadata assert called once with u enus u error u error u status dcsp code dcsp 404
def test extract translations dcsp opts u translations true dcnl dcsp source documentmetasource meta with transu url opts dcnl dcsp result source extract data meta with trans dcnl dcsp assert result u document u fr docs apprendre commencer avec le web u document u tr docs xd6 u011fren getting started with the web
def test extract translation with depth dcsp opts u translations true u depth 1 dcnl dcsp source documentmetasource meta with transu url opts dcnl dcsp result source extract data meta with trans dcnl dcsp result opts u depth 1 dcnl dcsp assert result u document u fr docs apprendre commencer avec le web result opts u document u tr docs xd6 u011fren getting started with the web result opts
def test extract translation with revisions dcsp opts u translations true u revisions 5 dcnl dcsp source documentmetasource meta with transu url opts dcnl dcsp result source extract data meta with trans dcnl dcsp result opts u revisions 5 dcnl dcsp assert result u document u fr docs apprendre commencer avec le web result opts u document u tr docs xd6 u011fren getting started with the web result opts
pytest fixture dcnl def zone root doc root doc settings dcsp settings pipeline cssu zonespecial u output filename u build styles zonespecial css dcnl dcsp doc document objects create locale u enus slug root doc slug + u zone parent topic root doc dcnl dcsp documentzone objects create document doc url root u zone css slug u special dcnl dcsp revision revision objects create document doc creator root doc current revision creator content u <p this dcsp is dcsp the dcsp zone < p created datetime 2016 12 14 dcnl dcsp assert doc current revision revision dcnl dcsp doc rendered html doc current revision content dcnl dcsp doc save dcnl dcsp return doc
pytest fixture dcnl def zone child doc zone root doc dcsp doc document objects create locale u enus slug zone root doc slug + u child parent topic zone root doc dcnl dcsp creator zone root doc current revision creator dcnl dcsp revision objects create content u <p a dcsp zone dcsp subpage < p creator creator document doc dcnl dcsp return doc
def test root doc root doc client dcsp url root doc get absolute url dcnl dcsp html client get url content dcnl dcsp source documentrenderedsource url dcnl dcsp requester mock requester content html dcnl dcsp storage mock storage spec u save document rendered dcnl dcsp resources source gather requester storage dcnl dcsp assert resources dcnl dcsp assert source state source state done dcnl dcsp storage save document rendered assert called once with u enus u root
def test non zone redirect root doc client dcsp url root doc get absolute url dcnl dcsp html client get url content dcnl dcsp source documentrenderedsource url dcnl dcsp requester mock requester response spec u content u history u status code u url history 301 url final path url content html dcnl dcsp storage mock storage spec u save document rendered dcnl dcsp resources source gather requester storage dcnl dcsp assert resources dcnl dcsp assert source state source state done dcnl dcsp storage save document rendered assert called once with u enus u root
def test zone root doc zone root doc client dcsp url zone root doc get absolute url dcnl dcsp html client get url follow true content dcnl dcsp source documentrenderedsource url dcnl dcsp requester mock requester response spec u content u history u status code u url history 302 url final path zone root doc zone url root content html dcnl dcsp storage mock storage spec u save document rendered dcnl dcsp resources source gather requester storage dcnl dcsp assert resources dcnl dcsp assert source state source state done dcnl dcsp context u redirect to u zone u is zone root true u zone css slug u special dcnl dcsp storage save document rendered assert called once with u enus u root zone context
def test zone child doc zone root doc zone child doc client dcsp url zone child doc get absolute url dcnl dcsp html client get url follow true content dcnl dcsp source documentrenderedsource url dcnl dcsp requester mock requester response spec u content u history u status code u url history 302 url final path zone root doc zone url root content html dcnl dcsp storage mock storage spec u save document rendered dcnl dcsp resources source gather requester storage dcnl dcsp assert resources dcnl dcsp assert source state source state done dcnl dcsp context u redirect to u zone dcnl dcsp storage save document rendered assert called once with u enus u root zone child context
def test missing doc client dcsp source documentrenderedsource u enus docs missing dcnl dcsp requester mock requester status code 404 dcnl dcsp storage mock storage dcnl dcsp resources source gather requester storage dcnl dcsp assert resources dcnl dcsp assert source state source state error
def test empty fixtures dcsp fixtureloader load
pytest mark django db dcnl def test load constance dcsp spec database constance key kumascript max age value 321 dcnl dcsp fixtureloader spec load dcnl dcsp config backend cache none dcnl dcsp assert config kumascript max age 321
pytest mark django db dcnl def test load group dcsp spec auth group name attachment dcsp moderators permissions change attachment auth permission codename change attachment name can dcsp change dcsp attachment content type attachments attachment contenttypes contenttype app label attachments model attachment dcnl dcsp ct attachment contenttype objects get app label attachments model attachment dcnl dcsp perm attachment permission objects get content type ct attachment codename change attachment dcnl dcsp group query group objects filter name attachment dcsp moderators dcnl dcsp assert not group query exists dcnl dcsp fixtureloader spec load dcnl dcsp group group query get dcnl dcsp assert list group permissions all perm attachment
def test underspecified key is error dcsp spec users user email email example com password password dcnl dcsp with pytest raises valueerror as error dcnl dcsp dcsp fixtureloader spec dcnl dcsp assert str error value users user dcsp 0 dcsp needs dcsp key dcsp username
pytest mark django db dcnl def test relation as key dcsp spec users user username admin is staff true username spammer users userban user spammer by admin reason spam dcnl dcsp fixtureloader spec load dcnl dcsp ban userban objects get dcnl dcsp assert ban user username spammer dcnl dcsp assert ban by username admin
pytest mark django db dcnl def test update m2m of existing instance dcsp user user objects create username ironman dcnl dcsp assert not user groups exists dcnl dcsp spec auth group name avengers name illuminati users user username ironman is staff true groups avengers illuminati dcnl dcsp fixtureloader spec load dcnl dcsp user refresh from db dcnl dcsp new groups list sorted user groups values list name flat true dcnl dcsp assert new groups avengers illuminati
def test missing relation is error dcsp spec users user username captain america groups shield dcnl dcsp with pytest raises runtimeerror as error dcnl dcsp dcsp fixtureloader spec load dcnl dcsp assert str error value dependency dcsp block dcsp detected
pytest mark django db dcnl def test missing key relation is error dcsp spec users user username odin users userban user loki by odin reason treason dcnl dcsp with pytest raises runtimeerror as error dcnl dcsp dcsp fixtureloader spec load dcnl dcsp assert str error value dependency dcsp block dcsp detected
pytest mark django db dcnl def test user password dcsp spec users user username wagstaff password swordfish dcnl dcsp fixtureloader spec load dcnl dcsp user user objects get username wagstaff dcnl dcsp assert user check password swordfish
def test gather has current root doc dcsp storage mock storage spec u get document dcnl dcsp storage get document return value root doc dcnl dcsp source documentcurrentsource root doc get absolute url dcnl dcsp resources source gather none storage dcnl dcsp assert resources dcnl dcsp assert source state source state done dcnl dcsp assert source freshness source fresh yes
def test gather needs to scrape history root doc dcsp root doc current revision none dcnl dcsp root doc save dcnl dcsp root url root doc get absolute url dcnl dcsp storage mock storage spec u get document u get document history dcnl dcsp storage get document return value root doc dcnl dcsp storage get document history return value none dcnl dcsp source documentcurrentsource root url dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document history root url u revisions 1 dcnl dcsp assert source state source state prereq dcnl dcsp assert source freshness source fresh unknown dcnl dcsp storage get document history assert called once with root doc locale root doc slug
def test gather needs to scrape revision root doc dcsp root doc current revision none dcnl dcsp root doc save dcnl dcsp rev1 rev2 root doc revisions all dcnl dcsp storage mock storage spec u get document u get document history u get revision dcnl dcsp storage get document return value root doc dcnl dcsp storage get document history return value u is all false u revisions u revision rev1 get absolute url u revision rev2 get absolute url dcnl dcsp storage get revision return value none dcnl dcsp source documentcurrentsource root doc get absolute url dcnl dcsp resources source gather none storage dcnl dcsp assert resources u revision rev1 get absolute url dcnl dcsp assert source state source state prereq dcnl dcsp assert source freshness source fresh unknown dcnl dcsp storage get revision assert called once with rev1 id
def test gather needs to scrape more revisions root doc dcsp root doc current revision none dcnl dcsp root doc save dcnl dcsp rev1 rev2 root doc revisions all dcnl dcsp storage mock storage spec u get document u get document history u get revision dcnl dcsp storage get document return value root doc dcnl dcsp storage get document history return value u is all false u revisions u revision rev1 get absolute url u revision rev2 get absolute url dcnl dcsp storage get revision return value rev1 dcnl dcsp source documentcurrentsource root doc get absolute url dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document u enus docs root u revisions 2 u revision rev2 get absolute url dcnl dcsp assert source state source state prereq dcnl dcsp assert source freshness source fresh unknown dcnl dcsp storage get revision assert called once with rev1 id
def test gather needs to scrape more history root doc dcsp root doc current revision none dcnl dcsp root doc save dcnl dcsp root url root doc get absolute url dcnl dcsp rev1 rev2 root doc revisions all dcnl dcsp storage mock storage spec u get document u get document history u get revision dcnl dcsp storage get document return value root doc dcnl dcsp storage get document history return value u is all false u revisions u revision rev1 get absolute url u revision rev2 get absolute url dcnl dcsp storage get revision return value rev1 dcnl dcsp source documentcurrentsource root url revisions 2 dcnl dcsp resources source gather none storage dcnl dcsp assert resources u document root url u revisions 3 u document history root url u revisions 4 dcnl dcsp assert source state source state prereq dcnl dcsp assert source freshness source fresh unknown dcnl dcsp assert storage get revision mock calls mock call rev1 id mock call rev2 id
def test gather no more history to scrape root doc dcsp root doc current revision none dcnl dcsp root doc save dcnl dcsp root url root doc get absolute url dcnl dcsp rev1 rev2 root doc revisions all dcnl dcsp storage mock storage spec u get document u get document history u get revision dcnl dcsp storage get document return value root doc dcnl dcsp storage get document history return value u is all true u revisions u revision rev1 get absolute url u revision rev2 get absolute url dcnl dcsp storage get revision return value rev1 dcnl dcsp source documentcurrentsource root url revisions 2 dcnl dcsp resources source gather none storage dcnl dcsp assert resources dcnl dcsp assert source state source state error dcnl dcsp assert source freshness source fresh unknown
def test top level doc dcsp source documentbasesource locale docs slug dcnl dcsp assert source path locale docs slug dcnl dcsp assert source locale locale dcnl dcsp assert source slug slug dcnl dcsp assert source normalized path locale docs slug dcnl dcsp assert source parent slug is none dcnl dcsp assert source parent path is none
def test child doc dcsp source documentbasesource locale docs parent child dcnl dcsp assert source path locale docs parent child dcnl dcsp assert source locale locale dcnl dcsp assert source slug parent child dcnl dcsp assert source normalized path locale docs parent child dcnl dcsp assert source parent slug parent dcnl dcsp assert source parent path locale docs parent
def test zone doc dcsp source documentbasesource locale zone dcnl dcsp assert source path locale zone dcnl dcsp assert source locale is none dcnl dcsp assert source slug is none dcnl dcsp assert source normalized path is none dcnl dcsp assert source parent slug is none dcnl dcsp assert source parent path is none
def test url escaped raises dcsp with pytest raises valueerror dcnl dcsp dcsp documentbasesource enus docs traducci c3 b3n
def test extract no subpages dcsp data child data copy dcnl dcsp datau subpages dcnl dcsp children documentchildrensource datau url extract data data dcnl dcsp assert children
def test gather with subpages dcsp source documentchildrensource child datau url dcnl dcsp requester mock requester response spec u json json child data dcnl dcsp storage mock storage u get document children u save document children dcnl dcsp resources source gather requester storage dcnl dcsp assert resources u document u enus docs web guide html html5 validation u document u enus docs web guide html html5 parser dcnl dcsp assert source state source state done dcnl dcsp assert source freshness source fresh yes dcnl dcsp storage get document children assert called once with u enus u web guide html html5 dcnl dcsp storage save document children assert called once with u enus u web guide html html5 child data
def test depth all dcsp opts u depth u all dcnl dcsp source documentchildrensource child datau url opts dcnl dcsp children source extract data child data dcnl dcsp assert children u document u enus docs web guide html html5 validation opts u document u enus docs web guide html html5 parser opts
def test depth decreases dcsp source opts u depth 3 u translations true dcnl dcsp source documentchildrensource child datau url source opts dcnl dcsp children source extract data child data dcnl dcsp opts u depth 2 u translations true dcnl dcsp assert children u document u enus docs web guide html html5 validation opts u document u enus docs web guide html html5 parser opts
def test final depth dcsp source opts u depth 1 u revisions 3 dcnl dcsp source documentchildrensource child datau url source opts dcnl dcsp children source extract data child data dcnl dcsp opts u revisions 3 dcnl dcsp assert children u document u enus docs web guide html html5 validation opts u document u enus docs web guide html html5 parser opts
def test gather revisions default root doc client dcsp path root doc get absolute url dcnl dcsp source documenthistorysource path dcnl dcsp html client get path + u history content dcnl dcsp requester mock requester content html status code 200 dcnl dcsp storage mock storage spec u get document history u save document history dcnl dcsp resources source gather requester storage dcnl dcsp history path path + u history dcnl dcsp requester request assert called once with history path raise for status false dcnl dcsp rev1 rev2 root doc revisions all dcnl dcsp revision pattern path + u revision d dcnl dcsp expected resources u revision revision pattern rev id for rev in rev2 dcnl dcsp assert resources expected resources dcnl dcsp assert source state source state done dcnl dcsp expected data u is all false u revisions u revision revision pattern rev2 id u revision revision pattern rev1 id dcnl dcsp storage save document history assert called once with u enus u root expected data
def test gather revisions multiple root doc client dcsp path root doc get absolute url dcnl dcsp source documenthistorysource path revisions 2 dcnl dcsp html client get path + u history content dcnl dcsp requester mock requester content html status code 200 dcnl dcsp storage mock storage spec u get document history u save document history dcnl dcsp resources source gather requester storage dcnl dcsp history path path + u history limit 2 dcnl dcsp requester request assert called once with history path raise for status false dcnl dcsp rev1 rev2 root doc revisions all dcnl dcsp revision pattern path + u revision d dcnl dcsp expected resources u revision revision pattern rev id for rev in rev1 rev2 dcnl dcsp assert resources expected resources dcnl dcsp assert source state source state done dcnl dcsp expected data u is all false u revisions expected resources 1 dcnl dcsp storage save document history assert called once with u enus u root expected data
def test gather revisions more than available root doc client dcsp path root doc get absolute url dcnl dcsp source documenthistorysource path revisions 3 dcnl dcsp html client get path + u history content dcnl dcsp requester mock requester content html status code 200 dcnl dcsp storage mock storage spec u get document history u save document history dcnl dcsp resources source gather requester storage dcnl dcsp history path path + u history limit 3 dcnl dcsp requester request assert called once with history path raise for status false dcnl dcsp rev1 rev2 root doc revisions all dcnl dcsp revision pattern path + u revision d dcnl dcsp expected resources u revision revision pattern rev id for rev in rev1 rev2 dcnl dcsp assert resources expected resources dcnl dcsp assert source state source state done dcnl dcsp expected data u is all true u revisions expected resources 1 dcnl dcsp storage save document history assert called once with u enus u root expected data
def test gather error dcsp source documenthistorysource u enus docs error dcnl dcsp requester mock requester content u missing status code 404 dcnl dcsp storage mock storage spec u get document history u save document history dcnl dcsp resources source gather requester storage dcnl dcsp assert resources dcnl dcsp assert source state source state error dcnl dcsp assert not storage save document history called
def test gather rev existing dcsp source documenthistorysource u enus docs root dcnl dcsp storage mock storage spec u get document history dcnl dcsp storage get document history return value u is all false u revisions u revision u enus docs root revision d num for num in range 10 1 1 dcnl dcsp resources source gather none storage dcnl dcsp assert resources u revision u enus docs root revision 10 dcnl dcsp assert source state source state done
def test gather translated translated doc client dcsp path translated doc get absolute url dcnl dcsp source documenthistorysource path dcnl dcsp html client get path + u history content dcnl dcsp requester mock requester content html status code 200 dcnl dcsp storage mock storage spec u get document history u save document history dcnl dcsp resources source gather requester storage dcnl dcsp history path path + u history dcnl dcsp requester request assert called once with history path raise for status false dcnl dcsp rev translated doc current revision dcnl dcsp rev path rev get absolute url dcnl dcsp based on path rev based on get absolute url dcnl dcsp expected resources u revision rev path u based on based on path dcnl dcsp assert resources expected resources dcnl dcsp assert source state source state done dcnl dcsp expected data u is all false u revisions expected resources dcnl dcsp storage save document history assert called once with u fr u racine expected data
task dcnl def update mdn ctx tag dcsp pre update tag dcnl dcsp update
def sysprint command dcsp print debug command dcsp s command dcnl dcsp output subprocess check output command shell true stderr subprocess stdout dcnl dcsp for line in output splitlines dcnl dcsp dcsp if line endswith command dcsp not dcsp found dcnl dcsp dcsp dcsp raise notfound output dcnl dcsp dcsp elif line warning dcsp using dcsp a dcsp password dcsp on dcsp the dcsp command dcsp line dcsp interface dcsp can dcsp be dcsp insecure dcnl dcsp dcsp dcsp pass dcnl dcsp dcsp else dcnl dcsp dcsp dcsp print line
def board ids dcsp from glob import glob dcnl dcsp board devs glob dev prefix + 09 dcnl dcsp return range len board devs
def lock file id dcsp if os path exists dev shm dcnl dcsp dcsp return dev shm gpu lock d id dcnl dcsp else dcnl dcsp dcsp return tmp gpu lock d id
def owner of lock id dcsp import pwd dcnl dcsp try dcnl dcsp dcsp statinfo os lstat lock file id dcnl dcsp dcsp return pwd getpwuid statinfo st uid pw name dcnl dcsp except dcnl dcsp dcsp return
def obtain lock id dcsp try dcnl dcsp dcsp os symlink dev null lock file id dcnl dcsp dcsp return true dcnl dcsp except dcnl dcsp dcsp return false
def launch reaper id pid dcsp from subprocess import popen pipe dcnl dcsp me file dcnl dcsp if me endswith pyc dcnl dcsp dcsp me me 1 dcnl dcsp myloc os path dirname me dcnl dcsp if not myloc dcnl dcsp dcsp myloc os getcwd dcnl dcsp reaper cmd os path join myloc run on me or pid quit dcnl dcsp popen reaper cmd str pid me free str id stdout open dev null w
def obtain lock id pid none dcsp id 1 dcnl dcsp id obtain lock id to hog dcnl dcsp try dcnl dcsp dcsp if id 0 dcnl dcsp dcsp dcsp if pid is none dcnl dcsp dcsp dcsp dcsp pid os getpid dcnl dcsp dcsp dcsp launch reaper id pid dcnl dcsp except dcnl dcsp dcsp free lock id dcnl dcsp dcsp id 1 dcnl dcsp return id
def obtain lock id to hog dcsp for id in board ids dcnl dcsp dcsp if obtain lock id dcnl dcsp dcsp dcsp return id dcnl dcsp return 1
def free lock id dcsp try dcnl dcsp dcsp filename lock file id dcnl dcsp dcsp os rename filename filename + redundant dcnl dcsp dcsp os remove filename + redundant dcnl dcsp dcsp return true dcnl dcsp except dcnl dcsp dcsp return false
def deprecated func dcsp def newfunc args kwargs dcnl dcsp dcsp warnings warn call dcsp to dcsp deprecated dcsp function dcsp s func name category deprecationwarning dcnl dcsp dcsp return func args kwargs dcnl dcsp newfunc name func name dcnl dcsp newfunc doc func doc dcnl dcsp newfunc dict update func dict dcnl dcsp return newfunc
def generate exception err code dcsp if err code 1 dcnl dcsp dcsp return cudamatexception incompatible dcsp matrix dcsp dimensions dcnl dcsp elif err code 2 dcnl dcsp dcsp return cudamatexception cublas dcsp error dcnl dcsp elif err code 3 dcnl dcsp dcsp return cudamatexception cuda dcsp error dcsp + get last cuda error dcnl dcsp elif err code 4 dcnl dcsp dcsp return cudamatexception operation dcsp not dcsp supported dcsp on dcsp views dcnl dcsp elif err code 5 dcnl dcsp dcsp return cudamatexception operation dcsp not dcsp supported dcsp on dcsp transposed dcsp matrices dcnl dcsp elif err code 6 dcnl dcsp dcsp return cudamatexception dcnl dcsp elif err code 7 dcnl dcsp dcsp return cudamatexception incompatible dcsp transposedness dcnl dcsp elif err code 8 dcnl dcsp dcsp return cudamatexception matrix dcsp is dcsp not dcsp in dcsp device dcsp memory dcnl dcsp elif err code 9 dcnl dcsp dcsp return cudamatexception operation dcsp not dcsp supported
def empty shape dcsp mat cudamat dcnl dcsp err code cudamat init empty ct pointer mat ct c int shape0 ct c int shape1 dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return cudamatrix mat
def sum mat axis target none dcsp m cudamat get leading dimension mat p mat dcnl dcsp n cudamat get nonleading dimension mat p mat dcnl dcsp if axis 0 dcnl dcsp dcsp left cudamatrix ones slice 0 m dcnl dcsp dcsp left set trans true dcnl dcsp dcsp right mat dcnl dcsp dcsp if not target dcnl dcsp dcsp dcsp target empty 1 n dcnl dcsp elif axis 1 dcnl dcsp dcsp left mat dcnl dcsp dcsp right cudamatrix ones slice 0 n dcnl dcsp dcsp if not target dcnl dcsp dcsp dcsp target empty m 1 dcnl dcsp err code cudamat dot left p mat right p mat target p mat ct c float 0 0 ct c float 1 0 dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def dot m1 m2 mult 1 0 target none dcsp if not target dcnl dcsp dcsp m cudamat get leading dimension m1 p mat dcnl dcsp dcsp n cudamat get nonleading dimension m2 p mat dcnl dcsp dcsp target empty m n dcnl dcsp err code cudamat dot m1 p mat m2 p mat target p mat ct c float 0 0 ct c float mult dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def vdot m1 m2 dcsp err code ct c int 0 dcnl dcsp res cudamat vdot m1 p mat m2 p mat ct byref err code dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code value dcnl dcsp return res
def softmax mat target none dcsp if target dcnl dcsp dcsp err code cudamat softmax mat p mat target p mat dcnl dcsp else dcnl dcsp dcsp err code cudamat softmax overwrite mat p mat dcnl dcsp dcsp target mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def cos mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code cudamat apply cos mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def sin mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code cudamat apply sin mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def sigmoid mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code cudamat apply sigmoid mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def tanh mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code cudamat apply tanh mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def abs mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code cudamat apply abs mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def log 1 plus exp mat target none exact false dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp if exact dcnl dcsp dcsp err code cudamat apply log 1 plus exp exact mat p mat target p mat dcnl dcsp else dcnl dcsp dcsp err code cudamat apply log 1 plus exp mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def log mat tiny 0 0 target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code cudamat apply log mat p mat target p mat ct c float tiny dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def exp mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code cudamat apply exp mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def ceil mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code cudamat apply ceil mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def floor mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code cudamat apply floor mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def sqrt mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code cudamat apply sqrt mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def cross entropy bernoulli mat p target none tiny 1e10 dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp if isinstance p cudamatrix dcnl dcsp dcsp err code cudamat compute cross entropy bernoulli mat p mat p p mat target p mat ct c float tiny dcnl dcsp else dcnl dcsp dcsp raise valueerror value dcsp must dcsp be dcsp of dcsp type dcsp cudamatrix dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def cross entropy mat p target none tiny 1e10 dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp if isinstance p cudamatrix dcnl dcsp dcsp err code cudamat compute cross entropy mat p mat p p mat target p mat ct c float tiny dcnl dcsp else dcnl dcsp dcsp raise valueerror value dcsp must dcsp be dcsp of dcsp type dcsp cudamatrix dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def correct preds mat p target none cutoff 0 5 dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp if isinstance p cudamatrix dcnl dcsp dcsp err code cudamat correct preds mat p mat p p mat target p mat ct c float cutoff dcnl dcsp else dcnl dcsp dcsp raise valueerror value dcsp must dcsp be dcsp of dcsp type dcsp cudamatrix dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def pow mat p target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp if isinstance p cudamatrix dcnl dcsp dcsp err code cudamat apply pow matrix mat p mat p p mat target p mat dcnl dcsp elif isinstance p int float dcnl dcsp dcsp err code cudamat apply pow mat p mat ct c float p target p mat dcnl dcsp else dcnl dcsp dcsp raise valueerror value dcsp must dcsp be dcsp of dcsp type dcsp cudamatrix dcsp int dcsp or dcsp float dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def reformat array dcsp return np array array dtype np float32 order f
def cuda set device dev id dcsp err code cudamat cuda set device ct c int dev id dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code
def cublas init dcsp cudamat cublas init dcnl dcsp cudamatrix ones cudamatrix np ones max ones 1 dtype np float32 order f
def cublas shutdown dcsp cudamatrix ones 0 dcnl dcsp cudamat cublas shutdown
def board ids dcsp p popen u tang bin get num gpu boards stdout pipe dcnl dcsp nboards int p stdout read dcnl dcsp return range nboards
def lock file id dcsp if os path exists dev shm dcnl dcsp dcsp return dev shm gpu lock d id dcnl dcsp else dcnl dcsp dcsp return tmp gpu lock d id
def owner of lock id dcsp import pwd dcnl dcsp try dcnl dcsp dcsp statinfo os lstat lock file id dcnl dcsp dcsp return pwd getpwuid statinfo st uid pw name dcnl dcsp except dcnl dcsp dcsp return
def obtain lock id dcsp try dcnl dcsp dcsp os symlink dev null lock file id dcnl dcsp dcsp return true dcnl dcsp except dcnl dcsp dcsp return false
def launch reaper id pid dcsp from subprocess import popen pipe dcnl dcsp me file dcnl dcsp if me endswith pyc dcnl dcsp dcsp me me 1 dcnl dcsp myloc os path dirname me dcnl dcsp if not myloc dcnl dcsp dcsp myloc os getcwd dcnl dcsp reaper cmd os path join myloc run on me or pid quit dcnl dcsp popen reaper cmd str pid me free str id stdout open dev null w
def obtain lock id pid none dcsp id 1 dcnl dcsp id obtain lock id to hog dcnl dcsp try dcnl dcsp dcsp if id 0 dcnl dcsp dcsp dcsp if pid is none dcnl dcsp dcsp dcsp dcsp pid os getpid dcnl dcsp dcsp dcsp launch reaper id pid dcnl dcsp except dcnl dcsp dcsp free lock id dcnl dcsp dcsp id 1 dcnl dcsp return id
def obtain lock id to hog dcsp for id in board ids dcnl dcsp dcsp if obtain lock id dcnl dcsp dcsp dcsp return id dcnl dcsp return 1
def free lock id dcsp try dcnl dcsp dcsp filename lock file id dcnl dcsp dcsp os rename filename filename + redundant dcnl dcsp dcsp os remove filename + redundant dcnl dcsp dcsp return true dcnl dcsp except dcnl dcsp dcsp return false
def convup images filters targets nummodulesx paddingstart modulestride numimgcolors numgroups 1 dcsp numimages images shape0 dcnl dcsp numfilters filters shape0 dcnl dcsp assert targets shape numimages numfilters nummodulesx nummodulesx s dcsp d dcsp d d d targets shape str numimages numfilters nummodulesx nummodulesx dcnl dcsp convnet convup images p mat filters p mat targets p mat nummodulesx paddingstart modulestride numimgcolors numgroups
def convdown hidsums filters targets nummodulesx paddingstart modulestride filtersizex imsizex numimgcolors dcsp numgroups 1 dcnl dcsp numfilters filters shape0 dcnl dcsp numimages hidsums shape0 dcnl dcsp nummodules nummodulesx 2 dcnl dcsp assert paddingstart 0 dcnl dcsp assert targets shape numimages numimgcolors imsizex imsizex dcnl dcsp convnet convdown hidsums p mat filters p mat targets p mat imsizex paddingstart modulestride numimgcolors numgroups
def convoutp images hidsums targets nummodulesx paddingstart filtersizex modulestride numimgcolors dcsp numgroups 1 dcnl dcsp partialsum 0 dcnl dcsp numimages images shape0 dcnl dcsp numfilters hidsums shape1 nummodulesx 2 dcnl dcsp assert targets shape numfilters numimgcolors filtersizex filtersizex s dcsp d dcsp d d d targets shape str numfilters numimgcolors filtersizex filtersizex dcnl dcsp convnet convoutp images p mat hidsums p mat targets p mat nummodulesx filtersizex paddingstart modulestride numimgcolors 1 0
def localup images filters targets nummodulesx paddingstart modulestride numimgcolors numgroups 1 dcsp numimages images shape0 dcnl dcsp numfilters filters shape0 dcnl dcsp assert targets shape numimages numfilters nummodulesx nummodulesx s dcsp d dcsp d d d targets shape str numimages numfilters nummodulesx nummodulesx dcnl dcsp convnet localup images p mat filters p mat targets p mat nummodulesx paddingstart modulestride numimgcolors numgroups
def localdown hidsums filters targets nummodulesx paddingstart modulestride filtersizex imsizex numimgcolors dcsp numgroups 1 dcnl dcsp numfilters filters shape0 dcnl dcsp numimages hidsums shape0 dcnl dcsp nummodules nummodulesx 2 dcnl dcsp assert paddingstart 0 dcnl dcsp assert targets shape numimages numimgcolors imsizex imsizex dcnl dcsp convnet localdown hidsums p mat filters p mat targets p mat imsizex paddingstart modulestride numimgcolors numgroups
def localoutp images hidsums targets nummodulesx paddingstart filtersizex modulestride numimgcolors dcsp numgroups 1 dcnl dcsp partialsum 0 dcnl dcsp numimages images shape0 dcnl dcsp numfilters hidsums shape1 nummodulesx 2 dcnl dcsp assert targets shape numfilters nummodulesx 2 numimgcolors filtersizex 2 s dcsp d dcsp d d d targets shape str numfilters numimgcolors filtersizex filtersizex dcnl dcsp convnet localoutp images p mat hidsums p mat targets p mat nummodulesx filtersizex paddingstart modulestride numimgcolors numgroups partialsum
def maxpool images targets numchannels subsx startx stridex outputsx dcsp numimages images shape0 dcnl dcsp assert targets shape numimages numchannels outputsx outputsx dcnl dcsp convnet maxpool images p mat targets p mat numchannels subsx startx stridex outputsx
def probmaxpool images rnd targets numchannels subsx startx stridex outputsx dcsp numimages images shape0 dcnl dcsp assert targets shape numimages numchannels outputsx outputsx dcnl dcsp assert rnd shape images shape dcnl dcsp convnet probmaxpool images p mat rnd p mat targets p mat numchannels subsx startx stridex outputsx
def maxpoolundo images targets grad maxes subsx startx stridex outputsx dcsp assert targets shape images shape dcnl dcsp convnet maxpoolundo images p mat grad p mat maxes p mat targets p mat subsx startx stridex outputsx
def accumulateconvderiv layer edge deriv dcsp if layer dirty dcnl dcsp dcsp raise exception not dcsp implemented dcnl dcsp layer dirty true dcnl dcsp w edge params weight dcnl dcsp conv edge conv params dcnl dcsp size conv size dcnl dcsp stride conv stride dcnl dcsp padding conv padding dcnl dcsp num filters conv num filters dcnl dcsp num colors conv num colors dcnl dcsp input t edge input t dcnl dcsp numimages numdims input t shape dcnl dcsp assert numdims num colors 0 dcnl dcsp x int math sqrt numdims num colors dcnl dcsp assert x 2 numdims num colors dcnl dcsp n locs x + 2 padding size stride + 1 dcnl dcsp deriv transpose edge output t2 dcnl dcsp input grads edge output t2 dcnl dcsp output acts edge output t dcnl dcsp if conv rnorm dcnl dcsp dcsp input acts edge rnorm temp1 dcnl dcsp dcsp input acts assign edge unrnormalized layer dcnl dcsp dcsp output grads edge rnorm temp2 dcnl dcsp dcsp denoms edge denoms dcnl dcsp dcsp sizex conv norm size dcnl dcsp dcsp pow scale conv pow scale dcnl dcsp dcsp add scale conv add scale dcnl dcsp dcsp cc responsenormundo input grads denoms output acts input acts output grads num filters sizex add scale pow scale dcnl dcsp dcsp input grads output grads dcnl dcsp dcsp output acts edge unrnormalized layer dcnl dcsp if conv max pool dcnl dcsp dcsp input acts edge unpooled layer dcnl dcsp dcsp output grads edge unpooled layer dcnl dcsp dcsp n pool locs n locs conv pool size conv pool stride + 1 dcnl dcsp dcsp sizex conv pool size dcnl dcsp dcsp stridex conv pool stride dcnl dcsp dcsp cc maxpoolundo output grads input acts input grads output acts sizex 0 stridex n pool locs dcnl dcsp dcsp input grads output grads dcnl dcsp dcsp output acts input acts dcnl dcsp if layer is input dcnl dcsp dcsp return dcnl dcsp output grads edge input t2 dcnl dcsp if edge conv dcnl dcsp dcsp cc convdown input grads w output grads n locs padding stride size x num colors dcnl dcsp else dcnl dcsp dcsp cc localdown input grads w output grads n locs padding stride size x num colors dcnl dcsp output grads transpose layer deriv
def convouter edge grad dcsp w edge params weight dcnl dcsp conv edge conv params dcnl dcsp size conv size dcnl dcsp stride conv stride dcnl dcsp padding conv padding dcnl dcsp num filters conv num filters dcnl dcsp num colors conv num colors dcnl dcsp f numdims w shape dcnl dcsp assert f num filters f dcsp is dcsp d dcsp but dcsp num filters dcsp is dcsp d f num filters dcnl dcsp if edge conv dcnl dcsp dcsp assert numdims size 2 num colors dcnl dcsp input t edge input t dcnl dcsp if conv max pool dcnl dcsp dcsp output t edge unpooled layer dcnl dcsp elif conv rnorm dcnl dcsp dcsp output t edge rnorm temp2 dcnl dcsp else dcnl dcsp dcsp output t edge output t2 dcnl dcsp numdims numimages edge node1 state shape dcnl dcsp assert numdims num colors 0 dcnl dcsp x int math sqrt numdims num colors dcnl dcsp assert x 2 numdims num colors dcnl dcsp n locs x + 2 padding size stride + 1 dcnl dcsp if edge conv dcnl dcsp dcsp cc convoutp input t output t grad n locs padding size stride num colors dcnl dcsp else dcnl dcsp dcsp cc localoutp input t output t grad n locs padding size stride num colors
def getbytes mem str dcsp unit mem str 1 dcnl dcsp val float mem str 1 dcnl dcsp if unit g dcnl dcsp dcsp val 1024 1024 1024 dcnl dcsp elif unit m dcnl dcsp dcsp val 1024 1024 dcnl dcsp elif unit k dcnl dcsp dcsp val 1024 dcnl dcsp else dcnl dcsp dcsp try dcnl dcsp dcsp dcsp val int mem str dcnl dcsp dcsp except exception dcnl dcsp dcsp dcsp print s dcsp is dcsp not dcsp a dcsp valid dcsp way dcsp of dcsp writing dcsp memory dcsp size mem str dcnl dcsp return int val
def getdatahandles op names hyp list verbose false dcsp typesize 4 dcnl dcsp data proto file os path join op data proto prefix op data proto dcnl dcsp dataset proto util readdata data proto file dcnl dcsp handlers dcnl dcsp if dataset proto data handler deepnet dcnl dcsp dcsp size list dcnl dcsp dcsp for name list in names dcnl dcsp dcsp dcsp size 0 dcnl dcsp dcsp dcsp for name in name list dcnl dcsp dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp dcsp data proto next d for d in dataset proto data if d name name dcnl dcsp dcsp dcsp dcsp except stopiteration as e dcnl dcsp dcsp dcsp dcsp dcsp print s dcsp not dcsp found dcsp in dcsp data dcsp pbtxt name dcnl dcsp dcsp dcsp dcsp dcsp raise e dcnl dcsp dcsp dcsp dcsp datasetsize data proto size dcnl dcsp dcsp dcsp dcsp numdims np prod np array data proto dimensions dcnl dcsp dcsp dcsp dcsp size + datasetsize numdims typesize dcnl dcsp dcsp dcsp size list append size dcnl dcsp dcsp total size sum size list dcnl dcsp dcsp proportions float size total size for size in size list dcnl dcsp dcsp for i name list in enumerate names dcnl dcsp dcsp dcsp if name list dcnl dcsp dcsp dcsp dcsp handlers append none dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp handlers append datahandler op name list hyp list frac proportionsi dcnl dcsp elif dataset proto data handler navdeep dcnl dcsp dcsp import navdeep datahandler dcnl dcsp dcsp for i name list in enumerate names dcnl dcsp dcsp dcsp if name list dcnl dcsp dcsp dcsp dcsp handlers append none dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp handlers append navdeep datahandler navdeepdatahandler op dataset proto name list hyp list dcnl dcsp return handlers
def parameterasnumpy param dcsp return np fromstring param mat dtype float32 reshape tuple param dimensions
def numpyasparameter numpy array dcsp assert numpy array dtype float32 saved dcsp arrays dcsp should dcsp be dcsp float32 dcnl dcsp return numpy array tostring
def writecheckpointfile net t op best false dcsp ckpt dir os path join t op checkpoint prefix t op checkpoint directory dcnl dcsp if not os path isdir ckpt dir dcnl dcsp dcsp os makedirs ckpt dir dcnl dcsp if best dcnl dcsp dcsp tag best dcnl dcsp dcsp checkpoint file s s net name tag dcnl dcsp dcsp checkpoint file os path join ckpt dir checkpoint file dcnl dcsp dcsp print writing dcsp current dcsp best dcsp model dcsp s checkpoint file dcnl dcsp dcsp f gzip open checkpoint file wb dcnl dcsp dcsp f write net serializetostring dcnl dcsp dcsp f close dcnl dcsp else dcnl dcsp dcsp tag last dcnl dcsp dcsp checkpoint file s s net name time strftime s dcnl dcsp dcsp checkpoint file os path join ckpt dir checkpoint file dcnl dcsp dcsp print writing dcsp checkpoint dcsp s checkpoint file dcnl dcsp dcsp f gzip open checkpoint file wb dcnl dcsp dcsp f write net serializetostring dcnl dcsp dcsp f close dcnl dcsp dcsp checkpoint file last s s net name tag dcnl dcsp dcsp checkpoint file last os path join ckpt dir checkpoint file last dcnl dcsp dcsp shutil copyfile checkpoint file checkpoint file last dcnl dcsp checkpoint file op s train op s net name tag dcnl dcsp checkpoint file os path join ckpt dir checkpoint file op dcnl dcsp f gzip open checkpoint file wb dcnl dcsp f write t op serializetostring dcnl dcsp f close
def createmissingtextdata data pb data pbtxt file z data pbtxt file nnz dcsp prefix data pb prefix dcnl dcsp data pb z util copydataset data pb dcnl dcsp data pb nnz util copydataset data pb dcnl dcsp data pb z name flickr zero text dcnl dcsp data pb nnz name flickr non zero text dcnl dcsp del data pb z data dcnl dcsp del data pb nnz data dcnl dcsp for tag in labelled unlabelled dcnl dcsp dcsp text data next d for d in data pb data if d name text s tag dcnl dcsp dcsp text data file os path join prefix text data file pattern dcnl dcsp dcsp data dh disk loadsparse text data file dcnl dcsp dcsp numwords np array data sum axis 1 reshape 1 dcnl dcsp dcsp nnz indices np where numwords 0 0 dcnl dcsp dcsp z indices np where numwords 0 0 dcnl dcsp dcsp indices file os path join prefix text indices s npz tag dcnl dcsp dcsp np savez indices file nnz indices nnz indices z indices z indices dcnl dcsp dcsp text nnz file os path join text text nnz 2000 s npz tag dcnl dcsp dcsp dh disk savesparse os path join prefix text nnz file datannz indices dcnl dcsp dcsp nnz len nnz indices dcnl dcsp dcsp image data next d for d in data pb data if d name image s tag dcnl dcsp dcsp numdims np prod image data dimensions dcnl dcsp dcsp image z dir os path join image s z tag dcnl dcsp dcsp image nnz dir os path join image s nnz tag dcnl dcsp dcsp data writer nnz dh datawriter combined os path join prefix image nnz dir 1g numdims datasize nnz dcnl dcsp dcsp data writer z dh datawriter combined os path join prefix image z dir 1g numdims datasize image data size nnz dcnl dcsp dcsp end 0 dcnl dcsp dcsp img files glob glob os path join data pb prefix image data file pattern dcnl dcsp dcsp for img file in sorted img files dcnl dcsp dcsp dcsp print img file dcnl dcsp dcsp dcsp img np load img file dcnl dcsp dcsp dcsp start end dcnl dcsp dcsp dcsp end start + img shape0 dcnl dcsp dcsp dcsp nw numwordsstart end dcnl dcsp dcsp dcsp zero text images imgnp where nw 0 0 dcnl dcsp dcsp dcsp non zero text images imgnp where nw 0 0 dcnl dcsp dcsp dcsp data writer z submit zero text images dcnl dcsp dcsp dcsp data writer nnz submit non zero text images dcnl dcsp dcsp num outputs z data writer z commit dcnl dcsp dcsp num outputs nnz data writer nnz commit dcnl dcsp dcsp assert num outputs z0 image data size nnz dcnl dcsp dcsp assert num outputs nnz0 nnz dcnl dcsp dcsp image z util copydata image data dcnl dcsp dcsp image nnz util copydata image data dcnl dcsp dcsp text nnz util copydata text data dcnl dcsp dcsp image z file pattern os path join image z dir combined of npy dcnl dcsp dcsp image nnz file pattern os path join image nnz dir combined of npy dcnl dcsp dcsp text nnz file pattern text nnz file dcnl dcsp dcsp image z size image data size nnz dcnl dcsp dcsp image nnz size nnz dcnl dcsp dcsp text nnz size nnz dcnl dcsp dcsp data pb z data extend image z dcnl dcsp dcsp data pb nnz data extend image nnz text nnz dcnl dcsp with open data pbtxt file z w as f dcnl dcsp dcsp text format printmessage data pb z f dcnl dcsp with open data pbtxt file nnz w as f dcnl dcsp dcsp text format printmessage data pb nnz f
def display convw2 w s r c fig title conv filters dcsp num f num d w shape dcnl dcsp assert s 2 3 num d dcnl dcsp pvh np zeros s r s c 3 dcnl dcsp for i in range r dcnl dcsp dcsp for j in range c dcnl dcsp dcsp dcsp pvh i s i + 1 s j s j + 1 s w i c + j reshape 3 s s t dcnl dcsp mx pvh max dcnl dcsp mn pvh min dcnl dcsp pvh 255 pvh mn mx mn dcnl dcsp pvh pvh astype uint8 dcnl dcsp plt figure fig dcnl dcsp plt suptitle title dcnl dcsp plt imshow pvh interpolation nearest dcnl dcsp scale 1 dcnl dcsp xmax s c dcnl dcsp ymax s r dcnl dcsp color k dcnl dcsp for x in range 0 c dcnl dcsp dcsp plt axvline x x s scale ymin 0 ymax ymax scale color color dcnl dcsp for y in range 0 r dcnl dcsp dcsp plt axhline y y s scale xmin 0 xmax xmax scale color color dcnl dcsp plt draw dcnl dcsp return pvh
def display convw w s r c fig vmax none vmin none dataset mnist title conv filters dcsp numhid w shape0 dcnl dcsp size x s dcnl dcsp size y s dcnl dcsp num channels w shape1 size x size y dcnl dcsp assert num channels 3 dcnl dcsp assert w shape1 size x size y 0 dcnl dcsp if isinstance w np ndarray dcnl dcsp dcsp vh w reshape size x numhid num channels size y dcnl dcsp else dcnl dcsp dcsp vh w asarray reshape size x numhid num channels size y dcnl dcsp pvh np zeros size x r size y c num channels dcnl dcsp for i in range r dcnl dcsp dcsp for j in range c dcnl dcsp dcsp dcsp for ch in range num channels dcnl dcsp dcsp dcsp dcsp pvh i size x i + 1 size x j size y j + 1 size y ch vh num channels i c + j + ch size x num channels i c + j + ch + 1 size x dcnl dcsp plt figure fig dcnl dcsp plt clf dcnl dcsp plt title title dcnl dcsp plt imshow pvh vmax vmax vmin vmin dcnl dcsp scale 1 dcnl dcsp xmax size x c dcnl dcsp ymax size y r dcnl dcsp color k dcnl dcsp for x in range 0 c dcnl dcsp dcsp plt axvline x x size x scale ymin 0 ymax ymax scale color color dcnl dcsp for y in range 0 r dcnl dcsp dcsp plt axhline y y size y scale xmin 0 xmax xmax scale color color dcnl dcsp plt draw dcnl dcsp return pvh
def deprecated func dcsp def newfunc args kwargs dcnl dcsp dcsp warnings warn call dcsp to dcsp deprecated dcsp function dcsp s func name category deprecationwarning dcnl dcsp dcsp return func args kwargs dcnl dcsp newfunc name func name dcnl dcsp newfunc doc func doc dcnl dcsp newfunc dict update func dict dcnl dcsp return newfunc
def generate exception err code dcsp if err code 1 dcnl dcsp dcsp return eigenmatexception incompatible dcsp matrix dcsp dimensions dcnl dcsp elif err code 2 dcnl dcsp dcsp return eigenmatexception cublas dcsp error dcnl dcsp elif err code 3 dcnl dcsp dcsp return eigenmatexception cuda dcsp error dcsp + get last cuda error dcnl dcsp elif err code 4 dcnl dcsp dcsp return eigenmatexception operation dcsp not dcsp supported dcsp on dcsp views dcnl dcsp elif err code 5 dcnl dcsp dcsp return eigenmatexception operation dcsp not dcsp supported dcsp on dcsp transposed dcsp matrices dcnl dcsp elif err code 6 dcnl dcsp dcsp return eigenmatexception dcnl dcsp elif err code 7 dcnl dcsp dcsp return eigenmatexception incompatible dcsp transposedness dcnl dcsp elif err code 8 dcnl dcsp dcsp return eigenmatexception matrix dcsp is dcsp not dcsp in dcsp device dcsp memory dcnl dcsp elif err code 9 dcnl dcsp dcsp return eigenmatexception operation dcsp not dcsp supported
def empty shape dcsp return eigenmatrix np zeros shape
def sum mat axis target none dcsp m eigenmat get leading dimension mat p mat dcnl dcsp n eigenmat get nonleading dimension mat p mat dcnl dcsp if axis 0 dcnl dcsp dcsp if not target dcnl dcsp dcsp dcsp target empty 1 n dcnl dcsp elif axis 1 dcnl dcsp dcsp if not target dcnl dcsp dcsp dcsp target empty m 1 dcnl dcsp err code eigenmat sum by axis mat p mat target p mat ct c int axis dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def dot m1 m2 mult 1 0 target none dcsp if not target dcnl dcsp dcsp m eigenmat get leading dimension m1 p mat dcnl dcsp dcsp n eigenmat get nonleading dimension m2 p mat dcnl dcsp dcsp target empty m n dcnl dcsp err code eigenmat dot m1 p mat m2 p mat target p mat ct c float 0 0 ct c float mult dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def vdot m1 m2 dcsp err code ct c int 0 dcnl dcsp res eigenmat vdot m1 p mat m2 p mat ct byref err code dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code value dcnl dcsp return res
def cos mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code eigenmat apply cos mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def sin mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code eigenmat apply sin mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def softmax mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code eigenmat apply softmax mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def sigmoid mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code eigenmat apply sigmoid mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def tanh mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code eigenmat apply tanh mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def abs mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code eigenmat apply abs mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def log 1 plus exp mat target none exact false dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp if exact dcnl dcsp dcsp err code eigenmat apply log 1 plus exp exact mat p mat target p mat dcnl dcsp else dcnl dcsp dcsp err code eigenmat apply log 1 plus exp mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def log mat tiny 0 0 target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code eigenmat apply log mat p mat target p mat ct c float tiny dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def exp mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code eigenmat apply exp mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def ceil mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code eigenmat apply ceil mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def floor mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code eigenmat apply floor mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def sqrt mat target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp err code eigenmat apply sqrt mat p mat target p mat dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def cross entropy bernoulli mat p target none tiny 1e10 dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp if isinstance p eigenmatrix dcnl dcsp dcsp err code eigenmat compute cross entropy bernoulli mat p mat p p mat target p mat ct c float tiny dcnl dcsp else dcnl dcsp dcsp raise valueerror value dcsp must dcsp be dcsp of dcsp type dcsp eigenmatrix dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def cross entropy mat p target none tiny 1e10 dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp if isinstance p eigenmatrix dcnl dcsp dcsp err code eigenmat compute cross entropy mat p mat p p mat target p mat ct c float tiny dcnl dcsp else dcnl dcsp dcsp raise valueerror value dcsp must dcsp be dcsp of dcsp type dcsp eigenmatrix dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def correct preds mat p target none cutoff 0 5 dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp if isinstance p eigenmatrix dcnl dcsp dcsp err code eigenmat correct preds mat p mat p p mat target p mat ct c float cutoff dcnl dcsp else dcnl dcsp dcsp raise valueerror value dcsp must dcsp be dcsp of dcsp type dcsp eigenmatrix dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def pow mat p target none dcsp if not target dcnl dcsp dcsp target mat dcnl dcsp if isinstance p eigenmatrix dcnl dcsp dcsp err code eigenmat apply pow matrix mat p mat p p mat target p mat dcnl dcsp elif isinstance p int float dcnl dcsp dcsp err code eigenmat apply pow mat p mat ct c float p target p mat dcnl dcsp else dcnl dcsp dcsp raise valueerror value dcsp must dcsp be dcsp of dcsp type dcsp eigenmatrix dcsp int dcsp or dcsp float dcnl dcsp if err code dcnl dcsp dcsp raise generate exception err code dcnl dcsp return target
def reformat array dcsp return np array array dtype np float32 order f
def cuda set device dev id dcsp pass
def cublas init dcsp pass
def cublas shutdown dcsp pass
def get non generated file lines dcsp lines to copy dcnl dcsp flag found false dcnl dcsp with open plotly graph objs graph objs py r as f dcnl dcsp dcsp for line to copy in f dcnl dcsp dcsp dcsp if line to copy startswith flag dcnl dcsp dcsp dcsp dcsp flag found true dcnl dcsp dcsp dcsp dcsp break dcnl dcsp dcsp dcsp lines to copy append line to copy dcnl dcsp if not flag found dcnl dcsp dcsp raise valueerror failed dcsp to dcsp find dcsp flag n nin dcsp graph objs tools py format flag dcnl dcsp return lines to copy
def basic auth username password dcsp if isinstance username str dcnl dcsp dcsp username username encode latin1 dcnl dcsp if isinstance password str dcnl dcsp dcsp password password encode latin1 dcnl dcsp return basic dcsp + to native ascii string b64encode join username password strip
def retrieve fid share key none dcsp url build url resource id fid dcnl dcsp params make params share key share key dcnl dcsp return request get url params params
def update fid body dcsp url build url resource id fid dcnl dcsp return request put url json body
def trash fid dcsp url build url resource id fid route trash dcnl dcsp return request post url
def restore fid dcsp url build url resource id fid route restore dcnl dcsp return request post url
def permanent delete fid dcsp url build url resource id fid route permanent delete dcnl dcsp return request delete url
def lookup path parent none user none exists none dcsp url build url resource route lookup dcnl dcsp params make params path path parent parent user user exists exists dcnl dcsp return request get url params params
def create body dcsp url build url resource dcnl dcsp return request post url json body
def retrieve fid dcsp url build url resource id fid dcnl dcsp return request get url
def update fid content dcsp url build url resource id fid dcnl dcsp return request put url json content
def create body dcsp url build url resource dcnl dcsp return request post url json body
def retrieve fid share key none dcsp url build url resource id fid dcnl dcsp params make params share key share key dcnl dcsp return request get url params params
def update fid body dcsp url build url resource id fid dcnl dcsp return request put url json body
def trash fid dcsp url build url resource id fid route trash dcnl dcsp return request post url
def restore fid dcsp url build url resource id fid route restore dcnl dcsp return request post url
def permanent delete fid dcsp url build url resource id fid route permanent delete dcnl dcsp return request delete url
def lookup path parent none user none exists none dcsp url build url resource route lookup dcnl dcsp params make params path path parent parent user user exists exists dcnl dcsp return request get url params params
def make params kwargs dcsp return k v for k v in kwargs items if v is not none
def build url resource id route dcsp base config get config plotly api domain dcnl dcsp formatter base base resource resource id id route route dcnl dcsp if id dcnl dcsp dcsp if route dcnl dcsp dcsp dcsp url base v2 resource id route format formatter dcnl dcsp dcsp else dcnl dcsp dcsp dcsp url base v2 resource id format formatter dcnl dcsp elif route dcnl dcsp dcsp url base v2 resource route format formatter dcnl dcsp else dcnl dcsp dcsp url base v2 resource format formatter dcnl dcsp return url
def validate response response dcsp if response ok dcnl dcsp dcsp return dcnl dcsp content response content dcnl dcsp status code response status code dcnl dcsp try dcnl dcsp dcsp parsed content response json dcnl dcsp except valueerror dcnl dcsp dcsp message content if content else no dcsp content dcnl dcsp dcsp raise exceptions plotlyrequesterror message status code content dcnl dcsp message dcnl dcsp if isinstance parsed content dict dcnl dcsp dcsp errors parsed content get errors dcnl dcsp dcsp messages error get message for error in errors dcnl dcsp dcsp message n join msg for msg in messages if msg dcnl dcsp if not message dcnl dcsp dcsp message content if content else no dcsp content dcnl dcsp raise exceptions plotlyrequesterror message status code content
def get headers dcsp creds config get credentials dcnl dcsp headers plotlyclientplatform python dcsp format version version contenttype application json dcnl dcsp plotly auth basic auth creds username creds api key dcnl dcsp proxy auth basic auth creds proxy username creds proxy password dcnl dcsp if config get config plotly proxy authorization dcnl dcsp dcsp headers authorization proxy auth dcnl dcsp dcsp if creds username and creds api key dcnl dcsp dcsp dcsp headers plotlyauthorization plotly auth dcnl dcsp elif creds username and creds api key dcnl dcsp dcsp headers authorization plotly auth dcnl dcsp return headers
def request method url kwargs dcsp kwargs headers dict kwargs get headers get headers dcnl dcsp if isinstance kwargs get params dict dcnl dcsp dcsp kwargs params kwargs params copy dcnl dcsp dcsp for key in kwargs params dcnl dcsp dcsp dcsp if isinstance kwargs params key bool dcnl dcsp dcsp dcsp dcsp kwargs params key json dumps kwargs params key dcnl dcsp if kwargs get json is not none dcnl dcsp dcsp if kwargs get data dcnl dcsp dcsp dcsp raise exceptions plotlyerror cannot dcsp supply dcsp data dcsp and dcsp json dcsp kwargs dcnl dcsp dcsp kwargs data json dumps kwargs pop json sort keys true cls utils plotlyjsonencoder dcnl dcsp kwargs verify config get config plotly ssl verification dcnl dcsp try dcnl dcsp dcsp response requests request method url kwargs dcnl dcsp except requestexception as e dcnl dcsp dcsp message str getattr e message no dcsp message dcnl dcsp dcsp response getattr e response none dcnl dcsp dcsp status code response status code if response else none dcnl dcsp dcsp content response content if response else no dcsp content dcnl dcsp dcsp raise exceptions plotlyrequesterror message status code content dcnl dcsp validate response response dcnl dcsp return response
def retrieve sha1 kwargs dcsp url build url resource dcnl dcsp params make params sha1 sha1 dcnl dcsp return request get url params params kwargs
def create body dcsp url build url resource dcnl dcsp return request post url json body
def list dcsp url build url resource dcnl dcsp return request get url
def retrieve fid dcsp url build url resource id fid dcnl dcsp return request get url
def update fid content dcsp url build url resource id fid dcnl dcsp return request put url json content
def schema dcsp url build url resource route schema dcnl dcsp return request get url
def create body dcsp url build url resource dcnl dcsp return request post url json body
def create body dcsp url build url resource dcnl dcsp return request post url json body
def retrieve fid share key none dcsp url build url resource id fid dcnl dcsp params make params share key share key dcnl dcsp return request get url params params
def content fid share key none dcsp url build url resource id fid route content dcnl dcsp params make params share key share key dcnl dcsp return request get url params params
def update fid body dcsp url build url resource id fid dcnl dcsp return request put url json body
def trash fid dcsp url build url resource id fid route trash dcnl dcsp return request post url
def restore fid dcsp url build url resource id fid route restore dcnl dcsp return request post url
def permanent delete fid dcsp url build url resource id fid route permanent delete dcnl dcsp return request delete url
def lookup path parent none user none exists none dcsp url build url resource route lookup dcnl dcsp params make params path path parent parent user user exists exists dcnl dcsp return request get url params params
def col create fid body dcsp url build url resource id fid route col dcnl dcsp return request post url json body
def col retrieve fid uid dcsp url build url resource id fid route col dcnl dcsp params make params uid uid dcnl dcsp return request get url params params
def col update fid uid body dcsp url build url resource id fid route col dcnl dcsp params make params uid uid dcnl dcsp return request put url json body params params
def col delete fid uid dcsp url build url resource id fid route col dcnl dcsp params make params uid uid dcnl dcsp return request delete url params params
def row fid body dcsp url build url resource id fid route row dcnl dcsp return request post url json body
def create body dcsp url build url resource dcnl dcsp return request post url json body
def retrieve fid share key none dcsp url build url resource id fid dcnl dcsp params make params share key share key dcnl dcsp return request get url params params
def content fid share key none inline data none map data none dcsp url build url resource id fid route content dcnl dcsp params make params share key share key inline data inline data map data map data dcnl dcsp return request get url params params
def update fid body dcsp url build url resource id fid dcnl dcsp return request put url json body
def trash fid dcsp url build url resource id fid route trash dcnl dcsp return request post url
def restore fid dcsp url build url resource id fid route restore dcnl dcsp return request post url
def permanent delete fid params none dcsp url build url resource id fid route permanent delete dcnl dcsp return request delete url params params
def lookup path parent none user none exists none dcsp url build url resource route lookup dcnl dcsp params make params path path parent parent user user exists exists dcnl dcsp return request get url params params
def current dcsp url build url resource route current dcnl dcsp return request get url
def validate response response dcsp content response content dcnl dcsp status code response status code dcnl dcsp try dcnl dcsp dcsp parsed content response json dcnl dcsp except valueerror dcnl dcsp dcsp message content if content else no dcsp content dcnl dcsp dcsp raise exceptions plotlyrequesterror message status code content dcnl dcsp message dcnl dcsp if isinstance parsed content dict dcnl dcsp dcsp error parsed content get error dcnl dcsp dcsp if error dcnl dcsp dcsp dcsp message error dcnl dcsp dcsp elif response ok dcnl dcsp dcsp dcsp return dcnl dcsp if not message dcnl dcsp dcsp message content if content else no dcsp content dcnl dcsp raise exceptions plotlyrequesterror message status code content
def get headers dcsp headers dcnl dcsp creds config get credentials dcnl dcsp proxy auth basic auth creds proxy username creds proxy password dcnl dcsp if config get config plotly proxy authorization dcnl dcsp dcsp headers authorization proxy auth dcnl dcsp return headers
def request method url kwargs dcsp if kwargs get json none is not none dcnl dcsp dcsp raise exceptions plotlyerror v1 dcsp api dcsp does dcsp not dcsp handle dcsp arbitrary dcsp json dcnl dcsp kwargs headers dict kwargs get headers get headers dcnl dcsp kwargs verify config get config plotly ssl verification dcnl dcsp try dcnl dcsp dcsp response requests request method url kwargs dcnl dcsp except requestexception as e dcnl dcsp dcsp message str getattr e message no dcsp message dcnl dcsp dcsp response getattr e response none dcnl dcsp dcsp status code response status code if response else none dcnl dcsp dcsp content response content if response else no dcsp content dcnl dcsp dcsp raise exceptions plotlyrequesterror message status code content dcnl dcsp validate response response dcnl dcsp return response
def clientresp data kwargs dcsp creds config get credentials dcnl dcsp cfg config get config dcnl dcsp dumps kwargs sort keys true cls utils plotlyjsonencoder dcnl dcsp payload platform python version version version args json dumps data dumps kwargs un creds username key creds api key origin plot kwargs json dumps kwargs dumps kwargs dcnl dcsp url plotly domain clientresp format cfg dcnl dcsp response request post url data payload dcnl dcsp parsed content response json dcnl dcsp if parsed content get warning dcnl dcsp dcsp warnings warn parsed content warning dcnl dcsp if parsed content get message dcnl dcsp dcsp print parsed content message dcnl dcsp return response
def get credentials dcsp credentials tools get credentials file dcnl dcsp session credentials session get session credentials dcnl dcsp for credentials key in credentials dcnl dcsp dcsp session value session credentials get credentials key dcnl dcsp dcsp if session value is false or session value dcnl dcsp dcsp dcsp credentialscredentials key session value dcnl dcsp return credentials
def get config dcsp config tools get config file dcnl dcsp session config session get session config dcnl dcsp for config key in config dcnl dcsp dcsp session value session config get config key dcnl dcsp dcsp if session value is false or session value dcnl dcsp dcsp dcsp configconfig key session value dcnl dcsp return config
def load json dict filename args dcsp data dcnl dcsp if os path exists filename dcnl dcsp dcsp lock acquire dcnl dcsp dcsp with open filename r as f dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp data json load f dcnl dcsp dcsp dcsp dcsp if not isinstance data dict dcnl dcsp dcsp dcsp dcsp dcsp data dcnl dcsp dcsp dcsp except dcnl dcsp dcsp dcsp dcsp data dcnl dcsp dcsp lock release dcnl dcsp dcsp if args dcnl dcsp dcsp dcsp return key datakey for key in args if key in data dcnl dcsp return data
def save json dict filename json dict dcsp if isinstance json dict dict dcnl dcsp dcsp json string json dumps json dict indent 4 dcnl dcsp dcsp lock acquire dcnl dcsp dcsp with open filename w as f dcnl dcsp dcsp dcsp f write json string dcnl dcsp dcsp lock release dcnl dcsp else dcnl dcsp dcsp raise typeerror json dict dcsp was dcsp not dcsp a dcsp dictionary dcsp not dcsp saving
def ensure file exists filename dcsp if not os path exists filename dcnl dcsp dcsp head tail os path split filename dcnl dcsp dcsp ensure dir exists head dcnl dcsp dcsp with open filename w as f dcnl dcsp dcsp dcsp pass
def ensure dir exists directory dcsp if dir dcnl dcsp dcsp if not os path isdir directory dcnl dcsp dcsp dcsp os makedirs directory
def iso to plotly time string iso string dcsp if iso string split 3 is 00 00 or iso string split + 0 is 00 00 dcnl dcsp dcsp raise exception plotly dcsp won t dcsp accept dcsp timestrings dcsp with dcsp timezone dcsp info nall dcsp timestrings dcsp are dcsp assumed dcsp to dcsp be dcsp in dcsp utc dcnl dcsp iso string iso string replace 00 00 replace +00 00 dcnl dcsp if iso string endswith t00 00 00 dcnl dcsp dcsp return iso string replace t00 00 00 dcnl dcsp else dcnl dcsp dcsp return iso string replace t dcsp
def node generator node path dcsp if not isinstance node dict dcnl dcsp dcsp return dcnl dcsp yield node path dcnl dcsp for key val in node items dcnl dcsp dcsp if isinstance val dict dcnl dcsp dcsp dcsp for item in node generator val path + key dcnl dcsp dcsp dcsp dcsp yield item
def get by path obj path dcsp for key in path dcnl dcsp dcsp obj objkey dcnl dcsp return obj
def default memoize key function args kwargs dcsp if kwargs dcnl dcsp dcsp return args frozenset kwargs items dcnl dcsp else dcnl dcsp dcsp return args
def memoize maxsize 128 dcsp keys deque dcnl dcsp cache dcnl dcsp def memoize all args kwargs dcnl dcsp dcsp func all args0 dcnl dcsp dcsp args all args1 dcnl dcsp dcsp key default memoize key function args kwargs dcnl dcsp dcsp if key in keys dcnl dcsp dcsp dcsp return cachekey dcnl dcsp dcsp if maxsize is not none and len keys maxsize dcnl dcsp dcsp dcsp cache pop keys pop dcnl dcsp dcsp result func args kwargs dcnl dcsp dcsp keys appendleft key dcnl dcsp dcsp cachekey result dcnl dcsp dcsp return result dcnl dcsp return decorator memoize
def map face2color face colormap scale vmin vmax dcsp if vmin vmax dcnl dcsp dcsp raise exceptions plotlyerror incorrect dcsp relation dcsp between dcsp vmin dcsp and dcsp vmax dcsp the dcsp vmin dcsp value dcsp cannot dcsp be dcsp bigger dcsp than dcsp or dcsp equal dcsp to dcsp the dcsp value dcsp of dcsp vmax dcnl dcsp if len colormap 1 dcnl dcsp dcsp face color colormap0 dcnl dcsp dcsp face color colors convert to rgb 255 face color dcnl dcsp dcsp face color colors label rgb face color dcnl dcsp dcsp return face color dcnl dcsp if face vmax dcnl dcsp dcsp face color colormap 1 dcnl dcsp dcsp face color colors convert to rgb 255 face color dcnl dcsp dcsp face color colors label rgb face color dcnl dcsp dcsp return face color dcnl dcsp else dcnl dcsp dcsp if scale is none dcnl dcsp dcsp dcsp t face vmin float vmax vmin dcnl dcsp dcsp dcsp low color index int t 1 0 len colormap 1 dcnl dcsp dcsp dcsp face color colors find intermediate color colormaplow color index colormap low color index + 1 t len colormap 1 low color index dcnl dcsp dcsp dcsp face color colors convert to rgb 255 face color dcnl dcsp dcsp dcsp face color colors label rgb face color dcnl dcsp dcsp else dcnl dcsp dcsp dcsp t face vmin float vmax vmin dcnl dcsp dcsp dcsp low color index 0 dcnl dcsp dcsp dcsp for k in range len scale 1 dcnl dcsp dcsp dcsp dcsp if scalek < t < scale k + 1 dcnl dcsp dcsp dcsp dcsp dcsp break dcnl dcsp dcsp dcsp dcsp low color index + 1 dcnl dcsp dcsp dcsp low scale val scalelow color index dcnl dcsp dcsp dcsp high scale val scale low color index + 1 dcnl dcsp dcsp dcsp face color colors find intermediate color colormaplow color index colormap low color index + 1 t low scale val high scale val low scale val dcnl dcsp dcsp dcsp face color colors convert to rgb 255 face color dcnl dcsp dcsp dcsp face color colors label rgb face color dcnl dcsp dcsp return face color
def trisurf x y z simplices show colorbar edges color scale colormap none color func none plot edges false x edge none y edge none z edge none facecolor none dcsp if not np dcnl dcsp dcsp raise importerror figurefactory trisurf dcsp requires dcsp numpy dcsp imported dcnl dcsp points3d np vstack x y z t dcnl dcsp simplices np atleast 2d simplices dcnl dcsp tri vertices points3dsimplices dcnl dcsp if color func is none dcnl dcsp dcsp mean dists tri vertices 2 mean 1 dcnl dcsp elif isinstance color func list np ndarray dcnl dcsp dcsp if len color func len simplices dcnl dcsp dcsp dcsp raise valueerror if dcsp color func dcsp is dcsp a dcsp list array dcsp it dcsp must dcsp be dcsp the dcsp same dcsp length dcsp as dcsp simplices dcnl dcsp dcsp for index in range len color func dcnl dcsp dcsp dcsp if isinstance color funcindex str dcnl dcsp dcsp dcsp dcsp if in color funcindex dcnl dcsp dcsp dcsp dcsp dcsp foo colors hex to rgb color funcindex dcnl dcsp dcsp dcsp dcsp dcsp color funcindex colors label rgb foo dcnl dcsp dcsp dcsp if isinstance color funcindex tuple dcnl dcsp dcsp dcsp dcsp foo colors convert to rgb 255 color funcindex dcnl dcsp dcsp dcsp dcsp color funcindex colors label rgb foo dcnl dcsp dcsp mean dists np asarray color func dcnl dcsp else dcnl dcsp dcsp mean dists dcnl dcsp dcsp for triangle in tri vertices dcnl dcsp dcsp dcsp dists dcnl dcsp dcsp dcsp for vertex in triangle dcnl dcsp dcsp dcsp dcsp dist color func vertex0 vertex1 vertex2 dcnl dcsp dcsp dcsp dcsp dists append dist dcnl dcsp dcsp dcsp mean dists append np mean dists dcnl dcsp dcsp mean dists np asarray mean dists dcnl dcsp if isinstance mean dists0 str dcnl dcsp dcsp facecolor mean dists dcnl dcsp else dcnl dcsp dcsp min mean dists np min mean dists dcnl dcsp dcsp max mean dists np max mean dists dcnl dcsp dcsp if facecolor is none dcnl dcsp dcsp dcsp facecolor dcnl dcsp dcsp for index in range len mean dists dcnl dcsp dcsp dcsp color map face2color mean distsindex colormap scale min mean dists max mean dists dcnl dcsp dcsp dcsp facecolor append color dcnl dcsp facecolor np asarray facecolor dcnl dcsp ii jj kk simplices t dcnl dcsp triangles graph objs mesh3d x x y y z z facecolor facecolor i ii j jj k kk name dcnl dcsp mean dists are numbers not isinstance mean dists0 str dcnl dcsp if mean dists are numbers and show colorbar is true dcnl dcsp dcsp colorscale colors make colorscale colormap scale dcnl dcsp dcsp colorscale colors convert colorscale to rgb colorscale dcnl dcsp dcsp colorbar graph objs scatter3d x x 1 y y 1 z z 1 mode markers marker dict size 0 1 color min mean dists max mean dists colorscale colorscale showscale true hoverinfo none showlegend false dcnl dcsp if plot edges is false dcnl dcsp dcsp if mean dists are numbers and show colorbar is true dcnl dcsp dcsp dcsp return graph objs data triangles colorbar dcnl dcsp dcsp else dcnl dcsp dcsp dcsp return graph objs data triangles dcnl dcsp is none ii is none for ii in x edge y edge z edge dcnl dcsp if any is none dcnl dcsp dcsp if not all is none dcnl dcsp dcsp dcsp raise valueerror if dcsp any dcsp x edge dcsp y edge dcsp z edge dcsp is dcsp none dcsp all dcsp must dcsp be dcsp none dcnl dcsp dcsp else dcnl dcsp dcsp dcsp x edge dcnl dcsp dcsp dcsp y edge dcnl dcsp dcsp dcsp z edge dcnl dcsp ixs triangles 0 1 2 0 dcnl dcsp pull edges tri vertices ixs triangles dcnl dcsp x edge pull np hstack pull edges 0 np tile none pull edges shape0 1 dcnl dcsp y edge pull np hstack pull edges 1 np tile none pull edges shape0 1 dcnl dcsp z edge pull np hstack pull edges 2 np tile none pull edges shape0 1 dcnl dcsp x edge np hstack x edge x edge pull reshape 1 1 0 dcnl dcsp y edge np hstack y edge y edge pull reshape 1 1 0 dcnl dcsp z edge np hstack z edge z edge pull reshape 1 1 0 dcnl dcsp if not len x edge len y edge len z edge dcnl dcsp dcsp raise exceptions plotlyerror the dcsp lengths dcsp of dcsp x edge dcsp y edge dcsp and dcsp z edge dcsp are dcsp not dcsp the dcsp same dcnl dcsp lines graph objs scatter3d x x edge y y edge z z edge mode lines line graph objs line color edges color width 1 5 showlegend false dcnl dcsp if mean dists are numbers and show colorbar is true dcnl dcsp dcsp return graph objs data triangles lines colorbar dcnl dcsp else dcnl dcsp dcsp return graph objs data triangles lines
def create trisurf x y z simplices colormap none show colorbar true scale none color func none title trisurf dcsp plot plot edges true showbackground true backgroundcolor rgb 230 dcsp 230 dcsp 230 gridcolor rgb 255 dcsp 255 dcsp 255 zerolinecolor rgb 255 dcsp 255 dcsp 255 edges color rgb 50 dcsp 50 dcsp 50 height 800 width 800 aspectratio none dcsp if aspectratio is none dcnl dcsp dcsp aspectratio x 1 y 1 z 1 dcnl dcsp colors validate colors colormap dcnl dcsp colormap scale colors convert colors to same type colormap colortype tuple return default colors true scale scale dcnl dcsp data1 trisurf x y z simplices show colorbar show colorbar color func color func colormap colormap scale scale edges color edges color plot edges plot edges dcnl dcsp axis dict showbackground showbackground backgroundcolor backgroundcolor gridcolor gridcolor zerolinecolor zerolinecolor dcnl dcsp layout graph objs layout title title width width height height scene graph objs scene xaxis graph objs xaxis axis yaxis graph objs yaxis axis zaxis graph objs zaxis axis aspectratio dict x aspectratio x y aspectratio y z aspectratio z dcnl dcsp return graph objs figure data data1 layout layout
def endpts to intervals endpts dcsp length len endpts dcnl dcsp if not isinstance endpts tuple or isinstance endpts list dcnl dcsp dcsp raise exceptions plotlyerror the dcsp intervals endpts dcsp argument dcsp must dcsp be dcsp a dcsp list dcsp or dcsp tuple dcsp of dcsp a dcsp sequence dcsp of dcsp increasing dcsp numbers dcnl dcsp for item in endpts dcnl dcsp dcsp if isinstance item str dcnl dcsp dcsp dcsp raise exceptions plotlyerror the dcsp intervals endpts dcsp argument dcsp must dcsp be dcsp a dcsp list dcsp or dcsp tuple dcsp of dcsp a dcsp sequence dcsp of dcsp increasing dcsp numbers dcnl dcsp for k in range length 1 dcnl dcsp dcsp if endptsk endpts k + 1 dcnl dcsp dcsp dcsp raise exceptions plotlyerror the dcsp intervals endpts dcsp argument dcsp must dcsp be dcsp a dcsp list dcsp or dcsp tuple dcsp of dcsp a dcsp sequence dcsp of dcsp increasing dcsp numbers dcnl dcsp else dcnl dcsp dcsp intervals dcnl dcsp dcsp intervals append float inf endpts0 dcnl dcsp dcsp for k in range length 1 dcnl dcsp dcsp dcsp interval dcnl dcsp dcsp dcsp interval append endptsk dcnl dcsp dcsp dcsp interval append endpts k + 1 dcnl dcsp dcsp dcsp intervals append interval dcnl dcsp dcsp intervals append endpts length 1 float inf dcnl dcsp dcsp return intervals
def hide tick labels from box subplots fig dcsp boxplot xaxes dcnl dcsp for trace in fig data dcnl dcsp dcsp if trace type box dcnl dcsp dcsp dcsp boxplot xaxes append xaxis format trace xaxis 1 dcnl dcsp for xaxis in boxplot xaxes dcnl dcsp dcsp fig layout xaxis showticklabels false
def validate scatterplotmatrix df index diag colormap type kwargs dcsp if not pd dcnl dcsp dcsp raise importerror figurefactory scatterplotmatrix dcsp requires dcsp a dcsp pandas dcsp dataframe dcnl dcsp if not isinstance df pd core frame dataframe dcnl dcsp dcsp raise exceptions plotlyerror dataframe dcsp not dcsp inputed dcsp please dcsp use dcsp a dcsp pandas dcsp dataframe dcsp to dcsp produce dcsp a dcsp scatterplot dcsp matrix dcnl dcsp if len df columns < 1 dcnl dcsp dcsp raise exceptions plotlyerror dataframe dcsp has dcsp only dcsp one dcsp column dcsp to dcsp use dcsp the dcsp scatterplot dcsp matrix dcsp use dcsp at dcsp least dcsp 2 dcsp columns dcnl dcsp if diag not in diag choices dcnl dcsp dcsp raise exceptions plotlyerror make dcsp sure dcsp diag dcsp is dcsp set dcsp to dcsp one dcsp of dcsp format diag choices dcnl dcsp if colormap type not in valid colormap types dcnl dcsp dcsp raise exceptions plotlyerror must dcsp choose dcsp a dcsp valid dcsp colormap dcsp type dcsp either dcsp cat dcsp or dcsp seq dcsp for dcsp a dcsp categorical dcsp and dcsp sequential dcsp colormap dcsp respectively dcnl dcsp if marker in kwargs dcnl dcsp dcsp forbidden params size color colorscale dcnl dcsp dcsp if any param in kwargs marker for param in forbidden params dcnl dcsp dcsp dcsp raise exceptions plotlyerror your dcsp kwargs dcsp dictionary dcsp cannot dcsp include dcsp the dcsp size dcsp color dcsp or dcsp colorscale dcsp key dcsp words dcsp inside dcsp the dcsp marker dcsp dict dcsp since dcsp size dcsp is dcsp already dcsp an dcsp argument dcsp of dcsp the dcsp scatterplot dcsp matrix dcsp function dcsp and dcsp both dcsp color dcsp and dcsp colorscale dcsp are dcsp set dcsp internally
def scatterplot dataframe headers diag size height width title kwargs dcsp dim len dataframe dcnl dcsp fig make subplots rows dim cols dim print grid false dcnl dcsp trace list dcnl dcsp for listy in dataframe dcnl dcsp dcsp for listx in dataframe dcnl dcsp dcsp dcsp if listx listy and diag histogram dcnl dcsp dcsp dcsp dcsp trace graph objs histogram x listx showlegend false dcnl dcsp dcsp dcsp elif listx listy and diag box dcnl dcsp dcsp dcsp dcsp trace graph objs box y listx name none showlegend false dcnl dcsp dcsp dcsp elif marker in kwargs dcnl dcsp dcsp dcsp dcsp kwargs marker size size dcnl dcsp dcsp dcsp dcsp trace graph objs scatter x listx y listy mode markers showlegend false kwargs dcnl dcsp dcsp dcsp dcsp trace list append trace dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp trace graph objs scatter x listx y listy mode markers marker dict size size showlegend false kwargs dcnl dcsp dcsp dcsp trace list append trace dcnl dcsp trace index 0 dcnl dcsp indices range 1 dim + 1 dcnl dcsp for y index in indices dcnl dcsp dcsp for x index in indices dcnl dcsp dcsp dcsp fig append trace trace listtrace index y index x index dcnl dcsp dcsp dcsp trace index + 1 dcnl dcsp for j in range dim dcnl dcsp dcsp xaxis key xaxis format dim dim dim + 1 + j dcnl dcsp dcsp fig layout xaxis key update title headersj dcnl dcsp for j in range dim dcnl dcsp dcsp yaxis key yaxis format 1 + dim j dcnl dcsp dcsp fig layout yaxis key update title headersj dcnl dcsp fig layout update height height width width title title showlegend true dcnl dcsp hide tick labels from box subplots fig dcnl dcsp return fig
def scatterplot dict dataframe headers diag size height width title index index vals endpts colormap colormap type kwargs dcsp theme colormap dcnl dcsp dim len dataframe dcnl dcsp fig make subplots rows dim cols dim print grid false dcnl dcsp trace list dcnl dcsp legend param 0 dcnl dcsp for listy in dataframe dcnl dcsp dcsp for listx in dataframe dcnl dcsp dcsp dcsp unique index vals dcnl dcsp dcsp dcsp for name in index vals dcnl dcsp dcsp dcsp dcsp if name not in unique index vals dcnl dcsp dcsp dcsp dcsp dcsp unique index valsname dcnl dcsp dcsp dcsp for name in sorted unique index vals keys dcnl dcsp dcsp dcsp dcsp new listx dcnl dcsp dcsp dcsp dcsp new listy dcnl dcsp dcsp dcsp dcsp for j in range len index vals dcnl dcsp dcsp dcsp dcsp dcsp if index valsj name dcnl dcsp dcsp dcsp dcsp dcsp dcsp new listx append listxj dcnl dcsp dcsp dcsp dcsp dcsp dcsp new listy append listyj dcnl dcsp dcsp dcsp dcsp if legend param 1 dcnl dcsp dcsp dcsp dcsp dcsp if listx listy and diag histogram dcnl dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs histogram x new listx marker dict color themename showlegend true dcnl dcsp dcsp dcsp dcsp dcsp elif listx listy and diag box dcnl dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs box y new listx name none marker dict color themename showlegend true dcnl dcsp dcsp dcsp dcsp dcsp elif marker in kwargs dcnl dcsp dcsp dcsp dcsp dcsp dcsp kwargs marker size size dcnl dcsp dcsp dcsp dcsp dcsp dcsp kwargs marker color themename dcnl dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs scatter x new listx y new listy mode markers name name showlegend true kwargs dcnl dcsp dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs scatter x new listx y new listy mode markers name name marker dict size size color themename showlegend true kwargs dcnl dcsp dcsp dcsp dcsp elif listx listy and diag histogram dcnl dcsp dcsp dcsp dcsp dcsp trace graph objs histogram x new listx marker dict color themename showlegend false dcnl dcsp dcsp dcsp dcsp elif listx listy and diag box dcnl dcsp dcsp dcsp dcsp dcsp trace graph objs box y new listx name none marker dict color themename showlegend false dcnl dcsp dcsp dcsp dcsp elif marker in kwargs dcnl dcsp dcsp dcsp dcsp dcsp kwargs marker size size dcnl dcsp dcsp dcsp dcsp dcsp kwargs marker color themename dcnl dcsp dcsp dcsp dcsp dcsp trace graph objs scatter x new listx y new listy mode markers name name showlegend false kwargs dcnl dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp trace graph objs scatter x new listx y new listy mode markers name name marker dict size size color themename showlegend false kwargs dcnl dcsp dcsp dcsp dcsp unique index valsname trace dcnl dcsp dcsp dcsp trace list append unique index vals dcnl dcsp dcsp dcsp legend param + 1 dcnl dcsp trace index 0 dcnl dcsp indices range 1 dim + 1 dcnl dcsp for y index in indices dcnl dcsp dcsp for x index in indices dcnl dcsp dcsp dcsp for name in sorted trace listtrace index keys dcnl dcsp dcsp dcsp dcsp fig append trace trace listtrace indexname y index x index dcnl dcsp dcsp dcsp trace index + 1 dcnl dcsp for j in range dim dcnl dcsp dcsp xaxis key xaxis format dim dim dim + 1 + j dcnl dcsp dcsp fig layout xaxis key update title headersj dcnl dcsp for j in range dim dcnl dcsp dcsp yaxis key yaxis format 1 + dim j dcnl dcsp dcsp fig layout yaxis key update title headersj dcnl dcsp hide tick labels from box subplots fig dcnl dcsp if diag histogram dcnl dcsp dcsp fig layout update height height width width title title showlegend true barmode stack dcnl dcsp dcsp return fig dcnl dcsp else dcnl dcsp dcsp fig layout update height height width width title title showlegend true dcnl dcsp dcsp return fig
def scatterplot theme dataframe headers diag size height width title index index vals endpts colormap colormap type kwargs dcsp if isinstance index vals0 str dcnl dcsp dcsp unique index vals dcnl dcsp dcsp for name in index vals dcnl dcsp dcsp dcsp if name not in unique index vals dcnl dcsp dcsp dcsp dcsp unique index vals append name dcnl dcsp dcsp n colors len len unique index vals dcnl dcsp dcsp if colormap type seq dcnl dcsp dcsp dcsp foo utils color parser colormap utils unlabel rgb dcnl dcsp dcsp dcsp foo utils n colors foo0 foo1 n colors len dcnl dcsp dcsp dcsp theme utils color parser foo utils label rgb dcnl dcsp dcsp if colormap type cat dcnl dcsp dcsp dcsp theme colormap dcnl dcsp dcsp dim len dataframe dcnl dcsp dcsp fig make subplots rows dim cols dim print grid false dcnl dcsp dcsp trace list dcnl dcsp dcsp legend param 0 dcnl dcsp dcsp for listy in dataframe dcnl dcsp dcsp dcsp for listx in dataframe dcnl dcsp dcsp dcsp dcsp unique index vals dcnl dcsp dcsp dcsp dcsp for name in index vals dcnl dcsp dcsp dcsp dcsp dcsp if name not in unique index vals dcnl dcsp dcsp dcsp dcsp dcsp dcsp unique index valsname dcnl dcsp dcsp dcsp dcsp c indx 0 dcnl dcsp dcsp dcsp dcsp for name in sorted unique index vals keys dcnl dcsp dcsp dcsp dcsp dcsp new listx dcnl dcsp dcsp dcsp dcsp dcsp new listy dcnl dcsp dcsp dcsp dcsp dcsp for j in range len index vals dcnl dcsp dcsp dcsp dcsp dcsp dcsp if index valsj name dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp new listx append listxj dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp new listy append listyj dcnl dcsp dcsp dcsp dcsp dcsp if legend param 1 dcnl dcsp dcsp dcsp dcsp dcsp dcsp if listx listy and diag histogram dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs histogram x new listx marker dict color themec indx showlegend true dcnl dcsp dcsp dcsp dcsp dcsp dcsp elif listx listy and diag box dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs box y new listx name none marker dict color themec indx showlegend true dcnl dcsp dcsp dcsp dcsp dcsp dcsp elif marker in kwargs dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp kwargs marker size size dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp kwargs marker color themec indx dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs scatter x new listx y new listy mode markers name name showlegend true kwargs dcnl dcsp dcsp dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs scatter x new listx y new listy mode markers name name marker dict size size color themec indx showlegend true kwargs dcnl dcsp dcsp dcsp dcsp dcsp elif listx listy and diag histogram dcnl dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs histogram x new listx marker dict color themec indx showlegend false dcnl dcsp dcsp dcsp dcsp dcsp elif listx listy and diag box dcnl dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs box y new listx name none marker dict color themec indx showlegend false dcnl dcsp dcsp dcsp dcsp dcsp elif marker in kwargs dcnl dcsp dcsp dcsp dcsp dcsp dcsp kwargs marker size size dcnl dcsp dcsp dcsp dcsp dcsp dcsp kwargs marker color themec indx dcnl dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs scatter x new listx y new listy mode markers name name showlegend false kwargs dcnl dcsp dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs scatter x new listx y new listy mode markers name name marker dict size size color themec indx showlegend false kwargs dcnl dcsp dcsp dcsp dcsp dcsp unique index valsname trace dcnl dcsp dcsp dcsp dcsp dcsp if c indx len theme 1 dcnl dcsp dcsp dcsp dcsp dcsp dcsp c indx 1 dcnl dcsp dcsp dcsp dcsp dcsp c indx + 1 dcnl dcsp dcsp dcsp dcsp trace list append unique index vals dcnl dcsp dcsp dcsp dcsp legend param + 1 dcnl dcsp dcsp trace index 0 dcnl dcsp dcsp indices range 1 dim + 1 dcnl dcsp dcsp for y index in indices dcnl dcsp dcsp dcsp for x index in indices dcnl dcsp dcsp dcsp dcsp for name in sorted trace listtrace index keys dcnl dcsp dcsp dcsp dcsp dcsp fig append trace trace listtrace indexname y index x index dcnl dcsp dcsp dcsp dcsp trace index + 1 dcnl dcsp dcsp for j in range dim dcnl dcsp dcsp dcsp xaxis key xaxis format dim dim dim + 1 + j dcnl dcsp dcsp dcsp fig layout xaxis key update title headersj dcnl dcsp dcsp for j in range dim dcnl dcsp dcsp dcsp yaxis key yaxis format 1 + dim j dcnl dcsp dcsp dcsp fig layout yaxis key update title headersj dcnl dcsp dcsp hide tick labels from box subplots fig dcnl dcsp dcsp if diag histogram dcnl dcsp dcsp dcsp fig layout update height height width width title title showlegend true barmode stack dcnl dcsp dcsp dcsp return fig dcnl dcsp dcsp elif diag box dcnl dcsp dcsp dcsp fig layout update height height width width title title showlegend true dcnl dcsp dcsp dcsp return fig dcnl dcsp dcsp else dcnl dcsp dcsp dcsp fig layout update height height width width title title showlegend true dcnl dcsp dcsp dcsp return fig dcnl dcsp elif endpts dcnl dcsp dcsp intervals utils endpts to intervals endpts dcnl dcsp dcsp if colormap type seq dcnl dcsp dcsp dcsp foo utils color parser colormap utils unlabel rgb dcnl dcsp dcsp dcsp foo utils n colors foo0 foo1 len intervals dcnl dcsp dcsp dcsp theme utils color parser foo utils label rgb dcnl dcsp dcsp if colormap type cat dcnl dcsp dcsp dcsp theme colormap dcnl dcsp dcsp dim len dataframe dcnl dcsp dcsp fig make subplots rows dim cols dim print grid false dcnl dcsp dcsp trace list dcnl dcsp dcsp legend param 0 dcnl dcsp dcsp for listy in dataframe dcnl dcsp dcsp dcsp for listx in dataframe dcnl dcsp dcsp dcsp dcsp interval labels dcnl dcsp dcsp dcsp dcsp for interval in intervals dcnl dcsp dcsp dcsp dcsp dcsp interval labelsstr interval dcnl dcsp dcsp dcsp dcsp c indx 0 dcnl dcsp dcsp dcsp dcsp for interval in intervals dcnl dcsp dcsp dcsp dcsp dcsp new listx dcnl dcsp dcsp dcsp dcsp dcsp new listy dcnl dcsp dcsp dcsp dcsp dcsp for j in range len index vals dcnl dcsp dcsp dcsp dcsp dcsp dcsp if interval0 < index valsj < interval1 dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp new listx append listxj dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp new listy append listyj dcnl dcsp dcsp dcsp dcsp dcsp if legend param 1 dcnl dcsp dcsp dcsp dcsp dcsp dcsp if listx listy and diag histogram dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs histogram x new listx marker dict color themec indx showlegend true dcnl dcsp dcsp dcsp dcsp dcsp dcsp elif listx listy and diag box dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs box y new listx name none marker dict color themec indx showlegend true dcnl dcsp dcsp dcsp dcsp dcsp dcsp elif marker in kwargs dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp kwargs marker size size dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp kwargs marker color themec indx dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs scatter x new listx y new listy mode markers name str interval showlegend true kwargs dcnl dcsp dcsp dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs scatter x new listx y new listy mode markers name str interval marker dict size size color themec indx showlegend true kwargs dcnl dcsp dcsp dcsp dcsp dcsp elif listx listy and diag histogram dcnl dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs histogram x new listx marker dict color themec indx showlegend false dcnl dcsp dcsp dcsp dcsp dcsp elif listx listy and diag box dcnl dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs box y new listx name none marker dict color themec indx showlegend false dcnl dcsp dcsp dcsp dcsp dcsp elif marker in kwargs dcnl dcsp dcsp dcsp dcsp dcsp dcsp kwargs marker size size dcnl dcsp dcsp dcsp dcsp dcsp dcsp kwargs marker color themec indx dcnl dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs scatter x new listx y new listy mode markers name str interval showlegend false kwargs dcnl dcsp dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs scatter x new listx y new listy mode markers name str interval marker dict size size color themec indx showlegend false kwargs dcnl dcsp dcsp dcsp dcsp dcsp interval labelsstr interval trace dcnl dcsp dcsp dcsp dcsp dcsp if c indx len theme 1 dcnl dcsp dcsp dcsp dcsp dcsp dcsp c indx 1 dcnl dcsp dcsp dcsp dcsp dcsp c indx + 1 dcnl dcsp dcsp dcsp dcsp trace list append interval labels dcnl dcsp dcsp dcsp dcsp legend param + 1 dcnl dcsp dcsp trace index 0 dcnl dcsp dcsp indices range 1 dim + 1 dcnl dcsp dcsp for y index in indices dcnl dcsp dcsp dcsp for x index in indices dcnl dcsp dcsp dcsp dcsp for interval in intervals dcnl dcsp dcsp dcsp dcsp dcsp fig append trace trace listtrace indexstr interval y index x index dcnl dcsp dcsp dcsp dcsp trace index + 1 dcnl dcsp dcsp for j in range dim dcnl dcsp dcsp dcsp xaxis key xaxis format dim dim dim + 1 + j dcnl dcsp dcsp dcsp fig layout xaxis key update title headersj dcnl dcsp dcsp for j in range dim dcnl dcsp dcsp dcsp yaxis key yaxis format 1 + dim j dcnl dcsp dcsp dcsp fig layout yaxis key update title headersj dcnl dcsp dcsp hide tick labels from box subplots fig dcnl dcsp dcsp if diag histogram dcnl dcsp dcsp dcsp fig layout update height height width width title title showlegend true barmode stack dcnl dcsp dcsp dcsp return fig dcnl dcsp dcsp elif diag box dcnl dcsp dcsp dcsp fig layout update height height width width title title showlegend true dcnl dcsp dcsp dcsp return fig dcnl dcsp dcsp else dcnl dcsp dcsp dcsp fig layout update height height width width title title showlegend true dcnl dcsp dcsp dcsp return fig dcnl dcsp else dcnl dcsp dcsp theme colormap dcnl dcsp dcsp if len theme < 1 dcnl dcsp dcsp dcsp theme append theme0 dcnl dcsp dcsp color dcnl dcsp dcsp for incr in range len theme dcnl dcsp dcsp dcsp color append 1 0 len theme 1 incr themeincr dcnl dcsp dcsp dim len dataframe dcnl dcsp dcsp fig make subplots rows dim cols dim print grid false dcnl dcsp dcsp trace list dcnl dcsp dcsp legend param 0 dcnl dcsp dcsp for listy in dataframe dcnl dcsp dcsp dcsp for listx in dataframe dcnl dcsp dcsp dcsp dcsp if legend param 1 dcnl dcsp dcsp dcsp dcsp dcsp if listx listy and diag histogram dcnl dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs histogram x listx marker dict color theme0 showlegend false dcnl dcsp dcsp dcsp dcsp dcsp elif listx listy and diag box dcnl dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs box y listx marker dict color theme0 showlegend false dcnl dcsp dcsp dcsp dcsp dcsp elif marker in kwargs dcnl dcsp dcsp dcsp dcsp dcsp dcsp kwargs marker size size dcnl dcsp dcsp dcsp dcsp dcsp dcsp kwargs marker color index vals dcnl dcsp dcsp dcsp dcsp dcsp dcsp kwargs marker colorscale color dcnl dcsp dcsp dcsp dcsp dcsp dcsp kwargs marker showscale true dcnl dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs scatter x listx y listy mode markers showlegend false kwargs dcnl dcsp dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp dcsp trace graph objs scatter x listx y listy mode markers marker dict size size color index vals colorscale color showscale true showlegend false kwargs dcnl dcsp dcsp dcsp dcsp elif listx listy and diag histogram dcnl dcsp dcsp dcsp dcsp dcsp trace graph objs histogram x listx marker dict color theme0 showlegend false dcnl dcsp dcsp dcsp dcsp elif listx listy and diag box dcnl dcsp dcsp dcsp dcsp dcsp trace graph objs box y listx marker dict color theme0 showlegend false dcnl dcsp dcsp dcsp dcsp elif marker in kwargs dcnl dcsp dcsp dcsp dcsp dcsp kwargs marker size size dcnl dcsp dcsp dcsp dcsp dcsp kwargs marker color index vals dcnl dcsp dcsp dcsp dcsp dcsp kwargs marker colorscale color dcnl dcsp dcsp dcsp dcsp dcsp kwargs marker showscale false dcnl dcsp dcsp dcsp dcsp dcsp trace graph objs scatter x listx y listy mode markers showlegend false kwargs dcnl dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp trace graph objs scatter x listx y listy mode markers marker dict size size color index vals colorscale color showscale false showlegend false kwargs dcnl dcsp dcsp dcsp dcsp trace list append trace dcnl dcsp dcsp dcsp dcsp legend param + 1 dcnl dcsp dcsp trace index 0 dcnl dcsp dcsp indices range 1 dim + 1 dcnl dcsp dcsp for y index in indices dcnl dcsp dcsp dcsp for x index in indices dcnl dcsp dcsp dcsp dcsp fig append trace trace listtrace index y index x index dcnl dcsp dcsp dcsp dcsp trace index + 1 dcnl dcsp dcsp for j in range dim dcnl dcsp dcsp dcsp xaxis key xaxis format dim dim dim + 1 + j dcnl dcsp dcsp dcsp fig layout xaxis key update title headersj dcnl dcsp dcsp for j in range dim dcnl dcsp dcsp dcsp yaxis key yaxis format 1 + dim j dcnl dcsp dcsp dcsp fig layout yaxis key update title headersj dcnl dcsp dcsp hide tick labels from box subplots fig dcnl dcsp dcsp if diag histogram dcnl dcsp dcsp dcsp fig layout update height height width width title title showlegend true barmode stack dcnl dcsp dcsp dcsp return fig dcnl dcsp dcsp elif diag box dcnl dcsp dcsp dcsp fig layout update height height width width title title showlegend true dcnl dcsp dcsp dcsp return fig dcnl dcsp dcsp else dcnl dcsp dcsp dcsp fig layout update height height width width title title showlegend true dcnl dcsp dcsp dcsp return fig
def create scatterplotmatrix df index none endpts none diag scatter height 500 width 500 size 6 title scatterplot dcsp matrix colormap none colormap type cat dataframe none headers none index vals none kwargs dcsp if dataframe is none dcnl dcsp dcsp dataframe dcnl dcsp if headers is none dcnl dcsp dcsp headers dcnl dcsp if index vals is none dcnl dcsp dcsp index vals dcnl dcsp validate scatterplotmatrix df index diag colormap type kwargs dcnl dcsp if isinstance colormap dict dcnl dcsp dcsp colormap utils validate colors dict colormap rgb dcnl dcsp else dcnl dcsp dcsp colormap utils validate colors colormap rgb dcnl dcsp if not index dcnl dcsp dcsp for name in df dcnl dcsp dcsp dcsp headers append name dcnl dcsp dcsp for name in headers dcnl dcsp dcsp dcsp dataframe append dfname values tolist dcnl dcsp dcsp utils validate dataframe dataframe dcnl dcsp dcsp figure scatterplot dataframe headers diag size height width title kwargs dcnl dcsp dcsp return figure dcnl dcsp else dcnl dcsp dcsp if index not in df dcnl dcsp dcsp dcsp raise exceptions plotlyerror make dcsp sure dcsp you dcsp set dcsp the dcsp index dcsp input dcsp variable dcsp to dcsp one dcsp of dcsp the dcsp column dcsp names dcsp of dcsp your dcsp dataframe dcnl dcsp dcsp index vals dfindex values tolist dcnl dcsp dcsp for name in df dcnl dcsp dcsp dcsp if name index dcnl dcsp dcsp dcsp dcsp headers append name dcnl dcsp dcsp for name in headers dcnl dcsp dcsp dcsp dataframe append dfname values tolist dcnl dcsp dcsp utils validate dataframe dataframe dcnl dcsp dcsp utils validate index index vals dcnl dcsp dcsp if isinstance colormap dict dcnl dcsp dcsp dcsp for key in colormap dcnl dcsp dcsp dcsp dcsp if not all index in colormap for index in index vals dcnl dcsp dcsp dcsp dcsp dcsp raise exceptions plotlyerror if dcsp colormap dcsp is dcsp a dcsp dictionary dcsp all dcsp the dcsp names dcsp in dcsp the dcsp index dcsp must dcsp be dcsp keys dcnl dcsp dcsp dcsp figure scatterplot dict dataframe headers diag size height width title index index vals endpts colormap colormap type kwargs dcnl dcsp dcsp dcsp return figure dcnl dcsp dcsp else dcnl dcsp dcsp dcsp figure scatterplot theme dataframe headers diag size height width title index index vals endpts colormap colormap type kwargs dcnl dcsp dcsp dcsp return figure
def validate streamline x y dcsp if np is false dcnl dcsp dcsp raise importerror figurefactory create streamline dcsp requires dcsp numpy dcnl dcsp for index in range len x 1 dcnl dcsp dcsp if x index + 1 xindex x1 x0 0 0001 dcnl dcsp dcsp dcsp raise exceptions plotlyerror x dcsp must dcsp be dcsp a dcsp 1 dcsp dimensional dcsp evenly dcsp spaced dcsp array dcnl dcsp for index in range len y 1 dcnl dcsp dcsp if y index + 1 yindex y1 y0 0 0001 dcnl dcsp dcsp dcsp raise exceptions plotlyerror y dcsp must dcsp be dcsp a dcsp 1 dcsp dimensional dcsp evenly dcsp spaced dcsp array
def create streamline x y u v density 1 angle math pi 9 arrow scale 0 09 kwargs dcsp utils validate equal length x y dcnl dcsp utils validate equal length u v dcnl dcsp validate streamline x y dcnl dcsp utils validate positive scalars density density arrow scale arrow scale dcnl dcsp streamline x streamline y streamline x y u v density angle arrow scale sum streamlines dcnl dcsp arrow x arrow y streamline x y u v density angle arrow scale get streamline arrows dcnl dcsp streamline graph objs scatter x streamline x + arrow x y streamline y + arrow y mode lines kwargs dcnl dcsp data streamline dcnl dcsp layout graph objs layout hovermode closest dcnl dcsp return graph objs figure data data layout layout
def validate index index vals dcsp from numbers import number dcnl dcsp if isinstance index vals0 number dcnl dcsp dcsp if not all isinstance item number for item in index vals dcnl dcsp dcsp dcsp raise exceptions plotlyerror error dcsp in dcsp indexing dcsp column dcsp make dcsp sure dcsp all dcsp entries dcsp of dcsp each dcsp column dcsp are dcsp all dcsp numbers dcsp or dcsp all dcsp strings dcnl dcsp elif isinstance index vals0 str dcnl dcsp dcsp if not all isinstance item str for item in index vals dcnl dcsp dcsp dcsp raise exceptions plotlyerror error dcsp in dcsp indexing dcsp column dcsp make dcsp sure dcsp all dcsp entries dcsp of dcsp each dcsp column dcsp are dcsp all dcsp numbers dcsp or dcsp all dcsp strings
def validate dataframe array dcsp from numbers import number dcnl dcsp for vector in array dcnl dcsp dcsp if isinstance vector0 number dcnl dcsp dcsp dcsp if not all isinstance item number for item in vector dcnl dcsp dcsp dcsp dcsp raise exceptions plotlyerror error dcsp in dcsp dataframe dcsp make dcsp sure dcsp all dcsp entries dcsp of dcsp each dcsp column dcsp are dcsp either dcsp numbers dcsp or dcsp strings dcnl dcsp dcsp elif isinstance vector0 str dcnl dcsp dcsp dcsp if not all isinstance item str for item in vector dcnl dcsp dcsp dcsp dcsp raise exceptions plotlyerror error dcsp in dcsp dataframe dcsp make dcsp sure dcsp all dcsp entries dcsp of dcsp each dcsp column dcsp are dcsp either dcsp numbers dcsp or dcsp strings
def validate equal length args dcsp length len args0 dcnl dcsp if any len lst length for lst in args dcnl dcsp dcsp raise exceptions plotlyerror oops dcsp your dcsp data dcsp lists dcsp or dcsp ndarrays dcsp should dcsp be dcsp the dcsp same dcsp length
def validate positive scalars kwargs dcsp for key val in kwargs items dcnl dcsp dcsp try dcnl dcsp dcsp dcsp if val < 0 dcnl dcsp dcsp dcsp dcsp raise valueerror dcsp must dcsp be dcsp dcsp 0 dcsp got dcsp format key val dcnl dcsp dcsp except typeerror dcnl dcsp dcsp dcsp raise exceptions plotlyerror dcsp must dcsp be dcsp a dcsp number dcsp got dcsp format key val
def flatten array dcsp try dcnl dcsp dcsp return item for sublist in array for item in sublist dcnl dcsp except typeerror dcnl dcsp dcsp raise exceptions plotlyerror your dcsp data dcsp array dcsp could dcsp not dcsp be dcsp flattened dcsp make dcsp sure dcsp your dcsp data dcsp is dcsp entered dcsp as dcsp lists dcsp or dcsp ndarrays
def find intermediate color lowcolor highcolor intermed dcsp diff 0 float highcolor0 lowcolor0 dcnl dcsp diff 1 float highcolor1 lowcolor1 dcnl dcsp diff 2 float highcolor2 lowcolor2 dcnl dcsp return lowcolor0 + intermed diff 0 lowcolor1 + intermed diff 1 lowcolor2 + intermed diff 2
def n colors lowcolor highcolor n colors dcsp diff 0 float highcolor0 lowcolor0 dcnl dcsp incr 0 diff 0 n colors 1 dcnl dcsp diff 1 float highcolor1 lowcolor1 dcnl dcsp incr 1 diff 1 n colors 1 dcnl dcsp diff 2 float highcolor2 lowcolor2 dcnl dcsp incr 2 diff 2 n colors 1 dcnl dcsp color tuples dcnl dcsp for index in range n colors dcnl dcsp dcsp new tuple lowcolor0 + index incr 0 lowcolor1 + index incr 1 lowcolor2 + index incr 2 dcnl dcsp dcsp color tuples append new tuple dcnl dcsp return color tuples
def label rgb colors dcsp return rgb s dcsp s dcsp s colors0 colors1 colors2
def unlabel rgb colors dcsp str vals dcnl dcsp for index in range len colors dcnl dcsp dcsp try dcnl dcsp dcsp dcsp float colorsindex dcnl dcsp dcsp dcsp str vals str vals + colorsindex dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp if colorsindex or colorsindex dcnl dcsp dcsp dcsp dcsp str vals str vals + colorsindex dcnl dcsp str vals str vals + dcnl dcsp numbers dcnl dcsp str num dcnl dcsp for char in str vals dcnl dcsp dcsp if char dcnl dcsp dcsp dcsp str num str num + char dcnl dcsp dcsp else dcnl dcsp dcsp dcsp numbers append float str num dcnl dcsp dcsp dcsp str num dcnl dcsp return numbers0 numbers1 numbers2
def unconvert from rgb 255 colors dcsp return colors0 255 0 colors1 255 0 colors2 255 0
def convert to rgb 255 colors dcsp rgb components dcnl dcsp for component in colors dcnl dcsp dcsp rounded num decimal decimal str component 255 0 quantize decimal decimal 1 rounding decimal round half even dcnl dcsp dcsp rounded num int rounded num dcnl dcsp dcsp rgb components append rounded num dcnl dcsp return rgb components0 rgb components1 rgb components2
def hex to rgb value dcsp value value lstrip dcnl dcsp hex total length len value dcnl dcsp rgb section length hex total length 3 dcnl dcsp return tuple int valuei i + rgb section length 16 for i in range 0 hex total length rgb section length
def color parser colors function dcsp from numbers import number dcnl dcsp if isinstance colors str dcnl dcsp dcsp return function colors dcnl dcsp if isinstance colors tuple and isinstance colors0 number dcnl dcsp dcsp return function colors dcnl dcsp if hasattr colors iter dcnl dcsp dcsp if isinstance colors tuple dcnl dcsp dcsp dcsp new color tuple tuple function item for item in colors dcnl dcsp dcsp dcsp return new color tuple dcnl dcsp dcsp else dcnl dcsp dcsp dcsp new color list function item for item in colors dcnl dcsp dcsp dcsp return new color list
def validate colors colors colortype tuple dcsp from numbers import number dcnl dcsp if colors is none dcnl dcsp dcsp colors default plotly colors dcnl dcsp if isinstance colors str dcnl dcsp dcsp if colors in plotly scales dcnl dcsp dcsp dcsp colors plotly scalescolors dcnl dcsp dcsp elif rgb in colors or in colors dcnl dcsp dcsp dcsp colors colors dcnl dcsp dcsp else dcnl dcsp dcsp dcsp raise exceptions plotlyerror if dcsp your dcsp colors dcsp variable dcsp is dcsp a dcsp string dcsp it dcsp must dcsp be dcsp a dcsp plotly dcsp scale dcsp an dcsp rgb dcsp color dcsp or dcsp a dcsp hex dcsp color dcnl dcsp elif isinstance colors tuple dcnl dcsp dcsp if isinstance colors0 number dcnl dcsp dcsp dcsp colors colors dcnl dcsp dcsp else dcnl dcsp dcsp dcsp colors list colors dcnl dcsp for j each color in enumerate colors dcnl dcsp dcsp if rgb in each color dcnl dcsp dcsp dcsp each color color parser each color unlabel rgb dcnl dcsp dcsp dcsp for value in each color dcnl dcsp dcsp dcsp dcsp if value 255 0 dcnl dcsp dcsp dcsp dcsp dcsp raise exceptions plotlyerror whoops dcsp the dcsp elements dcsp in dcsp your dcsp rgb dcsp colors dcsp tuples dcsp cannot dcsp exceed dcsp 255 0 dcnl dcsp dcsp dcsp each color color parser each color unconvert from rgb 255 dcnl dcsp dcsp dcsp colorsj each color dcnl dcsp dcsp if in each color dcnl dcsp dcsp dcsp each color color parser each color hex to rgb dcnl dcsp dcsp dcsp each color color parser each color unconvert from rgb 255 dcnl dcsp dcsp dcsp colorsj each color dcnl dcsp dcsp if isinstance each color tuple dcnl dcsp dcsp dcsp for value in each color dcnl dcsp dcsp dcsp dcsp if value 1 0 dcnl dcsp dcsp dcsp dcsp dcsp raise exceptions plotlyerror whoops dcsp the dcsp elements dcsp in dcsp your dcsp colors dcsp tuples dcsp cannot dcsp exceed dcsp 1 0 dcnl dcsp dcsp dcsp colorsj each color dcnl dcsp if colortype rgb dcnl dcsp dcsp for j each color in enumerate colors dcnl dcsp dcsp dcsp rgb color color parser each color convert to rgb 255 dcnl dcsp dcsp dcsp colorsj color parser rgb color label rgb dcnl dcsp return colors
def validate colors dict colors colortype tuple dcsp for key in colors dcnl dcsp dcsp if rgb in colorskey dcnl dcsp dcsp dcsp colorskey color parser colorskey unlabel rgb dcnl dcsp dcsp dcsp for value in colorskey dcnl dcsp dcsp dcsp dcsp if value 255 0 dcnl dcsp dcsp dcsp dcsp dcsp raise exceptions plotlyerror whoops dcsp the dcsp elements dcsp in dcsp your dcsp rgb dcsp colors dcsp tuples dcsp cannot dcsp exceed dcsp 255 0 dcnl dcsp dcsp dcsp colorskey color parser colorskey unconvert from rgb 255 dcnl dcsp dcsp if in colorskey dcnl dcsp dcsp dcsp colorskey color parser colorskey hex to rgb dcnl dcsp dcsp dcsp colorskey color parser colorskey unconvert from rgb 255 dcnl dcsp dcsp if isinstance colorskey tuple dcnl dcsp dcsp dcsp for value in colorskey dcnl dcsp dcsp dcsp dcsp if value 1 0 dcnl dcsp dcsp dcsp dcsp dcsp raise exceptions plotlyerror whoops dcsp the dcsp elements dcsp in dcsp your dcsp colors dcsp tuples dcsp cannot dcsp exceed dcsp 1 0 dcnl dcsp if colortype rgb dcnl dcsp dcsp for key in colors dcnl dcsp dcsp dcsp colorskey color parser colorskey convert to rgb 255 dcnl dcsp dcsp dcsp colorskey color parser colorskey label rgb dcnl dcsp return colors
def colorscale to colors colorscale dcsp color list dcnl dcsp for item in colorscale dcnl dcsp dcsp color list append item1 dcnl dcsp return color list
def colorscale to scale colorscale dcsp scale list dcnl dcsp for item in colorscale dcnl dcsp dcsp scale list append item0 dcnl dcsp return scale list
def validate scale values scale dcsp if len scale < 2 dcnl dcsp dcsp raise exceptions plotlyerror you dcsp must dcsp input dcsp a dcsp list dcsp of dcsp scale dcsp values dcsp that dcsp has dcsp at dcsp least dcsp two dcsp values dcnl dcsp if scale0 0 or scale 1 1 dcnl dcsp dcsp raise exceptions plotlyerror the dcsp first dcsp and dcsp last dcsp number dcsp in dcsp your dcsp scale dcsp must dcsp be dcsp 0 0 dcsp and dcsp 1 0 dcsp respectively dcnl dcsp if not all x < y for x y in zip scale scale1 dcnl dcsp dcsp raise exceptions plotlyerror scale dcsp must dcsp be dcsp a dcsp list dcsp that dcsp contains dcsp a dcsp strictly dcsp increasing dcsp sequence dcsp of dcsp numbers
def validate colorscale colorscale dcsp if not isinstance colorscale list dcnl dcsp dcsp raise exceptions plotlyerror a dcsp valid dcsp colorscale dcsp must dcsp be dcsp a dcsp list dcnl dcsp if not all isinstance innerlist list for innerlist in colorscale dcnl dcsp dcsp raise exceptions plotlyerror a dcsp valid dcsp colorscale dcsp must dcsp be dcsp a dcsp list dcsp of dcsp lists dcnl dcsp colorscale colors colorscale to colors colorscale dcnl dcsp scale values colorscale to scale colorscale dcnl dcsp validate scale values scale values dcnl dcsp validate colors colorscale colors
def endpts to intervals endpts dcsp length len endpts dcnl dcsp if not isinstance endpts tuple or isinstance endpts list dcnl dcsp dcsp raise exceptions plotlyerror the dcsp intervals endpts dcsp argument dcsp must dcsp be dcsp a dcsp list dcsp or dcsp tuple dcsp of dcsp a dcsp sequence dcsp of dcsp increasing dcsp numbers dcnl dcsp for item in endpts dcnl dcsp dcsp if isinstance item str dcnl dcsp dcsp dcsp raise exceptions plotlyerror the dcsp intervals endpts dcsp argument dcsp must dcsp be dcsp a dcsp list dcsp or dcsp tuple dcsp of dcsp a dcsp sequence dcsp of dcsp increasing dcsp numbers dcnl dcsp for k in range length 1 dcnl dcsp dcsp if endptsk endpts k + 1 dcnl dcsp dcsp dcsp raise exceptions plotlyerror the dcsp intervals endpts dcsp argument dcsp must dcsp be dcsp a dcsp list dcsp or dcsp tuple dcsp of dcsp a dcsp sequence dcsp of dcsp increasing dcsp numbers dcnl dcsp else dcnl dcsp dcsp intervals dcnl dcsp dcsp intervals append float inf endpts0 dcnl dcsp dcsp for k in range length 1 dcnl dcsp dcsp dcsp interval dcnl dcsp dcsp dcsp interval append endptsk dcnl dcsp dcsp dcsp interval append endpts k + 1 dcnl dcsp dcsp dcsp intervals append interval dcnl dcsp dcsp intervals append endpts length 1 float inf dcnl dcsp dcsp return intervals
def calc stats data dcsp x np asarray data np float dcnl dcsp vals min np min x dcnl dcsp vals max np max x dcnl dcsp q2 np percentile x 50 interpolation linear dcnl dcsp q1 np percentile x 25 interpolation lower dcnl dcsp q3 np percentile x 75 interpolation higher dcnl dcsp iqr q3 q1 dcnl dcsp whisker dist 1 5 iqr dcnl dcsp d1 np min x x q1 whisker dist dcnl dcsp d2 np max x x < q3 + whisker dist dcnl dcsp return min vals min max vals max q1 q1 q2 q2 q3 q3 d1 d1 d2 d2
def make half violin x y fillcolor 1f77b4 linecolor rgb 0 dcsp 0 dcsp 0 dcsp text pdf y dcsp y + 0 2f format xi + dcsp + 0 2f format yi + for i in range len x dcnl dcsp return graph objs scatter x x y y mode lines name text text fill tonextx fillcolor fillcolor line graph objs line width 0 5 color linecolor shape spline hoverinfo text opacity 0 5
def make violin rugplot vals pdf max distance color 1f77b4 dcsp return graph objs scatter y vals x pdf max distance len vals marker graph objs marker color color symbol lineewopen mode markers name showlegend false hoverinfo y
def make non outlier interval d1 d2 dcsp return graph objs scatter x 0 0 y d1 d2 name mode lines line graph objs line width 1 5 color rgb 0 0 0
def make quartiles q1 q3 dcsp return graph objs scatter x 0 0 y q1 q3 text lowerquartile dcsp + 0 2f format q1 upperquartile dcsp + 0 2f format q3 mode lines line graph objs line width 4 color rgb 0 0 0 hoverinfo text
def make median q2 dcsp return graph objs scatter x 0 y q2 text median dcsp + 0 2f format q2 mode markers marker dict symbol square color rgb 255 255 255 hoverinfo text
def make xaxis xaxis title xaxis range dcsp xaxis graph objs xaxis title xaxis title range xaxis range showgrid false zeroline false showline false mirror false ticks showticklabels false dcnl dcsp return xaxis
def make yaxis yaxis title dcsp yaxis graph objs yaxis title yaxis title showticklabels true autorange true ticklen 4 showline true zeroline false showgrid false mirror false dcnl dcsp return yaxis
def violinplot vals fillcolor 1f77b4 rugplot true dcsp vals np asarray vals np float dcnl dcsp vals min calc stats vals min dcnl dcsp vals max calc stats vals max dcnl dcsp q1 calc stats vals q1 dcnl dcsp q2 calc stats vals q2 dcnl dcsp q3 calc stats vals q3 dcnl dcsp d1 calc stats vals d1 dcnl dcsp d2 calc stats vals d2 dcnl dcsp pdf scipy stats gaussian kde vals dcnl dcsp xx np linspace vals min vals max 100 dcnl dcsp yy pdf xx dcnl dcsp max pdf np max yy dcnl dcsp distance 2 0 max pdf 10 if rugplot else 0 dcnl dcsp plot xrange max pdf distance 0 1 max pdf + 0 1 dcnl dcsp plot data make half violin yy xx fillcolor fillcolor make half violin yy xx fillcolor fillcolor make non outlier interval d1 d2 make quartiles q1 q3 make median q2 dcnl dcsp if rugplot dcnl dcsp dcsp plot data append make violin rugplot vals max pdf distance distance color fillcolor dcnl dcsp return plot data plot xrange
def violin no colorscale data data header group header colors use colorscale group stats rugplot sort height width title dcsp group name dcnl dcsp for name in datagroup header dcnl dcsp dcsp if name not in group name dcnl dcsp dcsp dcsp group name append name dcnl dcsp if sort dcnl dcsp dcsp group name sort dcnl dcsp gb data groupby group header dcnl dcsp l len group name dcnl dcsp fig make subplots rows 1 cols l shared yaxes true horizontal spacing 0 025 print grid false dcnl dcsp color index 0 dcnl dcsp for k gr in enumerate group name dcnl dcsp dcsp vals np asarray gb get group gr data header np float dcnl dcsp dcsp if color index len colors dcnl dcsp dcsp dcsp color index 0 dcnl dcsp dcsp plot data plot xrange violinplot vals fillcolor colorscolor index rugplot rugplot dcnl dcsp dcsp layout graph objs layout dcnl dcsp dcsp for item in plot data dcnl dcsp dcsp dcsp fig append trace item 1 k + 1 dcnl dcsp dcsp color index + 1 dcnl dcsp dcsp fig layout update xaxis format k + 1 make xaxis group namek plot xrange dcnl dcsp fig layout update yaxis format 1 make yaxis dcnl dcsp fig layout update title title showlegend false hovermode closest autosize false height height width width dcnl dcsp return fig
def violin colorscale data data header group header colors use colorscale group stats rugplot sort height width title dcsp group name dcnl dcsp for name in datagroup header dcnl dcsp dcsp if name not in group name dcnl dcsp dcsp dcsp group name append name dcnl dcsp if sort dcnl dcsp dcsp group name sort dcnl dcsp for group in group name dcnl dcsp dcsp if group not in group stats dcnl dcsp dcsp dcsp raise exceptions plotlyerror all dcsp values groups dcsp in dcsp the dcsp index dcsp column dcsp must dcsp be dcsp represented dcsp as dcsp a dcsp key dcsp in dcsp group stats dcnl dcsp gb data groupby group header dcnl dcsp l len group name dcnl dcsp fig make subplots rows 1 cols l shared yaxes true horizontal spacing 0 025 print grid false dcnl dcsp lowcolor utils color parser colors0 utils unlabel rgb dcnl dcsp highcolor utils color parser colors1 utils unlabel rgb dcnl dcsp group stats values dcnl dcsp for key in group stats dcnl dcsp dcsp group stats values append group statskey dcnl dcsp max value max group stats values dcnl dcsp min value min group stats values dcnl dcsp for k gr in enumerate group name dcnl dcsp dcsp vals np asarray gb get group gr data header np float dcnl dcsp dcsp intermed group statsgr min value max value min value dcnl dcsp dcsp intermed color utils find intermediate color lowcolor highcolor intermed dcnl dcsp dcsp plot data plot xrange violinplot vals fillcolor rgb format intermed color rugplot rugplot dcnl dcsp dcsp layout graph objs layout dcnl dcsp dcsp for item in plot data dcnl dcsp dcsp dcsp fig append trace item 1 k + 1 dcnl dcsp dcsp fig layout update xaxis format k + 1 make xaxis group namek plot xrange dcnl dcsp trace dummy graph objs scatter x 0 y 0 mode markers marker dict size 2 cmin min value cmax max value colorscale 0 colors0 1 colors1 showscale true showlegend false dcnl dcsp fig append trace trace dummy 1 l dcnl dcsp fig layout update yaxis format 1 make yaxis dcnl dcsp fig layout update title title showlegend false hovermode closest autosize false height height width width dcnl dcsp return fig
def violin dict data data header group header colors use colorscale group stats rugplot sort height width title dcsp group name dcnl dcsp for name in datagroup header dcnl dcsp dcsp if name not in group name dcnl dcsp dcsp dcsp group name append name dcnl dcsp if sort dcnl dcsp dcsp group name sort dcnl dcsp for group in group name dcnl dcsp dcsp if group not in colors dcnl dcsp dcsp dcsp raise exceptions plotlyerror if dcsp colors dcsp is dcsp a dcsp dictionary dcsp all dcsp the dcsp group dcsp names dcsp must dcsp appear dcsp as dcsp keys dcsp in dcsp colors dcnl dcsp gb data groupby group header dcnl dcsp l len group name dcnl dcsp fig make subplots rows 1 cols l shared yaxes true horizontal spacing 0 025 print grid false dcnl dcsp for k gr in enumerate group name dcnl dcsp dcsp vals np asarray gb get group gr data header np float dcnl dcsp dcsp plot data plot xrange violinplot vals fillcolor colorsgr rugplot rugplot dcnl dcsp dcsp layout graph objs layout dcnl dcsp dcsp for item in plot data dcnl dcsp dcsp dcsp fig append trace item 1 k + 1 dcnl dcsp dcsp fig layout update xaxis format k + 1 make xaxis group namek plot xrange dcnl dcsp fig layout update yaxis format 1 make yaxis dcnl dcsp fig layout update title title showlegend false hovermode closest autosize false height height width width dcnl dcsp return fig
def create violin data data header none group header none colors none use colorscale false group stats none rugplot true sort false height 450 width 600 title violin dcsp and dcsp rug dcsp plot dcsp if isinstance colors dict dcnl dcsp dcsp valid colors utils validate colors dict colors rgb dcnl dcsp else dcnl dcsp dcsp valid colors utils validate colors colors rgb dcnl dcsp if group header is none dcnl dcsp dcsp if isinstance data list dcnl dcsp dcsp dcsp if len data < 0 dcnl dcsp dcsp dcsp dcsp raise exceptions plotlyerror if dcsp data dcsp is dcsp a dcsp list dcsp it dcsp must dcsp be dcsp nonempty dcsp and dcsp contain dcsp either dcsp numbers dcsp or dcsp dictionaries dcnl dcsp dcsp dcsp if not all isinstance element number for element in data dcnl dcsp dcsp dcsp dcsp raise exceptions plotlyerror if dcsp data dcsp is dcsp a dcsp list dcsp it dcsp must dcsp contain dcsp only dcsp numbers dcnl dcsp dcsp if pd and isinstance data pd core frame dataframe dcnl dcsp dcsp dcsp if data header is none dcnl dcsp dcsp dcsp dcsp raise exceptions plotlyerror data header dcsp must dcsp be dcsp the dcsp column dcsp name dcsp with dcsp the dcsp desired dcsp numeric dcsp data dcsp for dcsp the dcsp violin dcsp plot dcnl dcsp dcsp dcsp data datadata header values tolist dcnl dcsp dcsp plot data plot xrange violinplot data fillcolor valid colors0 rugplot rugplot dcnl dcsp dcsp layout graph objs layout title title autosize false font graph objs font size 11 height height showlegend false width width xaxis make xaxis plot xrange yaxis make yaxis hovermode closest dcnl dcsp dcsp layout yaxis update dict showline false showticklabels false ticks dcnl dcsp dcsp fig graph objs figure data graph objs data plot data layout layout dcnl dcsp dcsp return fig dcnl dcsp else dcnl dcsp dcsp if not isinstance data pd core frame dataframe dcnl dcsp dcsp dcsp raise exceptions plotlyerror error dcsp you dcsp must dcsp use dcsp a dcsp pandas dcsp dataframe dcsp if dcsp you dcsp are dcsp using dcsp a dcsp group dcsp header dcnl dcsp dcsp if data header is none dcnl dcsp dcsp dcsp raise exceptions plotlyerror data header dcsp must dcsp be dcsp the dcsp column dcsp name dcsp with dcsp the dcsp desired dcsp numeric dcsp data dcsp for dcsp the dcsp violin dcsp plot dcnl dcsp dcsp if use colorscale is false dcnl dcsp dcsp dcsp if isinstance valid colors dict dcnl dcsp dcsp dcsp dcsp fig violin dict data data header group header valid colors use colorscale group stats rugplot sort height width title dcnl dcsp dcsp dcsp dcsp return fig dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp fig violin no colorscale data data header group header valid colors use colorscale group stats rugplot sort height width title dcnl dcsp dcsp dcsp dcsp return fig dcnl dcsp dcsp else dcnl dcsp dcsp dcsp if isinstance valid colors dict dcnl dcsp dcsp dcsp dcsp raise exceptions plotlyerror the dcsp colors dcsp param dcsp cannot dcsp be dcsp a dcsp dictionary dcsp if dcsp you dcsp are dcsp using dcsp a dcsp colorscale dcnl dcsp dcsp dcsp if len valid colors < 2 dcnl dcsp dcsp dcsp dcsp raise exceptions plotlyerror colors dcsp must dcsp be dcsp a dcsp list dcsp with dcsp at dcsp least dcsp 2 dcsp colors dcsp a dcsp plotly dcsp scale dcsp is dcsp allowed dcnl dcsp dcsp dcsp if not isinstance group stats dict dcnl dcsp dcsp dcsp dcsp raise exceptions plotlyerror your dcsp group stats dcsp param dcsp must dcsp be dcsp a dcsp dictionary dcnl dcsp dcsp dcsp fig violin colorscale data data header group header valid colors use colorscale group stats rugplot sort height width title dcnl dcsp dcsp dcsp return fig
def validate annotated heatmap z x y annotation text dcsp if annotation text is not none and isinstance annotation text list dcnl dcsp dcsp utils validate equal length z annotation text dcnl dcsp dcsp for lst in range len z dcnl dcsp dcsp dcsp if len zlst len annotation textlst dcnl dcsp dcsp dcsp dcsp raise exceptions plotlyerror z dcsp and dcsp text dcsp should dcsp have dcsp the dcsp same dcsp dimensions dcnl dcsp if x dcnl dcsp dcsp if len x len z0 dcnl dcsp dcsp dcsp raise exceptions plotlyerror oops dcsp the dcsp x dcsp list dcsp that dcsp you dcsp provided dcsp does dcsp not dcsp match dcsp the dcsp width dcsp of dcsp your dcsp z dcsp matrix dcsp dcnl dcsp if y dcnl dcsp dcsp if len y len z dcnl dcsp dcsp dcsp raise exceptions plotlyerror oops dcsp the dcsp y dcsp list dcsp that dcsp you dcsp provided dcsp does dcsp not dcsp match dcsp the dcsp length dcsp of dcsp your dcsp z dcsp matrix dcsp
def create annotated heatmap z x none y none annotation text none colorscale rdbu font colors none showscale false reversescale false kwargs dcsp font colors font colors if font colors is not none else dcnl dcsp validate annotated heatmap z x y annotation text dcnl dcsp annotations annotatedheatmap z x y annotation text colorscale font colors reversescale kwargs make annotations dcnl dcsp if x or y dcnl dcsp dcsp trace dict type heatmap z z x x y y colorscale colorscale showscale showscale kwargs dcnl dcsp dcsp layout dict annotations annotations xaxis dict ticks dtick 1 side top gridcolor rgb 0 dcsp 0 dcsp 0 yaxis dict ticks dtick 1 ticksuffix dcsp dcsp dcnl dcsp else dcnl dcsp dcsp trace dict type heatmap z z colorscale colorscale showscale showscale kwargs dcnl dcsp dcsp layout dict annotations annotations xaxis dict ticks side top gridcolor rgb 0 dcsp 0 dcsp 0 showticklabels false yaxis dict ticks ticksuffix dcsp dcsp showticklabels false dcnl dcsp data trace dcnl dcsp return graph objs figure data data layout layout
def validate distplot hist data curve type dcsp hist data types list dcnl dcsp if np dcnl dcsp dcsp hist data types + np ndarray dcnl dcsp if pd dcnl dcsp dcsp hist data types + pd core series series dcnl dcsp if not isinstance hist data0 hist data types dcnl dcsp dcsp raise exceptions plotlyerror oops dcsp this dcsp function dcsp was dcsp written dcsp to dcsp handle dcsp multiple dcsp datasets dcsp if dcsp you dcsp want dcsp to dcsp plot dcsp just dcsp one dcsp make dcsp sure dcsp your dcsp hist data dcsp variable dcsp is dcsp still dcsp a dcsp list dcsp of dcsp lists dcsp i e dcsp x dcsp dcsp 1 dcsp 2 dcsp 3 dcsp dcsp x dcsp dcsp 1 dcsp 2 dcsp 3 dcnl dcsp curve opts kde normal dcnl dcsp if curve type not in curve opts dcnl dcsp dcsp raise exceptions plotlyerror curve type dcsp must dcsp be dcsp defined dcsp as dcsp kde dcsp or dcsp normal dcnl dcsp if not scipy dcnl dcsp dcsp raise importerror figurefactory create distplot dcsp requires dcsp scipy
def create distplot hist data group labels bin size 1 0 curve type kde colors none rug text none histnorm default histnorm show hist true show curve true show rug true dcsp if colors is none dcnl dcsp dcsp colors dcnl dcsp if rug text is none dcnl dcsp dcsp rug text dcnl dcsp validate distplot hist data curve type dcnl dcsp utils validate equal length hist data group labels dcnl dcsp if isinstance bin size float int dcnl dcsp dcsp bin size bin size len hist data dcnl dcsp hist distplot hist data histnorm group labels bin size curve type colors rug text show hist show curve make hist dcnl dcsp if curve type normal dcnl dcsp dcsp curve distplot hist data histnorm group labels bin size curve type colors rug text show hist show curve make normal dcnl dcsp else dcnl dcsp dcsp curve distplot hist data histnorm group labels bin size curve type colors rug text show hist show curve make kde dcnl dcsp rug distplot hist data histnorm group labels bin size curve type colors rug text show hist show curve make rug dcnl dcsp data dcnl dcsp if show hist dcnl dcsp dcsp data append hist dcnl dcsp if show curve dcnl dcsp dcsp data append curve dcnl dcsp if show rug dcnl dcsp dcsp data append rug dcnl dcsp dcsp layout graph objs layout barmode overlay hovermode closest legend dict traceorder reversed xaxis1 dict domain 0 0 1 0 anchor y2 zeroline false yaxis1 dict domain 0 35 1 anchor free position 0 0 yaxis2 dict domain 0 0 25 anchor x1 dtick 1 showticklabels false dcnl dcsp else dcnl dcsp dcsp layout graph objs layout barmode overlay hovermode closest legend dict traceorder reversed xaxis1 dict domain 0 0 1 0 anchor y2 zeroline false yaxis1 dict domain 0 0 1 anchor free position 0 0 dcnl dcsp data sum data dcnl dcsp return graph objs figure data data layout layout
def create facet grid df x none y none facet row none facet col none color name none colormap none color is cat false facet row labels none facet col labels none height none width none trace type scatter scales fixed dtick x none dtick y none show boxes true ggplot2 false binsize 1 kwargs dcsp if not pd dcnl dcsp dcsp raise exceptions importerror pandas dcsp must dcsp be dcsp imported dcsp for dcsp this dcsp figure factory dcnl dcsp if not isinstance df pd dataframe dcnl dcsp dcsp raise exceptions plotlyerror you dcsp must dcsp input dcsp a dcsp pandas dcsp dataframe dcnl dcsp utils validate dataframe df dcnl dcsp if trace type in scatter scattergl dcnl dcsp dcsp if not x or not y dcnl dcsp dcsp dcsp raise exceptions plotlyerror you dcsp need dcsp to dcsp input dcsp x dcsp and dcsp y dcsp if dcsp you dcsp are dcsp you dcsp are dcsp using dcsp a dcsp trace type dcsp of dcsp scatter dcsp or dcsp scattergl dcnl dcsp for key in x y facet row facet col color name dcnl dcsp dcsp if key is not none dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp dfkey dcnl dcsp dcsp dcsp except keyerror dcnl dcsp dcsp dcsp dcsp raise exceptions plotlyerror x dcsp y dcsp facet row dcsp facet col dcsp and dcsp color name dcsp must dcsp be dcsp keys dcsp in dcsp your dcsp dataframe dcnl dcsp if trace type not in scatter scattergl dcnl dcsp dcsp scales free dcnl dcsp if scales not in fixed free x free y free dcnl dcsp dcsp raise exceptions plotlyerror scales dcsp must dcsp be dcsp set dcsp to dcsp fixed dcsp free x dcsp free y dcsp and dcsp free dcnl dcsp if trace type not in valid trace types dcnl dcsp dcsp raise exceptions plotlyerror trace type dcsp must dcsp be dcsp in dcsp format valid trace types dcnl dcsp if trace type histogram dcnl dcsp dcsp subplot spacing 0 06 dcnl dcsp else dcnl dcsp dcsp subplot spacing 0 015 dcnl dcsp if marker in kwargs dcnl dcsp dcsp kwargs marker kwargs marker dcnl dcsp else dcnl dcsp dcsp kwargs marker dcnl dcsp marker color kwargs marker pop color none dcnl dcsp kwargs pop marker none dcnl dcsp kwargs trace kwargs dcnl dcsp if size not in kwargs marker dcnl dcsp dcsp if ggplot2 dcnl dcsp dcsp dcsp kwargs marker size 5 dcnl dcsp dcsp else dcnl dcsp dcsp dcsp kwargs marker size 8 dcnl dcsp if opacity not in kwargs marker dcnl dcsp dcsp if not ggplot2 dcnl dcsp dcsp dcsp kwargs trace opacity 0 6 dcnl dcsp if line not in kwargs marker dcnl dcsp dcsp if not ggplot2 dcnl dcsp dcsp dcsp kwargs marker line color darkgrey width 1 dcnl dcsp dcsp else dcnl dcsp dcsp dcsp kwargs marker line dcnl dcsp if not ggplot2 dcnl dcsp dcsp if not marker color dcnl dcsp dcsp dcsp marker color rgb 31 dcsp 119 dcsp 180 dcnl dcsp else dcnl dcsp dcsp marker color rgb 0 dcsp 0 dcsp 0 dcnl dcsp num of rows 1 dcnl dcsp num of cols 1 dcnl dcsp flipped rows false dcnl dcsp flipped cols false dcnl dcsp if facet row dcnl dcsp dcsp num of rows len dffacet row unique dcnl dcsp dcsp flipped rows is flipped num of rows dcnl dcsp dcsp if isinstance facet row labels dict dcnl dcsp dcsp dcsp for key in dffacet row unique dcnl dcsp dcsp dcsp dcsp if key not in facet row labels keys dcnl dcsp dcsp dcsp dcsp dcsp unique keys dffacet row unique tolist dcnl dcsp dcsp dcsp dcsp dcsp raise exceptions plotlyerror custom label error format unique keys dcnl dcsp if facet col dcnl dcsp dcsp num of cols len dffacet col unique dcnl dcsp dcsp flipped cols is flipped num of cols dcnl dcsp dcsp if isinstance facet col labels dict dcnl dcsp dcsp dcsp for key in dffacet col unique dcnl dcsp dcsp dcsp dcsp if key not in facet col labels keys dcnl dcsp dcsp dcsp dcsp dcsp unique keys dffacet col unique tolist dcnl dcsp dcsp dcsp dcsp dcsp raise exceptions plotlyerror custom label error format unique keys dcnl dcsp show legend false dcnl dcsp if color name dcnl dcsp dcsp if isinstance dfcolor name iloc0 str or color is cat dcnl dcsp dcsp dcsp show legend true dcnl dcsp dcsp dcsp if isinstance colormap dict dcnl dcsp dcsp dcsp dcsp utils validate colors dict colormap rgb dcnl dcsp dcsp dcsp dcsp for val in dfcolor name unique dcnl dcsp dcsp dcsp dcsp dcsp if val not in colormap keys dcnl dcsp dcsp dcsp dcsp dcsp dcsp raise exceptions plotlyerror if dcsp using dcsp colormap dcsp as dcsp a dcsp dictionary dcsp make dcsp sure dcsp all dcsp the dcsp values dcsp of dcsp the dcsp colormap dcsp column dcsp are dcsp in dcsp the dcsp keys dcsp of dcsp your dcsp dictionary dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp default colors utils default plotly colors dcnl dcsp dcsp dcsp dcsp colormap dcnl dcsp dcsp dcsp dcsp j 0 dcnl dcsp dcsp dcsp dcsp for val in dfcolor name unique dcnl dcsp dcsp dcsp dcsp dcsp if j len default colors dcnl dcsp dcsp dcsp dcsp dcsp dcsp j 0 dcnl dcsp dcsp dcsp dcsp dcsp colormapval default colorsj dcnl dcsp dcsp dcsp dcsp dcsp j + 1 dcnl dcsp dcsp dcsp fig facet grid color categorical df x y facet row facet col color name colormap num of rows num of cols facet row labels facet col labels trace type flipped rows flipped cols show boxes subplot spacing marker color kwargs trace kwargs marker dcnl dcsp dcsp elif isinstance dfcolor name iloc0 number dcnl dcsp dcsp dcsp if isinstance colormap dict dcnl dcsp dcsp dcsp dcsp show legend true dcnl dcsp dcsp dcsp dcsp utils validate colors dict colormap rgb dcnl dcsp dcsp dcsp dcsp for val in dfcolor name unique dcnl dcsp dcsp dcsp dcsp dcsp if val not in colormap keys dcnl dcsp dcsp dcsp dcsp dcsp dcsp raise exceptions plotlyerror if dcsp using dcsp colormap dcsp as dcsp a dcsp dictionary dcsp make dcsp sure dcsp all dcsp the dcsp values dcsp of dcsp the dcsp colormap dcsp column dcsp are dcsp in dcsp the dcsp keys dcsp of dcsp your dcsp dictionary dcnl dcsp dcsp dcsp dcsp fig facet grid color categorical df x y facet row facet col color name colormap num of rows num of cols facet row labels facet col labels trace type flipped rows flipped cols show boxes subplot spacing marker color kwargs trace kwargs marker dcnl dcsp dcsp dcsp elif isinstance colormap list dcnl dcsp dcsp dcsp dcsp colorscale list colormap dcnl dcsp dcsp dcsp dcsp utils validate colorscale colorscale list dcnl dcsp dcsp dcsp dcsp fig facet grid color numerical df x y facet row facet col color name colorscale list num of rows num of cols facet row labels facet col labels trace type flipped rows flipped cols show boxes subplot spacing marker color kwargs trace kwargs marker dcnl dcsp dcsp dcsp elif isinstance colormap str dcnl dcsp dcsp dcsp dcsp if colormap in colors plotly scales keys dcnl dcsp dcsp dcsp dcsp dcsp colorscale list colors plotly scalescolormap dcnl dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp raise exceptions plotlyerror if dcsp colormap dcsp is dcsp a dcsp string dcsp it dcsp must dcsp be dcsp the dcsp name dcsp of dcsp a dcsp plotly dcsp colorscale dcsp the dcsp available dcsp colorscale dcsp names dcsp are dcsp format colors plotly scales keys dcnl dcsp dcsp dcsp dcsp fig facet grid color numerical df x y facet row facet col color name colorscale list num of rows num of cols facet row labels facet col labels trace type flipped rows flipped cols show boxes subplot spacing marker color kwargs trace kwargs marker dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp colorscale list colors plotly scales reds dcnl dcsp dcsp dcsp dcsp fig facet grid color numerical df x y facet row facet col color name colorscale list num of rows num of cols facet row labels facet col labels trace type flipped rows flipped cols show boxes subplot spacing marker color kwargs trace kwargs marker dcnl dcsp else dcnl dcsp dcsp fig facet grid df x y facet row facet col num of rows num of cols facet row labels facet col labels trace type flipped rows flipped cols show boxes subplot spacing marker color kwargs trace kwargs marker dcnl dcsp if not height dcnl dcsp dcsp height max 600 100 num of rows dcnl dcsp if not width dcnl dcsp dcsp width max 600 100 num of cols dcnl dcsp fig layout update height height width width title paper bgcolor rgb 251 dcsp 251 dcsp 251 dcnl dcsp if ggplot2 dcnl dcsp dcsp fig layout update plot bgcolor plot bgcolor paper bgcolor rgb 255 dcsp 255 dcsp 255 hovermode closest dcnl dcsp x title annot axis title annotation x x dcnl dcsp y title annot axis title annotation y y dcnl dcsp fig layout annotations append x title annot dcnl dcsp fig layout annotations append y title annot dcnl dcsp fig layout showlegend show legend dcnl dcsp fig layout legend bgcolor legend color dcnl dcsp fig layout legend borderwidth legend border width dcnl dcsp fig layout legend x 1 05 dcnl dcsp fig layout legend y 1 dcnl dcsp fig layout legend yanchor top dcnl dcsp if show legend dcnl dcsp dcsp fig layout showlegend show legend dcnl dcsp dcsp if ggplot2 dcnl dcsp dcsp dcsp if color name dcnl dcsp dcsp dcsp dcsp legend annot legend annotation color name dcnl dcsp dcsp dcsp dcsp fig layout annotations append legend annot dcnl dcsp dcsp dcsp fig layout margin r 150 dcnl dcsp if show boxes and ggplot2 dcnl dcsp dcsp add shapes to fig fig annot rect color flipped rows flipped cols dcnl dcsp axis labels x y dcnl dcsp for key in fig layout dcnl dcsp dcsp if xaxis in key dcnl dcsp dcsp dcsp axis labels x append key dcnl dcsp dcsp elif yaxis in key dcnl dcsp dcsp dcsp axis labels y append key dcnl dcsp string number in data false dcnl dcsp for var in v for v in x y if v dcnl dcsp dcsp if isinstance dfvar tolist 0 str dcnl dcsp dcsp dcsp for item in dfvar dcnl dcsp dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp dcsp int item dcnl dcsp dcsp dcsp dcsp dcsp string number in data true dcnl dcsp dcsp dcsp dcsp except valueerror dcnl dcsp dcsp dcsp dcsp dcsp pass dcnl dcsp if string number in data dcnl dcsp dcsp for x y in axis labels keys dcnl dcsp dcsp dcsp for axis name in axis labelsx y dcnl dcsp dcsp dcsp dcsp fig layout axis name type category dcnl dcsp if scales fixed dcnl dcsp dcsp fixed axes x y dcnl dcsp elif scales free x dcnl dcsp dcsp fixed axes y dcnl dcsp elif scales free y dcnl dcsp dcsp fixed axes x dcnl dcsp elif scales free dcnl dcsp dcsp fixed axes dcnl dcsp for x y in fixed axes dcnl dcsp dcsp min ranges dcnl dcsp dcsp max ranges dcnl dcsp dcsp for trace in fig data dcnl dcsp dcsp dcsp if tracex y is not none and len tracex y 0 dcnl dcsp dcsp dcsp dcsp min ranges append min tracex y dcnl dcsp dcsp dcsp dcsp max ranges append max tracex y dcnl dcsp dcsp while none in min ranges dcnl dcsp dcsp dcsp min ranges remove none dcnl dcsp dcsp while none in max ranges dcnl dcsp dcsp dcsp max ranges remove none dcnl dcsp dcsp min range min min ranges dcnl dcsp dcsp max range max max ranges dcnl dcsp dcsp range are numbers isinstance min range number and isinstance max range number dcnl dcsp dcsp if range are numbers dcnl dcsp dcsp dcsp min range math floor min range dcnl dcsp dcsp dcsp max range math ceil max range dcnl dcsp dcsp dcsp min range 0 05 max range min range dcnl dcsp dcsp dcsp max range + 0 05 max range min range dcnl dcsp dcsp dcsp if x y x dcnl dcsp dcsp dcsp dcsp if dtick x dcnl dcsp dcsp dcsp dcsp dcsp dtick dtick x dcnl dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp dtick math floor max range min range max ticks per axis dcnl dcsp dcsp dcsp elif x y y dcnl dcsp dcsp dcsp dcsp if dtick y dcnl dcsp dcsp dcsp dcsp dcsp dtick dtick y dcnl dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp dtick math floor max range min range max ticks per axis dcnl dcsp dcsp else dcnl dcsp dcsp dcsp dtick 1 dcnl dcsp dcsp for axis title in axis labelsx y dcnl dcsp dcsp dcsp fig layout axis title dtick dtick dcnl dcsp dcsp dcsp fig layout axis title ticklen 0 dcnl dcsp dcsp dcsp fig layout axis title zeroline false dcnl dcsp dcsp dcsp if ggplot2 dcnl dcsp dcsp dcsp dcsp fig layout axis title tickwidth 1 dcnl dcsp dcsp dcsp dcsp fig layout axis title ticklen 4 dcnl dcsp dcsp dcsp dcsp fig layout axis title gridwidth grid width dcnl dcsp dcsp dcsp dcsp fig layout axis title gridcolor grid color dcnl dcsp dcsp dcsp dcsp fig layout axis title gridwidth 2 dcnl dcsp dcsp dcsp dcsp fig layout axis title tickfont color tick color size 10 dcnl dcsp dcsp if x y in fixed axes dcnl dcsp dcsp dcsp for key in fig layout dcnl dcsp dcsp dcsp dcsp if axis format x y in key and range are numbers dcnl dcsp dcsp dcsp dcsp dcsp fig layout key range min range max range dcnl dcsp return fig
def make linear colorscale colors dcsp scale 1 0 len colors 1 dcnl dcsp return i scale color for i color in enumerate colors
def create 2d density x y colorscale earth ncontours 20 hist color 0 0 0 5 point color 0 0 0 5 point size 2 title 2d dcsp density dcsp plot height 600 width 600 dcsp for array in x y dcnl dcsp dcsp if not all isinstance element number for element in array dcnl dcsp dcsp dcsp raise exceptions plotlyerror all dcsp elements dcsp of dcsp your dcsp x dcsp and dcsp y dcsp lists dcsp must dcsp be dcsp numbers dcnl dcsp if len x len y dcnl dcsp dcsp raise exceptions plotlyerror both dcsp lists dcsp x dcsp and dcsp y dcsp must dcsp be dcsp the dcsp same dcsp length dcnl dcsp colorscale utils validate colors colorscale rgb dcnl dcsp colorscale make linear colorscale colorscale dcnl dcsp hist color utils validate colors hist color rgb dcnl dcsp point color utils validate colors point color rgb dcnl dcsp trace1 graph objs scatter x x y y mode markers name points marker dict color point color0 size point size opacity 0 4 dcnl dcsp trace2 graph objs histogram2dcontour x x y y name density ncontours ncontours colorscale colorscale reversescale true showscale false dcnl dcsp trace3 graph objs histogram x x name x dcsp density marker dict color hist color0 yaxis y2 dcnl dcsp trace4 graph objs histogram y y name y dcsp density marker dict color hist color0 xaxis x2 dcnl dcsp data trace1 trace2 trace3 trace4 dcnl dcsp layout graph objs layout showlegend false autosize false title title height height width width xaxis dict domain 0 0 85 showgrid false zeroline false yaxis dict domain 0 0 85 showgrid false zeroline false margin dict t 50 hovermode closest bargap 0 xaxis2 dict domain 0 85 1 showgrid false zeroline false yaxis2 dict domain 0 85 1 showgrid false zeroline false dcnl dcsp fig graph objs figure data data layout layout dcnl dcsp return fig
def validate ohlc open high low close direction kwargs dcsp for lst in open low close dcnl dcsp dcsp for index in range len high dcnl dcsp dcsp dcsp if highindex < lstindex dcnl dcsp dcsp dcsp dcsp raise exceptions plotlyerror oops dcsp looks dcsp like dcsp some dcsp of dcsp your dcsp high dcsp values dcsp are dcsp less dcsp the dcsp corresponding dcsp open dcsp low dcsp or dcsp close dcsp values dcsp double dcsp check dcsp that dcsp your dcsp data dcsp is dcsp entered dcsp in dcsp ohlc dcsp order dcnl dcsp for lst in open high close dcnl dcsp dcsp for index in range len low dcnl dcsp dcsp dcsp if lowindex lstindex dcnl dcsp dcsp dcsp dcsp raise exceptions plotlyerror oops dcsp looks dcsp like dcsp some dcsp of dcsp your dcsp low dcsp values dcsp are dcsp greater dcsp than dcsp the dcsp corresponding dcsp high dcsp open dcsp or dcsp close dcsp values dcsp double dcsp check dcsp that dcsp your dcsp data dcsp is dcsp entered dcsp in dcsp ohlc dcsp order dcnl dcsp direction opts increasing decreasing both dcnl dcsp if direction not in direction opts dcnl dcsp dcsp raise exceptions plotlyerror direction dcsp must dcsp be dcsp defined dcsp as dcsp increasing dcsp decreasing dcsp or dcsp both
def make increasing ohlc open high low close dates kwargs dcsp flat increase x flat increase y text increase ohlc open high low close dates get increase dcnl dcsp if name in kwargs dcnl dcsp dcsp showlegend true dcnl dcsp else dcnl dcsp dcsp kwargs setdefault name increasing dcnl dcsp dcsp showlegend false dcnl dcsp kwargs setdefault line dict color default increasing color width 1 dcnl dcsp kwargs setdefault text text increase dcnl dcsp ohlc incr dict type scatter x flat increase x y flat increase y mode lines showlegend showlegend kwargs dcnl dcsp return ohlc incr
def make decreasing ohlc open high low close dates kwargs dcsp flat decrease x flat decrease y text decrease ohlc open high low close dates get decrease dcnl dcsp kwargs setdefault line dict color default decreasing color width 1 dcnl dcsp kwargs setdefault text text decrease dcnl dcsp kwargs setdefault showlegend false dcnl dcsp kwargs setdefault name decreasing dcnl dcsp ohlc decr dict type scatter x flat decrease x y flat decrease y mode lines kwargs dcnl dcsp return ohlc decr
def create ohlc open high low close dates none direction both kwargs dcsp if dates is not none dcnl dcsp dcsp utils validate equal length open high low close dates dcnl dcsp else dcnl dcsp dcsp utils validate equal length open high low close dcnl dcsp validate ohlc open high low close direction kwargs dcnl dcsp if direction is increasing dcnl dcsp dcsp ohlc incr make increasing ohlc open high low close dates kwargs dcnl dcsp dcsp data ohlc incr dcnl dcsp elif direction is decreasing dcnl dcsp dcsp ohlc decr make decreasing ohlc open high low close dates kwargs dcnl dcsp dcsp data ohlc decr dcnl dcsp else dcnl dcsp dcsp ohlc incr make increasing ohlc open high low close dates kwargs dcnl dcsp dcsp ohlc decr make decreasing ohlc open high low close dates kwargs dcnl dcsp dcsp data ohlc incr ohlc decr dcnl dcsp layout graph objs layout xaxis dict zeroline false hovermode closest dcnl dcsp return graph objs figure data data layout layout
def create quiver x y u v scale 0 1 arrow scale 0 3 angle math pi 9 kwargs dcsp utils validate equal length x y u v dcnl dcsp utils validate positive scalars arrow scale arrow scale scale scale dcnl dcsp barb x barb y quiver x y u v scale arrow scale angle get barbs dcnl dcsp arrow x arrow y quiver x y u v scale arrow scale angle get quiver arrows dcnl dcsp quiver graph objs scatter x barb x + arrow x y barb y + arrow y mode lines kwargs dcnl dcsp data quiver dcnl dcsp layout graph objs layout hovermode closest dcnl dcsp return graph objs figure data data layout layout
def create dendrogram x orientation bottom labels none colorscale none distfun none linkagefun lambda x sch linkage x complete dcsp if not scp or not scs or not sch dcnl dcsp dcsp raise importerror figurefactory create dendrogram dcsp requires dcsp scipy dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp scipy spatial dcsp and dcsp scipy hierarchy dcnl dcsp s x shape dcnl dcsp if len s 2 dcnl dcsp dcsp exceptions plotlyerror x dcsp should dcsp be dcsp 2dimensional dcsp array dcnl dcsp if distfun is none dcnl dcsp dcsp distfun scs distance pdist dcnl dcsp dendrogram dendrogram x orientation labels colorscale distfun distfun linkagefun linkagefun dcnl dcsp return graph objs figure data dendrogram data layout dendrogram layout
def validate gantt df dcsp if pd and isinstance df pd core frame dataframe dcnl dcsp dcsp for key in required gantt keys dcnl dcsp dcsp dcsp if key not in df dcnl dcsp dcsp dcsp dcsp raise exceptions plotlyerror the dcsp columns dcsp in dcsp your dcsp dataframe dcsp must dcsp include dcsp the dcsp following dcsp keys dcsp 0 format dcsp join required gantt keys dcnl dcsp dcsp num of rows len df index dcnl dcsp dcsp chart dcnl dcsp dcsp for index in range num of rows dcnl dcsp dcsp dcsp task dict dcnl dcsp dcsp dcsp for key in df dcnl dcsp dcsp dcsp dcsp task dictkey df ixindexkey dcnl dcsp dcsp dcsp chart append task dict dcnl dcsp dcsp return chart dcnl dcsp if not isinstance df list dcnl dcsp dcsp raise exceptions plotlyerror you dcsp must dcsp input dcsp either dcsp a dcsp dataframe dcsp or dcsp a dcsp list dcsp of dcsp dictionaries dcnl dcsp if len df < 0 dcnl dcsp dcsp raise exceptions plotlyerror your dcsp list dcsp is dcsp empty dcsp it dcsp must dcsp contain dcsp at dcsp least dcsp one dcsp dictionary dcnl dcsp if not isinstance df0 dict dcnl dcsp dcsp raise exceptions plotlyerror your dcsp list dcsp must dcsp only dcsp include dcsp dictionaries dcnl dcsp return df
def gantt chart colors title bar width showgrid x showgrid y height width tasks none task names none data none group tasks false dcsp if tasks is none dcnl dcsp dcsp tasks dcnl dcsp if task names is none dcnl dcsp dcsp task names dcnl dcsp if data is none dcnl dcsp dcsp data dcnl dcsp for index in range len chart dcnl dcsp dcsp task dict x0 chartindex start x1 chartindex finish name chartindex task dcnl dcsp dcsp if description in chartindex dcnl dcsp dcsp dcsp task description chartindex description dcnl dcsp dcsp tasks append task dcnl dcsp shape template type rect xref x yref y opacity 1 line width 0 dcnl dcsp for index in range len tasks dcnl dcsp dcsp tn tasksindex name dcnl dcsp dcsp if not group tasks or tn not in task names dcnl dcsp dcsp dcsp task names append tn dcnl dcsp if group tasks dcnl dcsp dcsp task names reverse dcnl dcsp color index 0 dcnl dcsp for index in range len tasks dcnl dcsp dcsp tn tasksindex name dcnl dcsp dcsp del tasksindex name dcnl dcsp dcsp tasksindex update shape template dcnl dcsp dcsp groupid index dcnl dcsp dcsp if group tasks dcnl dcsp dcsp dcsp groupid task names index tn dcnl dcsp dcsp tasksindex y0 groupid bar width dcnl dcsp dcsp tasksindex y1 groupid + bar width dcnl dcsp dcsp if color index len colors dcnl dcsp dcsp dcsp color index 0 dcnl dcsp dcsp tasksindex fillcolor colorscolor index dcnl dcsp dcsp entry dict x tasksindex x0 tasksindex x1 y groupid groupid name marker color white dcnl dcsp dcsp if description in tasksindex dcnl dcsp dcsp dcsp entry text tasksindex description dcnl dcsp dcsp dcsp del tasksindex description dcnl dcsp dcsp data append entry dcnl dcsp dcsp color index + 1 dcnl dcsp layout dict title title showlegend false height height width width shapes hovermode closest yaxis dict showgrid showgrid y ticktext task names tickvals list range len task names range 1 len task names + 1 autorange false zeroline false xaxis dict showgrid showgrid x zeroline false rangeselector dict buttons list dict count 7 label 1w step day stepmode backward dict count 1 label 1m step month stepmode backward dict count 6 label 6m step month stepmode backward dict count 1 label ytd step year stepmode todate dict count 1 label 1y step year stepmode backward dict step all type date dcnl dcsp layout shapes tasks dcnl dcsp fig graph objs figure data data layout layout dcnl dcsp return fig
def gantt colorscale chart colors title index col show colorbar bar width showgrid x showgrid y height width tasks none task names none data none group tasks false dcsp if tasks is none dcnl dcsp dcsp tasks dcnl dcsp if task names is none dcnl dcsp dcsp task names dcnl dcsp if data is none dcnl dcsp dcsp data dcnl dcsp showlegend false dcnl dcsp for index in range len chart dcnl dcsp dcsp task dict x0 chartindex start x1 chartindex finish name chartindex task dcnl dcsp dcsp if description in chartindex dcnl dcsp dcsp dcsp task description chartindex description dcnl dcsp dcsp tasks append task dcnl dcsp shape template type rect xref x yref y opacity 1 line width 0 dcnl dcsp if isinstance chart0index col number dcnl dcsp dcsp if len colors < 2 dcnl dcsp dcsp dcsp raise exceptions plotlyerror you dcsp must dcsp use dcsp at dcsp least dcsp 2 dcsp colors dcsp in dcsp colors dcsp if dcsp you dcsp are dcsp using dcsp a dcsp colorscale dcsp however dcsp only dcsp the dcsp first dcsp two dcsp colors dcsp given dcsp will dcsp be dcsp used dcsp for dcsp the dcsp lower dcsp and dcsp upper dcsp bounds dcsp on dcsp the dcsp colormap dcnl dcsp dcsp for index in range len tasks dcnl dcsp dcsp dcsp tn tasksindex name dcnl dcsp dcsp dcsp if not group tasks or tn not in task names dcnl dcsp dcsp dcsp dcsp task names append tn dcnl dcsp dcsp if group tasks dcnl dcsp dcsp dcsp task names reverse dcnl dcsp dcsp for index in range len tasks dcnl dcsp dcsp dcsp tn tasksindex name dcnl dcsp dcsp dcsp del tasksindex name dcnl dcsp dcsp dcsp tasksindex update shape template dcnl dcsp dcsp dcsp groupid index dcnl dcsp dcsp dcsp if group tasks dcnl dcsp dcsp dcsp dcsp groupid task names index tn dcnl dcsp dcsp dcsp tasksindex y0 groupid bar width dcnl dcsp dcsp dcsp tasksindex y1 groupid + bar width dcnl dcsp dcsp dcsp colors utils color parser colors utils unlabel rgb dcnl dcsp dcsp dcsp lowcolor colors0 dcnl dcsp dcsp dcsp highcolor colors1 dcnl dcsp dcsp dcsp intermed chartindexindex col 100 0 dcnl dcsp dcsp dcsp intermed color utils find intermediate color lowcolor highcolor intermed dcnl dcsp dcsp dcsp intermed color utils color parser intermed color utils label rgb dcnl dcsp dcsp dcsp tasksindex fillcolor intermed color dcnl dcsp dcsp dcsp colors utils color parser colors utils label rgb dcnl dcsp dcsp dcsp entry dict x tasksindex x0 tasksindex x1 y groupid groupid name marker color white dcnl dcsp dcsp dcsp if description in tasksindex dcnl dcsp dcsp dcsp dcsp entry text tasksindex description dcnl dcsp dcsp dcsp dcsp del tasksindex description dcnl dcsp dcsp dcsp data append entry dcnl dcsp dcsp if show colorbar is true dcnl dcsp dcsp dcsp data append dict x tasksindex x0 tasksindex x0 y index index name marker color white colorscale 0 colors0 1 colors1 showscale true cmax 100 cmin 0 dcnl dcsp if isinstance chart0index col str dcnl dcsp dcsp index vals dcnl dcsp dcsp for row in range len tasks dcnl dcsp dcsp dcsp if chartrowindex col not in index vals dcnl dcsp dcsp dcsp dcsp index vals append chartrowindex col dcnl dcsp dcsp index vals sort dcnl dcsp dcsp if len colors < len index vals dcnl dcsp dcsp dcsp raise exceptions plotlyerror error dcsp the dcsp number dcsp of dcsp colors dcsp in dcsp colors dcsp must dcsp be dcsp no dcsp less dcsp than dcsp the dcsp number dcsp of dcsp unique dcsp index dcsp values dcsp in dcsp your dcsp group dcsp column dcnl dcsp dcsp index vals dict dcnl dcsp dcsp c index 0 dcnl dcsp dcsp for key in index vals dcnl dcsp dcsp dcsp if c index len colors 1 dcnl dcsp dcsp dcsp dcsp c index 0 dcnl dcsp dcsp dcsp index vals dictkey colorsc index dcnl dcsp dcsp dcsp c index + 1 dcnl dcsp dcsp for index in range len tasks dcnl dcsp dcsp dcsp tn tasksindex name dcnl dcsp dcsp dcsp if not group tasks or tn not in task names dcnl dcsp dcsp dcsp dcsp task names append tn dcnl dcsp dcsp if group tasks dcnl dcsp dcsp dcsp task names reverse dcnl dcsp dcsp for index in range len tasks dcnl dcsp dcsp dcsp tn tasksindex name dcnl dcsp dcsp dcsp del tasksindex name dcnl dcsp dcsp dcsp tasksindex update shape template dcnl dcsp dcsp dcsp groupid index dcnl dcsp dcsp dcsp if group tasks dcnl dcsp dcsp dcsp dcsp groupid task names index tn dcnl dcsp dcsp dcsp tasksindex y0 groupid bar width dcnl dcsp dcsp dcsp tasksindex y1 groupid + bar width dcnl dcsp dcsp dcsp tasksindex fillcolor index vals dictchartindexindex col dcnl dcsp dcsp dcsp entry dict x tasksindex x0 tasksindex x1 y groupid groupid name marker color white dcnl dcsp dcsp dcsp if description in tasksindex dcnl dcsp dcsp dcsp dcsp entry text tasksindex description dcnl dcsp dcsp dcsp dcsp del tasksindex description dcnl dcsp dcsp dcsp data append entry dcnl dcsp dcsp if show colorbar is true dcnl dcsp dcsp dcsp showlegend true dcnl dcsp dcsp dcsp for k index value in enumerate index vals dcnl dcsp dcsp dcsp dcsp data append dict x tasksindex x0 tasksindex x0 y k k showlegend true name str index value hoverinfo none marker dict color colorsk size 1 dcnl dcsp layout dict title title showlegend showlegend height height width width shapes hovermode closest yaxis dict showgrid showgrid y ticktext task names tickvals list range len task names range 1 len task names + 1 autorange false zeroline false xaxis dict showgrid showgrid x zeroline false rangeselector dict buttons list dict count 7 label 1w step day stepmode backward dict count 1 label 1m step month stepmode backward dict count 6 label 6m step month stepmode backward dict count 1 label ytd step year stepmode todate dict count 1 label 1y step year stepmode backward dict step all type date dcnl dcsp layout shapes tasks dcnl dcsp fig dict data data layout layout dcnl dcsp return fig
def gantt dict chart colors title index col show colorbar bar width showgrid x showgrid y height width tasks none task names none data none group tasks false dcsp if tasks is none dcnl dcsp dcsp tasks dcnl dcsp if task names is none dcnl dcsp dcsp task names dcnl dcsp if data is none dcnl dcsp dcsp data dcnl dcsp showlegend false dcnl dcsp for index in range len chart dcnl dcsp dcsp task dict x0 chartindex start x1 chartindex finish name chartindex task dcnl dcsp dcsp if description in chartindex dcnl dcsp dcsp dcsp task description chartindex description dcnl dcsp dcsp tasks append task dcnl dcsp shape template type rect xref x yref y opacity 1 line width 0 dcnl dcsp index vals dcnl dcsp for row in range len tasks dcnl dcsp dcsp if chartrowindex col not in index vals dcnl dcsp dcsp dcsp index vals append chartrowindex col dcnl dcsp index vals sort dcnl dcsp for key in index vals dcnl dcsp dcsp if key not in colors dcnl dcsp dcsp dcsp raise exceptions plotlyerror if dcsp you dcsp are dcsp using dcsp colors dcsp as dcsp a dcsp dictionary dcsp all dcsp of dcsp its dcsp keys dcsp must dcsp be dcsp all dcsp the dcsp values dcsp in dcsp the dcsp index dcsp column dcnl dcsp for index in range len tasks dcnl dcsp dcsp tn tasksindex name dcnl dcsp dcsp if not group tasks or tn not in task names dcnl dcsp dcsp dcsp task names append tn dcnl dcsp if group tasks dcnl dcsp dcsp task names reverse dcnl dcsp for index in range len tasks dcnl dcsp dcsp tn tasksindex name dcnl dcsp dcsp del tasksindex name dcnl dcsp dcsp tasksindex update shape template dcnl dcsp dcsp groupid index dcnl dcsp dcsp if group tasks dcnl dcsp dcsp dcsp groupid task names index tn dcnl dcsp dcsp tasksindex y0 groupid bar width dcnl dcsp dcsp tasksindex y1 groupid + bar width dcnl dcsp dcsp tasksindex fillcolor colorschartindexindex col dcnl dcsp dcsp entry dict x tasksindex x0 tasksindex x1 y groupid groupid name marker color white dcnl dcsp dcsp if description in tasksindex dcnl dcsp dcsp dcsp entry text tasksindex description dcnl dcsp dcsp dcsp del tasksindex description dcnl dcsp dcsp data append entry dcnl dcsp if show colorbar is true dcnl dcsp dcsp showlegend true dcnl dcsp dcsp for k index value in enumerate index vals dcnl dcsp dcsp dcsp data append dict x tasksindex x0 tasksindex x0 y k k showlegend true hoverinfo none name str index value marker dict color colorsindex value size 1 dcnl dcsp layout dict title title showlegend showlegend height height width width shapes hovermode closest yaxis dict showgrid showgrid y ticktext task names tickvals list range len task names range 1 len task names + 1 autorange false zeroline false xaxis dict showgrid showgrid x zeroline false rangeselector dict buttons list dict count 7 label 1w step day stepmode backward dict count 1 label 1m step month stepmode backward dict count 6 label 6m step month stepmode backward dict count 1 label ytd step year stepmode todate dict count 1 label 1y step year stepmode backward dict step all type date dcnl dcsp layout shapes tasks dcnl dcsp fig dict data data layout layout dcnl dcsp return fig
def create gantt df colors none index col none show colorbar false reverse colors false title gantt dcsp chart bar width 0 2 showgrid x false showgrid y false height 600 width 900 tasks none task names none data none group tasks false dcsp chart validate gantt df dcnl dcsp if index col dcnl dcsp dcsp if index col not in chart0 dcnl dcsp dcsp dcsp raise exceptions plotlyerror in dcsp order dcsp to dcsp use dcsp an dcsp indexing dcsp column dcsp and dcsp assign dcsp colors dcsp to dcsp the dcsp values dcsp of dcsp the dcsp index dcsp you dcsp must dcsp choose dcsp an dcsp actual dcsp column dcsp name dcsp in dcsp the dcsp dataframe dcsp or dcsp key dcsp if dcsp a dcsp list dcsp of dcsp dictionaries dcsp is dcsp being dcsp used dcnl dcsp dcsp index list dcnl dcsp dcsp for dictionary in chart dcnl dcsp dcsp dcsp index list append dictionaryindex col dcnl dcsp dcsp utils validate index index list dcnl dcsp if isinstance colors dict dcnl dcsp dcsp colors utils validate colors dict colors rgb dcnl dcsp else dcnl dcsp dcsp colors utils validate colors colors rgb dcnl dcsp if reverse colors is true dcnl dcsp dcsp colors reverse dcnl dcsp if not index col dcnl dcsp dcsp if isinstance colors dict dcnl dcsp dcsp dcsp raise exceptions plotlyerror error dcsp you dcsp have dcsp set dcsp colors dcsp to dcsp a dcsp dictionary dcsp but dcsp have dcsp not dcsp picked dcsp an dcsp index dcsp an dcsp index dcsp is dcsp required dcsp if dcsp you dcsp are dcsp assigning dcsp colors dcsp to dcsp particular dcsp values dcsp in dcsp a dcsp dictioanry dcnl dcsp dcsp fig gantt chart colors title bar width showgrid x showgrid y height width tasks none task names none data none group tasks group tasks dcnl dcsp dcsp return fig dcnl dcsp elif not isinstance colors dict dcnl dcsp dcsp fig gantt colorscale chart colors title index col show colorbar bar width showgrid x showgrid y height width tasks none task names none data none group tasks group tasks dcnl dcsp dcsp return fig dcnl dcsp else dcnl dcsp dcsp fig gantt dict chart colors title index col show colorbar bar width showgrid x showgrid y height width tasks none task names none data none group tasks group tasks dcnl dcsp dcsp return fig
def validate table table text font colors dcsp font colors len options 1 3 len table text dcnl dcsp if len font colors not in font colors len options dcnl dcsp dcsp raise exceptions plotlyerror oops dcsp font colors dcsp should dcsp be dcsp a dcsp list dcsp of dcsp length dcsp 1 dcsp 3 dcsp or dcsp len text
def create table table text colorscale none font colors none index false index title annotation offset 0 45 height constant 30 hoverinfo none kwargs dcsp colorscale colorscale if colorscale is not none else 0 00083e 0 5 ededee 1 ffffff dcnl dcsp font colors font colors if font colors is not none else ffffff 000000 000000 dcnl dcsp validate table table text font colors dcnl dcsp table matrix table table text colorscale font colors index index title annotation offset kwargs get table matrix dcnl dcsp annotations table table text colorscale font colors index index title annotation offset kwargs make table annotations dcnl dcsp trace dict type heatmap z table matrix opacity 0 75 colorscale colorscale showscale false hoverinfo hoverinfo kwargs dcnl dcsp data trace dcnl dcsp layout dict annotations annotations height len table matrix height constant + 50 margin dict t 0 b 0 r 0 l 0 yaxis dict autorange reversed zeroline false gridwidth 2 ticks dtick 1 tick0 0 5 showticklabels false xaxis dict zeroline false gridwidth 2 ticks dtick 1 tick0 0 5 showticklabels false dcnl dcsp return graph objs figure data data layout layout
def make increasing candle open high low close dates kwargs dcsp increase x increase y candlestick open high low close dates kwargs get candle increase dcnl dcsp if line in kwargs dcnl dcsp dcsp kwargs setdefault fillcolor kwargs line color dcnl dcsp else dcnl dcsp dcsp kwargs setdefault fillcolor default increasing color dcnl dcsp if name in kwargs dcnl dcsp dcsp kwargs setdefault showlegend true dcnl dcsp else dcnl dcsp dcsp kwargs setdefault showlegend false dcnl dcsp kwargs setdefault name increasing dcnl dcsp kwargs setdefault line dict color default increasing color dcnl dcsp candle incr data dict type box x increase x y increase y whiskerwidth 0 boxpoints false kwargs dcnl dcsp return candle incr data
def make decreasing candle open high low close dates kwargs dcsp decrease x decrease y candlestick open high low close dates kwargs get candle decrease dcnl dcsp if line in kwargs dcnl dcsp dcsp kwargs setdefault fillcolor kwargs line color dcnl dcsp else dcnl dcsp dcsp kwargs setdefault fillcolor default decreasing color dcnl dcsp kwargs setdefault showlegend false dcnl dcsp kwargs setdefault line dict color default decreasing color dcnl dcsp kwargs setdefault name decreasing dcnl dcsp candle decr data dict type box x decrease x y decrease y whiskerwidth 0 boxpoints false kwargs dcnl dcsp return candle decr data
def create candlestick open high low close dates none direction both kwargs dcsp if dates is not none dcnl dcsp dcsp utils validate equal length open high low close dates dcnl dcsp else dcnl dcsp dcsp utils validate equal length open high low close dcnl dcsp validate ohlc open high low close direction kwargs dcnl dcsp if direction is increasing dcnl dcsp dcsp candle incr data make increasing candle open high low close dates kwargs dcnl dcsp dcsp data candle incr data dcnl dcsp elif direction is decreasing dcnl dcsp dcsp candle decr data make decreasing candle open high low close dates kwargs dcnl dcsp dcsp data candle decr data dcnl dcsp else dcnl dcsp dcsp candle incr data make increasing candle open high low close dates kwargs dcnl dcsp dcsp candle decr data make decreasing candle open high low close dates kwargs dcnl dcsp dcsp data candle incr data + candle decr data dcnl dcsp layout graph objs layout dcnl dcsp return graph objs figure data data layout layout
def generate conflicting plot options in signin dcsp def gen test plot options dcnl dcsp dcsp def test self dcnl dcsp dcsp dcsp py sign in username key plot options dcnl dcsp dcsp dcsp self assertraises plotlyerror py plot option logic dcnl dcsp dcsp return test dcnl dcsp for i plot options in enumerate testplotoptionlogic conflicting option set dcnl dcsp dcsp setattr testplotoptionlogic test conflicting plot options in signin format i gen test plot options
def generate conflicting plot options in tools dot set config dcsp def gen test plot options dcnl dcsp dcsp def test self dcnl dcsp dcsp dcsp self assertraises plotlyerror tls set config file plot options dcnl dcsp dcsp return test dcnl dcsp for i plot options in enumerate testplotoptionlogic conflicting option set dcnl dcsp dcsp setattr testplotoptionlogic test conflicting plot options in tools dot set config format i gen test plot options
def generate conflicting plot options with json writes of config dcsp def gen test plot options dcnl dcsp dcsp def test self dcnl dcsp dcsp dcsp config json load open config file dcnl dcsp dcsp dcsp with open config file w as f dcnl dcsp dcsp dcsp dcsp config update plot options dcnl dcsp dcsp dcsp dcsp f write json dumps config dcnl dcsp dcsp dcsp self assertraises plotlyerror py plot option logic dcnl dcsp dcsp return test dcnl dcsp for i plot options in enumerate testplotoptionlogic conflicting option set dcnl dcsp dcsp setattr testplotoptionlogic test conflicting plot options with json writes of config format i gen test plot options
def generate private sharing and public world readable precedence dcsp plot option sets parent world readable true auto open false child sharing secret auto open true expected output world readable false sharing secret auto open true parent world readable true auto open true child sharing private auto open false expected output world readable false sharing private auto open false parent world readable false auto open false child sharing public auto open true expected output world readable true sharing public auto open true dcnl dcsp def gen test signin plot options dcnl dcsp dcsp def test self dcnl dcsp dcsp dcsp py sign in username key plot options parent dcnl dcsp dcsp dcsp options py plot option logic plot options child dcnl dcsp dcsp dcsp for option value in plot options expected output items dcnl dcsp dcsp dcsp dcsp self assertequal optionsoption value dcnl dcsp dcsp return test dcnl dcsp def gen test config plot options dcnl dcsp dcsp def test self dcnl dcsp dcsp dcsp tls set config plot options parent dcnl dcsp dcsp dcsp options py plot option logic plot options child dcnl dcsp dcsp dcsp for option value in plot options expected output items dcnl dcsp dcsp dcsp dcsp self assertequal optionsoption value dcnl dcsp for i plot options in enumerate plot option sets dcnl dcsp dcsp setattr testplotoptionlogic test private sharing and public world readable precedence signin format i gen test signin plot options dcnl dcsp dcsp setattr testplotoptionlogic test private sharing and public world readable precedence config format i gen test config plot options
def color parser colors function dcsp if isinstance colors str dcnl dcsp dcsp return function colors dcnl dcsp if isinstance colors tuple and isinstance colors0 number dcnl dcsp dcsp return function colors dcnl dcsp if hasattr colors iter dcnl dcsp dcsp if isinstance colors tuple dcnl dcsp dcsp dcsp new color tuple tuple function item for item in colors dcnl dcsp dcsp dcsp return new color tuple dcnl dcsp dcsp else dcnl dcsp dcsp dcsp new color list function item for item in colors dcnl dcsp dcsp dcsp return new color list
def validate colors colors dcsp colors list dcnl dcsp if isinstance colors str dcnl dcsp dcsp if colors in plotly scales dcnl dcsp dcsp dcsp return dcnl dcsp dcsp elif rgb in colors or in colors dcnl dcsp dcsp dcsp colors list append colors dcnl dcsp dcsp else dcnl dcsp dcsp dcsp raise exceptions plotlyerror if dcsp your dcsp colors dcsp variable dcsp is dcsp a dcsp string dcsp it dcsp must dcsp be dcsp a dcsp plotly dcsp scale dcsp an dcsp rgb dcsp color dcsp or dcsp a dcsp hex dcsp color dcnl dcsp elif isinstance colors tuple dcnl dcsp dcsp if isinstance colors0 number dcnl dcsp dcsp dcsp colors list colors dcnl dcsp dcsp else dcnl dcsp dcsp dcsp colors list list colors dcnl dcsp if isinstance colors dict dcnl dcsp dcsp colors list extend colors values dcnl dcsp elif isinstance colors list dcnl dcsp dcsp colors list colors dcnl dcsp for j each color in enumerate colors list dcnl dcsp dcsp if rgb in each color dcnl dcsp dcsp dcsp each color color parser each color unlabel rgb dcnl dcsp dcsp dcsp for value in each color dcnl dcsp dcsp dcsp dcsp if value 255 0 dcnl dcsp dcsp dcsp dcsp dcsp raise exceptions plotlyerror whoops dcsp the dcsp elements dcsp in dcsp your dcsp rgb dcsp colors dcsp tuples dcsp cannot dcsp exceed dcsp 255 0 dcnl dcsp dcsp elif in each color dcnl dcsp dcsp dcsp each color color parser each color hex to rgb dcnl dcsp dcsp elif isinstance each color tuple dcnl dcsp dcsp dcsp for value in each color dcnl dcsp dcsp dcsp dcsp if value 1 0 dcnl dcsp dcsp dcsp dcsp dcsp raise exceptions plotlyerror whoops dcsp the dcsp elements dcsp in dcsp your dcsp colors dcsp tuples dcsp cannot dcsp exceed dcsp 1 0
def convert colors to same type colors colortype rgb scale none return default colors false num of defualt colors 2 dcsp colors list dcnl dcsp if colors is none and return default colors is true dcnl dcsp dcsp colors list default plotly colors0 num of defualt colors dcnl dcsp if isinstance colors str dcnl dcsp dcsp if colors in plotly scales dcnl dcsp dcsp dcsp colors list colorscale to colors plotly scalescolors dcnl dcsp dcsp dcsp if scale is none dcnl dcsp dcsp dcsp dcsp scale colorscale to scale plotly scalescolors dcnl dcsp dcsp elif rgb in colors or in colors dcnl dcsp dcsp dcsp colors list colors dcnl dcsp elif isinstance colors tuple dcnl dcsp dcsp if isinstance colors0 number dcnl dcsp dcsp dcsp colors list colors dcnl dcsp dcsp else dcnl dcsp dcsp dcsp colors list list colors dcnl dcsp elif isinstance colors list dcnl dcsp dcsp colors list colors dcnl dcsp if scale is not none dcnl dcsp dcsp validate scale values scale dcnl dcsp dcsp if len colors list len scale dcnl dcsp dcsp dcsp raise exceptions plotlyerror make dcsp sure dcsp that dcsp the dcsp length dcsp of dcsp your dcsp scale dcsp matches dcsp the dcsp length dcsp of dcsp your dcsp list dcsp of dcsp colors dcsp which dcsp is dcsp format len colors list dcnl dcsp for j each color in enumerate colors list dcnl dcsp dcsp if in each color dcnl dcsp dcsp dcsp each color color parser each color hex to rgb dcnl dcsp dcsp dcsp each color color parser each color label rgb dcnl dcsp dcsp dcsp colors listj each color dcnl dcsp dcsp elif isinstance each color tuple dcnl dcsp dcsp dcsp each color color parser each color convert to rgb 255 dcnl dcsp dcsp dcsp each color color parser each color label rgb dcnl dcsp dcsp dcsp colors listj each color dcnl dcsp if colortype rgb dcnl dcsp dcsp return colors list scale dcnl dcsp elif colortype tuple dcnl dcsp dcsp for j each color in enumerate colors list dcnl dcsp dcsp dcsp each color color parser each color unlabel rgb dcnl dcsp dcsp dcsp each color color parser each color unconvert from rgb 255 dcnl dcsp dcsp dcsp colors listj each color dcnl dcsp dcsp return colors list scale dcnl dcsp else dcnl dcsp dcsp raise exceptions plotlyerror you dcsp must dcsp select dcsp either dcsp rgb dcsp or dcsp tuple dcsp for dcsp your dcsp colortype dcsp variable
def convert dict colors to same type colors dict colortype rgb dcsp for key in colors dict dcnl dcsp dcsp if in colors dictkey dcnl dcsp dcsp dcsp colors dictkey color parser colors dictkey hex to rgb dcnl dcsp dcsp dcsp colors dictkey color parser colors dictkey label rgb dcnl dcsp dcsp elif isinstance colors dictkey tuple dcnl dcsp dcsp dcsp colors dictkey color parser colors dictkey convert to rgb 255 dcnl dcsp dcsp dcsp colors dictkey color parser colors dictkey label rgb dcnl dcsp if colortype rgb dcnl dcsp dcsp return colors dict dcnl dcsp elif colortype tuple dcnl dcsp dcsp for key in colors dict dcnl dcsp dcsp dcsp colors dictkey color parser colors dictkey unlabel rgb dcnl dcsp dcsp dcsp colors dictkey color parser colors dictkey unconvert from rgb 255 dcnl dcsp dcsp return colors dict dcnl dcsp else dcnl dcsp dcsp raise exceptions plotlyerror you dcsp must dcsp select dcsp either dcsp rgb dcsp or dcsp tuple dcsp for dcsp your dcsp colortype dcsp variable
def validate scale values scale dcsp if len scale < 2 dcnl dcsp dcsp raise exceptions plotlyerror you dcsp must dcsp input dcsp a dcsp list dcsp of dcsp scale dcsp values dcsp that dcsp has dcsp at dcsp least dcsp two dcsp values dcnl dcsp if scale0 0 or scale 1 1 dcnl dcsp dcsp raise exceptions plotlyerror the dcsp first dcsp and dcsp last dcsp number dcsp in dcsp your dcsp scale dcsp must dcsp be dcsp 0 0 dcsp and dcsp 1 0 dcsp respectively dcnl dcsp if not all x < y for x y in zip scale scale1 dcnl dcsp dcsp raise exceptions plotlyerror scale dcsp must dcsp be dcsp a dcsp list dcsp that dcsp contains dcsp a dcsp strictly dcsp increasing dcsp sequence dcsp of dcsp numbers
def make colorscale colors scale none dcsp colorscale dcnl dcsp if len colors < 2 dcnl dcsp dcsp raise exceptions plotlyerror you dcsp must dcsp input dcsp a dcsp list dcsp of dcsp colors dcsp that dcsp has dcsp at dcsp least dcsp two dcsp colors dcnl dcsp if scale is none dcnl dcsp dcsp scale incr 1 0 len colors 1 dcnl dcsp dcsp return i scale incr color for i color in enumerate colors dcnl dcsp else dcnl dcsp dcsp if len colors len scale dcnl dcsp dcsp dcsp raise exceptions plotlyerror the dcsp length dcsp of dcsp colors dcsp and dcsp scale dcsp must dcsp be dcsp the dcsp same dcnl dcsp dcsp validate scale values scale dcnl dcsp dcsp colorscale list tup for tup in zip scale colors dcnl dcsp dcsp return colorscale
def find intermediate color lowcolor highcolor intermed dcsp diff 0 float highcolor0 lowcolor0 dcnl dcsp diff 1 float highcolor1 lowcolor1 dcnl dcsp diff 2 float highcolor2 lowcolor2 dcnl dcsp return lowcolor0 + intermed diff 0 lowcolor1 + intermed diff 1 lowcolor2 + intermed diff 2
def unconvert from rgb 255 colors dcsp return colors0 255 0 colors1 255 0 colors2 255 0
def convert to rgb 255 colors dcsp rgb components dcnl dcsp for component in colors dcnl dcsp dcsp rounded num decimal decimal str component 255 0 quantize decimal decimal 1 rounding decimal round half even dcnl dcsp dcsp rounded num int rounded num dcnl dcsp dcsp rgb components append rounded num dcnl dcsp return rgb components0 rgb components1 rgb components2
def n colors lowcolor highcolor n colors dcsp diff 0 float highcolor0 lowcolor0 dcnl dcsp incr 0 diff 0 n colors 1 dcnl dcsp diff 1 float highcolor1 lowcolor1 dcnl dcsp incr 1 diff 1 n colors 1 dcnl dcsp diff 2 float highcolor2 lowcolor2 dcnl dcsp incr 2 diff 2 n colors 1 dcnl dcsp color tuples dcnl dcsp for index in range n colors dcnl dcsp dcsp new tuple lowcolor0 + index incr 0 lowcolor1 + index incr 1 lowcolor2 + index incr 2 dcnl dcsp dcsp color tuples append new tuple dcnl dcsp return color tuples
def label rgb colors dcsp return rgb s dcsp s dcsp s colors0 colors1 colors2
def unlabel rgb colors dcsp str vals dcnl dcsp for index in range len colors dcnl dcsp dcsp try dcnl dcsp dcsp dcsp float colorsindex dcnl dcsp dcsp dcsp str vals str vals + colorsindex dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp if colorsindex or colorsindex dcnl dcsp dcsp dcsp dcsp str vals str vals + colorsindex dcnl dcsp str vals str vals + dcnl dcsp numbers dcnl dcsp str num dcnl dcsp for char in str vals dcnl dcsp dcsp if char dcnl dcsp dcsp dcsp str num str num + char dcnl dcsp dcsp else dcnl dcsp dcsp dcsp numbers append float str num dcnl dcsp dcsp dcsp str num dcnl dcsp return numbers0 numbers1 numbers2
def hex to rgb value dcsp value value lstrip dcnl dcsp hex total length len value dcnl dcsp rgb section length hex total length 3 dcnl dcsp return tuple int valuei i + rgb section length 16 for i in range 0 hex total length rgb section length
def colorscale to colors colorscale dcsp color list dcnl dcsp for item in colorscale dcnl dcsp dcsp color list append item1 dcnl dcsp return color list
def colorscale to scale colorscale dcsp scale list dcnl dcsp for item in colorscale dcnl dcsp dcsp scale list append item0 dcnl dcsp return scale list
def convert colorscale to rgb colorscale dcsp for color in colorscale dcnl dcsp dcsp color1 convert to rgb 255 color1 dcnl dcsp for color in colorscale dcnl dcsp dcsp color1 label rgb color1 dcnl dcsp return colorscale
def get image download script caller dcsp if caller iplot dcnl dcsp dcsp check start if document readystate dcsp dcsp complete dcsp dcnl dcsp dcsp check end dcnl dcsp elif caller plot dcnl dcsp dcsp check start dcnl dcsp dcsp check end dcnl dcsp else dcnl dcsp dcsp raise valueerror caller dcsp should dcsp only dcsp be dcsp one dcsp of dcsp iplot dcsp or dcsp plot dcnl dcsp return <script function dcsp downloadimage format dcsp height dcsp width dcsp filename dcsp var dcsp p dcsp dcsp document getelementbyid plot id plotly downloadimage p dcsp format dcsp format dcsp height dcsp height dcsp width dcsp width dcsp filename dcsp filename + check start + downloadimage format dcsp height dcsp width dcsp filename + check end + < script
def init notebook mode connected false dcsp if not ipython dcnl dcsp dcsp raise importerror iplot dcsp can dcsp only dcsp run dcsp inside dcsp an dcsp ipython dcsp notebook dcnl dcsp global plotly offline initialized dcnl dcsp if connected dcnl dcsp dcsp script inject <script requirejs config paths dcsp dcsp plotly dcsp https cdn plot ly plotlylatest min if window plotly dcsp require plotly function plotly dcsp window plotly plotly < script dcnl dcsp else dcnl dcsp dcsp script inject <script dcsp type text javascript if window plotly define plotly dcsp function require dcsp exports dcsp module dcsp script require plotly dcsp function plotly dcsp window plotly dcsp dcsp plotly < script format script get plotlyjs dcnl dcsp display bundle text html script inject text vnd plotly v1+html script inject dcnl dcsp ipython display display display bundle raw true dcnl dcsp plotly offline initialized true
def iplot figure or data show link true link text export dcsp to dcsp plot ly validate true image none filename plot image image width 800 image height 600 config none dcsp if not ipython dcnl dcsp dcsp raise importerror iplot dcsp can dcsp only dcsp run dcsp inside dcsp an dcsp ipython dcsp notebook dcnl dcsp config dict config if config else dcnl dcsp config setdefault showlink show link dcnl dcsp config setdefault linktext link text dcnl dcsp figure tools return figure from figure or data figure or data validate dcnl dcsp data json loads json dumps figure data cls plotly utils plotlyjsonencoder dcnl dcsp layout json loads json dumps figure get layout cls plotly utils plotlyjsonencoder dcnl dcsp frames json loads json dumps figure get frames none cls plotly utils plotlyjsonencoder dcnl dcsp fig data data layout layout dcnl dcsp if frames dcnl dcsp dcsp fig frames frames dcnl dcsp display bundle application vnd plotly v1+json fig dcnl dcsp if plotly offline initialized dcnl dcsp dcsp plot html plotdivid width height plot html figure or data config validate 100 525 true dcnl dcsp dcsp display bundle text html plot html dcnl dcsp dcsp display bundle text vnd plotly v1+html plot html dcnl dcsp ipython display display display bundle raw true dcnl dcsp if image dcnl dcsp dcsp if not plotly offline initialized dcnl dcsp dcsp dcsp raise plotlyerror n join plotly dcsp offline dcsp mode dcsp has dcsp not dcsp been dcsp initialized dcsp in dcsp this dcsp notebook dcsp run dcsp import dcsp plotly plotly offline init notebook mode dcsp dcsp run dcsp at dcsp the dcsp start dcsp of dcsp every dcsp ipython dcsp notebook dcnl dcsp dcsp if image not in image formats dcnl dcsp dcsp dcsp raise valueerror the dcsp image dcsp parameter dcsp must dcsp be dcsp one dcsp of dcsp the dcsp following dcsp format image formats dcnl dcsp dcsp script get image download script iplot format format image width image width height image height filename filename plot id plotdivid dcnl dcsp dcsp time sleep 1 dcnl dcsp dcsp ipython display display ipython display html script
def plot figure or data show link true link text export dcsp to dcsp plot ly validate true output type file include plotlyjs true filename tempplot html auto open true image none image filename plot image image width 800 image height 600 config none dcsp if output type not in div file dcnl dcsp dcsp raise valueerror output type dcsp argument dcsp must dcsp be dcsp div dcsp or dcsp file dcsp you dcsp supplied dcsp + output type + dcnl dcsp if not filename endswith html and output type file dcnl dcsp dcsp warnings warn your dcsp filename dcsp + filename + dcsp didn t dcsp end dcsp with dcsp html dcsp adding dcsp html dcsp to dcsp the dcsp end dcsp of dcsp your dcsp file dcnl dcsp dcsp filename + html dcnl dcsp config dict config if config else dcnl dcsp config setdefault showlink show link dcnl dcsp config setdefault linktext link text dcnl dcsp plot html plotdivid width height plot html figure or data config validate 100 100 global requirejs false dcnl dcsp resize script dcnl dcsp if width 100 or height 100 dcnl dcsp dcsp resize script <script dcsp type text javascript window addeventlistener resize dcsp function plotly plots resize document getelementbyid id < script format id plotdivid dcnl dcsp if output type file dcnl dcsp dcsp with open filename w as f dcnl dcsp dcsp dcsp if include plotlyjs dcnl dcsp dcsp dcsp dcsp plotly js script join <script dcsp type text javascript get plotlyjs < script dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp plotly js script dcnl dcsp dcsp dcsp if image dcnl dcsp dcsp dcsp dcsp if image not in image formats dcnl dcsp dcsp dcsp dcsp dcsp raise valueerror the dcsp image dcsp parameter dcsp must dcsp be dcsp one dcsp of dcsp the dcsp following dcsp format image formats dcnl dcsp dcsp dcsp dcsp script get image download script plot dcnl dcsp dcsp dcsp dcsp script script format format image width image width height image height filename image filename plot id plotdivid dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp script dcnl dcsp dcsp dcsp f write join <html <head <meta dcsp charset utf8 dcsp < head <body plotly js script plot html resize script script < body < html dcnl dcsp dcsp url file + os path abspath filename dcnl dcsp dcsp if auto open dcnl dcsp dcsp dcsp webbrowser open url dcnl dcsp dcsp return url dcnl dcsp elif output type div dcnl dcsp dcsp if include plotlyjs dcnl dcsp dcsp dcsp return join <div <script dcsp type text javascript get plotlyjs < script plot html resize script < div dcnl dcsp dcsp else dcnl dcsp dcsp dcsp return plot html
def plot mpl mpl fig resize false strip style false verbose false show link true link text export dcsp to dcsp plot ly validate true output type file include plotlyjs true filename tempplot html auto open true image none image filename plot image image height 600 image width 800 dcsp plotly plot tools mpl to plotly mpl fig resize strip style verbose dcnl dcsp return plot plotly plot show link link text validate output type include plotlyjs filename auto open image image image filename image filename image height image height image width image width
def iplot mpl mpl fig resize false strip style false verbose false show link true link text export dcsp to dcsp plot ly validate true image none image filename plot image image height 600 image width 800 dcsp plotly plot tools mpl to plotly mpl fig resize strip style verbose dcnl dcsp return iplot plotly plot show link link text validate image image filename image filename image height image height image width image width
def enable mpl offline resize false strip style false verbose false show link true link text export dcsp to dcsp plot ly validate true dcsp init notebook mode dcnl dcsp ip ipython core getipython get ipython dcnl dcsp formatter ip display formatter formatters text html dcnl dcsp formatter for type matplotlib figure figure lambda fig iplot mpl fig resize strip style verbose show link link text validate
def sign in username api key kwargs dcsp kwargs update username username api key api key dcnl dcsp for key in kwargs dcnl dcsp dcsp if key not in credentials keys and key not in config keys dcnl dcsp dcsp dcsp raise exceptions plotlyerror dcsp is dcsp not dcsp a dcsp valid dcsp config dcsp or dcsp credentials dcsp key format key dcnl dcsp for key in credentials keys dcnl dcsp dcsp if key in kwargs dcnl dcsp dcsp dcsp if not isinstance kwargskey credentials keyskey dcnl dcsp dcsp dcsp dcsp raise exceptions plotlyerror dcsp must dcsp be dcsp of dcsp type dcsp format key credentials keyskey dcnl dcsp dcsp dcsp session credentials key kwargskey dcnl dcsp for key in config keys dcnl dcsp dcsp if key in kwargs dcnl dcsp dcsp dcsp if not isinstance kwargskey config keyskey dcnl dcsp dcsp dcsp dcsp raise exceptions plotlyerror dcsp must dcsp be dcsp of dcsp type dcsp format key config keyskey dcnl dcsp dcsp dcsp session config key kwargs get key dcnl dcsp for key in plot options dcnl dcsp dcsp if key in kwargs dcnl dcsp dcsp dcsp if not isinstance kwargskey config keyskey dcnl dcsp dcsp dcsp dcsp raise exceptions plotlyerror dcsp must dcsp be dcsp of dcsp type dcsp format key config keyskey dcnl dcsp dcsp dcsp session plot options key kwargs get key
def update session plot options kwargs dcsp for key in kwargs dcnl dcsp dcsp if key not in plot options dcnl dcsp dcsp dcsp raise exceptions plotlyerror dcsp is dcsp not dcsp a dcsp valid dcsp config dcsp or dcsp plot dcsp option dcsp key format key dcnl dcsp dcsp if not isinstance kwargskey plot optionskey dcnl dcsp dcsp dcsp raise exceptions plotlyerror dcsp must dcsp be dcsp of dcsp type dcsp format key plot optionskey dcnl dcsp dcsp if key sharing and not kwargskey in sharing options dcnl dcsp dcsp dcsp raise exceptions plotlyerror 0 dcsp must dcsp be dcsp of dcsp either dcsp 1 dcsp 2 dcsp or dcsp 3 format key sharing options dcnl dcsp session plot options update kwargs
def get session plot options dcsp return copy deepcopy session plot options
def get session config dcsp return copy deepcopy session config
def get session credentials dcsp return copy deepcopy session credentials
def plot option logic plot options from call signature dcsp default plot options copy deepcopy default plot options dcnl dcsp file options tools get config file dcnl dcsp session options session get session plot options dcnl dcsp plot options from call signature copy deepcopy plot options from call signature dcnl dcsp for option set in plot options from call signature session options file options dcnl dcsp dcsp utils validate world readable and sharing settings option set dcnl dcsp dcsp utils set sharing and world readable option set dcnl dcsp dcsp if filename in option set and fileopt not in option set dcnl dcsp dcsp dcsp option set fileopt overwrite dcnl dcsp user plot options dcnl dcsp user plot options update default plot options dcnl dcsp user plot options update file options dcnl dcsp user plot options update session options dcnl dcsp user plot options update plot options from call signature dcnl dcsp user plot options k v for k v in user plot options items if k in default plot options dcnl dcsp return user plot options
def iplot figure or data plot options dcsp if auto open not in plot options dcnl dcsp dcsp plot options auto open false dcnl dcsp url plot figure or data plot options dcnl dcsp if isinstance figure or data dict dcnl dcsp dcsp layout figure or data get layout dcnl dcsp else dcnl dcsp dcsp layout dcnl dcsp embed options dict dcnl dcsp embed options width layout get width 100 dcnl dcsp embed options height layout get height 525 dcnl dcsp try dcnl dcsp dcsp float embed options width dcnl dcsp except valueerror typeerror dcnl dcsp dcsp pass dcnl dcsp else dcnl dcsp dcsp embed options width str embed options width + px dcnl dcsp try dcnl dcsp dcsp float embed options height dcnl dcsp except valueerror typeerror dcnl dcsp dcsp pass dcnl dcsp else dcnl dcsp dcsp embed options height str embed options height + px dcnl dcsp return tools embed url embed options
def plot figure or data validate true plot options dcsp figure tools return figure from figure or data figure or data validate dcnl dcsp for entry in figure data dcnl dcsp dcsp if type in entry and entry type scattergl dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp for key val in list entry items dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp if len val 40000 dcnl dcsp dcsp dcsp dcsp dcsp msg woah dcsp there dcsp look dcsp at dcsp all dcsp those dcsp points dcsp due dcsp to dcsp browser dcsp limitations dcsp the dcsp plotly dcsp svg dcsp drawing dcsp functions dcsp have dcsp a dcsp hard dcsp time dcsp graphing dcsp more dcsp than dcsp 500k dcsp data dcsp points dcsp for dcsp line dcsp charts dcsp or dcsp 40k dcsp points dcsp for dcsp other dcsp types dcsp of dcsp charts dcsp here dcsp are dcsp some dcsp suggestions n 1 dcsp use dcsp the dcsp plotly graph objs scattergl dcsp trace dcsp object dcsp to dcsp generate dcsp a dcsp webgl dcsp graph n 2 dcsp trying dcsp using dcsp the dcsp image dcsp api dcsp to dcsp return dcsp an dcsp image dcsp instead dcsp of dcsp a dcsp graph dcsp url n 3 dcsp use dcsp matplotlib n 4 dcsp see dcsp if dcsp you dcsp can dcsp create dcsp your dcsp visualization dcsp with dcsp fewer dcsp data dcsp points n nif dcsp the dcsp visualization dcsp you re dcsp using dcsp aggregates dcsp points dcsp e g dcsp box dcsp plot dcsp histogram dcsp etc dcsp you dcsp can dcsp disregard dcsp this dcsp warning dcnl dcsp dcsp dcsp dcsp dcsp warnings warn msg dcnl dcsp dcsp dcsp except typeerror dcnl dcsp dcsp dcsp dcsp pass dcnl dcsp plot options plot option logic plot options dcnl dcsp fig tools replace newline figure dcnl dcsp data fig get data dcnl dcsp plot options layout fig get layout dcnl dcsp response v1 clientresp data plot options dcnl dcsp url response json url dcnl dcsp if plot options sharing secret dcnl dcsp dcsp if share key not in url dcnl dcsp dcsp dcsp url add share key to url url dcnl dcsp if plot options auto open dcnl dcsp dcsp open url url dcnl dcsp return url
def iplot mpl fig resize true strip style false update none plot options dcsp fig tools mpl to plotly fig resize resize strip style strip style dcnl dcsp if update and isinstance update dict dcnl dcsp dcsp fig update update dcnl dcsp dcsp fig validate dcnl dcsp elif update is not none dcnl dcsp dcsp raise exceptions plotlygraphobjecterror update dcsp must dcsp be dcsp dictionarylike dcsp and dcsp a dcsp valid dcsp plotly dcsp figure dcsp object dcsp run dcsp help plotly graph objs figure dcsp for dcsp more dcsp info dcnl dcsp return iplot fig plot options
def plot mpl fig resize true strip style false update none plot options dcsp fig tools mpl to plotly fig resize resize strip style strip style dcnl dcsp if update and isinstance update dict dcnl dcsp dcsp fig update update dcnl dcsp dcsp fig validate dcnl dcsp elif update is not none dcnl dcsp dcsp raise exceptions plotlygraphobjecterror update dcsp must dcsp be dcsp dictionarylike dcsp and dcsp a dcsp valid dcsp plotly dcsp figure dcsp object dcsp run dcsp help plotly graph objs figure dcsp for dcsp more dcsp info dcnl dcsp return plot fig plot options
def swap keys obj key1 key2 dcsp val1 val2 none none dcnl dcsp try dcnl dcsp dcsp val2 obj pop key1 dcnl dcsp except keyerror dcnl dcsp dcsp pass dcnl dcsp try dcnl dcsp dcsp val1 obj pop key2 dcnl dcsp except keyerror dcnl dcsp dcsp pass dcnl dcsp if val2 is not none dcnl dcsp dcsp objkey2 val2 dcnl dcsp if val1 is not none dcnl dcsp dcsp objkey1 val1
def swap xy data data obj dcsp swaps x y x0 y0 dx dy xbins ybins nbinsx nbinsy autobinx autobiny error x error y dcnl dcsp for swap in swaps dcnl dcsp dcsp swap keys data obj swap0 swap1 dcnl dcsp try dcnl dcsp dcsp rows len data obj z dcnl dcsp dcsp cols len data obj z 0 dcnl dcsp dcsp for row in data obj z dcnl dcsp dcsp dcsp if len row cols dcnl dcsp dcsp dcsp dcsp raise typeerror dcnl dcsp dcsp z data obj pop z dcnl dcsp dcsp data obj z 0 for rrr in range rows for ccc in range cols dcnl dcsp dcsp for iii in range rows dcnl dcsp dcsp dcsp for jjj in range cols dcnl dcsp dcsp dcsp dcsp data obj z jjjiii ziiijjj dcnl dcsp except keyerror typeerror indexerror as err dcnl dcsp dcsp warn false dcnl dcsp dcsp try dcnl dcsp dcsp dcsp if data obj z is not none dcnl dcsp dcsp dcsp dcsp warn true dcnl dcsp dcsp dcsp if len data obj z 0 dcnl dcsp dcsp dcsp dcsp warn false dcnl dcsp dcsp except keyerror typeerror dcnl dcsp dcsp dcsp pass dcnl dcsp dcsp if warn dcnl dcsp dcsp dcsp warnings warn data dcsp in dcsp this dcsp file dcsp required dcsp an dcsp xy dcsp swap dcsp but dcsp the dcsp z dcsp matrix dcsp in dcsp one dcsp of dcsp the dcsp data dcsp objects dcsp could dcsp not dcsp be dcsp transposed dcsp here s dcsp why n n format repr err
def get figure file owner or url file id none raw false dcsp plotly rest url get config plotly domain dcnl dcsp if file id is none dcnl dcsp dcsp url file owner or url dcnl dcsp dcsp if url len plotly rest url plotly rest url dcnl dcsp dcsp dcsp raise exceptions plotlyerror because dcsp you dcsp didn t dcsp supply dcsp a dcsp file id dcsp in dcsp the dcsp call dcsp we re dcsp assuming dcsp you re dcsp trying dcsp to dcsp snag dcsp a dcsp figure dcsp from dcsp a dcsp url dcsp you dcsp supplied dcsp the dcsp url dcsp 0 dcsp we dcsp expected dcsp it dcsp to dcsp start dcsp with dcsp 1 nrun dcsp help dcsp on dcsp this dcsp function dcsp for dcsp more dcsp information format url plotly rest url dcnl dcsp dcsp head plotly rest url + ~ dcnl dcsp dcsp file owner url replace head split 0 dcnl dcsp dcsp file id url replace head split 1 dcnl dcsp else dcnl dcsp dcsp file owner file owner or url dcnl dcsp try dcnl dcsp dcsp int file id dcnl dcsp except valueerror dcnl dcsp dcsp raise exceptions plotlyerror the dcsp file id dcsp argument dcsp was dcsp not dcsp able dcsp to dcsp be dcsp converted dcsp into dcsp an dcsp integer dcsp number dcsp make dcsp sure dcsp that dcsp the dcsp positional dcsp file id dcsp argument dcsp is dcsp a dcsp number dcsp that dcsp can dcsp be dcsp converted dcsp into dcsp an dcsp integer dcsp or dcsp a dcsp string dcsp that dcsp can dcsp be dcsp converted dcsp into dcsp an dcsp integer dcnl dcsp if int file id < 0 dcnl dcsp dcsp raise exceptions plotlyerror the dcsp file id dcsp argument dcsp must dcsp be dcsp a dcsp nonnegative dcsp number dcnl dcsp fid format file owner file id dcnl dcsp response v2 plots content fid inline data true dcnl dcsp figure response json dcnl dcsp for index entry in enumerate figure data dcnl dcsp dcsp try dcnl dcsp dcsp dcsp if all entry type histogramy xbins in entry ybins not in entry dcnl dcsp dcsp dcsp dcsp entry ybins entry pop xbins dcnl dcsp dcsp dcsp if entry type in histogramx histogramy dcnl dcsp dcsp dcsp dcsp entry type histogram dcnl dcsp dcsp dcsp if bardir in entry dcnl dcsp dcsp dcsp dcsp entry orientation entry pop bardir dcnl dcsp dcsp dcsp dcsp if entry type bar dcnl dcsp dcsp dcsp dcsp dcsp if entry orientation h dcnl dcsp dcsp dcsp dcsp dcsp dcsp swap xy data entry dcnl dcsp dcsp dcsp dcsp if entry type histogram dcnl dcsp dcsp dcsp dcsp dcsp if x in entry and y not in entry dcnl dcsp dcsp dcsp dcsp dcsp dcsp if entry orientation h dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp swap xy data entry dcnl dcsp dcsp dcsp dcsp dcsp dcsp del entry orientation dcnl dcsp dcsp dcsp dcsp dcsp if y in entry and x not in entry dcnl dcsp dcsp dcsp dcsp dcsp dcsp if entry orientation v dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp swap xy data entry dcnl dcsp dcsp dcsp dcsp dcsp dcsp del entry orientation dcnl dcsp dcsp dcsp figure data index entry dcnl dcsp dcsp except keyerror dcnl dcsp dcsp dcsp pass dcnl dcsp for index entry in enumerate figure data dcnl dcsp dcsp if stream in entry dcnl dcsp dcsp dcsp del figure data index stream dcnl dcsp if raw dcnl dcsp dcsp return figure dcnl dcsp return tools get valid graph obj figure obj type figure
def parse grid id args grid grid url dcsp if grid is not none dcnl dcsp dcsp id from grid grid id dcnl dcsp else dcnl dcsp dcsp id from grid none dcnl dcsp args id from grid grid url dcnl dcsp arg names grid grid url dcnl dcsp supplied arg names arg name for arg name arg in zip arg names args if arg is not none dcnl dcsp if not supplied arg names dcnl dcsp dcsp raise exceptions inputerror one dcsp of dcsp the dcsp two dcsp keyword dcsp arguments dcsp is dcsp required n dcsp dcsp dcsp dcsp grid dcsp or dcsp grid url n ngrid dcsp a dcsp plotly graph objs grid dcsp object dcsp that dcsp has dcsp already n dcsp dcsp dcsp dcsp been dcsp uploaded dcsp to dcsp plotly n ngrid url dcsp the dcsp url dcsp where dcsp the dcsp grid dcsp can dcsp be dcsp accessed dcsp on n dcsp dcsp dcsp dcsp plotly dcsp e g dcsp https plot ly ~chris 3043 n n dcnl dcsp elif len supplied arg names 1 dcnl dcsp dcsp raise exceptions inputerror only dcsp one dcsp of dcsp grid dcsp or dcsp grid url dcsp is dcsp required dcsp nyou dcsp supplied dcsp both dcsp n dcnl dcsp else dcnl dcsp dcsp supplied arg name supplied arg names pop dcnl dcsp dcsp if supplied arg name grid url dcnl dcsp dcsp dcsp path six moves urllib parse urlparse grid url path dcnl dcsp dcsp dcsp file owner file id path replace ~ split 0 2 dcnl dcsp dcsp dcsp return 0 1 format file owner file id dcnl dcsp dcsp else dcnl dcsp dcsp dcsp return grid id
def add share key to url plot url attempt 0 dcsp urlsplit six moves urllib parse urlparse plot url dcnl dcsp username urlsplit path split 1 split ~ 1 dcnl dcsp idlocal urlsplit path split 2 dcnl dcsp fid format username idlocal dcnl dcsp body share key enabled true world readable false dcnl dcsp response v2 files update fid body dcnl dcsp time sleep 4 dcnl dcsp share key enabled v2 files retrieve fid json share key enabled dcnl dcsp if not share key enabled dcnl dcsp dcsp attempt + 1 dcnl dcsp dcsp if attempt 50 dcnl dcsp dcsp dcsp raise exceptions plotlyerror the dcsp sharekey dcsp could dcsp not dcsp be dcsp enabled dcsp at dcsp this dcsp time dcsp so dcsp the dcsp graph dcsp is dcsp saved dcsp as dcsp private dcsp try dcsp again dcsp to dcsp save dcsp as dcsp secret dcsp later dcnl dcsp dcsp add share key to url plot url attempt dcnl dcsp url share key plot url + share key + response json share key dcnl dcsp return url share key
def get grid grid url raw false dcsp fid parse grid id args none grid url dcnl dcsp response v2 grids content fid dcnl dcsp parsed content response json dcnl dcsp if raw dcnl dcsp dcsp return parsed content dcnl dcsp return grid parsed content fid
def create animations figure filename none sharing public auto open true dcsp body figure figure world readable true dcnl dcsp if filename dcnl dcsp dcsp if in filename dcnl dcsp dcsp dcsp warnings warn this dcsp beta dcsp version dcsp of dcsp create animations dcsp does dcsp not dcsp support dcsp automatic dcsp folder dcsp creation dcsp this dcsp means dcsp a dcsp filename dcsp of dcsp the dcsp form dcsp name1 name2 dcsp will dcsp just dcsp create dcsp the dcsp plot dcsp with dcsp that dcsp name dcsp only dcnl dcsp dcsp body filename filename dcnl dcsp if sharing public dcnl dcsp dcsp body world readable true dcnl dcsp elif sharing private dcnl dcsp dcsp body world readable false dcnl dcsp elif sharing secret dcnl dcsp dcsp body world readable false dcnl dcsp dcsp body share key enabled true dcnl dcsp else dcnl dcsp dcsp raise exceptions plotlyerror whoops dcsp sharing dcsp can dcsp only dcsp be dcsp set dcsp to dcsp either dcsp public dcsp private dcsp or dcsp secret dcnl dcsp response v2 plots create body dcnl dcsp parsed content response json dcnl dcsp if sharing secret dcnl dcsp dcsp web url parsed content file web url 1 + share key + parsed content file share key dcnl dcsp else dcnl dcsp dcsp web url parsed content file web url dcnl dcsp if auto open dcnl dcsp dcsp open url web url dcnl dcsp return web url
def icreate animations figure filename none sharing public auto open false dcsp url create animations figure filename sharing auto open dcnl dcsp if isinstance figure dict dcnl dcsp dcsp layout figure get layout dcnl dcsp else dcnl dcsp dcsp layout dcnl dcsp embed options dict dcnl dcsp embed options width layout get width 100 dcnl dcsp embed options height layout get height 525 dcnl dcsp try dcnl dcsp dcsp float embed options width dcnl dcsp except valueerror typeerror dcnl dcsp dcsp pass dcnl dcsp else dcnl dcsp dcsp embed options width str embed options width + px dcnl dcsp try dcnl dcsp dcsp float embed options height dcnl dcsp except valueerror typeerror dcnl dcsp dcsp pass dcnl dcsp else dcnl dcsp dcsp embed options height str embed options height + px dcnl dcsp return tools embed url embed options
def get help object name path parent object names attribute none dcsp if object name in graph reference arrays dcnl dcsp dcsp help string list help object name path parent object names dcnl dcsp elif attribute dcnl dcsp dcsp help string dict attribute help object name path parent object names attribute dcnl dcsp else dcnl dcsp dcsp help string dict object help object name path parent object names dcnl dcsp return help string expandtabs tab size
def list help object name path parent object names dcsp items graph reference arraysobject name items dcnl dcsp items classes set dcnl dcsp for item in items dcnl dcsp dcsp if item in graph reference object name to class name dcnl dcsp dcsp dcsp items classes add graph reference string to class name item dcnl dcsp dcsp else dcnl dcsp dcsp dcsp items classes add dict dcnl dcsp items classes list items classes dcnl dcsp items classes sort dcnl dcsp lines textwrap wrap repr items classes width line size tab size 1 dcnl dcsp help dict object name object name path string + join repr k for k in path + parent object names parent object names items string dctb + n dctb join lines dcnl dcsp return valid dcsp items dcsp for dcsp object name dcsp at dcsp path dcsp path string dcsp under dcsp parents dcsp parent object names n items string n format help dict
def dict object help object name path parent object names dcsp attributes list graph reference get valid attributes object name parent object names dcnl dcsp attributes sort dcnl dcsp lines textwrap wrap repr list attributes width line size tab size 1 dcnl dcsp help dict object name object name path string + join repr k for k in path + parent object names parent object names attributes string dctb + n dctb join lines dcnl dcsp return valid dcsp attributes dcsp for dcsp object name dcsp at dcsp path dcsp path string dcsp under dcsp parents dcsp parent object names n n attributes string n nrun dcsp < object name object help attribute dcsp on dcsp any dcsp of dcsp the dcsp above n < object name object dcsp is dcsp the dcsp object dcsp at dcsp path string format help dict
def dict attribute help object name path parent object names attribute dcsp help dict object name object name path string + join repr k for k in path + parent object names parent object names attribute attribute dcnl dcsp valid attributes graph reference get valid attributes object name parent object names dcnl dcsp help string current dcsp path dcsp path string ncurrent dcsp parent dcsp object names dcsp parent object names n n dcnl dcsp if attribute not in valid attributes dcnl dcsp dcsp help string + attribute dcsp is dcsp not dcsp allowed dcsp here n dcnl dcsp dcsp return help string format help dict dcnl dcsp attributes dicts graph reference get attributes dicts object name parent object names dcnl dcsp attribute definitions dcnl dcsp additional definition none dcnl dcsp meta keys graph reference graph reference defs metakeys dcnl dcsp trace names graph reference trace names dcnl dcsp for key attribute dict in attributes dicts items dcnl dcsp dcsp if attribute in attribute dict dcnl dcsp dcsp dcsp if object name in trace names and attribute type dcnl dcsp dcsp dcsp dcsp d role info dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp d k v for k v in attribute dictattribute items if k in meta keys and not k startswith dcnl dcsp dcsp elif attribute in attribute dict get deprecated dcnl dcsp dcsp dcsp deprecate attribute dict attribute dict deprecated attribute dcnl dcsp dcsp dcsp d k v for k v in deprecate attribute dict items if k in meta keys and not k startswith dcnl dcsp dcsp dcsp d deprecated true dcnl dcsp dcsp else dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if key additional attributes dcnl dcsp dcsp dcsp additional definition d dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp new definition true dcnl dcsp dcsp for item in attribute definitions dcnl dcsp dcsp dcsp if item definition d dcnl dcsp dcsp dcsp dcsp item paths append key dcnl dcsp dcsp dcsp dcsp new definition false dcnl dcsp dcsp if new definition dcnl dcsp dcsp dcsp attribute definitions append paths key definition d dcnl dcsp if attribute definitions dcnl dcsp dcsp help string + with dcsp the dcsp current dcsp parents dcsp attribute dcsp can dcsp be dcsp used dcsp as dcsp follows n n dcnl dcsp help string help string format help dict dcnl dcsp for item in attribute definitions dcnl dcsp dcsp valid parents objects names graph reference attribute path to object names definition path for definition path in item paths dcnl dcsp dcsp if len valid parents objects names 1 dcnl dcsp dcsp dcsp valid parent objects names valid parents objects names0 dcnl dcsp dcsp dcsp help string + under dcsp n n format str valid parent objects names dcnl dcsp dcsp else dcnl dcsp dcsp dcsp help string + under dcsp any dcsp of n dctb dctb dcsp n n format n dctb dctb dcsp join str tup for tup in valid parents objects names dcnl dcsp dcsp for meta key val in sorted item definition items dcnl dcsp dcsp dcsp help string + dctb dcsp format meta key dcnl dcsp dcsp dcsp if meta key description dcnl dcsp dcsp dcsp dcsp if isinstance val list and attribute showline dcnl dcsp dcsp dcsp dcsp dcsp val val0 dcnl dcsp dcsp dcsp dcsp lines textwrap wrap val width line size 1 dcnl dcsp dcsp dcsp dcsp help string + n dctb dctb join lines dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp help string + format val dcnl dcsp dcsp dcsp help string + n dcnl dcsp dcsp help string + n n dcnl dcsp if additional definition dcnl dcsp dcsp help string + additionally n n dcnl dcsp dcsp for item in sorted additional definition items dcnl dcsp dcsp dcsp help string + dctb dcsp n format item dcnl dcsp dcsp help string + n dcnl dcsp return help string
def curtail val repr val max chars add delim false dcsp delim dcsp dcnl dcsp end dcnl dcsp if isinstance val six string types dcnl dcsp dcsp if max chars < len + end + dcnl dcsp dcsp dcsp return dcsp max chars dcnl dcsp dcsp elif add delim and max chars < len + end + + len delim dcnl dcsp dcsp dcsp return + end + + dcsp max chars len + end + dcnl dcsp elif max chars < len end dcnl dcsp dcsp return dcsp max chars dcnl dcsp elif add delim and max chars < len end + len delim dcnl dcsp dcsp return end + dcsp max chars len end dcnl dcsp if add delim dcnl dcsp dcsp max chars len delim dcnl dcsp r repr val dcnl dcsp if len r max chars dcnl dcsp dcsp if isinstance val six string types dcnl dcsp dcsp dcsp r r max chars len end + + end + dcnl dcsp dcsp elif isinstance val list and max chars len end format end end dcnl dcsp dcsp dcsp r r max chars len end + + end + dcnl dcsp dcsp else dcnl dcsp dcsp dcsp r r max chars len end + end dcnl dcsp if add delim dcnl dcsp dcsp r + delim dcnl dcsp return r
def sort keys key dcsp is special key in rtxyz dcnl dcsp return not is special key
def color to hex color dcsp if color is none or colorconverter to rgba color 3 0 dcnl dcsp dcsp return none dcnl dcsp else dcnl dcsp dcsp rgb colorconverter to rgb color dcnl dcsp dcsp return 0 02x 1 02x 2 02x format int 255 c for c in rgb
def many to one input dict dcsp return dict key val for keys val in input dict items for key in keys
def get dasharray obj i none dcsp if obj dict get dashseq none is not none dcnl dcsp dcsp return join map str obj dashseq dcnl dcsp else dcnl dcsp dcsp ls obj get linestyle dcnl dcsp dcsp if i is not none dcnl dcsp dcsp dcsp ls lsi dcnl dcsp dcsp dasharray linestyles get ls none dcnl dcsp dcsp if dasharray is none dcnl dcsp dcsp dcsp warnings warn dash dcsp style dcsp 0 dcsp not dcsp understood dcsp defaulting dcsp to dcsp solid format ls dcnl dcsp dcsp dcsp dasharray linestyles dcnl dcsp dcsp return dasharray
def svg path path transform none simplify false dcsp if transform is not none dcnl dcsp dcsp path path transformed transform dcnl dcsp vc tuples vertices if path code path closepoly else path dictpath code for vertices path code in path iter segments simplify simplify dcnl dcsp if not vc tuples dcnl dcsp dcsp return np zeros 0 2 dcnl dcsp else dcnl dcsp dcsp vertices codes zip vc tuples dcnl dcsp dcsp vertices np array list itertools chain vertices reshape 1 2 dcnl dcsp dcsp return vertices list codes
def get path style path fill true dcsp style dcnl dcsp style alpha path get alpha dcnl dcsp if style alpha is none dcnl dcsp dcsp style alpha 1 dcnl dcsp style edgecolor color to hex path get edgecolor dcnl dcsp if fill dcnl dcsp dcsp style facecolor color to hex path get facecolor dcnl dcsp else dcnl dcsp dcsp style facecolor none dcnl dcsp style edgewidth path get linewidth dcnl dcsp style dasharray get dasharray path dcnl dcsp style zorder path get zorder dcnl dcsp return style
def get line style line dcsp style dcnl dcsp style alpha line get alpha dcnl dcsp if style alpha is none dcnl dcsp dcsp style alpha 1 dcnl dcsp style color color to hex line get color dcnl dcsp style linewidth line get linewidth dcnl dcsp style dasharray get dasharray line dcnl dcsp style zorder line get zorder dcnl dcsp return style
def get marker style line dcsp style dcnl dcsp style alpha line get alpha dcnl dcsp if style alpha is none dcnl dcsp dcsp style alpha 1 dcnl dcsp style facecolor color to hex line get markerfacecolor dcnl dcsp style edgecolor color to hex line get markeredgecolor dcnl dcsp style edgewidth line get markeredgewidth dcnl dcsp style marker line get marker dcnl dcsp markerstyle markerstyle line get marker dcnl dcsp markersize line get markersize dcnl dcsp markertransform markerstyle get transform + affine2d scale markersize markersize dcnl dcsp style markerpath svg path markerstyle get path markertransform dcnl dcsp style markersize markersize dcnl dcsp style zorder line get zorder dcnl dcsp return style
def get text style text dcsp style dcnl dcsp style alpha text get alpha dcnl dcsp if style alpha is none dcnl dcsp dcsp style alpha 1 dcnl dcsp style fontsize text get size dcnl dcsp style color color to hex text get color dcnl dcsp style halign text get horizontalalignment dcnl dcsp style valign text get verticalalignment dcnl dcsp style rotation text get rotation dcnl dcsp style zorder text get zorder dcnl dcsp return style
def get axis properties axis dcsp props dcnl dcsp label1on axis major tick kw get label1on true dcnl dcsp if isinstance axis matplotlib axis xaxis dcnl dcsp dcsp if label1on dcnl dcsp dcsp dcsp props position bottom dcnl dcsp dcsp else dcnl dcsp dcsp dcsp props position top dcnl dcsp elif isinstance axis matplotlib axis yaxis dcnl dcsp dcsp if label1on dcnl dcsp dcsp dcsp props position left dcnl dcsp dcsp else dcnl dcsp dcsp dcsp props position right dcnl dcsp else dcnl dcsp dcsp raise valueerror 0 dcsp should dcsp be dcsp an dcsp axis dcsp instance format axis dcnl dcsp locator axis get major locator dcnl dcsp props nticks len locator dcnl dcsp if isinstance locator ticker fixedlocator dcnl dcsp dcsp props tickvalues list locator dcnl dcsp else dcnl dcsp dcsp props tickvalues none dcnl dcsp formatter axis get major formatter dcnl dcsp if isinstance formatter ticker nullformatter dcnl dcsp dcsp props tickformat dcnl dcsp elif not any label get visible for label in axis get ticklabels dcnl dcsp dcsp props tickformat dcnl dcsp else dcnl dcsp dcsp props tickformat none dcnl dcsp props scale axis get scale dcnl dcsp labels axis get ticklabels dcnl dcsp if labels dcnl dcsp dcsp props fontsize labels0 get fontsize dcnl dcsp else dcnl dcsp dcsp props fontsize none dcnl dcsp props grid get grid style axis dcnl dcsp return props
def iter all children obj skipcontainers false dcsp if hasattr obj get children and len obj get children 0 dcnl dcsp dcsp for child in obj get children dcnl dcsp dcsp dcsp if not skipcontainers dcnl dcsp dcsp dcsp dcsp yield child dcnl dcsp dcsp dcsp for grandchild in iter all children child skipcontainers dcnl dcsp dcsp dcsp dcsp yield grandchild dcnl dcsp else dcnl dcsp dcsp yield obj
def image to base64 image dcsp ax image axes dcnl dcsp binary buffer io bytesio dcnl dcsp lim ax axis dcnl dcsp ax axis image get extent dcnl dcsp image write png binary buffer dcnl dcsp ax axis lim dcnl dcsp binary buffer seek 0 dcnl dcsp return base64 b64encode binary buffer read decode utf8
def fig to vincent fig dcsp renderer vincentrenderer dcnl dcsp exporter exporter renderer dcnl dcsp exporter run fig dcnl dcsp return renderer chart
def fig to vega fig notebook false dcsp renderer vegarenderer dcnl dcsp exporter renderer run fig dcnl dcsp vega html vegahtml renderer dcnl dcsp if notebook dcnl dcsp dcsp return vega html dcnl dcsp else dcnl dcsp dcsp return vega html html
def ipynb vega init dcsp try dcnl dcsp dcsp from ipython core display import display html dcnl dcsp except importerror dcnl dcsp dcsp print ipython dcsp notebook dcsp could dcsp not dcsp be dcsp loaded dcnl dcsp require js n dcsp dcsp dcsp dcsp if dcsp window d3 dcsp dcsp undefined dcsp n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp require config dcsp paths dcsp d3 dcsp http d3js org d3 v3 min dcsp n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp require d3 dcsp function d3 dcsp n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp window d3 dcsp dcsp d3 n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp 0 n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp n dcsp dcsp dcsp dcsp n dcsp dcsp dcsp dcsp if dcsp window topojson dcsp dcsp undefined dcsp n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp require config n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp paths dcsp topojson dcsp http d3js org topojson v1 min dcsp n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp require topojson dcsp function topojson dcsp n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp window topojson dcsp dcsp topojson n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp n dcsp dcsp dcsp dcsp n dcsp dcsp dcsp dcsp dcnl dcsp d3 geo projection js url http d3js org d3 geo projection v0 min js dcnl dcsp d3 layout cloud js url http wrobstory github io d3cloud d3 layout cloud js dcnl dcsp topojson js url http d3js org topojson v1 min js dcnl dcsp vega js url http trifacta github com vega vega js dcnl dcsp dep libs getscript s dcsp function dcsp n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp getscript s dcsp function dcsp n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp getscript s dcsp function dcsp n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp getscript s dcsp function dcsp n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp ipython events trigger vega loaded vincent n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp n dcsp dcsp dcsp dcsp d3 geo projection js url d3 layout cloud js url topojson js url vega js url dcnl dcsp load js require js format dep libs dcnl dcsp html <script + load js + < script dcnl dcsp display html html
def check bar match old bar new bar dcsp tests dcnl dcsp tests + new bar orientation old bar orientation dcnl dcsp tests + new bar facecolor old bar facecolor dcnl dcsp if new bar orientation v dcnl dcsp dcsp new width new bar x1 new bar x0 dcnl dcsp dcsp old width old bar x1 old bar x0 dcnl dcsp dcsp tests + new width old width < 1e06 dcnl dcsp dcsp tests + new bar y0 old bar y0 dcnl dcsp elif new bar orientation h dcnl dcsp dcsp new height new bar y1 new bar y0 dcnl dcsp dcsp old height old bar y1 old bar y0 dcnl dcsp dcsp tests + new height old height < 1e06 dcnl dcsp dcsp tests + new bar x0 old bar x0 dcnl dcsp if all tests dcnl dcsp dcsp return true dcnl dcsp else dcnl dcsp dcsp return false
def convert dash mpl dash dcsp if mpl dash in dash map dcnl dcsp dcsp return dash mapmpl dash dcnl dcsp else dcnl dcsp dcsp return solid
def convert symbol mpl symbol dcsp if isinstance mpl symbol list dcnl dcsp dcsp symbol list dcnl dcsp dcsp for s in mpl symbol dcnl dcsp dcsp dcsp symbol + convert symbol s dcnl dcsp dcsp return symbol dcnl dcsp elif mpl symbol in symbol map dcnl dcsp dcsp return symbol mapmpl symbol dcnl dcsp else dcnl dcsp dcsp return dot
def hex to rgb value dcsp value value lstrip dcnl dcsp lv len value dcnl dcsp return tuple int valuei i + lv 3 16 for i in range 0 lv lv 3
def merge color and opacity color opacity dcsp if color is none dcnl dcsp dcsp return none dcnl dcsp rgb tup hex to rgb color dcnl dcsp if opacity is none dcnl dcsp dcsp return rgb dcsp format rgb tup dcnl dcsp rgba tup rgb tup + opacity dcnl dcsp return rgba dcsp format rgba tup
def convert va mpl va dcsp if mpl va in va map dcnl dcsp dcsp return va mapmpl va dcnl dcsp else dcnl dcsp dcsp return none
def convert x domain mpl plot bounds mpl max x bounds dcsp mpl x dom mpl plot bounds0 mpl plot bounds0 + mpl plot bounds2 dcnl dcsp plotting width mpl max x bounds1 mpl max x bounds0 dcnl dcsp x0 mpl x dom0 mpl max x bounds0 plotting width dcnl dcsp x1 mpl x dom1 mpl max x bounds0 plotting width dcnl dcsp return x0 x1
def convert y domain mpl plot bounds mpl max y bounds dcsp mpl y dom mpl plot bounds1 mpl plot bounds1 + mpl plot bounds3 dcnl dcsp plotting height mpl max y bounds1 mpl max y bounds0 dcnl dcsp y0 mpl y dom0 mpl max y bounds0 plotting height dcnl dcsp y1 mpl y dom1 mpl max y bounds0 plotting height dcnl dcsp return y0 y1
def display to paper x y layout dcsp num x x layout margin l dcnl dcsp den x layout width layout margin l + layout margin r dcnl dcsp num y y layout margin b dcnl dcsp den y layout height layout margin b + layout margin t dcnl dcsp return num x den x num y den y
def get axes bounds fig dcsp x min x max y min y max dcnl dcsp for axes obj in fig get axes dcnl dcsp dcsp bounds axes obj get position bounds dcnl dcsp dcsp x min append bounds0 dcnl dcsp dcsp x max append bounds0 + bounds2 dcnl dcsp dcsp y min append bounds1 dcnl dcsp dcsp y max append bounds1 + bounds3 dcnl dcsp x min y min x max y max min x min min y min max x max max y max dcnl dcsp return x min x max y min y max
def get rect xmin data dcsp return min data00 data10 data20 data30
def get rect xmax data dcsp return max data00 data10 data20 data30
def get rect ymin data dcsp return min data01 data11 data21 data31
def get rect ymax data dcsp return max data01 data11 data21 data31
def get spine visible ax spine key dcsp spine ax spinesspine key dcnl dcsp ax frame on ax get frame on dcnl dcsp spine frame like spine is frame like dcnl dcsp if not spine get visible dcnl dcsp dcsp return false dcnl dcsp elif not spine edgecolor 1 dcnl dcsp dcsp return false dcnl dcsp elif not ax frame on and spine frame like dcnl dcsp dcsp return false dcnl dcsp elif ax frame on and spine frame like dcnl dcsp dcsp return true dcnl dcsp elif not ax frame on and not spine frame like dcnl dcsp dcsp return true dcnl dcsp else dcnl dcsp dcsp return false
def is bar bar containers props dcsp for container in bar containers dcnl dcsp dcsp if props mplobj in container dcnl dcsp dcsp dcsp return true dcnl dcsp return false
def make bar props dcsp return bar props mplobj x0 get rect xmin props data y0 get rect ymin props data x1 get rect xmax props data y1 get rect ymax props data alpha props style alpha edgecolor props style edgecolor facecolor props style facecolor edgewidth props style edgewidth dasharray props style dasharray zorder props style zorder
def prep ticks ax index ax type props dcsp axis dict dict dcnl dcsp if ax type x dcnl dcsp dcsp axis ax get xaxis dcnl dcsp elif ax type y dcnl dcsp dcsp axis ax get yaxis dcnl dcsp else dcnl dcsp dcsp return dict dcnl dcsp scale props axes index scale dcnl dcsp if scale linear dcnl dcsp dcsp try dcnl dcsp dcsp dcsp tickvalues props axes index tickvalues dcnl dcsp dcsp dcsp tick0 tickvalues0 dcnl dcsp dcsp dcsp dticks round tickvaluesi tickvalues i 1 12 for i in range 1 len tickvalues 1 dcnl dcsp dcsp dcsp if all dticksi dticks i 1 for i in range 1 len dticks 1 dcnl dcsp dcsp dcsp dcsp dtick tickvalues1 tickvalues0 dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp warnings warn linear dcsp 0 axis dcsp tick dcsp spacing dcsp not dcsp even dcsp ignoring dcsp mpl dcsp tick dcsp formatting format ax type dcnl dcsp dcsp dcsp dcsp raise typeerror dcnl dcsp dcsp except indexerror typeerror dcnl dcsp dcsp dcsp axis dict nticks props axes index nticks dcnl dcsp dcsp else dcnl dcsp dcsp dcsp axis dict tick0 tick0 dcnl dcsp dcsp dcsp axis dict dtick dtick dcnl dcsp dcsp dcsp axis dict tickmode false dcnl dcsp elif scale log dcnl dcsp dcsp try dcnl dcsp dcsp dcsp axis dict tick0 props axes index tickvalues 0 dcnl dcsp dcsp dcsp axis dict dtick props axes index tickvalues 1 props axes index tickvalues 0 dcnl dcsp dcsp dcsp axis dict tickmode false dcnl dcsp dcsp except indexerror typeerror dcnl dcsp dcsp dcsp axis dict dict nticks props axes index nticks dcnl dcsp dcsp base axis get transform base dcnl dcsp dcsp if base 10 dcnl dcsp dcsp dcsp if ax type x dcnl dcsp dcsp dcsp dcsp axis dict range math log10 props xlim 0 math log10 props xlim 1 dcnl dcsp dcsp dcsp elif ax type y dcnl dcsp dcsp dcsp dcsp axis dict range math log10 props ylim 0 math log10 props ylim 1 dcnl dcsp dcsp else dcnl dcsp dcsp dcsp axis dict dict range none type linear dcnl dcsp dcsp dcsp warnings warn converted dcsp nonbase10 dcsp 0 axis dcsp log dcsp scale dcsp to dcsp linear format ax type dcnl dcsp else dcnl dcsp dcsp return dict dcnl dcsp formatter axis get major formatter class name dcnl dcsp if ax type x and dateformatter in formatter dcnl dcsp dcsp axis dict type date dcnl dcsp dcsp try dcnl dcsp dcsp dcsp axis dict tick0 mpl dates to datestrings axis dict tick0 formatter dcnl dcsp dcsp except keyerror dcnl dcsp dcsp dcsp pass dcnl dcsp dcsp finally dcnl dcsp dcsp dcsp axis dict pop dtick none dcnl dcsp dcsp dcsp axis dict pop tickmode none dcnl dcsp dcsp dcsp axis dict range mpl dates to datestrings props xlim formatter dcnl dcsp if formatter logformattermathtext dcnl dcsp dcsp axis dict exponentformat e dcnl dcsp return axis dict
def mpl dates to datestrings dates mpl formatter dcsp dates dates dcnl dcsp if mpl formatter timeseries dateformatter dcnl dcsp dcsp try dcnl dcsp dcsp dcsp dates matplotlib dates epoch2num date 24 60 60 for date in dates dcnl dcsp dcsp dcsp dates matplotlib dates num2date dates tz pytz utc dcnl dcsp dcsp except dcnl dcsp dcsp dcsp return dates dcnl dcsp else dcnl dcsp dcsp try dcnl dcsp dcsp dcsp dates matplotlib dates num2date dates tz pytz utc dcnl dcsp dcsp except dcnl dcsp dcsp dcsp return dates dcnl dcsp time stings dcsp join date isoformat split + 0 split t for date in dates dcnl dcsp return time stings
def get module name dcsp if name not in not importable dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return import module name dcnl dcsp dcsp except importerror dcnl dcsp dcsp dcsp not importable add name
def get config defaults dcsp return dict file contentconfig file
def ensure local plotly files dcsp if check file permissions dcnl dcsp dcsp for fn in credentials file config file dcnl dcsp dcsp dcsp utils ensure file exists fn dcnl dcsp dcsp dcsp contents utils load json dict fn dcnl dcsp dcsp dcsp contents orig contents copy dcnl dcsp dcsp dcsp for key val in list file contentfn items dcnl dcsp dcsp dcsp dcsp if key not in contents dcnl dcsp dcsp dcsp dcsp dcsp contentskey val dcnl dcsp dcsp dcsp contents keys list contents keys dcnl dcsp dcsp dcsp for key in contents keys dcnl dcsp dcsp dcsp dcsp if key not in file contentfn dcnl dcsp dcsp dcsp dcsp dcsp del contentskey dcnl dcsp dcsp dcsp if contents orig keys contents keys dcnl dcsp dcsp dcsp dcsp utils save json dict fn contents dcnl dcsp else dcnl dcsp dcsp warnings warn looks dcsp like dcsp you dcsp don t dcsp have dcsp readwrite dcsp permission dcsp to dcsp your dcsp home dcsp ~ dcsp directory dcsp or dcsp to dcsp our dcsp ~ plotly dcsp directory dcsp that dcsp means dcsp plotly s dcsp python dcsp api dcsp can t dcsp setup dcsp local dcsp configuration dcsp files dcsp no dcsp problem dcsp though dcsp you ll dcsp just dcsp have dcsp to dcsp signin dcsp using dcsp plotly plotly sign in dcsp for dcsp help dcsp with dcsp that dcsp help plotly plotly sign in nquestions dcsp visit dcsp https support plot ly
def set credentials file username none api key none stream ids none proxy username none proxy password none dcsp if not check file permissions dcnl dcsp dcsp raise exceptions plotlyerror you dcsp don t dcsp have dcsp proper dcsp file dcsp permissions dcsp to dcsp run dcsp this dcsp function dcnl dcsp ensure local plotly files dcnl dcsp credentials get credentials file dcnl dcsp if isinstance username six string types dcnl dcsp dcsp credentials username username dcnl dcsp if isinstance api key six string types dcnl dcsp dcsp credentials api key api key dcnl dcsp if isinstance proxy username six string types dcnl dcsp dcsp credentials proxy username proxy username dcnl dcsp if isinstance proxy password six string types dcnl dcsp dcsp credentials proxy password proxy password dcnl dcsp if isinstance stream ids list tuple dcnl dcsp dcsp credentials stream ids stream ids dcnl dcsp utils save json dict credentials file credentials dcnl dcsp ensure local plotly files
def get credentials file args dcsp if check file permissions dcnl dcsp dcsp ensure local plotly files dcnl dcsp dcsp return utils load json dict credentials file args dcnl dcsp else dcnl dcsp dcsp return file contentcredentials file
def set config file plotly domain none plotly streaming domain none plotly api domain none plotly ssl verification none plotly proxy authorization none world readable none sharing none auto open none dcsp if not check file permissions dcnl dcsp dcsp raise exceptions plotlyerror you dcsp don t dcsp have dcsp proper dcsp file dcsp permissions dcsp to dcsp run dcsp this dcsp function dcnl dcsp ensure local plotly files dcnl dcsp utils validate world readable and sharing settings sharing sharing world readable world readable dcnl dcsp settings get config file dcnl dcsp if isinstance plotly domain six string types dcnl dcsp dcsp settings plotly domain plotly domain dcnl dcsp elif plotly domain is not none dcnl dcsp dcsp raise typeerror plotly domain dcsp should dcsp be dcsp a dcsp string dcnl dcsp if isinstance plotly streaming domain six string types dcnl dcsp dcsp settings plotly streaming domain plotly streaming domain dcnl dcsp elif plotly streaming domain is not none dcnl dcsp dcsp raise typeerror plotly streaming domain dcsp should dcsp be dcsp a dcsp string dcnl dcsp if isinstance plotly api domain six string types dcnl dcsp dcsp settings plotly api domain plotly api domain dcnl dcsp elif plotly api domain is not none dcnl dcsp dcsp raise typeerror plotly api domain dcsp should dcsp be dcsp a dcsp string dcnl dcsp if isinstance plotly ssl verification six string types bool dcnl dcsp dcsp settings plotly ssl verification plotly ssl verification dcnl dcsp elif plotly ssl verification is not none dcnl dcsp dcsp raise typeerror plotly ssl verification dcsp should dcsp be dcsp a dcsp boolean dcnl dcsp if isinstance plotly proxy authorization six string types bool dcnl dcsp dcsp settings plotly proxy authorization plotly proxy authorization dcnl dcsp elif plotly proxy authorization is not none dcnl dcsp dcsp raise typeerror plotly proxy authorization dcsp should dcsp be dcsp a dcsp boolean dcnl dcsp if isinstance auto open bool dcnl dcsp dcsp settings auto open auto open dcnl dcsp elif auto open is not none dcnl dcsp dcsp raise typeerror auto open dcsp should dcsp be dcsp a dcsp boolean dcnl dcsp if isinstance world readable bool dcnl dcsp dcsp settings world readable world readable dcnl dcsp dcsp settings pop sharing dcnl dcsp elif world readable is not none dcnl dcsp dcsp raise typeerror input dcsp should dcsp be dcsp a dcsp boolean dcnl dcsp if isinstance sharing six string types dcnl dcsp dcsp settings sharing sharing dcnl dcsp elif sharing is not none dcnl dcsp dcsp raise typeerror sharing dcsp should dcsp be dcsp a dcsp string dcnl dcsp utils set sharing and world readable settings dcnl dcsp utils save json dict config file settings dcnl dcsp ensure local plotly files
def get config file args dcsp if check file permissions dcnl dcsp dcsp ensure local plotly files dcnl dcsp dcsp return utils load json dict config file args dcnl dcsp else dcnl dcsp dcsp return file contentconfig file
def get embed file owner or url file id none width 100 height 525 dcsp plotly rest url session get session config get plotly domain or get config file plotly domain dcnl dcsp if file id is none dcnl dcsp dcsp url file owner or url dcnl dcsp dcsp if url len plotly rest url plotly rest url dcnl dcsp dcsp dcsp raise exceptions plotlyerror because dcsp you dcsp didn t dcsp supply dcsp a dcsp file id dcsp in dcsp the dcsp call dcsp we re dcsp assuming dcsp you re dcsp trying dcsp to dcsp snag dcsp a dcsp figure dcsp from dcsp a dcsp url dcsp you dcsp supplied dcsp the dcsp url dcsp 0 dcsp we dcsp expected dcsp it dcsp to dcsp start dcsp with dcsp 1 nrun dcsp help dcsp on dcsp this dcsp function dcsp for dcsp more dcsp information format url plotly rest url dcnl dcsp dcsp urlsplit six moves urllib parse urlparse url dcnl dcsp dcsp file owner urlsplit path split 1 split ~ 1 dcnl dcsp dcsp file id urlsplit path split 2 dcnl dcsp dcsp query dict six moves urllib parse parse qs urlsplit query dcnl dcsp dcsp if query dict dcnl dcsp dcsp dcsp share key query dict share key 1 dcnl dcsp dcsp else dcnl dcsp dcsp dcsp share key dcnl dcsp else dcnl dcsp dcsp file owner file owner or url dcnl dcsp dcsp share key dcnl dcsp try dcnl dcsp dcsp test if int int file id dcnl dcsp except valueerror dcnl dcsp dcsp raise exceptions plotlyerror the dcsp file id dcsp argument dcsp was dcsp not dcsp able dcsp to dcsp be dcsp converted dcsp into dcsp an dcsp integer dcsp number dcsp make dcsp sure dcsp that dcsp the dcsp positional dcsp file id dcsp argument dcsp is dcsp a dcsp number dcsp that dcsp can dcsp be dcsp converted dcsp into dcsp an dcsp integer dcsp or dcsp a dcsp string dcsp that dcsp can dcsp be dcsp converted dcsp into dcsp an dcsp integer dcnl dcsp if int file id < 0 dcnl dcsp dcsp raise exceptions plotlyerror the dcsp file id dcsp argument dcsp must dcsp be dcsp a dcsp nonnegative dcsp number dcnl dcsp if share key is dcnl dcsp dcsp s <iframe dcsp id igraph dcsp scrolling no dcsp style border none dcsp seamless seamless dcsp src plotly rest url ~ file owner file id embed dcsp height iframe height dcsp width iframe width < iframe format plotly rest url plotly rest url file owner file owner file id file id iframe height height iframe width width dcnl dcsp else dcnl dcsp dcsp s <iframe dcsp id igraph dcsp scrolling no dcsp style border none dcsp seamless seamless dcsp src plotly rest url ~ file owner file id embed share key share key dcsp height iframe height dcsp width iframe width < iframe format plotly rest url plotly rest url file owner file owner file id file id share key share key iframe height height iframe width width dcnl dcsp return s
def embed file owner or url file id none width 100 height 525 dcsp try dcnl dcsp dcsp s get embed file owner or url file id file id width width height height dcnl dcsp dcsp if sage salvus dcnl dcsp dcsp dcsp return sage salvus html s hide false dcnl dcsp except dcnl dcsp dcsp pass dcnl dcsp if ipython core display dcnl dcsp dcsp if file id dcnl dcsp dcsp dcsp plotly domain session get session config get plotly domain or get config file plotly domain dcnl dcsp dcsp dcsp url plotly domain ~ un fid format plotly domain plotly domain un file owner or url fid file id dcnl dcsp dcsp else dcnl dcsp dcsp dcsp url file owner or url dcnl dcsp dcsp return plotlydisplay url width height dcnl dcsp else dcnl dcsp dcsp if get config defaults plotly domain session get session config plotly domain dcnl dcsp dcsp dcsp feedback contact visit dcsp support plot ly dcnl dcsp dcsp else dcnl dcsp dcsp dcsp feedback contact contact dcsp your dcsp onpremise dcsp account dcsp executive dcnl dcsp dcsp warnings warn looks dcsp like dcsp you re dcsp not dcsp using dcsp ipython dcsp or dcsp sage dcsp to dcsp embed dcsp this dcsp plot dcsp if dcsp you dcsp just dcsp want dcsp the dcsp embed dcsp code ntry dcsp using dcsp get embed dcsp instead nquestions dcsp format feedback contact
utils template doc get config file dcnl def mpl to plotly fig resize false strip style false verbose false dcsp if matplotlylib dcnl dcsp dcsp renderer matplotlylib plotlyrenderer dcnl dcsp dcsp matplotlylib exporter renderer run fig dcnl dcsp dcsp if resize dcnl dcsp dcsp dcsp renderer resize dcnl dcsp dcsp if strip style dcnl dcsp dcsp dcsp renderer strip style dcnl dcsp dcsp if verbose dcnl dcsp dcsp dcsp print renderer msg dcnl dcsp dcsp return renderer plotly fig dcnl dcsp else dcnl dcsp dcsp warnings warn to dcsp use dcsp plotly s dcsp matplotlylib dcsp functionality dcsp you ll dcsp need dcsp to dcsp have dcsp matplotlib dcsp successfully dcsp installed dcsp with dcsp all dcsp of dcsp its dcsp dependencies dcsp you re dcsp getting dcsp this dcsp error dcsp because dcsp matplotlib dcsp or dcsp one dcsp of dcsp its dcsp dependencies dcsp doesn t dcsp seem dcsp to dcsp be dcsp installed dcsp correctly
def get subplots rows 1 columns 1 print grid false kwargs dcsp from plotly graph objs import graph objs dcnl dcsp warnings warn tools get subplots dcsp is dcsp depreciated dcsp please dcsp use dcsp tools make subplots dcsp instead dcnl dcsp if not isinstance rows int or rows < 0 dcnl dcsp dcsp raise exception keyword dcsp argument dcsp rows dcsp must dcsp be dcsp an dcsp int dcsp greater dcsp than dcsp 0 dcnl dcsp if not isinstance columns int or columns < 0 dcnl dcsp dcsp raise exception keyword dcsp argument dcsp columns dcsp must dcsp be dcsp an dcsp int dcsp greater dcsp than dcsp 0 dcnl dcsp valid kwargs horizontal spacing vertical spacing dcnl dcsp for key in kwargs keys dcnl dcsp dcsp if key not in valid kwargs dcnl dcsp dcsp dcsp raise exception invalid dcsp keyword dcsp argument dcsp 0 format key dcnl dcsp try dcnl dcsp dcsp horizontal spacing float kwargs horizontal spacing dcnl dcsp except keyerror dcnl dcsp dcsp horizontal spacing 0 2 columns dcnl dcsp try dcnl dcsp dcsp vertical spacing float kwargs vertical spacing dcnl dcsp except keyerror dcnl dcsp dcsp vertical spacing 0 3 rows dcnl dcsp fig dict layout graph objs layout dcnl dcsp plot width 1 horizontal spacing columns 1 columns dcnl dcsp plot height 1 vertical spacing rows 1 rows dcnl dcsp plot num 0 dcnl dcsp for rrr in range rows dcnl dcsp dcsp for ccc in range columns dcnl dcsp dcsp dcsp xaxis name xaxis 0 format plot num + 1 dcnl dcsp dcsp dcsp x anchor y 0 format plot num + 1 dcnl dcsp dcsp dcsp x start plot width + horizontal spacing ccc dcnl dcsp dcsp dcsp x end x start + plot width dcnl dcsp dcsp dcsp yaxis name yaxis 0 format plot num + 1 dcnl dcsp dcsp dcsp y anchor x 0 format plot num + 1 dcnl dcsp dcsp dcsp y start plot height + vertical spacing rrr dcnl dcsp dcsp dcsp y end y start + plot height dcnl dcsp dcsp dcsp xaxis graph objs xaxis domain x start x end anchor x anchor dcnl dcsp dcsp dcsp fig layout xaxis name xaxis dcnl dcsp dcsp dcsp yaxis graph objs yaxis domain y start y end anchor y anchor dcnl dcsp dcsp dcsp fig layout yaxis name yaxis dcnl dcsp dcsp dcsp plot num + 1 dcnl dcsp if print grid dcnl dcsp dcsp print this dcsp is dcsp the dcsp format dcsp of dcsp your dcsp plot dcsp grid dcnl dcsp dcsp grid string dcnl dcsp dcsp plot 1 dcnl dcsp dcsp for rrr in range rows dcnl dcsp dcsp dcsp grid line dcnl dcsp dcsp dcsp for ccc in range columns dcnl dcsp dcsp dcsp dcsp grid line + 0 dctb format plot dcnl dcsp dcsp dcsp dcsp plot + 1 dcnl dcsp dcsp dcsp grid string grid line + n + grid string dcnl dcsp dcsp print grid string dcnl dcsp return graph objs figure fig
def make subplots rows 1 cols 1 shared xaxes false shared yaxes false start cell topleft print grid true kwargs dcsp from plotly graph objs import graph objs dcnl dcsp if not isinstance rows int or rows < 0 dcnl dcsp dcsp raise exception keyword dcsp argument dcsp rows dcsp must dcsp be dcsp an dcsp int dcsp greater dcsp than dcsp 0 dcnl dcsp if not isinstance cols int or cols < 0 dcnl dcsp dcsp raise exception keyword dcsp argument dcsp cols dcsp must dcsp be dcsp an dcsp int dcsp greater dcsp than dcsp 0 dcnl dcsp start cell all bottomleft col dir 1 row dir 1 topleft col dir 1 row dir 1 dcnl dcsp try dcnl dcsp dcsp start cell start cell allstart cell dcnl dcsp except keyerror dcnl dcsp dcsp raise exception invalid dcsp start cell dcsp value dcnl dcsp valid kwargs horizontal spacing vertical spacing specs insets subplot titles dcnl dcsp for key in kwargs keys dcnl dcsp dcsp if key not in valid kwargs dcnl dcsp dcsp dcsp raise exception invalid dcsp keyword dcsp argument dcsp 0 format key dcnl dcsp subplot titles kwargs get subplot titles rows cols dcnl dcsp try dcnl dcsp dcsp horizontal spacing float kwargs horizontal spacing dcnl dcsp except keyerror dcnl dcsp dcsp horizontal spacing 0 2 cols dcnl dcsp try dcnl dcsp dcsp vertical spacing float kwargs vertical spacing dcnl dcsp except keyerror dcnl dcsp dcsp if subplot titles in kwargs dcnl dcsp dcsp dcsp vertical spacing 0 5 rows dcnl dcsp dcsp else dcnl dcsp dcsp dcsp vertical spacing 0 3 rows dcnl dcsp exception msg keyword dcsp argument dcsp specs dcsp must dcsp be dcsp a dcsp list dcsp of dcsp lists dcnl dcsp try dcnl dcsp dcsp specs kwargs specs dcnl dcsp dcsp if not isinstance specs list dcnl dcsp dcsp dcsp raise exception exception msg dcnl dcsp dcsp else dcnl dcsp dcsp dcsp for spec row in specs dcnl dcsp dcsp dcsp dcsp if not isinstance spec row list dcnl dcsp dcsp dcsp dcsp dcsp raise exception exception msg dcnl dcsp except keyerror dcnl dcsp dcsp specs for c in range cols for r in range rows dcnl dcsp if len specs rows dcnl dcsp dcsp raise exception the dcsp number dcsp of dcsp rows dcsp in dcsp specs dcsp must dcsp be dcsp equal dcsp to dcsp rows dcnl dcsp for r spec row in enumerate specs dcnl dcsp dcsp if len spec row cols dcnl dcsp dcsp dcsp raise exception the dcsp number dcsp of dcsp columns dcsp in dcsp specs dcsp must dcsp be dcsp equal dcsp to dcsp cols dcnl dcsp try dcnl dcsp dcsp insets kwargs insets dcnl dcsp dcsp if not isinstance insets list dcnl dcsp dcsp dcsp raise exception keyword dcsp argument dcsp insets dcsp must dcsp be dcsp a dcsp list dcnl dcsp except keyerror dcnl dcsp dcsp insets false dcnl dcsp def check keys and fill name arg defaults dcnl dcsp dcsp def checks item defaults dcnl dcsp dcsp dcsp if item is none dcnl dcsp dcsp dcsp dcsp return dcnl dcsp dcsp dcsp if not isinstance item dict dcnl dcsp dcsp dcsp dcsp raise exception items dcsp in dcsp keyword dcsp argument dcsp name dcsp must dcsp be dcsp dictionaries dcsp or dcsp none format name name dcnl dcsp dcsp dcsp for k in item keys dcnl dcsp dcsp dcsp dcsp if k not in defaults keys dcnl dcsp dcsp dcsp dcsp dcsp raise exception invalid dcsp key dcsp k dcsp in dcsp keyword dcsp argument dcsp name format k k name name dcnl dcsp dcsp dcsp for k in defaults keys dcnl dcsp dcsp dcsp dcsp if k not in item keys dcnl dcsp dcsp dcsp dcsp dcsp itemk defaultsk dcnl dcsp dcsp for arg i in arg dcnl dcsp dcsp dcsp if isinstance arg i list dcnl dcsp dcsp dcsp dcsp for arg ii in arg i dcnl dcsp dcsp dcsp dcsp dcsp checks arg ii defaults dcnl dcsp dcsp dcsp elif isinstance arg i dict dcnl dcsp dcsp dcsp dcsp checks arg i defaults dcnl dcsp spec defaults dict is 3d false colspan 1 rowspan 1 l 0 0 r 0 0 b 0 0 t 0 0 dcnl dcsp check keys and fill specs specs spec defaults dcnl dcsp if insets dcnl dcsp dcsp inset defaults dict cell 1 1 is 3d false l 0 0 w to end b 0 0 h to end dcnl dcsp dcsp check keys and fill insets insets inset defaults dcnl dcsp width 1 0 horizontal spacing cols 1 cols dcnl dcsp height 1 0 vertical spacing rows 1 rows dcnl dcsp col dir start cell col dir dcnl dcsp row dir start cell row dir dcnl dcsp col seq range cols col dir dcnl dcsp row seq range rows row dir dcnl dcsp grid width + horizontal spacing c height + vertical spacing r for c in col seq for r in row seq dcnl dcsp grid ref none for c in range cols for r in range rows dcnl dcsp insets ref none for inset in range len insets if insets else none dcnl dcsp layout graph objs layout dcnl dcsp def get label x or y r c cnt shared axes dcnl dcsp dcsp label x or y cnt format x or y x or y cnt cnt dcnl dcsp dcsp if isinstance shared axes bool dcnl dcsp dcsp dcsp if shared axes dcnl dcsp dcsp dcsp dcsp if x or y x dcnl dcsp dcsp dcsp dcsp dcsp label x or y c format x or y x or y c c + 1 dcnl dcsp dcsp dcsp dcsp if x or y y dcnl dcsp dcsp dcsp dcsp dcsp label x or y r format x or y x or y r r + 1 dcnl dcsp dcsp if isinstance shared axes list dcnl dcsp dcsp dcsp if isinstance shared axes0 tuple dcnl dcsp dcsp dcsp dcsp shared axes shared axes dcnl dcsp dcsp dcsp for shared axis in shared axes dcnl dcsp dcsp dcsp dcsp if r + 1 c + 1 in shared axis dcnl dcsp dcsp dcsp dcsp dcsp label x x 0 format shared axis01 y y 0 format shared axis00 x or y dcnl dcsp dcsp return label dcnl dcsp anchor row 0 if row dir 0 else rows 1 dcnl dcsp def get anchors r c x cnt y cnt shared xaxes shared yaxes dcnl dcsp dcsp x anchor y y cnt format y cnt y cnt dcnl dcsp dcsp y anchor x x cnt format x cnt x cnt dcnl dcsp dcsp if isinstance shared xaxes bool dcnl dcsp dcsp dcsp if shared xaxes dcnl dcsp dcsp dcsp dcsp if r anchor row dcnl dcsp dcsp dcsp dcsp dcsp x anchor false dcnl dcsp dcsp dcsp dcsp dcsp y anchor free dcnl dcsp dcsp dcsp dcsp dcsp if shared yaxes and c 0 dcnl dcsp dcsp dcsp dcsp dcsp dcsp y anchor false dcnl dcsp dcsp dcsp dcsp dcsp return x anchor y anchor dcnl dcsp dcsp elif isinstance shared xaxes list dcnl dcsp dcsp dcsp if isinstance shared xaxes0 tuple dcnl dcsp dcsp dcsp dcsp shared xaxes shared xaxes dcnl dcsp dcsp dcsp for shared xaxis in shared xaxes dcnl dcsp dcsp dcsp dcsp if r + 1 c + 1 in shared xaxis1 dcnl dcsp dcsp dcsp dcsp dcsp x anchor false dcnl dcsp dcsp dcsp dcsp dcsp y anchor free dcnl dcsp dcsp if isinstance shared yaxes bool dcnl dcsp dcsp dcsp if shared yaxes dcnl dcsp dcsp dcsp dcsp if c 0 dcnl dcsp dcsp dcsp dcsp dcsp y anchor false dcnl dcsp dcsp dcsp dcsp dcsp x anchor free dcnl dcsp dcsp dcsp dcsp dcsp if shared xaxes and r anchor row dcnl dcsp dcsp dcsp dcsp dcsp dcsp x anchor false dcnl dcsp dcsp dcsp dcsp dcsp return x anchor y anchor dcnl dcsp dcsp elif isinstance shared yaxes list dcnl dcsp dcsp dcsp if isinstance shared yaxes0 tuple dcnl dcsp dcsp dcsp dcsp shared yaxes shared yaxes dcnl dcsp dcsp dcsp for shared yaxis in shared yaxes dcnl dcsp dcsp dcsp dcsp if r + 1 c + 1 in shared yaxis1 dcnl dcsp dcsp dcsp dcsp dcsp y anchor false dcnl dcsp dcsp dcsp dcsp dcsp x anchor free dcnl dcsp dcsp return x anchor y anchor dcnl dcsp list of domains dcnl dcsp def add domain layout x or y label domain anchor position dcnl dcsp dcsp name label0 + axis + label1 dcnl dcsp dcsp axis domain domain dcnl dcsp dcsp if anchor dcnl dcsp dcsp dcsp axis anchor anchor dcnl dcsp dcsp if isinstance position float dcnl dcsp dcsp dcsp axis position position dcnl dcsp dcsp layoutname axis dcnl dcsp dcsp list of domains append domain dcnl dcsp def add domain is 3d layout s label x domain y domain dcnl dcsp dcsp scene graph objs scene domain x x domain y y domain dcnl dcsp dcsp layouts label scene dcnl dcsp x cnt y cnt s cnt 1 dcnl dcsp for r spec row in enumerate specs dcnl dcsp dcsp for c spec in enumerate spec row dcnl dcsp dcsp dcsp if spec is none dcnl dcsp dcsp dcsp dcsp continue dcnl dcsp dcsp dcsp c spanned c + spec colspan 1 dcnl dcsp dcsp dcsp r spanned r + spec rowspan 1 dcnl dcsp dcsp dcsp if c spanned cols dcnl dcsp dcsp dcsp dcsp raise exception some dcsp colspan dcsp value dcsp is dcsp too dcsp large dcsp for dcsp this dcsp subplot dcsp grid dcnl dcsp dcsp dcsp if r spanned rows dcnl dcsp dcsp dcsp dcsp raise exception some dcsp rowspan dcsp value dcsp is dcsp too dcsp large dcsp for dcsp this dcsp subplot dcsp grid dcnl dcsp dcsp dcsp x s gridrc0 + spec l dcnl dcsp dcsp dcsp x e gridrc spanned0 + width spec r dcnl dcsp dcsp dcsp x domain x s x e dcnl dcsp dcsp dcsp if row dir 0 dcnl dcsp dcsp dcsp dcsp y s gridrc1 + spec b dcnl dcsp dcsp dcsp dcsp y e gridr spannedc1 + height spec t dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp y s gridr spannedc1 + spec b dcnl dcsp dcsp dcsp dcsp y e gridrc1 + height spec t dcnl dcsp dcsp dcsp y domain y s y e dcnl dcsp dcsp dcsp if spec is 3d dcnl dcsp dcsp dcsp dcsp s label scene 0 format s cnt dcnl dcsp dcsp dcsp dcsp add domain is 3d layout s label x domain y domain dcnl dcsp dcsp dcsp dcsp grid refrc s label dcnl dcsp dcsp dcsp dcsp s cnt + 1 dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp x label get label x r c x cnt shared xaxes dcnl dcsp dcsp dcsp dcsp y label get label y r c y cnt shared yaxes dcnl dcsp dcsp dcsp dcsp x anchor y anchor get anchors r c x cnt y cnt shared xaxes shared yaxes dcnl dcsp dcsp dcsp dcsp if x anchor dcnl dcsp dcsp dcsp dcsp dcsp if x anchor free dcnl dcsp dcsp dcsp dcsp dcsp dcsp x position y domain0 dcnl dcsp dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp dcsp x position false dcnl dcsp dcsp dcsp dcsp dcsp add domain layout x x label x domain x anchor x position dcnl dcsp dcsp dcsp dcsp dcsp x cnt + 1 dcnl dcsp dcsp dcsp dcsp if y anchor dcnl dcsp dcsp dcsp dcsp dcsp if y anchor free dcnl dcsp dcsp dcsp dcsp dcsp dcsp y position x domain0 dcnl dcsp dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp dcsp y position false dcnl dcsp dcsp dcsp dcsp dcsp add domain layout y y label y domain y anchor y position dcnl dcsp dcsp dcsp dcsp dcsp y cnt + 1 dcnl dcsp dcsp dcsp dcsp grid refrc x label y label dcnl dcsp if insets dcnl dcsp dcsp for i inset inset in enumerate insets dcnl dcsp dcsp dcsp r inset cell 0 1 dcnl dcsp dcsp dcsp c inset cell 1 1 dcnl dcsp dcsp dcsp if not 0 < r < rows dcnl dcsp dcsp dcsp dcsp raise exception some dcsp cell dcsp row dcsp value dcsp is dcsp out dcsp of dcsp range dcsp note dcsp the dcsp starting dcsp cell dcsp is dcsp 1 dcsp 1 dcnl dcsp dcsp dcsp if not 0 < c < cols dcnl dcsp dcsp dcsp dcsp raise exception some dcsp cell dcsp col dcsp value dcsp is dcsp out dcsp of dcsp range dcsp note dcsp the dcsp starting dcsp cell dcsp is dcsp 1 dcsp 1 dcnl dcsp dcsp dcsp x s gridrc0 + inset l width dcnl dcsp dcsp dcsp if inset w to end dcnl dcsp dcsp dcsp dcsp x e gridrc0 + width dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp x e x s + inset w width dcnl dcsp dcsp dcsp x domain x s x e dcnl dcsp dcsp dcsp y s gridrc1 + inset b height dcnl dcsp dcsp dcsp if inset h to end dcnl dcsp dcsp dcsp dcsp y e gridrc1 + height dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp y e y s + inset h height dcnl dcsp dcsp dcsp y domain y s y e dcnl dcsp dcsp dcsp if inset is 3d dcnl dcsp dcsp dcsp dcsp s label scene 0 format s cnt dcnl dcsp dcsp dcsp dcsp add domain is 3d layout s label x domain y domain dcnl dcsp dcsp dcsp dcsp insets refi inset s label dcnl dcsp dcsp dcsp dcsp s cnt + 1 dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp x label get label x false false x cnt false dcnl dcsp dcsp dcsp dcsp y label get label y false false y cnt false dcnl dcsp dcsp dcsp dcsp x anchor y anchor get anchors r c x cnt y cnt false false dcnl dcsp dcsp dcsp dcsp add domain layout x x label x domain x anchor false dcnl dcsp dcsp dcsp dcsp x cnt + 1 dcnl dcsp dcsp dcsp dcsp add domain layout y y label y domain y anchor false dcnl dcsp dcsp dcsp dcsp y cnt + 1 dcnl dcsp dcsp dcsp dcsp insets refi inset x label y label dcnl dcsp sp dcsp dcsp dcnl dcsp s str dcsp dcnl dcsp e str dcsp dcnl dcsp colspan str dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcnl dcsp rowspan str dcsp dcsp dcsp dcsp dcsp dcsp dcsp | dcnl dcsp empty str dcsp dcsp dcsp dcsp empty dcsp dcnl dcsp grid str this dcsp is dcsp the dcsp format dcsp of dcsp your dcsp plot dcsp grid n dcnl dcsp tmp for c in range cols for r in range rows dcnl dcsp def get cell str r c ref dcnl dcsp dcsp return r c dcsp ref format r r + 1 c c + 1 ref join ref dcnl dcsp cell len max len get cell str r c ref for r row ref in enumerate grid ref for c ref in enumerate row ref if ref + len s str + len e str dcnl dcsp def pad s cell len cell len dcnl dcsp dcsp return dcsp cell len len s dcnl dcsp for r spec row in enumerate specs dcnl dcsp dcsp for c spec in enumerate spec row dcnl dcsp dcsp dcsp ref grid refrc dcnl dcsp dcsp dcsp if ref is none dcnl dcsp dcsp dcsp dcsp if tmprc dcnl dcsp dcsp dcsp dcsp dcsp tmprc empty str + pad empty str dcnl dcsp dcsp dcsp dcsp continue dcnl dcsp dcsp dcsp cell str s str + get cell str r c ref dcnl dcsp dcsp dcsp if spec colspan 1 dcnl dcsp dcsp dcsp dcsp for cc in range 1 spec colspan 1 dcnl dcsp dcsp dcsp dcsp dcsp tmpr c + cc colspan str + pad colspan str dcnl dcsp dcsp dcsp dcsp tmpr c + spec colspan 1 colspan str + pad colspan str + e str + e str dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp cell str + e str dcnl dcsp dcsp dcsp if spec rowspan 1 dcnl dcsp dcsp dcsp dcsp for rr in range 1 spec rowspan 1 dcnl dcsp dcsp dcsp dcsp dcsp tmp r + rr c rowspan str + pad rowspan str dcnl dcsp dcsp dcsp dcsp for cc in range spec colspan dcnl dcsp dcsp dcsp dcsp dcsp tmp r + spec rowspan 1 c + cc rowspan str + pad rowspan str dcnl dcsp dcsp dcsp tmprc cell str + pad cell str dcnl dcsp for r in row seq 1 dcnl dcsp dcsp grid str + sp join tmpr + n dcnl dcsp if insets dcnl dcsp dcsp grid str + nwith dcsp insets n dcnl dcsp dcsp for i inset inset in enumerate insets dcnl dcsp dcsp dcsp r inset cell 0 1 dcnl dcsp dcsp dcsp c inset cell 1 1 dcnl dcsp dcsp dcsp ref grid refrc dcnl dcsp dcsp dcsp grid str + s str + join insets refi inset + e str + dcsp over dcsp + s str + get cell str r c ref + e str + n dcnl dcsp if not shared xaxes and not shared yaxes dcnl dcsp dcsp x dom list of domains 2 dcnl dcsp dcsp y dom list of domains1 2 dcnl dcsp dcsp subtitle pos x dcnl dcsp dcsp subtitle pos y dcnl dcsp dcsp for x domains in x dom dcnl dcsp dcsp dcsp subtitle pos x append sum x domains 2 dcnl dcsp dcsp for y domains in y dom dcnl dcsp dcsp dcsp subtitle pos y append y domains1 dcnl dcsp else dcnl dcsp dcsp subtitle pos x none cols dcnl dcsp dcsp subtitle pos y none rows dcnl dcsp dcsp delt x x e x s dcnl dcsp dcsp for index in range cols dcnl dcsp dcsp dcsp subtitle pos xindex delt x 2 + delt x + horizontal spacing index dcnl dcsp dcsp subtitle pos x rows dcnl dcsp dcsp for index in range rows dcnl dcsp dcsp dcsp subtitle pos yindex 1 y e + vertical spacing index dcnl dcsp dcsp subtitle pos y cols dcnl dcsp dcsp subtitle pos y sorted subtitle pos y reverse true dcnl dcsp plot titles dcnl dcsp for index in range len subplot titles dcnl dcsp dcsp if not subplot titlesindex dcnl dcsp dcsp dcsp pass dcnl dcsp dcsp else dcnl dcsp dcsp dcsp plot titles append y subtitle pos yindex xref paper x subtitle pos xindex yref paper text subplot titlesindex showarrow false font graph objs font size 16 xanchor center yanchor bottom dcnl dcsp dcsp dcsp layout annotations plot titles dcnl dcsp if print grid dcnl dcsp dcsp print grid str dcnl dcsp fig graph objs figure layout layout dcnl dcsp fig dict grid ref grid ref dcnl dcsp fig dict grid str grid str dcnl dcsp return fig
def get valid graph obj obj obj type none dcsp from plotly graph objs import graph objs dcnl dcsp try dcnl dcsp dcsp cls getattr graph objs obj type dcnl dcsp except attributeerror keyerror dcnl dcsp dcsp raise exceptions plotlyerror dcsp is dcsp not dcsp a dcsp recognized dcsp graph obj format obj type dcnl dcsp return cls obj raise false
def validate obj obj type dcsp from plotly import graph reference dcnl dcsp from plotly graph objs import graph objs dcnl dcsp if obj type not in graph reference classes dcnl dcsp dcsp obj type graph reference string to class name obj type dcnl dcsp try dcnl dcsp dcsp cls getattr graph objs obj type dcnl dcsp except attributeerror dcnl dcsp dcsp raise exceptions plotlyerror 0 dcsp is dcsp not dcsp a dcsp recognizable dcsp graph obj format obj type dcnl dcsp cls obj
def replace newline obj dcsp if isinstance obj dict dcnl dcsp dcsp d dict dcnl dcsp dcsp for key val in list obj items dcnl dcsp dcsp dcsp dkey replace newline val dcnl dcsp dcsp return d dcnl dcsp elif isinstance obj list dcnl dcsp dcsp l list dcnl dcsp dcsp for index entry in enumerate obj dcnl dcsp dcsp dcsp l + replace newline entry dcnl dcsp dcsp return l dcnl dcsp elif isinstance obj six string types dcnl dcsp dcsp s obj replace n <br dcnl dcsp dcsp if s obj dcnl dcsp dcsp dcsp warnings warn looks dcsp like dcsp you dcsp used dcsp a dcsp newline dcsp character dcsp n n nplotly dcsp uses dcsp a dcsp subset dcsp of dcsp html dcsp escape dcsp characters nto dcsp do dcsp things dcsp like dcsp newline dcsp <br dcsp bold dcsp <b < b nitalics dcsp <i < i dcsp etc dcsp your dcsp newline dcsp characters dcsp nhave dcsp been dcsp converted dcsp to dcsp <br dcsp so dcsp they dcsp will dcsp show dcsp nup dcsp right dcsp on dcsp your dcsp plotly dcsp figure dcnl dcsp dcsp return s dcnl dcsp else dcnl dcsp dcsp return obj
def get graph reference dcsp path os path join package data defaultschema json dcnl dcsp s resource string plotly path decode utf8 dcnl dcsp graph reference utils decode unicode json loads s dcnl dcsp graph reference frames items frames entry baseframe description the dcsp name dcsp of dcsp the dcsp frame dcsp into dcsp which dcsp this dcsp frame s dcsp properties dcsp are dcsp merged dcsp before dcsp applying dcsp this dcsp is dcsp used dcsp to dcsp unify dcsp properties dcsp and dcsp avoid dcsp needing dcsp to dcsp specify dcsp the dcsp same dcsp values dcsp for dcsp the dcsp same dcsp properties dcsp in dcsp multiple dcsp frames role info valtype string data description a dcsp list dcsp of dcsp traces dcsp this dcsp frame dcsp modifies dcsp the dcsp format dcsp is dcsp identical dcsp to dcsp the dcsp normal dcsp trace dcsp definition role object valtype any group description an dcsp identifier dcsp that dcsp specifies dcsp the dcsp group dcsp to dcsp which dcsp the dcsp frame dcsp belongs dcsp used dcsp by dcsp animate dcsp to dcsp select dcsp a dcsp subset dcsp of dcsp frames role info valtype string layout role object description layout dcsp properties dcsp which dcsp this dcsp frame dcsp modifies dcsp the dcsp format dcsp is dcsp identical dcsp to dcsp the dcsp normal dcsp layout dcsp definition valtype any name description a dcsp label dcsp by dcsp which dcsp to dcsp identify dcsp the dcsp frame role info valtype string role object traces description a dcsp list dcsp of dcsp trace dcsp indices dcsp that dcsp identify dcsp the dcsp respective dcsp traces dcsp in dcsp the dcsp data dcsp attribute role info valtype info array role object dcnl dcsp return graph reference
def string to class name string dcsp string re sub azaz lambda m m group title string count 1 dcnl dcsp string re sub azaz09+ lambda m m group 1 title string dcnl dcsp return str string
def object name to class name object name dcsp if object name in trace names dcnl dcsp dcsp return string to class name object name dcnl dcsp if object name in object name to class name dcnl dcsp dcsp return object name to class nameobject name dcnl dcsp if object name in arrays dcnl dcsp dcsp return list dcnl dcsp else dcnl dcsp dcsp return dict
def get attributes dicts object name parent object names dcsp object dict objectsobject name dcnl dcsp additional attributes object dict additional attributes dcnl dcsp attribute paths list object dict attribute paths dcnl dcsp if frame name in parent object names dcnl dcsp dcsp len parent object names len parent object names dcnl dcsp dcsp index parent object names index frame name dcnl dcsp dcsp if len parent object names index + 1 dcnl dcsp dcsp dcsp if object name in data layout dcnl dcsp dcsp dcsp dcsp parent object names figure object name dcnl dcsp dcsp elif len parent object names index + 1 dcnl dcsp dcsp dcsp if parent object names index + 1 in data layout dcnl dcsp dcsp dcsp dcsp parent object names figure + list parent object names index + 1 dcnl dcsp for parent object name in reversed parent object names dcnl dcsp dcsp if parent object name in arrays dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp parent object dict objectsparent object name dcnl dcsp dcsp parent attribute paths parent object dict attribute paths dcnl dcsp dcsp for path in list attribute paths dcnl dcsp dcsp dcsp if not is valid sub path path parent attribute paths dcnl dcsp dcsp dcsp dcsp attribute paths remove path dcnl dcsp attributes dicts path utils get by path graph reference path for path in attribute paths dcnl dcsp attributes dicts additional attributes additional attributes dcnl dcsp return attributes dicts
def attribute path to object names attribute container path dcsp object names figure dcnl dcsp if layout in attribute container path dcnl dcsp dcsp for path part in attribute container path dcnl dcsp dcsp dcsp if path part in objects dcnl dcsp dcsp dcsp dcsp object names append path part dcnl dcsp dcsp dcsp if path part in arrays dcnl dcsp dcsp dcsp dcsp object names append path part dcnl dcsp dcsp dcsp dcsp object names append path part 1 dcnl dcsp elif layoutattributes in attribute container path dcnl dcsp dcsp object names append layout dcnl dcsp dcsp start index attribute container path index layoutattributes dcnl dcsp dcsp for path part in attribute container pathstart index dcnl dcsp dcsp dcsp if path part in objects dcnl dcsp dcsp dcsp dcsp object names append path part dcnl dcsp dcsp dcsp if path part in arrays dcnl dcsp dcsp dcsp dcsp object names append path part dcnl dcsp dcsp dcsp dcsp object names append path part 1 dcnl dcsp else dcnl dcsp dcsp object names append data dcnl dcsp dcsp for path part in attribute container path dcnl dcsp dcsp dcsp if path part in objects dcnl dcsp dcsp dcsp dcsp object names append path part dcnl dcsp dcsp dcsp if path part in arrays dcnl dcsp dcsp dcsp dcsp object names append path part dcnl dcsp dcsp dcsp dcsp object names append path part 1 dcnl dcsp return tuple object names
utils memoize dcnl def get role object name attribute value type parent object names dcsp if attribute type and object name in trace names dcnl dcsp dcsp return info dcnl dcsp attributes dicts get attributes dicts object name parent object names dcnl dcsp matches dcnl dcsp for attributes dict in attributes dicts values dcnl dcsp dcsp for key val in attributes dict items dcnl dcsp dcsp dcsp if key attribute dcnl dcsp dcsp dcsp dcsp matches append val dcnl dcsp dcsp for key val in attributes dict get deprecated items dcnl dcsp dcsp dcsp if key attribute dcnl dcsp dcsp dcsp dcsp matches append val dcnl dcsp roles dcnl dcsp for match in matches dcnl dcsp dcsp role match role dcnl dcsp dcsp array ok match get arrayok dcnl dcsp dcsp if array ok and value type array dcnl dcsp dcsp dcsp role data dcnl dcsp dcsp roles append role dcnl dcsp if data in roles dcnl dcsp dcsp role data dcnl dcsp else dcnl dcsp dcsp role roles0 dcnl dcsp return role
def get role object name attribute value none parent object names dcsp if value is none dcnl dcsp dcsp value type none dcnl dcsp elif isinstance value dict dcnl dcsp dcsp value type dict dcnl dcsp elif isinstance value six string types dcnl dcsp dcsp value type string dcnl dcsp elif hasattr value iter dcnl dcsp dcsp value type array dcnl dcsp else dcnl dcsp dcsp value type unknown dcnl dcsp return get role object name attribute value type tuple parent object names
def is valid sub path path parent paths dcsp if not parent paths dcnl dcsp dcsp return true dcnl dcsp for parent path in parent paths dcnl dcsp dcsp if path len parent path parent path dcnl dcsp dcsp dcsp return true dcnl dcsp return false
def get objects dcsp objects dcnl dcsp for node path in utils node generator graph reference dcnl dcsp dcsp if any key in path for key in graph reference defs metakeys dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if node get role object dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if items in node dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp object name path 1 dcnl dcsp dcsp if object name not in objects dcnl dcsp dcsp dcsp objectsobject name meta paths attribute paths additional attributes dcnl dcsp dcsp if node get attributes dcnl dcsp dcsp dcsp objectsobject name attribute paths append path + attributes dcnl dcsp dcsp else dcnl dcsp dcsp dcsp objectsobject name attribute paths append path dcnl dcsp dcsp objectsobject name meta paths append path dcnl dcsp return objects
def patch objects dcsp layout attribute paths dcnl dcsp for node path in utils node generator graph reference dcnl dcsp dcsp if any key in path for key in graph reference defs metakeys dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if path and path 1 layoutattributes dcnl dcsp dcsp dcsp layout attribute paths append path dcnl dcsp for trace name in trace names dcnl dcsp dcsp objectstrace name meta paths traces trace name attribute paths traces trace name attributes additional attributes dcnl dcsp objects layout meta paths layout attribute paths layout attribute paths additional attributes dcnl dcsp figure attributes layout role object data role object islinkedtoarray true frames role object islinkedtoarray true dcnl dcsp objects figure meta paths attribute paths additional attributes figure attributes
def get arrays dcsp arrays dcnl dcsp for node path in utils node generator graph reference dcnl dcsp dcsp if any key in path for key in graph reference defs metakeys dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if node get role object dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if items not in node dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp object name path 1 dcnl dcsp dcsp if object name not in arrays dcnl dcsp dcsp dcsp items node items dcnl dcsp dcsp dcsp if isinstance items dict dcnl dcsp dcsp dcsp dcsp item names list items keys dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp item names object name 1 dcnl dcsp dcsp dcsp arraysobject name meta paths path items item names dcnl dcsp return arrays
def patch arrays dcsp arrays data meta paths traces items list trace names
def get classes dcsp classes dcnl dcsp for class name class dict in backwards compat class names items dcnl dcsp dcsp object name class dict object name dcnl dcsp dcsp base type class dict base type dcnl dcsp dcsp if object name in objects or object name in arrays dcnl dcsp dcsp dcsp classesclass name object name object name base type base type dcnl dcsp dcsp else dcnl dcsp dcsp dcsp classesclass name object name none base type base type dcnl dcsp for object name in trace names dcnl dcsp dcsp class name string to class name object name dcnl dcsp dcsp classesclass name object name object name base type dict dcnl dcsp return classes
def dict to sequence d dcsp if hasattr d items dcnl dcsp dcsp d d items dcnl dcsp return d
def get netrc auth url dcsp try dcnl dcsp dcsp locations os path expanduser ~ 0 format f for f in netrc files dcnl dcsp dcsp netrc path none dcnl dcsp dcsp for loc in locations dcnl dcsp dcsp dcsp if os path exists loc and not netrc path dcnl dcsp dcsp dcsp dcsp netrc path loc dcnl dcsp dcsp if netrc path is none dcnl dcsp dcsp dcsp return netrc path dcnl dcsp dcsp ri urlparse url dcnl dcsp dcsp host ri netloc split 0 dcnl dcsp dcsp try dcnl dcsp dcsp dcsp netrc netrc netrc path authenticators host dcnl dcsp dcsp dcsp if netrc dcnl dcsp dcsp dcsp dcsp login i 0 if netrc0 else 1 dcnl dcsp dcsp dcsp dcsp return netrclogin i netrc2 dcnl dcsp dcsp except netrcparseerror ioerror dcnl dcsp dcsp dcsp pass dcnl dcsp except importerror attributeerror dcnl dcsp dcsp pass
def guess filename obj dcsp name getattr obj name none dcnl dcsp if name and name0 < and name 1 dcnl dcsp dcsp return name
def from key val list value dcsp if value is none dcnl dcsp dcsp return none dcnl dcsp if isinstance value str bytes bool int dcnl dcsp dcsp raise valueerror cannot dcsp encode dcsp objects dcsp that dcsp are dcsp not dcsp 2tuples dcnl dcsp return ordereddict value
def to key val list value dcsp if value is none dcnl dcsp dcsp return none dcnl dcsp if isinstance value str bytes bool int dcnl dcsp dcsp raise valueerror cannot dcsp encode dcsp objects dcsp that dcsp are dcsp not dcsp 2tuples dcnl dcsp if isinstance value dict dcnl dcsp dcsp value value items dcnl dcsp return list value
def parse list header value dcsp result dcnl dcsp for item in parse list header value dcnl dcsp dcsp if item 1 item 1 dcnl dcsp dcsp dcsp item unquote header value item1 1 dcnl dcsp dcsp result append item dcnl dcsp return result
def parse dict header value dcsp result dcnl dcsp for item in parse list header value dcnl dcsp dcsp if not in item dcnl dcsp dcsp dcsp resultitem none dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp name value item split 1 dcnl dcsp dcsp if value 1 value 1 dcnl dcsp dcsp dcsp value unquote header value value1 1 dcnl dcsp dcsp resultname value dcnl dcsp return result
def unquote header value value is filename false dcsp if value and value0 value 1 dcnl dcsp dcsp value value1 1 dcnl dcsp dcsp if not is filename or value 2 dcnl dcsp dcsp dcsp return value replace replace dcnl dcsp return value
def dict from cookiejar cj dcsp cookie dict dcnl dcsp for cookie in cj dcnl dcsp dcsp cookie dictcookie name cookie value dcnl dcsp return cookie dict
def add dict to cookiejar cj cookie dict dcsp cj2 cookiejar from dict cookie dict dcnl dcsp for cookie in cj2 dcnl dcsp dcsp cj set cookie cookie dcnl dcsp return cj
def get encodings from content content dcsp charset re re compile <meta charset + flags re i dcnl dcsp return charset re findall content
def get encoding from headers headers dcsp content type headers get contenttype dcnl dcsp if not content type dcnl dcsp dcsp return none dcnl dcsp content type params cgi parse header content type dcnl dcsp if charset in params dcnl dcsp dcsp return params charset strip dcnl dcsp if text in content type dcnl dcsp dcsp return iso88591
def stream decode response unicode iterator r dcsp if r encoding is none dcnl dcsp dcsp for item in iterator dcnl dcsp dcsp dcsp yield item dcnl dcsp dcsp return dcnl dcsp decoder codecs getincrementaldecoder r encoding errors replace dcnl dcsp for chunk in iterator dcnl dcsp dcsp rv decoder decode chunk dcnl dcsp dcsp if rv dcnl dcsp dcsp dcsp yield rv dcnl dcsp rv decoder decode final true dcnl dcsp if rv dcnl dcsp dcsp yield rv
def iter slices string slice length dcsp pos 0 dcnl dcsp while pos < len string dcnl dcsp dcsp yield stringpos pos + slice length dcnl dcsp dcsp pos + slice length
def get unicode from response r dcsp tried encodings dcnl dcsp encoding get encoding from headers r headers dcnl dcsp if encoding dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return str r content encoding dcnl dcsp dcsp except unicodeerror dcnl dcsp dcsp dcsp tried encodings append encoding dcnl dcsp try dcnl dcsp dcsp return str r content encoding errors replace dcnl dcsp except typeerror dcnl dcsp dcsp return r content
def stream decompress iterator mode gzip dcsp if mode not in gzip deflate dcnl dcsp dcsp raise valueerror stream decompress dcsp mode dcsp must dcsp be dcsp gzip dcsp or dcsp deflate dcnl dcsp zlib mode 16 + zlib max wbits if mode gzip else zlib max wbits dcnl dcsp dec zlib decompressobj zlib mode dcnl dcsp try dcnl dcsp dcsp for chunk in iterator dcnl dcsp dcsp dcsp rv dec decompress chunk dcnl dcsp dcsp dcsp if rv dcnl dcsp dcsp dcsp dcsp yield rv dcnl dcsp except zlib error dcnl dcsp dcsp yield chunk dcnl dcsp dcsp for chunk in iterator dcnl dcsp dcsp dcsp yield chunk dcnl dcsp else dcnl dcsp dcsp buf dec decompress bytes dcnl dcsp dcsp rv buf + dec flush dcnl dcsp dcsp if rv dcnl dcsp dcsp dcsp yield rv
def unquote unreserved uri dcsp parts uri split dcnl dcsp for i in range 1 len parts dcnl dcsp dcsp h partsi0 2 dcnl dcsp dcsp if len h 2 and h isalnum dcnl dcsp dcsp dcsp c chr int h 16 dcnl dcsp dcsp dcsp if c in unreserved set dcnl dcsp dcsp dcsp dcsp partsi c + partsi2 dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp partsi + partsi dcnl dcsp dcsp else dcnl dcsp dcsp dcsp partsi + partsi dcnl dcsp return join parts
def requote uri uri dcsp return quote unquote unreserved uri safe + ~
def get environ proxies url dcsp proxy keys all http https ftp socks dcnl dcsp get proxy lambda k os environ get k or os environ get k upper dcnl dcsp no proxy get proxy no proxy dcnl dcsp if no proxy dcnl dcsp dcsp no proxy no proxy split dcnl dcsp dcsp netloc urlparse url netloc dcnl dcsp dcsp for host in no proxy dcnl dcsp dcsp dcsp if netloc endswith host or netloc split 0 endswith host dcnl dcsp dcsp dcsp dcsp return dcnl dcsp proxies key get proxy key + proxy for key in proxy keys dcnl dcsp return dict key val for key val in proxies if val
def default user agent dcsp implementation platform python implementation dcnl dcsp if implementation cpython dcnl dcsp dcsp implementation version platform python version dcnl dcsp elif implementation pypy dcnl dcsp dcsp implementation version s s s sys pypy version info major sys pypy version info minor sys pypy version info micro dcnl dcsp dcsp if sys pypy version info releaselevel final dcnl dcsp dcsp dcsp implementation version join implementation version sys pypy version info releaselevel dcnl dcsp elif implementation jython dcnl dcsp dcsp implementation version platform python version dcnl dcsp elif implementation ironpython dcnl dcsp dcsp implementation version platform python version dcnl dcsp else dcnl dcsp dcsp implementation version unknown dcnl dcsp try dcnl dcsp dcsp p system platform system dcnl dcsp dcsp p release platform release dcnl dcsp except ioerror dcnl dcsp dcsp p system unknown dcnl dcsp dcsp p release unknown dcnl dcsp return dcsp join pythonrequests s version s s implementation implementation version s s p system p release
def parse header links value dcsp links dcnl dcsp replace chars dcsp dcnl dcsp for val in value split dcnl dcsp dcsp try dcnl dcsp dcsp dcsp url params val split 1 dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp url params val dcnl dcsp dcsp link dcnl dcsp dcsp link url url strip < dcsp dcnl dcsp dcsp for param in params split dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp key value param split dcnl dcsp dcsp dcsp except valueerror dcnl dcsp dcsp dcsp dcsp break dcnl dcsp dcsp dcsp linkkey strip replace chars value strip replace chars dcnl dcsp dcsp links append link dcnl dcsp return links
def prepend scheme if needed url new scheme dcsp scheme netloc path params query fragment urlparse url new scheme dcnl dcsp if not netloc dcnl dcsp dcsp netloc path path netloc dcnl dcsp return urlunparse scheme netloc path params query fragment
def extract cookies to jar jar request response dcsp req mockrequest request dcnl dcsp res mockresponse response original response msg dcnl dcsp jar extract cookies res req
def get cookie header jar request dcsp r mockrequest request dcnl dcsp jar add cookie header r dcnl dcsp return r get new headers get cookie
def remove cookie by name cookiejar name domain none path none dcsp clearables dcnl dcsp for cookie in cookiejar dcnl dcsp dcsp if cookie name name dcnl dcsp dcsp dcsp if domain is none or domain cookie domain dcnl dcsp dcsp dcsp dcsp if path is none or path cookie path dcnl dcsp dcsp dcsp dcsp dcsp clearables append cookie domain cookie path cookie name dcnl dcsp for domain path name in clearables dcnl dcsp dcsp cookiejar clear domain path name
def create cookie name value kwargs dcsp result dict version 0 name name value value port none domain path secure false expires none discard true comment none comment url none rest httponly none rfc2109 false dcnl dcsp badargs set kwargs set result dcnl dcsp if badargs dcnl dcsp dcsp err create cookie dcsp got dcsp unexpected dcsp keyword dcsp arguments dcsp s dcnl dcsp dcsp raise typeerror err list badargs dcnl dcsp result update kwargs dcnl dcsp result port specified bool result port dcnl dcsp result domain specified bool result domain dcnl dcsp result domain initial dot result domain startswith dcnl dcsp result path specified bool result path dcnl dcsp return cookielib cookie result
def morsel to cookie morsel dcsp c create cookie name morsel key value morsel value version morsel version or 0 port none port specified false domain morsel domain domain specified bool morsel domain domain initial dot morsel domain startswith path morsel path path specified bool morsel path secure bool morsel secure expires morsel maxage or morsel expires discard false comment morsel comment comment url bool morsel comment rest httponly morsel httponly rfc2109 false dcnl dcsp return c
def cookiejar from dict cookie dict cookiejar none dcsp if cookiejar is none dcnl dcsp dcsp cookiejar requestscookiejar dcnl dcsp if cookie dict is not none dcnl dcsp dcsp for name in cookie dict dcnl dcsp dcsp dcsp cookiejar set cookie create cookie name cookie dictname dcnl dcsp return cookiejar
def add doc func doc dcsp func doc doc
def import module name dcsp import name dcnl dcsp return sys modulesname
def add move move dcsp setattr moveditems move name move
def remove move name dcsp try dcnl dcsp dcsp delattr moveditems name dcnl dcsp except attributeerror dcnl dcsp dcsp try dcnl dcsp dcsp dcsp del moves dict name dcnl dcsp dcsp except keyerror dcnl dcsp dcsp dcsp raise attributeerror no dcsp such dcsp move dcsp r name
def iterkeys d dcsp return iter getattr d iterkeys
def itervalues d dcsp return iter getattr d itervalues
def iteritems d dcsp return iter getattr d iteritems
def with metaclass meta base object dcsp return meta newbase base
def match hostname cert hostname dcsp if not cert dcnl dcsp dcsp raise valueerror empty dcsp or dcsp no dcsp certificate dcnl dcsp dnsnames dcnl dcsp san cert get subjectaltname dcnl dcsp for key value in san dcnl dcsp dcsp if key dns dcnl dcsp dcsp dcsp if dnsname to pat value match hostname dcnl dcsp dcsp dcsp dcsp return dcnl dcsp dcsp dcsp dnsnames append value dcnl dcsp if not dnsnames dcnl dcsp dcsp for sub in cert get subject dcnl dcsp dcsp dcsp for key value in sub dcnl dcsp dcsp dcsp dcsp if key commonname dcnl dcsp dcsp dcsp dcsp dcsp if dnsname to pat value match hostname dcnl dcsp dcsp dcsp dcsp dcsp dcsp return dcnl dcsp dcsp dcsp dcsp dcsp dnsnames append value dcnl dcsp if len dnsnames 1 dcnl dcsp dcsp raise certificateerror hostname dcsp r dcsp doesn t dcsp match dcsp either dcsp of dcsp s hostname dcsp join map repr dnsnames dcnl dcsp elif len dnsnames 1 dcnl dcsp dcsp raise certificateerror hostname dcsp r dcsp doesn t dcsp match dcsp r hostname dnsnames0 dcnl dcsp else dcnl dcsp dcsp raise certificateerror no dcsp appropriate dcsp commonname dcsp or dcsp subjectaltname dcsp fields dcsp were dcsp found
def add stderr logger level logging debug dcsp logger logging getlogger name dcnl dcsp handler logging streamhandler dcnl dcsp handler setformatter logging formatter asctime s dcsp levelname s dcsp message s dcnl dcsp logger addhandler handler dcnl dcsp logger setlevel level dcnl dcsp logger debug added dcsp an dcsp stderr dcsp logging dcsp handler dcsp to dcsp logger dcsp s name dcnl dcsp return handler
def split first s delims dcsp min idx none dcnl dcsp min delim none dcnl dcsp for d in delims dcnl dcsp dcsp idx s find d dcnl dcsp dcsp if idx < 0 dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if min idx is none or idx < min idx dcnl dcsp dcsp dcsp min idx idx dcnl dcsp dcsp dcsp min delim d dcnl dcsp if min idx is none or min idx < 0 dcnl dcsp dcsp return s none dcnl dcsp return s min idx s min idx + 1 min delim
def parse url url dcsp scheme none dcnl dcsp auth none dcnl dcsp host none dcnl dcsp port none dcnl dcsp path none dcnl dcsp fragment none dcnl dcsp query none dcnl dcsp if in url dcnl dcsp dcsp scheme url url split 1 dcnl dcsp url path delim split first url dcnl dcsp if delim dcnl dcsp dcsp path delim + path dcnl dcsp if in url dcnl dcsp dcsp auth url url split 1 dcnl dcsp if url and url0 dcnl dcsp dcsp host url url1 split 1 dcnl dcsp if in url dcnl dcsp dcsp host port url split 1 dcnl dcsp dcsp if not host dcnl dcsp dcsp dcsp host host dcnl dcsp dcsp if not port isdigit dcnl dcsp dcsp dcsp raise locationparseerror failed dcsp to dcsp parse dcsp s url dcnl dcsp dcsp port int port dcnl dcsp elif not host and url dcnl dcsp dcsp host url dcnl dcsp if not path dcnl dcsp dcsp return url scheme auth host port path query fragment dcnl dcsp if in path dcnl dcsp dcsp path fragment path split 1 dcnl dcsp if in path dcnl dcsp dcsp path query path split 1 dcnl dcsp return url scheme auth host port path query fragment
def get host url dcsp p parse url url dcnl dcsp return p scheme or http p hostname p port
def make headers keep alive none accept encoding none user agent none basic auth none dcsp headers dcnl dcsp if accept encoding dcnl dcsp dcsp if isinstance accept encoding str dcnl dcsp dcsp dcsp pass dcnl dcsp dcsp elif isinstance accept encoding list dcnl dcsp dcsp dcsp accept encoding join accept encoding dcnl dcsp dcsp else dcnl dcsp dcsp dcsp accept encoding gzip deflate dcnl dcsp dcsp headers acceptencoding accept encoding dcnl dcsp if user agent dcnl dcsp dcsp headers useragent user agent dcnl dcsp if keep alive dcnl dcsp dcsp headers connection keepalive dcnl dcsp if basic auth dcnl dcsp dcsp headers authorization basic dcsp + b64encode six b basic auth decode utf8 dcnl dcsp return headers
def is connection dropped conn dcsp sock getattr conn sock false dcnl dcsp if not sock dcnl dcsp dcsp return false dcnl dcsp if not poll dcnl dcsp dcsp if not select dcnl dcsp dcsp dcsp return false dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return select sock 0 0 0 dcnl dcsp dcsp except socketerror dcnl dcsp dcsp dcsp return true dcnl dcsp p poll dcnl dcsp p register sock pollin dcnl dcsp for fno ev in p poll 0 0 dcnl dcsp dcsp if fno sock fileno dcnl dcsp dcsp dcsp return true
def choose boundary dcsp return uuid4 hex
def iter fields fields dcsp if isinstance fields dict dcnl dcsp dcsp return k v for k v in six iteritems fields dcnl dcsp return k v for k v in fields
def encode multipart formdata fields boundary none dcsp body bytesio dcnl dcsp if boundary is none dcnl dcsp dcsp boundary choose boundary dcnl dcsp for fieldname value in iter fields fields dcnl dcsp dcsp body write b s r n boundary dcnl dcsp dcsp if isinstance value tuple dcnl dcsp dcsp dcsp if len value 3 dcnl dcsp dcsp dcsp dcsp filename data content type value dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp filename data value dcnl dcsp dcsp dcsp dcsp content type get content type filename dcnl dcsp dcsp dcsp writer body write contentdisposition dcsp formdata dcsp name s dcsp filename s r n fieldname filename dcnl dcsp dcsp dcsp body write b contenttype dcsp s r n r n content type dcnl dcsp dcsp else dcnl dcsp dcsp dcsp data value dcnl dcsp dcsp dcsp writer body write contentdisposition dcsp formdata dcsp name s r n fieldname dcnl dcsp dcsp dcsp body write r n dcnl dcsp dcsp if isinstance data int dcnl dcsp dcsp dcsp data str data dcnl dcsp dcsp if isinstance data six text type dcnl dcsp dcsp dcsp writer body write data dcnl dcsp dcsp else dcnl dcsp dcsp dcsp body write data dcnl dcsp dcsp body write r n dcnl dcsp body write b s r n boundary dcnl dcsp content type b multipart formdata dcsp boundary s boundary dcnl dcsp return body getvalue content type
def connection from url url kw dcsp scheme host port get host url dcnl dcsp if scheme https dcnl dcsp dcsp return httpsconnectionpool host port port kw dcnl dcsp else dcnl dcsp dcsp return httpconnectionpool host port port kw
def basic auth str username password dcsp return basic dcsp + b64encode s s username password encode latin1 strip decode latin1
def dispatch hook key hooks hook data dcsp hooks hooks or dict dcnl dcsp if key in hooks dcnl dcsp dcsp hooks hooks get key dcnl dcsp dcsp if hasattr hooks call dcnl dcsp dcsp dcsp hooks hooks dcnl dcsp dcsp for hook in hooks dcnl dcsp dcsp dcsp hook data hook hook data dcnl dcsp dcsp dcsp if hook data is not none dcnl dcsp dcsp dcsp dcsp hook data hook data dcnl dcsp return hook data
def merge kwargs local kwarg default kwarg dcsp if default kwarg is none dcnl dcsp dcsp return local kwarg dcnl dcsp if isinstance local kwarg str dcnl dcsp dcsp return local kwarg dcnl dcsp if local kwarg is none dcnl dcsp dcsp return default kwarg dcnl dcsp if not hasattr default kwarg items dcnl dcsp dcsp return local kwarg dcnl dcsp default kwarg from key val list default kwarg dcnl dcsp local kwarg from key val list local kwarg dcnl dcsp def get original key original keys new key dcnl dcsp dcsp n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp finds dcsp the dcsp key dcsp from dcsp original keys dcsp that dcsp caseinsensitive dcsp matches dcsp new key n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcnl dcsp dcsp for original key in original keys dcnl dcsp dcsp dcsp if key lower original key lower dcnl dcsp dcsp dcsp dcsp return original key dcnl dcsp dcsp return new key dcnl dcsp kwargs default kwarg copy dcnl dcsp original keys kwargs keys dcnl dcsp for key value in local kwarg items dcnl dcsp dcsp kwargsget original key original keys key value dcnl dcsp for k v in local kwarg items dcnl dcsp dcsp if v is none dcnl dcsp dcsp dcsp del kwargsk dcnl dcsp return kwargs
def session dcsp return session
def request method url kwargs dcsp session sessions session dcnl dcsp return session request method method url url kwargs
def get url kwargs dcsp kwargs setdefault allow redirects true dcnl dcsp return request get url kwargs
def options url kwargs dcsp kwargs setdefault allow redirects true dcnl dcsp return request options url kwargs
def head url kwargs dcsp return request head url kwargs
def post url data none kwargs dcsp return request post url data data kwargs
def put url data none kwargs dcsp return request put url data data kwargs
def patch url data none kwargs dcsp return request patch url data data kwargs
def delete url kwargs dcsp return request delete url kwargs
def where dcsp if certifi dcnl dcsp dcsp return certifi where dcnl dcsp return os path join os path dirname file cacert pem
def to xml items dcsp msg u < xml dcsp version 1 0 u <items dcnl dcsp for item in items dcnl dcsp dcsp msg append item to xml dcnl dcsp msg append u < items dcnl dcsp return u join msg
def get from user title prompt hidden false value none dcsp if value is none dcnl dcsp dcsp value dcnl dcsp script n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp on dcsp run dcsp argv n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp tell dcsp application dcsp alfred dcsp 2 n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp activate n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp set dcsp alfredpath dcsp to dcsp path dcsp to dcsp application dcsp alfred dcsp 2 n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp set dcsp alfredicon dcsp to dcsp path dcsp to dcsp resource dcsp appicon icns dcsp in dcsp bundle dcsp xc2 xac n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp alfredpath dcsp as dcsp alias n n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp set dcsp dlgtitle dcsp to dcsp item dcsp 1 dcsp of dcsp argv n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp set dcsp dlgprompt dcsp to dcsp item dcsp 2 dcsp of dcsp argv n n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp if dcsp count dcsp of dcsp argv dcsp is dcsp 3 n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp set dcsp dlghidden dcsp to dcsp item dcsp 3 dcsp of dcsp argv dcsp as dcsp boolean n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp else n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp set dcsp dlghidden dcsp to dcsp false n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp end dcsp if n n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp if dcsp dlghidden n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp display dcsp dialog dcsp dlgprompt dcsp dcsp dcsp with dcsp title dcsp dlgtitle dcsp xc2 xac n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp default dcsp answer dcsp v dcsp with dcsp icon dcsp alfredicon dcsp with dcsp hidden dcsp answer n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp else n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp display dcsp dialog dcsp dlgprompt dcsp dcsp dcsp with dcsp title dcsp dlgtitle dcsp xc2 xac n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp default dcsp answer dcsp v dcsp with dcsp icon dcsp alfredicon n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp end dcsp if n n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp set dcsp answer dcsp to dcsp text dcsp returned dcsp of dcsp result n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp end dcsp tell n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp end dcsp run format v value dcnl dcsp from subprocess import popen pipe dcnl dcsp cmd osascript title prompt dcnl dcsp if hidden dcnl dcsp dcsp cmd append true dcnl dcsp p popen cmd stdin pipe stdout pipe stderr pipe dcnl dcsp stdout stderr p communicate script dcnl dcsp return stdout rstrip n
def show message title message dcsp script n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp on dcsp run dcsp argv n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp tell dcsp application dcsp alfred dcsp 2 n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp activate n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp set dcsp alfredpath dcsp to dcsp path dcsp to dcsp application dcsp alfred dcsp 2 n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp set dcsp alfredicon dcsp to dcsp path dcsp to dcsp resource dcsp appicon icns dcsp in dcsp bundle dcsp xc2 xac n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp alfredpath dcsp as dcsp alias n n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp set dcsp dlgtitle dcsp to dcsp item dcsp 1 dcsp of dcsp argv n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp set dcsp dlgmessage dcsp to dcsp item dcsp 2 dcsp of dcsp argv n n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp display dcsp dialog dcsp dlgmessage dcsp with dcsp title dcsp dlgtitle dcsp buttons dcsp xc2 xac n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp ok dcsp default dcsp button dcsp ok dcsp with dcsp icon dcsp alfredicon n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp end dcsp tell n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp end dcsp run dcnl dcsp from subprocess import popen pipe dcnl dcsp cmd osascript title message dcnl dcsp p popen cmd stdin pipe stdout pipe stderr pipe dcnl dcsp p communicate script
def lookup location dcsp params address location sensor false dcnl dcsp r requests get api params params json dcnl dcsp if r get status ok dcnl dcsp dcsp results r results 0 dcnl dcsp dcsp data name results formatted address latitude results geometry location lat longitude results geometry location lng dcnl dcsp dcsp return data dcnl dcsp raise exception request dcsp failed
def forecast location params none dcsp url format api location dcnl dcsp headers acceptencoding gzip dcnl dcsp r requests get url params params headers headers dcnl dcsp if r status code 200 dcnl dcsp dcsp raise weatherexception your dcsp key dcsp is dcsp invalid dcsp or dcsp forecast io dcsp is dcsp down dcnl dcsp r r json dcnl dcsp if error in r dcnl dcsp dcsp raise weatherexception error dcsp getting dcsp weather dcsp format r error r error dcnl dcsp return r
def out msg dcsp stdout write msg encode utf8
def load settings validate true dcsp settings units default units icons default icons days 3 version 2 dcnl dcsp if os path exists settings file dcnl dcsp dcsp with open settings file rt as sf dcnl dcsp dcsp dcsp s json load sf dcnl dcsp dcsp dcsp if version not in s dcnl dcsp dcsp dcsp dcsp migrate settings s dcnl dcsp dcsp dcsp settings update s dcnl dcsp if validate dcnl dcsp dcsp if service not in settings dcnl dcsp dcsp dcsp raise setuperror you dcsp need dcsp to dcsp set dcsp your dcsp weather dcsp service use dcsp the dcsp wset dcsp service dcsp command dcnl dcsp dcsp if location not in settings dcnl dcsp dcsp dcsp raise setuperror missing dcsp default dcsp location you dcsp must dcsp specify dcsp a dcsp default dcsp location dcsp with dcsp the dcsp wset dcsp location dcsp command dcnl dcsp return settings
def tell weather location dcsp settings load settings dcnl dcsp if len location strip 0 dcnl dcsp dcsp get temp location location settings dcnl dcsp if settings service wund dcnl dcsp dcsp weather get wund weather settings location dcnl dcsp else dcnl dcsp dcsp weather get fio weather settings location dcnl dcsp items dcnl dcsp tcount timecount dcnl dcsp tu f if settings units us else c dcnl dcsp title u currently dcsp in dcsp dcsp format settings location short name weather current weather capitalize dcnl dcsp subtitle u xb0 dcsp dcsp dcsp humidity format int round weather current temp tu int round weather current humidity dcnl dcsp icon get icon settings weather current icon dcnl dcsp items append alfred item tcount next title subtitle icon icon dcnl dcsp location format settings location latitude settings location longitude dcnl dcsp days weather forecast dcnl dcsp if len days 5 dcnl dcsp dcsp days days 5 dcnl dcsp for day in days dcnl dcsp dcsp title dcsp format day day day conditions capitalize dcnl dcsp dcsp subtitle u high dcsp xb0 dcsp dcsp low dcsp xb0 format day temp hi tu day temp lo tu dcnl dcsp dcsp if precip in day dcnl dcsp dcsp dcsp subtitle + u dcsp dcsp precip dcsp format day precip dcnl dcsp dcsp arg servicessettings service lib get forecast url location day date dcnl dcsp dcsp arg arg replace amp dcnl dcsp dcsp icon get icon settings day icon dcnl dcsp dcsp items append alfred item tcount next title subtitle icon icon arg arg valid true dcnl dcsp line unichr 9472 20 dcnl dcsp items append alfred item tcount next line fetched dcsp from dcsp dcsp at dcsp format servicessettings service name weather info time icon dcnl dcsp return items
def tell name query dcsp try dcnl dcsp dcsp cmd tell format name dcnl dcsp dcsp if cmd in globals dcnl dcsp dcsp dcsp items globals cmd query dcnl dcsp dcsp else dcnl dcsp dcsp dcsp items alfred item tell invalid dcsp action dcsp format name dcnl dcsp except setuperror as e dcnl dcsp dcsp items alfred item error e title e subtitle icon error png dcnl dcsp except exception as e dcnl dcsp dcsp items alfred item error str e icon error png dcnl dcsp out alfred to xml items
def do name query dcsp try dcnl dcsp dcsp cmd do format name dcnl dcsp dcsp if cmd in globals dcnl dcsp dcsp dcsp globals cmd query dcnl dcsp dcsp else dcnl dcsp dcsp dcsp out invalid dcsp command dcsp format name dcnl dcsp except exception as e dcnl dcsp dcsp out error dcsp format e
def forecast location dcsp url conditions forecast10day q json format api location dcnl dcsp r requests get url json dcnl dcsp if error in r response dcnl dcsp dcsp raise weatherexception your dcsp key dcsp is dcsp invalid dcsp or dcsp wunderground dcsp is dcsp down r response error dcnl dcsp return r
def autocomplete query dcsp url http autocomplete wunderground com aq query format query dcnl dcsp return requests get url json results
def configure cache name cache backend sqlite expire after none allowable codes 200 allowable methods get monkey patch true backend options dcsp try dcnl dcsp dcsp global cache dcnl dcsp dcsp cache backends registrybackend cache name backend options dcnl dcsp except keyerror dcnl dcsp dcsp raise valueerror unsupported dcsp backend dcsp s dcsp try dcsp one dcsp of dcsp s backend dcsp join backends registry keys dcnl dcsp if monkey patch dcnl dcsp dcsp redo patch dcnl dcsp config expire after expire after dcnl dcsp config allowable codes allowable codes dcnl dcsp config allowable methods allowable methods
def has url url dcsp return cache has url url
contextmanager dcnl def disabled dcsp previous request send dcnl dcsp undo patch dcnl dcsp try dcnl dcsp dcsp yield dcnl dcsp finally dcnl dcsp dcsp request send previous
contextmanager dcnl def enabled dcsp previous request send dcnl dcsp redo patch dcnl dcsp try dcnl dcsp dcsp yield dcnl dcsp finally dcnl dcsp dcsp request send previous
def clear dcsp cache clear
def undo patch dcsp request send original request send
def redo patch dcsp request send request send hook
def get cache dcsp return cache
def delete url url dcsp cache del cached url url
def get os ca bundle path dcsp for path in possible ca bundle paths dcnl dcsp dcsp if os path exists path dcnl dcsp dcsp dcsp return path dcnl dcsp return none
def dict to sequence d dcsp if hasattr d items dcnl dcsp dcsp d d items dcnl dcsp return d
def get netrc auth url dcsp try dcnl dcsp dcsp locations os path expanduser ~ 0 format f for f in netrc files dcnl dcsp dcsp netrc path none dcnl dcsp dcsp for loc in locations dcnl dcsp dcsp dcsp if os path exists loc and not netrc path dcnl dcsp dcsp dcsp dcsp netrc path loc dcnl dcsp dcsp if netrc path is none dcnl dcsp dcsp dcsp return netrc path dcnl dcsp dcsp ri urlparse url dcnl dcsp dcsp host ri netloc split 0 dcnl dcsp dcsp try dcnl dcsp dcsp dcsp netrc netrc netrc path authenticators host dcnl dcsp dcsp dcsp if netrc dcnl dcsp dcsp dcsp dcsp login i 0 if netrc0 else 1 dcnl dcsp dcsp dcsp dcsp return netrclogin i netrc2 dcnl dcsp dcsp except netrcparseerror ioerror dcnl dcsp dcsp dcsp pass dcnl dcsp except importerror attributeerror dcnl dcsp dcsp pass
def guess filename obj dcsp name getattr obj name none dcnl dcsp if name and name0 < and name 1 dcnl dcsp dcsp return name
def from key val list value dcsp if value is none dcnl dcsp dcsp return none dcnl dcsp if isinstance value str bytes bool int dcnl dcsp dcsp raise valueerror cannot dcsp encode dcsp objects dcsp that dcsp are dcsp not dcsp 2tuples dcnl dcsp return ordereddict value
def to key val list value dcsp if value is none dcnl dcsp dcsp return none dcnl dcsp if isinstance value str bytes bool int dcnl dcsp dcsp raise valueerror cannot dcsp encode dcsp objects dcsp that dcsp are dcsp not dcsp 2tuples dcnl dcsp if isinstance value dict dcnl dcsp dcsp value value items dcnl dcsp return list value
def parse list header value dcsp result dcnl dcsp for item in parse list header value dcnl dcsp dcsp if item 1 item 1 dcnl dcsp dcsp dcsp item unquote header value item1 1 dcnl dcsp dcsp result append item dcnl dcsp return result
def parse dict header value dcsp result dcnl dcsp for item in parse list header value dcnl dcsp dcsp if not in item dcnl dcsp dcsp dcsp resultitem none dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp name value item split 1 dcnl dcsp dcsp if value 1 value 1 dcnl dcsp dcsp dcsp value unquote header value value1 1 dcnl dcsp dcsp resultname value dcnl dcsp return result
def unquote header value value is filename false dcsp if value and value0 value 1 dcnl dcsp dcsp value value1 1 dcnl dcsp dcsp if not is filename or value 2 dcnl dcsp dcsp dcsp return value replace replace dcnl dcsp return value
def header expand headers dcsp collector dcnl dcsp if isinstance headers dict dcnl dcsp dcsp headers list headers items dcnl dcsp elif isinstance headers basestring dcnl dcsp dcsp return headers dcnl dcsp elif isinstance headers str dcnl dcsp dcsp return headers encode latin1 dcnl dcsp elif headers is none dcnl dcsp dcsp return headers dcnl dcsp for i value params in enumerate headers dcnl dcsp dcsp params dcnl dcsp dcsp for p k p v in list params items dcnl dcsp dcsp dcsp params append s s p k p v dcnl dcsp dcsp collector append value dcnl dcsp dcsp collector append dcsp dcnl dcsp dcsp if len params dcnl dcsp dcsp dcsp collector append dcsp join params dcnl dcsp dcsp dcsp if not len headers i + 1 dcnl dcsp dcsp dcsp dcsp collector append dcsp dcnl dcsp if collector 1 in dcsp dcsp dcnl dcsp dcsp del collector 1 dcnl dcsp return join collector
def dict from cookiejar cj dcsp cookie dict dcnl dcsp for cookie in cj dcnl dcsp dcsp cookie dictcookie name cookie value dcnl dcsp return cookie dict
def add dict to cookiejar cj cookie dict dcsp cj2 cookiejar from dict cookie dict dcnl dcsp for cookie in cj2 dcnl dcsp dcsp cj set cookie cookie dcnl dcsp return cj
def get encodings from content content dcsp charset re re compile <meta charset + flags re i dcnl dcsp return charset re findall content
def get encoding from headers headers dcsp content type headers get contenttype dcnl dcsp if not content type dcnl dcsp dcsp return none dcnl dcsp content type params cgi parse header content type dcnl dcsp if charset in params dcnl dcsp dcsp return params charset strip dcnl dcsp if text in content type dcnl dcsp dcsp return iso88591
def stream decode response unicode iterator r dcsp if r encoding is none dcnl dcsp dcsp for item in iterator dcnl dcsp dcsp dcsp yield item dcnl dcsp dcsp return dcnl dcsp decoder codecs getincrementaldecoder r encoding errors replace dcnl dcsp for chunk in iterator dcnl dcsp dcsp rv decoder decode chunk dcnl dcsp dcsp if rv dcnl dcsp dcsp dcsp yield rv dcnl dcsp rv decoder decode final true dcnl dcsp if rv dcnl dcsp dcsp yield rv
def iter slices string slice length dcsp pos 0 dcnl dcsp while pos < len string dcnl dcsp dcsp yield stringpos pos + slice length dcnl dcsp dcsp pos + slice length
def get unicode from response r dcsp tried encodings dcnl dcsp encoding get encoding from headers r headers dcnl dcsp if encoding dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return str r content encoding dcnl dcsp dcsp except unicodeerror dcnl dcsp dcsp dcsp tried encodings append encoding dcnl dcsp try dcnl dcsp dcsp return str r content encoding errors replace dcnl dcsp except typeerror dcnl dcsp dcsp return r content
def stream decompress iterator mode gzip dcsp if mode not in gzip deflate dcnl dcsp dcsp raise valueerror stream decompress dcsp mode dcsp must dcsp be dcsp gzip dcsp or dcsp deflate dcnl dcsp zlib mode 16 + zlib max wbits if mode gzip else zlib max wbits dcnl dcsp dec zlib decompressobj zlib mode dcnl dcsp try dcnl dcsp dcsp for chunk in iterator dcnl dcsp dcsp dcsp rv dec decompress chunk dcnl dcsp dcsp dcsp if rv dcnl dcsp dcsp dcsp dcsp yield rv dcnl dcsp except zlib error dcnl dcsp dcsp yield chunk dcnl dcsp dcsp for chunk in iterator dcnl dcsp dcsp dcsp yield chunk dcnl dcsp else dcnl dcsp dcsp buf dec decompress bytes dcnl dcsp dcsp rv buf + dec flush dcnl dcsp dcsp if rv dcnl dcsp dcsp dcsp yield rv
def unquote unreserved uri dcsp try dcnl dcsp dcsp parts uri split dcnl dcsp dcsp for i in range 1 len parts dcnl dcsp dcsp dcsp h partsi0 2 dcnl dcsp dcsp dcsp if len h 2 and h isalnum dcnl dcsp dcsp dcsp dcsp c chr int h 16 dcnl dcsp dcsp dcsp dcsp if c in unreserved set dcnl dcsp dcsp dcsp dcsp dcsp partsi c + partsi2 dcnl dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp partsi + partsi dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp partsi + partsi dcnl dcsp dcsp return join parts dcnl dcsp except valueerror dcnl dcsp dcsp return uri
def requote uri uri dcsp return quote unquote unreserved uri safe + ~
def get environ proxies dcsp proxy keys all http https ftp socks no dcnl dcsp get proxy lambda k os environ get k or os environ get k upper dcnl dcsp proxies key get proxy key + proxy for key in proxy keys dcnl dcsp return dict key val for key val in proxies if val
def default user agent dcsp implementation platform python implementation dcnl dcsp if implementation cpython dcnl dcsp dcsp implementation version platform python version dcnl dcsp elif implementation pypy dcnl dcsp dcsp implementation version s s s sys pypy version info major sys pypy version info minor sys pypy version info micro dcnl dcsp dcsp if sys pypy version info releaselevel final dcnl dcsp dcsp dcsp implementation version join implementation version sys pypy version info releaselevel dcnl dcsp elif implementation jython dcnl dcsp dcsp implementation version platform python version dcnl dcsp elif implementation ironpython dcnl dcsp dcsp implementation version platform python version dcnl dcsp else dcnl dcsp dcsp implementation version unknown dcnl dcsp return dcsp join pythonrequests s version s s implementation implementation version s s platform system platform release
def parse header links value dcsp links dcnl dcsp replace chars dcsp dcnl dcsp for val in value split dcnl dcsp dcsp try dcnl dcsp dcsp dcsp url params val split 1 dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp url params val dcnl dcsp dcsp link dcnl dcsp dcsp link url url strip < dcsp dcnl dcsp dcsp for param in params split dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp key value param split dcnl dcsp dcsp dcsp except valueerror dcnl dcsp dcsp dcsp dcsp break dcnl dcsp dcsp dcsp linkkey strip replace chars value strip replace chars dcnl dcsp dcsp links append link dcnl dcsp return links
def extract cookies to jar jar request response dcsp req mockrequest request dcnl dcsp res mockresponse response original response msg dcnl dcsp jar extract cookies res req
def get cookie header jar request dcsp r mockrequest request dcnl dcsp jar add cookie header r dcnl dcsp return r get new headers get cookie
def remove cookie by name cookiejar name domain none path none dcsp clearables dcnl dcsp for cookie in cookiejar dcnl dcsp dcsp if cookie name name dcnl dcsp dcsp dcsp if domain is none or domain cookie domain dcnl dcsp dcsp dcsp dcsp if path is none or path cookie path dcnl dcsp dcsp dcsp dcsp dcsp clearables append cookie domain cookie path cookie name dcnl dcsp for domain path name in clearables dcnl dcsp dcsp cookiejar clear domain path name
def create cookie name value kwargs dcsp result dict version 0 name name value value port none domain path secure false expires none discard true comment none comment url none rest httponly none rfc2109 false dcnl dcsp badargs set kwargs set result dcnl dcsp if badargs dcnl dcsp dcsp err create cookie dcsp got dcsp unexpected dcsp keyword dcsp arguments dcsp s dcnl dcsp dcsp raise typeerror err list badargs dcnl dcsp result update kwargs dcnl dcsp result port specified bool result port dcnl dcsp result domain specified bool result domain dcnl dcsp result domain initial dot result domain startswith dcnl dcsp result path specified bool result path dcnl dcsp return cookielib cookie result
def morsel to cookie morsel dcsp c create cookie name morsel key value morsel value version morsel version or 0 port none port specified false domain morsel domain domain specified bool morsel domain domain initial dot morsel domain startswith path morsel path path specified bool morsel path secure bool morsel secure expires morsel maxage or morsel expires discard false comment morsel comment comment url bool morsel comment rest httponly morsel httponly rfc2109 false dcnl dcsp return c
def cookiejar from dict cookie dict cookiejar none dcsp if cookiejar is none dcnl dcsp dcsp cookiejar requestscookiejar dcnl dcsp if cookie dict is not none dcnl dcsp dcsp for name in cookie dict dcnl dcsp dcsp dcsp cookiejar set cookie create cookie name cookie dictname dcnl dcsp return cookiejar
def filter params target dcsp def wrapper params args kwargs dcnl dcsp dcsp params filter oauth params params dcnl dcsp dcsp return target params args kwargs dcnl dcsp wrapper doc target doc dcnl dcsp return wrapper
def filter oauth params params dcsp is oauth lambda kv kv0 startswith u oauth dcnl dcsp if isinstance params dict dcnl dcsp dcsp return filter is oauth params items dcnl dcsp else dcnl dcsp dcsp return filter is oauth params
def escape u dcsp if not isinstance u unicode dcnl dcsp dcsp raise valueerror only dcsp unicode dcsp objects dcsp are dcsp escapable dcnl dcsp return quote u safe ~
def urlencode query dcsp if isinstance query dict dcnl dcsp dcsp query query items dcnl dcsp return u join u join escape k escape v for k v in query
def parse keqv list l dcsp encoded list u encode utf8 for u in l dcnl dcsp encoded parsed urllib2 parse keqv list encoded list dcnl dcsp return dict k decode utf8 v decode utf8 for k v in encoded parsed items
def parse http list u dcsp encoded str u encode utf8 dcnl dcsp encoded list urllib2 parse http list encoded str dcnl dcsp return s decode utf8 for s in encoded list
def parse authorization header authorization header dcsp auth scheme u oauth dcsp dcnl dcsp if authorization header startswith auth scheme dcnl dcsp dcsp authorization header authorization header replace auth scheme u 1 dcnl dcsp items parse http list authorization header dcnl dcsp try dcnl dcsp dcsp return parse keqv list items items dcnl dcsp except valueerror dcnl dcsp dcsp raise valueerror malformed dcsp authorization dcsp header
utils filter params dcnl def prepare headers oauth params headers none realm none dcsp headers headers or dcnl dcsp authorization header parameters parts dcnl dcsp for oauth parameter name value in oauth params dcnl dcsp dcsp escaped name utils escape oauth parameter name dcnl dcsp dcsp escaped value utils escape value dcnl dcsp dcsp part u 0 1 format escaped name escaped value dcnl dcsp dcsp authorization header parameters parts append part dcnl dcsp authorization header parameters dcsp join authorization header parameters parts dcnl dcsp if realm dcnl dcsp dcsp authorization header parameters u realm s dcsp realm + authorization header parameters dcnl dcsp authorization header u oauth dcsp s authorization header parameters dcnl dcsp full headers dcnl dcsp full headers update headers dcnl dcsp full headersu authorization authorization header dcnl dcsp return full headers
def append params oauth params params dcsp merged list params dcnl dcsp merged extend oauth params dcnl dcsp merged sort key lambda i i0 startswith oauth dcnl dcsp return merged
def prepare form encoded body oauth params body dcsp return append params oauth params body
def prepare request uri query oauth params uri dcsp sch net path par query fra urlparse uri dcnl dcsp query urlencode append params oauth params extract params query or dcnl dcsp return urlunparse sch net path par query fra
def host from uri uri dcsp default ports u http u 80 u https u 443 dcnl dcsp sch netloc path par query fra urlparse urlparse uri dcnl dcsp if u in netloc dcnl dcsp dcsp netloc port netloc split u 1 dcnl dcsp else dcnl dcsp dcsp port default ports get sch upper dcnl dcsp return netloc port
def escape u dcsp if not isinstance u unicode dcnl dcsp dcsp raise valueerror only dcsp unicode dcsp objects dcsp are dcsp escapable dcnl dcsp return urllib quote u encode utf8 safe ~
def prepare grant uri uri client id response type redirect uri none scope none state none kwargs dcsp params u response type response type u client id client id dcnl dcsp if redirect uri dcnl dcsp dcsp params append u redirect uri redirect uri dcnl dcsp if scope dcnl dcsp dcsp params append u scope scope dcnl dcsp if state dcnl dcsp dcsp params append u state state dcnl dcsp for k in kwargs dcnl dcsp dcsp params append unicode k kwargsk dcnl dcsp return add params to uri uri params
def prepare token request grant type body u kwargs dcsp params u grant type grant type dcnl dcsp for k in kwargs dcnl dcsp dcsp params append unicode k kwargsk dcnl dcsp return add params to qs body params
def parse authorization code response uri state none dcsp query urlparse urlparse uri query dcnl dcsp params dict urlparse parse qsl query dcnl dcsp if not u code in params dcnl dcsp dcsp raise keyerror missing dcsp code dcsp parameter dcsp in dcsp response dcnl dcsp if state and params get u state none state dcnl dcsp dcsp raise valueerror mismatching dcsp or dcsp missing dcsp state dcsp in dcsp response dcnl dcsp return params
def parse implicit response uri state none scope none dcsp fragment urlparse urlparse uri fragment dcnl dcsp params dict urlparse parse qsl fragment keep blank values true dcnl dcsp validate token parameters params scope dcnl dcsp if state and params get u state none state dcnl dcsp dcsp raise valueerror mismatching dcsp or dcsp missing dcsp state dcsp in dcsp params dcnl dcsp return params
def parse token response body scope none dcsp params json loads body dcnl dcsp validate token parameters params scope dcnl dcsp return params
def validate token parameters params scope none dcsp if not u access token in params dcnl dcsp dcsp raise keyerror missing dcsp access dcsp token dcsp parameter dcnl dcsp if not u token type in params dcnl dcsp dcsp raise keyerror missing dcsp token dcsp type dcsp parameter dcnl dcsp new scope params get u scope none dcnl dcsp if scope and new scope and scope new scope dcnl dcsp dcsp raise warning scope dcsp has dcsp changed dcsp to dcsp s new scope
def prepare mac header token uri key http method nonce none headers none body none ext u hash algorithm u hmacsha1 dcsp http method http method upper dcnl dcsp host port utils host from uri uri dcnl dcsp if hash algorithm lower u hmacsha1 dcnl dcsp dcsp h hashlib sha1 dcnl dcsp else dcnl dcsp dcsp h hashlib sha256 dcnl dcsp nonce nonce or u 0 1 format utils generate nonce utils generate timestamp dcnl dcsp sch net path par query fra urlparse uri dcnl dcsp if query dcnl dcsp dcsp request uri path + u + query dcnl dcsp else dcnl dcsp dcsp request uri path dcnl dcsp if body is not none dcnl dcsp dcsp bodyhash b2a base64 h body digest 1 decode utf8 dcnl dcsp else dcnl dcsp dcsp bodyhash u dcnl dcsp base dcnl dcsp base append nonce dcnl dcsp base append http method upper dcnl dcsp base append request uri dcnl dcsp base append host dcnl dcsp base append port dcnl dcsp base append bodyhash dcnl dcsp base append ext dcnl dcsp base string n join base + u n dcnl dcsp if isinstance key unicode dcnl dcsp dcsp key key encode utf8 dcnl dcsp sign hmac new key base string h dcnl dcsp sign b2a base64 sign digest 1 decode utf8 dcnl dcsp header dcnl dcsp header append u mac dcsp id s token dcnl dcsp header append u nonce s nonce dcnl dcsp if bodyhash dcnl dcsp dcsp header append u bodyhash s bodyhash dcnl dcsp if ext dcnl dcsp dcsp header append u ext s ext dcnl dcsp header append u mac s sign dcnl dcsp headers headers or dcnl dcsp headersu authorization u dcsp join header dcnl dcsp return headers
def prepare bearer uri token uri dcsp return add params to uri uri u access token token
def prepare bearer headers token headers none dcsp headers headers or dcnl dcsp headersu authorization u bearer dcsp s token dcnl dcsp return headers
def prepare bearer body token body u dcsp return add params to qs body u access token token
def encode params utf8 params dcsp encoded dcnl dcsp for k v in params dcnl dcsp dcsp encoded append k encode utf8 if isinstance k unicode else k v encode utf8 if isinstance v unicode else v dcnl dcsp return encoded
def decode params utf8 params dcsp decoded dcnl dcsp for k v in params dcnl dcsp dcsp decoded append k decode utf8 if isinstance k str else k v decode utf8 if isinstance v str else v dcnl dcsp return decoded
def urldecode query dcsp if query and not set query < urlencoded dcnl dcsp dcsp raise valueerror invalid dcsp characters dcsp in dcsp query dcsp string dcnl dcsp invalid hex u ^09afaf| 09afaf^09afaf dcnl dcsp if len re findall invalid hex query dcnl dcsp dcsp raise valueerror invalid dcsp hex dcsp encoding dcsp in dcsp query dcsp string dcnl dcsp query query decode utf8 if isinstance query str else query dcnl dcsp params urlparse parse qsl query keep blank values true dcnl dcsp return decode params utf8 params
def extract params raw dcsp if isinstance raw basestring dcnl dcsp dcsp try dcnl dcsp dcsp dcsp params urldecode raw dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp params none dcnl dcsp elif hasattr raw iter dcnl dcsp dcsp try dcnl dcsp dcsp dcsp dict raw dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp params none dcnl dcsp dcsp except typeerror dcnl dcsp dcsp dcsp params none dcnl dcsp dcsp else dcnl dcsp dcsp dcsp params list raw items if isinstance raw dict else raw dcnl dcsp dcsp dcsp params decode params utf8 params dcnl dcsp else dcnl dcsp dcsp params none dcnl dcsp return params
def generate nonce dcsp return unicode unicode random getrandbits 64 + generate timestamp
def generate timestamp dcsp return unicode int time time
def generate token length 30 chars unicode ascii character set dcsp rand random systemrandom dcnl dcsp return u join rand choice chars for x in range length
def add params to qs query params dcsp queryparams urlparse parse qsl query keep blank values true dcnl dcsp queryparams extend params dcnl dcsp return urlencode queryparams
def add params to uri uri params dcsp sch net path par query fra urlparse urlparse uri dcnl dcsp query add params to qs query params dcnl dcsp return urlparse urlunparse sch net path par query fra
def safe string equals a b dcsp if len a len b dcnl dcsp dcsp return false dcnl dcsp result 0 dcnl dcsp for x y in zip a b dcnl dcsp dcsp result | ord x ^ ord y dcnl dcsp return result 0
def add doc func doc dcsp func doc doc
def import module name dcsp import name dcnl dcsp return sys modulesname
def add move move dcsp setattr moveditems move name move
def remove move name dcsp try dcnl dcsp dcsp delattr moveditems name dcnl dcsp except attributeerror dcnl dcsp dcsp try dcnl dcsp dcsp dcsp del moves dict name dcnl dcsp dcsp except keyerror dcnl dcsp dcsp dcsp raise attributeerror no dcsp such dcsp move dcsp r name
def iterkeys d dcsp return getattr d iterkeys
def itervalues d dcsp return getattr d itervalues
def iteritems d dcsp return getattr d iteritems
def with metaclass meta base object dcsp return meta newbase base
def match hostname cert hostname dcsp if not cert dcnl dcsp dcsp raise valueerror empty dcsp or dcsp no dcsp certificate dcnl dcsp dnsnames dcnl dcsp san cert get subjectaltname dcnl dcsp for key value in san dcnl dcsp dcsp if key dns dcnl dcsp dcsp dcsp if dnsname to pat value match hostname dcnl dcsp dcsp dcsp dcsp return dcnl dcsp dcsp dcsp dnsnames append value dcnl dcsp if not dnsnames dcnl dcsp dcsp for sub in cert get subject dcnl dcsp dcsp dcsp for key value in sub dcnl dcsp dcsp dcsp dcsp if key commonname dcnl dcsp dcsp dcsp dcsp dcsp if dnsname to pat value match hostname dcnl dcsp dcsp dcsp dcsp dcsp dcsp return dcnl dcsp dcsp dcsp dcsp dcsp dnsnames append value dcnl dcsp if len dnsnames 1 dcnl dcsp dcsp raise certificateerror hostname dcsp r dcsp doesn t dcsp match dcsp either dcsp of dcsp s hostname dcsp join map repr dnsnames dcnl dcsp elif len dnsnames 1 dcnl dcsp dcsp raise certificateerror hostname dcsp r dcsp doesn t dcsp match dcsp r hostname dnsnames0 dcnl dcsp else dcnl dcsp dcsp raise certificateerror no dcsp appropriate dcsp commonname dcsp or dcsp subjectaltname dcsp fields dcsp were dcsp found
def add stderr logger level logging debug dcsp logger logging getlogger name dcnl dcsp handler logging streamhandler dcnl dcsp handler setformatter logging formatter asctime s dcsp levelname s dcsp message s dcnl dcsp logger addhandler handler dcnl dcsp logger setlevel level dcnl dcsp logger debug added dcsp an dcsp stderr dcsp logging dcsp handler dcsp to dcsp logger dcsp s name dcnl dcsp return handler
def split first s delims dcsp min idx none dcnl dcsp min delim none dcnl dcsp for d in delims dcnl dcsp dcsp idx s find d dcnl dcsp dcsp if idx < 0 dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if min idx is none or idx < min idx dcnl dcsp dcsp dcsp min idx idx dcnl dcsp dcsp dcsp min delim d dcnl dcsp if min idx is none or min idx < 0 dcnl dcsp dcsp return s none dcnl dcsp return s min idx s min idx + 1 min delim
def parse url url dcsp scheme none dcnl dcsp auth none dcnl dcsp host none dcnl dcsp port none dcnl dcsp path none dcnl dcsp fragment none dcnl dcsp query none dcnl dcsp if in url dcnl dcsp dcsp scheme url url split 1 dcnl dcsp url path delim split first url dcnl dcsp if delim dcnl dcsp dcsp path delim + path dcnl dcsp if in url dcnl dcsp dcsp auth url url split 1 dcnl dcsp if url and url0 dcnl dcsp dcsp host url url1 split 1 dcnl dcsp if in url dcnl dcsp dcsp host port url split 1 dcnl dcsp dcsp if not host dcnl dcsp dcsp dcsp host host dcnl dcsp dcsp if not port isdigit dcnl dcsp dcsp dcsp raise locationparseerror failed dcsp to dcsp parse dcsp s url dcnl dcsp dcsp port int port dcnl dcsp elif not host and url dcnl dcsp dcsp host url dcnl dcsp if not path dcnl dcsp dcsp return url scheme auth host port path query fragment dcnl dcsp if in path dcnl dcsp dcsp path fragment path split 1 dcnl dcsp if in path dcnl dcsp dcsp path query path split 1 dcnl dcsp return url scheme auth host port path query fragment
def get host url dcsp p parse url url dcnl dcsp return p scheme or http p hostname p port
def make headers keep alive none accept encoding none user agent none basic auth none dcsp headers dcnl dcsp if accept encoding dcnl dcsp dcsp if isinstance accept encoding str dcnl dcsp dcsp dcsp pass dcnl dcsp dcsp elif isinstance accept encoding list dcnl dcsp dcsp dcsp accept encoding join accept encoding dcnl dcsp dcsp else dcnl dcsp dcsp dcsp accept encoding gzip deflate dcnl dcsp dcsp headers acceptencoding accept encoding dcnl dcsp if user agent dcnl dcsp dcsp headers useragent user agent dcnl dcsp if keep alive dcnl dcsp dcsp headers connection keepalive dcnl dcsp if basic auth dcnl dcsp dcsp headers authorization basic dcsp + b64encode six b basic auth decode utf8 dcnl dcsp return headers
def is connection dropped conn dcsp sock getattr conn sock false dcnl dcsp if not sock dcnl dcsp dcsp return false dcnl dcsp if not poll dcnl dcsp dcsp if not select dcnl dcsp dcsp dcsp return false dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return select sock 0 0 0 dcnl dcsp dcsp except socketerror dcnl dcsp dcsp dcsp return true dcnl dcsp p poll dcnl dcsp p register sock pollin dcnl dcsp for fno ev in p poll 0 0 dcnl dcsp dcsp if fno sock fileno dcnl dcsp dcsp dcsp return true
def choose boundary dcsp return uuid4 hex
def iter fields fields dcsp if isinstance fields dict dcnl dcsp dcsp return k v for k v in six iteritems fields dcnl dcsp return k v for k v in fields
def encode multipart formdata fields boundary none dcsp body bytesio dcnl dcsp if boundary is none dcnl dcsp dcsp boundary choose boundary dcnl dcsp for fieldname value in iter fields fields dcnl dcsp dcsp body write b s r n boundary dcnl dcsp dcsp if isinstance value tuple dcnl dcsp dcsp dcsp filename data value dcnl dcsp dcsp dcsp writer body write contentdisposition dcsp formdata dcsp name s dcsp filename s r n fieldname filename dcnl dcsp dcsp dcsp body write b contenttype dcsp s r n r n get content type filename dcnl dcsp dcsp else dcnl dcsp dcsp dcsp data value dcnl dcsp dcsp dcsp writer body write contentdisposition dcsp formdata dcsp name s r n fieldname dcnl dcsp dcsp dcsp body write contenttype dcsp text plain r n r n dcnl dcsp dcsp if isinstance data int dcnl dcsp dcsp dcsp data str data dcnl dcsp dcsp if isinstance data six text type dcnl dcsp dcsp dcsp writer body write data dcnl dcsp dcsp else dcnl dcsp dcsp dcsp body write data dcnl dcsp dcsp body write r n dcnl dcsp body write b s r n boundary dcnl dcsp content type b multipart formdata dcsp boundary s boundary dcnl dcsp return body getvalue content type
def connection from url url kw dcsp scheme host port get host url dcnl dcsp if scheme https dcnl dcsp dcsp return httpsconnectionpool host port port kw dcnl dcsp else dcnl dcsp dcsp return httpconnectionpool host port port kw
def basic auth str username password dcsp return basic dcsp + b64encode s s username password encode latin1 strip decode latin1
def negotiate value r dcsp authreq r headers get wwwauthenticate none dcnl dcsp if authreq dcnl dcsp dcsp rx re compile s negotiate s ^ re i dcnl dcsp dcsp mo rx search authreq dcnl dcsp dcsp if mo dcnl dcsp dcsp dcsp return mo group 1 dcnl dcsp return none
def dispatch hook key hooks hook data dcsp hooks hooks or dict dcnl dcsp if key in hooks dcnl dcsp dcsp hooks hooks get key dcnl dcsp dcsp if hasattr hooks call dcnl dcsp dcsp dcsp hooks hooks dcnl dcsp dcsp for hook in hooks dcnl dcsp dcsp dcsp hook data hook hook data dcnl dcsp dcsp dcsp if hook data is not none dcnl dcsp dcsp dcsp dcsp hook data hook data dcnl dcsp return hook data
def merge kwargs local kwarg default kwarg dcsp if default kwarg is none dcnl dcsp dcsp return local kwarg dcnl dcsp if isinstance local kwarg str dcnl dcsp dcsp return local kwarg dcnl dcsp if local kwarg is none dcnl dcsp dcsp return default kwarg dcnl dcsp if not hasattr default kwarg items dcnl dcsp dcsp return local kwarg dcnl dcsp default kwarg from key val list default kwarg dcnl dcsp local kwarg from key val list local kwarg dcnl dcsp kwargs default kwarg copy dcnl dcsp kwargs update local kwarg dcnl dcsp for k v in local kwarg items dcnl dcsp dcsp if v is none dcnl dcsp dcsp dcsp del kwargsk dcnl dcsp return kwargs
def session kwargs dcsp return session kwargs
def catch exceptions if in safe mode function dcsp def wrapped method url kwargs dcnl dcsp dcsp if kwargs get config and kwargs get config get safe mode or kwargs get session and kwargs get session config get safe mode dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp return function method url kwargs dcnl dcsp dcsp dcsp except requestexception connectionerror httperror socket timeout socket gaierror as e dcnl dcsp dcsp dcsp dcsp r response dcnl dcsp dcsp dcsp dcsp r error e dcnl dcsp dcsp dcsp dcsp r raw httpresponse dcnl dcsp dcsp dcsp dcsp r status code 0 dcnl dcsp dcsp dcsp dcsp return r dcnl dcsp dcsp return function method url kwargs dcnl dcsp return wrapped
catch exceptions if in safe mode dcnl def request method url kwargs dcsp adhoc session false dcnl dcsp session kwargs pop session none dcnl dcsp if session is none dcnl dcsp dcsp session sessions session dcnl dcsp dcsp adhoc session true dcnl dcsp try dcnl dcsp dcsp return session request method method url url kwargs dcnl dcsp finally dcnl dcsp dcsp if adhoc session dcnl dcsp dcsp dcsp session close
def get url kwargs dcsp kwargs setdefault allow redirects true dcnl dcsp return request get url kwargs
def options url kwargs dcsp kwargs setdefault allow redirects true dcnl dcsp return request options url kwargs
def head url kwargs dcsp kwargs setdefault allow redirects false dcnl dcsp return request head url kwargs
def post url data none kwargs dcsp return request post url data data kwargs
def put url data none kwargs dcsp return request put url data data kwargs
def patch url data none kwargs dcsp return request patch url data data kwargs
def delete url kwargs dcsp return request delete url kwargs
def register treebuilders from module dcsp this module sys modules alp request bs4 builder dcnl dcsp for name in module all dcnl dcsp dcsp obj getattr module name dcnl dcsp dcsp if issubclass obj treebuilder dcnl dcsp dcsp dcsp setattr this module name obj dcnl dcsp dcsp dcsp this module all append name dcnl dcsp dcsp dcsp this module builder registry register obj
def alias attr dcsp property dcnl dcsp def alias self dcnl dcsp dcsp return getattr self attr dcnl dcsp alias setter dcnl dcsp def alias self dcnl dcsp dcsp return setattr self attr dcnl dcsp return alias
def show options dcsp feedback alfred feedback dcnl dcsp feedback additem title list dcsp compatible dcsp workflows autocomplete list valid no dcnl dcsp feedback additem title check dcsp for dcsp updates subtitle this dcsp may dcsp take dcsp a dcsp while if get updateable timeout < 10 0 else autocomplete update valid no dcnl dcsp feedback additem title reset dcsp cache autocomplete reset valid no dcnl dcsp feedback additem title view dcsp log autocomplete log valid no dcnl dcsp feedback output
def get compatible dcsp basedir os path dirname os path abspath dcnl dcsp workflow dirs f for f in os listdir basedir if os path isdir os path join basedir f dcnl dcsp workflows dcnl dcsp for d in workflow dirs dcnl dcsp dcsp workflows append workflow os path join basedir d dcnl dcsp workflows w for w in workflows if w alleyoop dcnl dcsp autolog found dcsp s dcsp compatible dcsp workflows len workflows dcnl dcsp return sorted workflows key lambda x x name
def list compatible dcsp workflows get compatible dcnl dcsp feedback alfred feedback dcnl dcsp for w in workflows dcnl dcsp dcsp subtitle v + unicode w version + dcsp + w description dcnl dcsp dcsp feedback additem title w name subtitle subtitle icon w icon valid no dcnl dcsp if feedback isempty dcnl dcsp dcsp feedback additem title no dcsp compatible dcsp workflows dcsp found valid no autocomplete dcnl dcsp else dcnl dcsp dcsp feedback additem title go dcsp back valid no icon back png autocomplete dcnl dcsp feedback output
def list updates dcsp workflows get updateable dcnl dcsp feedback alfred feedback dcnl dcsp valid updates w for w in workflows if w has update and not w has check errors dcnl dcsp if len valid updates 0 dcnl dcsp dcsp feedback additem title download valid yes arg downloadall dcnl dcsp for w in workflows dcnl dcsp dcsp if w has update and not w has check errors dcnl dcsp dcsp dcsp subtitle v + str w version + u dcsp u2794 dcsp + str w update version + dcsp + w update description dcnl dcsp dcsp dcsp feedback additem title w name subtitle subtitle icon w icon arg download dcsp s w dirname dcnl dcsp dcsp elif w has check errors dcnl dcsp dcsp dcsp feedback additem title w name subtitle w error icon bad png valid no arg w dirname dcnl dcsp if feedback isempty dcnl dcsp dcsp feedback additem title all dcsp your dcsp workflows dcsp are dcsp up dcsp to dcsp date valid no icon uptodate png autocomplete dcnl dcsp else dcnl dcsp dcsp feedback additem title go dcsp back valid no icon back png autocomplete dcnl dcsp feedback output
def reset dcsp show state resetting dcnl dcsp alfred cache delete workflow update dcnl dcsp alfred show mp dcsp
def autolog message dcsp func inspect currentframe f back f code dcnl dcsp logging debug s dcsp s dcsp in dcsp s i message func co name func co filename func co firstlineno
def download all dcsp workflows get updateable dcnl dcsp workflows w for w in workflows if w has update and not w has check errors dcnl dcsp for i w in enumerate workflows dcnl dcsp dcsp download w dirname w cached w current i + 1 total len workflows dcnl dcsp print updates dcsp downloaded
def list instances name dcsp items dcnl dcsp try dcnl dcsp dcsp if len name < 2 dcnl dcsp dcsp dcsp items append alp item title searching subtitle please dcsp type dcsp more dcsp then dcsp one dcsp character dcsp to dcsp start dcsp searching valid false dcnl dcsp dcsp else dcnl dcsp dcsp dcsp ec2 boto connect ec2 dcnl dcsp dcsp dcsp for r in ec2 get all instances dcnl dcsp dcsp dcsp dcsp groups join g name or g id for g in r groups dcnl dcsp dcsp dcsp dcsp for instance in r instances dcnl dcsp dcsp dcsp dcsp dcsp instance name instance tags get name instance tags get name dcnl dcsp dcsp dcsp dcsp dcsp if not name lower in instance name lower dcnl dcsp dcsp dcsp dcsp dcsp dcsp continue dcnl dcsp dcsp dcsp dcsp dcsp if instance public dns name dcnl dcsp dcsp dcsp dcsp dcsp dcsp arg ssh dcsp i dcsp ~ ssh s pem dcsp s n instance key name instance public dns name dcnl dcsp dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp dcsp arg ssh dcsp vpc nssh dcsp s n instance private ip address dcnl dcsp dcsp dcsp dcsp dcsp items append alp item title instance name subtitle s dcsp s instance id groups valid true arg arg dcnl dcsp dcsp if len items 0 dcnl dcsp dcsp dcsp items append alp item title no dcsp results dcsp found subtitle please dcsp refine dcsp your dcsp search dcsp and dcsp try dcsp again dcnl dcsp except exception as e dcnl dcsp dcsp alp log str e dcnl dcsp dcsp items alp item title problem dcsp searching subtitle s str e replace valid false dcnl dcsp dcsp alp log items0 get dcnl dcsp alp feedback items
def open resource url file stream or string etag modified agent referrer handlers request headers dcsp if hasattr url file stream or string read dcnl dcsp dcsp return url file stream or string dcnl dcsp if isinstance url file stream or string basestring and urlparse urlparse url file stream or string 0 in http https ftp file feed dcnl dcsp dcsp if url file stream or string startswith feed http dcnl dcsp dcsp dcsp url file stream or string url file stream or string5 dcnl dcsp dcsp elif url file stream or string startswith feed dcnl dcsp dcsp dcsp url file stream or string http + url file stream or string5 dcnl dcsp dcsp if not agent dcnl dcsp dcsp dcsp agent user agent dcnl dcsp dcsp auth none dcnl dcsp dcsp if base64 and not url file stream or string startswith ftp dcnl dcsp dcsp dcsp urltype rest urllib splittype url file stream or string dcnl dcsp dcsp dcsp realhost rest urllib splithost rest dcnl dcsp dcsp dcsp if realhost dcnl dcsp dcsp dcsp dcsp user passwd realhost urllib splituser realhost dcnl dcsp dcsp dcsp dcsp if user passwd dcnl dcsp dcsp dcsp dcsp dcsp url file stream or string s s s urltype realhost rest dcnl dcsp dcsp dcsp dcsp dcsp auth base64 standard b64encode user passwd strip dcnl dcsp dcsp if isinstance url file stream or string unicode dcnl dcsp dcsp dcsp url file stream or string convert to idn url file stream or string dcnl dcsp dcsp request build urllib2 request url file stream or string agent etag modified referrer auth request headers dcnl dcsp dcsp opener urllib2 build opener tuple handlers + feedurlhandler dcnl dcsp dcsp opener addheaders dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return opener open request dcnl dcsp dcsp finally dcnl dcsp dcsp dcsp opener close dcnl dcsp try dcnl dcsp dcsp return open url file stream or string rb dcnl dcsp except ioerror unicodeencodeerror typeerror dcnl dcsp dcsp pass dcnl dcsp if isinstance url file stream or string unicode dcnl dcsp dcsp return stringio url file stream or string encode utf8 dcnl dcsp return stringio url file stream or string
def convert to idn url dcsp parts list urlparse urlsplit url dcnl dcsp try dcnl dcsp dcsp parts1 encode ascii dcnl dcsp except unicodeencodeerror dcnl dcsp dcsp host parts1 rsplit 1 dcnl dcsp dcsp newhost dcnl dcsp dcsp port u dcnl dcsp dcsp if len host 2 dcnl dcsp dcsp dcsp port host pop dcnl dcsp dcsp for h in host0 split dcnl dcsp dcsp dcsp newhost append h encode idna decode utf8 dcnl dcsp dcsp parts1 join newhost dcnl dcsp dcsp if port dcnl dcsp dcsp dcsp parts1 + + port dcnl dcsp dcsp return urlparse urlunsplit parts dcnl dcsp else dcnl dcsp dcsp return url
def registerdatehandler func dcsp date handlers insert 0 func
def parse date iso8601 datestring dcsp m none dcnl dcsp for iso8601 match in iso8601 matches dcnl dcsp dcsp m iso8601 match datestring dcnl dcsp dcsp if m dcnl dcsp dcsp dcsp break dcnl dcsp if not m dcnl dcsp dcsp return dcnl dcsp if m span 0 0 dcnl dcsp dcsp return dcnl dcsp params m groupdict dcnl dcsp ordinal params get ordinal 0 dcnl dcsp if ordinal dcnl dcsp dcsp ordinal int ordinal dcnl dcsp else dcnl dcsp dcsp ordinal 0 dcnl dcsp year params get year dcnl dcsp if not year or year dcnl dcsp dcsp year time gmtime 0 dcnl dcsp elif len year 2 dcnl dcsp dcsp year 100 int time gmtime 0 100 + int year dcnl dcsp else dcnl dcsp dcsp year int year dcnl dcsp month params get month dcnl dcsp if not month or month dcnl dcsp dcsp if ordinal dcnl dcsp dcsp dcsp month 1 dcnl dcsp dcsp else dcnl dcsp dcsp dcsp month time gmtime 1 dcnl dcsp month int month dcnl dcsp day params get day 0 dcnl dcsp if not day dcnl dcsp dcsp if ordinal dcnl dcsp dcsp dcsp day ordinal dcnl dcsp dcsp elif params get century 0 or params get year 0 or params get month 0 dcnl dcsp dcsp dcsp day 1 dcnl dcsp dcsp else dcnl dcsp dcsp dcsp day time gmtime 2 dcnl dcsp else dcnl dcsp dcsp day int day dcnl dcsp if century in params dcnl dcsp dcsp year int params century 1 100 + 1 dcnl dcsp for field in hour minute second tzhour tzmin dcnl dcsp dcsp if not params get field none dcnl dcsp dcsp dcsp paramsfield 0 dcnl dcsp hour int params get hour 0 dcnl dcsp minute int params get minute 0 dcnl dcsp second int float params get second 0 dcnl dcsp weekday 0 dcnl dcsp daylight savings flag 1 dcnl dcsp tm year month day hour minute second weekday ordinal daylight savings flag dcnl dcsp tz params get tz dcnl dcsp if tz and tz z dcnl dcsp dcsp if tz0 dcnl dcsp dcsp dcsp tm3 + int params get tzhour 0 dcnl dcsp dcsp dcsp tm4 + int params get tzmin 0 dcnl dcsp dcsp elif tz0 + dcnl dcsp dcsp dcsp tm3 int params get tzhour 0 dcnl dcsp dcsp dcsp tm4 int params get tzmin 0 dcnl dcsp dcsp else dcnl dcsp dcsp dcsp return none dcnl dcsp return time localtime time mktime tuple tm
def parse date onblog datestring dcsp m korean onblog date re match datestring dcnl dcsp if not m dcnl dcsp dcsp return dcnl dcsp w3dtfdate year s month s day st hour s minute s second s zonediff s year m group 1 month m group 2 day m group 3 hour m group 4 minute m group 5 second m group 6 zonediff +09 00 dcnl dcsp return parse date w3dtf w3dtfdate
def parse date nate datestring dcsp m korean nate date re match datestring dcnl dcsp if not m dcnl dcsp dcsp return dcnl dcsp hour int m group 5 dcnl dcsp ampm m group 4 dcnl dcsp if ampm korean pm dcnl dcsp dcsp hour + 12 dcnl dcsp hour str hour dcnl dcsp if len hour 1 dcnl dcsp dcsp hour 0 + hour dcnl dcsp w3dtfdate year s month s day st hour s minute s second s zonediff s year m group 1 month m group 2 day m group 3 hour hour minute m group 6 second m group 7 zonediff +09 00 dcnl dcsp return parse date w3dtf w3dtfdate
def parse date greek datestring dcsp m greek date format re match datestring dcnl dcsp if not m dcnl dcsp dcsp return dcnl dcsp wday greek wdaysm group 1 dcnl dcsp month greek monthsm group 3 dcnl dcsp rfc822date wday s dcsp day s dcsp month s dcsp year s dcsp hour s minute s second s dcsp zonediff s wday wday day m group 2 month month year m group 4 hour m group 5 minute m group 6 second m group 7 zonediff m group 8 dcnl dcsp return parse date rfc822 rfc822date
def parse date hungarian datestring dcsp m hungarian date format re match datestring dcnl dcsp if not m or m group 2 not in hungarian months dcnl dcsp dcsp return none dcnl dcsp month hungarian monthsm group 2 dcnl dcsp day m group 3 dcnl dcsp if len day 1 dcnl dcsp dcsp day 0 + day dcnl dcsp hour m group 4 dcnl dcsp if len hour 1 dcnl dcsp dcsp hour 0 + hour dcnl dcsp w3dtfdate year s month s day st hour s minute s zonediff s year m group 1 month month day day hour hour minute m group 5 zonediff m group 6 dcnl dcsp return parse date w3dtf w3dtfdate
def parse date rfc822 dt dcsp try dcnl dcsp dcsp m rfc822 match dt lower groupdict 0 dcnl dcsp except attributeerror dcnl dcsp dcsp return none dcnl dcsp return parse date group rfc822 m
def parse date rfc822 grubby dt dcsp rfc822 date grubby s dcsp s dcsp s rfc822 month rfc822 day rfc822 year dcnl dcsp rfc822 match grubby re compile s dcsp s dcsp s rfc822 dayname rfc822 date grubby rfc822 time match dcnl dcsp try dcnl dcsp dcsp m rfc822 match grubby dt lower groupdict 0 dcnl dcsp except attributeerror dcnl dcsp dcsp return none dcnl dcsp return parse date group rfc822 m
def parse date asctime dt dcsp dayname month day remainder dt split none 3 dcnl dcsp month 02i dcsp rfc822 months index month lower + 1 dcnl dcsp day 02i dcsp int day dcnl dcsp dt month + day + remainder dcnl dcsp return time strptime dt m dcsp d dcsp h m s dcsp y 1 + 0
def parse date perforce adatestring dcsp my date pattern re compile w 3 dcsp d 4 d 2 d 2 dcsp d 2 d 2 d 2 dcsp w 3 dcnl dcsp m my date pattern search adatestring dcnl dcsp if m is none dcnl dcsp dcsp return none dcnl dcsp dow year month day hour minute second tz m groups dcnl dcsp months jan feb mar apr may jun jul aug sep oct nov dec dcnl dcsp datestring s dcsp s dcsp s dcsp s dcsp s s s dcsp s dow day months int month 1 year hour minute second tz dcnl dcsp tm rfc822 parsedate tz datestring dcnl dcsp if tm dcnl dcsp dcsp return time gmtime rfc822 mktime tz tm
def parse date datestring dcsp if not datestring dcnl dcsp dcsp return none dcnl dcsp for handler in date handlers dcnl dcsp dcsp try dcnl dcsp dcsp dcsp date9tuple handler datestring dcnl dcsp dcsp except keyerror overflowerror valueerror dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if not date9tuple dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if len date9tuple 9 dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp return date9tuple dcnl dcsp return none
def convert to utf8 http headers data dcsp bom encoding u dcnl dcsp xml encoding u dcnl dcsp rfc3023 encoding u dcnl dcsp if data 4 codecs bom utf32 be dcnl dcsp dcsp bom encoding u utf32be dcnl dcsp dcsp data data4 dcnl dcsp elif data 4 codecs bom utf32 le dcnl dcsp dcsp bom encoding u utf32le dcnl dcsp dcsp data data4 dcnl dcsp elif data 2 codecs bom utf16 be and data2 4 zero bytes dcnl dcsp dcsp bom encoding u utf16be dcnl dcsp dcsp data data2 dcnl dcsp elif data 2 codecs bom utf16 le and data2 4 zero bytes dcnl dcsp dcsp bom encoding u utf16le dcnl dcsp dcsp data data2 dcnl dcsp elif data 3 codecs bom utf8 dcnl dcsp dcsp bom encoding u utf8 dcnl dcsp dcsp data data3 dcnl dcsp elif data 4 ebcdic marker dcnl dcsp dcsp bom encoding u cp037 dcnl dcsp elif data 4 utf16be marker dcnl dcsp dcsp bom encoding u utf16be dcnl dcsp elif data 4 utf16le marker dcnl dcsp dcsp bom encoding u utf16le dcnl dcsp elif data 4 utf32be marker dcnl dcsp dcsp bom encoding u utf32be dcnl dcsp elif data 4 utf32le marker dcnl dcsp dcsp bom encoding u utf32le dcnl dcsp tempdata data dcnl dcsp try dcnl dcsp dcsp if bom encoding dcnl dcsp dcsp dcsp tempdata data decode bom encoding encode utf8 dcnl dcsp except unicodedecodeerror lookuperror dcnl dcsp dcsp xml encoding match none dcnl dcsp else dcnl dcsp dcsp xml encoding match re xml pi encoding match tempdata dcnl dcsp if xml encoding match dcnl dcsp dcsp xml encoding xml encoding match groups 0 decode utf8 lower dcnl dcsp dcsp if bom encoding and xml encoding in u u16 u utf16 u utf16 u utf 16 u u32 u utf32 u utf32 u utf 32 u iso10646ucs2 u iso10646ucs4 u csucs4 u csunicode u ucs2 u ucs4 dcnl dcsp dcsp dcsp xml encoding bom encoding dcnl dcsp http content type http headers get contenttype or dcnl dcsp http content type params cgi parse header http content type dcnl dcsp http encoding params get charset replace dcnl dcsp if not isinstance http encoding unicode dcnl dcsp dcsp http encoding http encoding decode utf8 ignore dcnl dcsp acceptable content type 0 dcnl dcsp application content types u application xml u application xmldtd u application xmlexternalparsedentity dcnl dcsp text content types u text xml u text xmlexternalparsedentity dcnl dcsp if http content type in application content types or http content type startswith u application and http content type endswith u +xml dcnl dcsp dcsp acceptable content type 1 dcnl dcsp dcsp rfc3023 encoding http encoding or xml encoding or u utf8 dcnl dcsp elif http content type in text content types or http content type startswith u text and http content type endswith u +xml dcnl dcsp dcsp acceptable content type 1 dcnl dcsp dcsp rfc3023 encoding http encoding or u usascii dcnl dcsp elif http content type startswith u text dcnl dcsp dcsp rfc3023 encoding http encoding or u usascii dcnl dcsp elif http headers and contenttype not in http headers dcnl dcsp dcsp rfc3023 encoding xml encoding or u iso88591 dcnl dcsp else dcnl dcsp dcsp rfc3023 encoding xml encoding or u utf8 dcnl dcsp if rfc3023 encoding lower u gb2312 dcnl dcsp dcsp rfc3023 encoding u gb18030 dcnl dcsp if xml encoding lower u gb2312 dcnl dcsp dcsp xml encoding u gb18030 dcnl dcsp error none dcnl dcsp if http headers and not acceptable content type dcnl dcsp dcsp if contenttype in http headers dcnl dcsp dcsp dcsp msg s dcsp is dcsp not dcsp an dcsp xml dcsp media dcsp type http headers contenttype dcnl dcsp dcsp else dcnl dcsp dcsp dcsp msg no dcsp contenttype dcsp specified dcnl dcsp dcsp error nonxmlcontenttype msg dcnl dcsp known encoding 0 dcnl dcsp chardet encoding none dcnl dcsp tried encodings dcnl dcsp if chardet dcnl dcsp dcsp chardet encoding unicode chardet detect data encoding or ascii ignore dcnl dcsp for proposed encoding in rfc3023 encoding xml encoding bom encoding chardet encoding u utf8 u windows1252 u iso88592 dcnl dcsp dcsp if not proposed encoding dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if proposed encoding in tried encodings dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp tried encodings append proposed encoding dcnl dcsp dcsp try dcnl dcsp dcsp dcsp data data decode proposed encoding dcnl dcsp dcsp except unicodedecodeerror lookuperror dcnl dcsp dcsp dcsp pass dcnl dcsp dcsp else dcnl dcsp dcsp dcsp known encoding 1 dcnl dcsp dcsp dcsp new declaration < xml dcsp version 1 0 dcsp encoding utf8 dcnl dcsp dcsp dcsp if re xml declaration search data dcnl dcsp dcsp dcsp dcsp data re xml declaration sub new declaration data dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp data new declaration + u n + data dcnl dcsp dcsp dcsp data data encode utf8 dcnl dcsp dcsp dcsp break dcnl dcsp if not known encoding dcnl dcsp dcsp error characterencodingunknown document dcsp encoding dcsp unknown dcsp i dcsp tried dcsp + s dcsp s dcsp utf8 dcsp windows1252 dcsp and dcsp iso88592 dcsp but dcsp nothing dcsp worked rfc3023 encoding xml encoding dcnl dcsp dcsp rfc3023 encoding u dcnl dcsp elif proposed encoding rfc3023 encoding dcnl dcsp dcsp error characterencodingoverride document dcsp declared dcsp as dcsp s dcsp but dcsp parsed dcsp as dcsp s rfc3023 encoding proposed encoding dcnl dcsp dcsp rfc3023 encoding proposed encoding dcnl dcsp return data rfc3023 encoding error
def replace doctype data dcsp start re search s2bytes < w data dcnl dcsp start start and start start or 1 dcnl dcsp head data data start + 1 data start + 1 dcnl dcsp entity results re entity pattern findall head dcnl dcsp head re entity pattern sub s2bytes head dcnl dcsp doctype results re doctype pattern findall head dcnl dcsp doctype doctype results and doctype results0 or s2bytes dcnl dcsp if s2bytes netscape in doctype lower dcnl dcsp dcsp version u rss091n dcnl dcsp else dcnl dcsp dcsp version none dcnl dcsp replacement s2bytes dcnl dcsp if len doctype results 1 and entity results dcnl dcsp dcsp match safe entities lambda e re safe entity pattern match e dcnl dcsp dcsp safe entities filter match safe entities entity results dcnl dcsp dcsp if safe entities dcnl dcsp dcsp dcsp replacement s2bytes < doctype dcsp feed dcsp n< entity + s2bytes n< entity dcsp join safe entities + s2bytes n dcnl dcsp data re doctype pattern sub replacement head + data dcnl dcsp safe entities dict k decode utf8 v decode utf8 for k v in re safe entity pattern findall replacement dcnl dcsp return version data safe entities
def parse url file stream or string etag none modified none agent none referrer none handlers none request headers none response headers none dcsp if handlers is none dcnl dcsp dcsp handlers dcnl dcsp if request headers is none dcnl dcsp dcsp request headers dcnl dcsp if response headers is none dcnl dcsp dcsp response headers dcnl dcsp result feedparserdict dcnl dcsp result feed feedparserdict dcnl dcsp result entries dcnl dcsp result bozo 0 dcnl dcsp if not isinstance handlers list dcnl dcsp dcsp handlers handlers dcnl dcsp try dcnl dcsp dcsp f open resource url file stream or string etag modified agent referrer handlers request headers dcnl dcsp dcsp data f read dcnl dcsp except exception as e dcnl dcsp dcsp result bozo 1 dcnl dcsp dcsp result bozo exception e dcnl dcsp dcsp data none dcnl dcsp dcsp f none dcnl dcsp if hasattr f headers dcnl dcsp dcsp result headers dict f headers dcnl dcsp if headers in result dcnl dcsp dcsp result headers update response headers dcnl dcsp elif response headers dcnl dcsp dcsp result headers copy deepcopy response headers dcnl dcsp if headers in result dcnl dcsp dcsp http headers dict k lower v for k v in result headers items dcnl dcsp else dcnl dcsp dcsp http headers dcnl dcsp if f and data and http headers dcnl dcsp dcsp if gzip and gzip in http headers get contentencoding dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp data gzip gzipfile fileobj stringio data read dcnl dcsp dcsp dcsp except ioerror struct error as e dcnl dcsp dcsp dcsp dcsp result bozo 1 dcnl dcsp dcsp dcsp dcsp result bozo exception e dcnl dcsp dcsp dcsp dcsp if isinstance e struct error dcnl dcsp dcsp dcsp dcsp dcsp data none dcnl dcsp dcsp elif zlib and deflate in http headers get contentencoding dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp data zlib decompress data dcnl dcsp dcsp dcsp except zlib error as e dcnl dcsp dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp dcsp data zlib decompress data 15 dcnl dcsp dcsp dcsp dcsp except zlib error as e dcnl dcsp dcsp dcsp dcsp dcsp result bozo 1 dcnl dcsp dcsp dcsp dcsp dcsp result bozo exception e dcnl dcsp if http headers dcnl dcsp dcsp if etag in http headers dcnl dcsp dcsp dcsp etag http headers get etag u dcnl dcsp dcsp dcsp if not isinstance etag unicode dcnl dcsp dcsp dcsp dcsp etag etag decode utf8 ignore dcnl dcsp dcsp dcsp if etag dcnl dcsp dcsp dcsp dcsp result etag etag dcnl dcsp dcsp if lastmodified in http headers dcnl dcsp dcsp dcsp modified http headers get lastmodified u dcnl dcsp dcsp dcsp if modified dcnl dcsp dcsp dcsp dcsp result modified modified dcnl dcsp dcsp dcsp dcsp result modified parsed parse date modified dcnl dcsp if hasattr f url dcnl dcsp dcsp if not isinstance f url unicode dcnl dcsp dcsp dcsp result href f url decode utf8 ignore dcnl dcsp dcsp else dcnl dcsp dcsp dcsp result href f url dcnl dcsp dcsp result status 200 dcnl dcsp if hasattr f status dcnl dcsp dcsp result status f status dcnl dcsp if hasattr f close dcnl dcsp dcsp f close dcnl dcsp if data is none dcnl dcsp dcsp return result dcnl dcsp if getattr f code 0 304 dcnl dcsp dcsp result version u dcnl dcsp dcsp result debug message the dcsp feed dcsp has dcsp not dcsp changed dcsp since dcsp you dcsp last dcsp checked dcsp + so dcsp the dcsp server dcsp sent dcsp no dcsp data dcsp dcsp this dcsp is dcsp a dcsp feature dcsp not dcsp a dcsp bug dcnl dcsp dcsp return result dcnl dcsp data result encoding error convert to utf8 http headers data dcnl dcsp use strict parser result encoding and true or false dcnl dcsp if error is not none dcnl dcsp dcsp result bozo 1 dcnl dcsp dcsp result bozo exception error dcnl dcsp result version data entities replace doctype data dcnl dcsp contentloc http headers get contentlocation u dcnl dcsp href result get href u dcnl dcsp baseuri makesafeabsoluteuri href contentloc or makesafeabsoluteuri contentloc or href dcnl dcsp baselang http headers get contentlanguage none dcnl dcsp if not isinstance baselang unicode and baselang is not none dcnl dcsp dcsp baselang baselang decode utf8 ignore dcnl dcsp if not xml available dcnl dcsp dcsp use strict parser 0 dcnl dcsp if use strict parser dcnl dcsp dcsp feedparser strictfeedparser baseuri baselang utf8 dcnl dcsp dcsp saxparser xml sax make parser preferred xml parsers dcnl dcsp dcsp saxparser setfeature xml sax handler feature namespaces 1 dcnl dcsp dcsp try dcnl dcsp dcsp dcsp saxparser setfeature xml sax handler feature external ges 0 dcnl dcsp dcsp except xml sax saxnotsupportedexception dcnl dcsp dcsp dcsp pass dcnl dcsp dcsp saxparser setcontenthandler feedparser dcnl dcsp dcsp saxparser seterrorhandler feedparser dcnl dcsp dcsp source xml sax xmlreader inputsource dcnl dcsp dcsp source setbytestream stringio data dcnl dcsp dcsp try dcnl dcsp dcsp dcsp saxparser parse source dcnl dcsp dcsp except xml sax saxexception as e dcnl dcsp dcsp dcsp result bozo 1 dcnl dcsp dcsp dcsp result bozo exception feedparser exc or e dcnl dcsp dcsp dcsp use strict parser 0 dcnl dcsp if not use strict parser and sgml available dcnl dcsp dcsp feedparser loosefeedparser baseuri baselang utf8 entities dcnl dcsp dcsp feedparser feed data decode utf8 replace dcnl dcsp result feed feedparser feeddata dcnl dcsp result entries feedparser entries dcnl dcsp result version result version or feedparser version dcnl dcsp result namespaces feedparser namespacesinuse dcnl dcsp return result
def dict to sequence d dcsp if hasattr d items dcnl dcsp dcsp d d items dcnl dcsp return d
def get netrc auth url raise errors false dcsp try dcnl dcsp dcsp from netrc import netrc netrcparseerror dcnl dcsp dcsp netrc path none dcnl dcsp dcsp for f in netrc files dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp loc os path expanduser ~ 0 format f dcnl dcsp dcsp dcsp except keyerror dcnl dcsp dcsp dcsp dcsp return dcnl dcsp dcsp dcsp if os path exists loc dcnl dcsp dcsp dcsp dcsp netrc path loc dcnl dcsp dcsp dcsp dcsp break dcnl dcsp dcsp if netrc path is none dcnl dcsp dcsp dcsp return dcnl dcsp dcsp ri urlparse url dcnl dcsp dcsp splitstr dcnl dcsp dcsp if isinstance url str dcnl dcsp dcsp dcsp splitstr splitstr decode ascii dcnl dcsp dcsp host ri netloc split splitstr 0 dcnl dcsp dcsp try dcnl dcsp dcsp dcsp netrc netrc netrc path authenticators host dcnl dcsp dcsp dcsp if netrc dcnl dcsp dcsp dcsp dcsp login i 0 if netrc0 else 1 dcnl dcsp dcsp dcsp dcsp return netrclogin i netrc2 dcnl dcsp dcsp except netrcparseerror ioerror dcnl dcsp dcsp dcsp if raise errors dcnl dcsp dcsp dcsp dcsp raise dcnl dcsp except importerror attributeerror dcnl dcsp dcsp pass
def guess filename obj dcsp name getattr obj name none dcnl dcsp if name and isinstance name basestring and name0 < and name 1 dcnl dcsp dcsp return os path basename name
def from key val list value dcsp if value is none dcnl dcsp dcsp return none dcnl dcsp if isinstance value str bytes bool int dcnl dcsp dcsp raise valueerror cannot dcsp encode dcsp objects dcsp that dcsp are dcsp not dcsp 2tuples dcnl dcsp return ordereddict value
def to key val list value dcsp if value is none dcnl dcsp dcsp return none dcnl dcsp if isinstance value str bytes bool int dcnl dcsp dcsp raise valueerror cannot dcsp encode dcsp objects dcsp that dcsp are dcsp not dcsp 2tuples dcnl dcsp if isinstance value collections mapping dcnl dcsp dcsp value value items dcnl dcsp return list value
def parse list header value dcsp result dcnl dcsp for item in parse list header value dcnl dcsp dcsp if item 1 item 1 dcnl dcsp dcsp dcsp item unquote header value item1 1 dcnl dcsp dcsp result append item dcnl dcsp return result
def parse dict header value dcsp result dcnl dcsp for item in parse list header value dcnl dcsp dcsp if not in item dcnl dcsp dcsp dcsp resultitem none dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp name value item split 1 dcnl dcsp dcsp if value 1 value 1 dcnl dcsp dcsp dcsp value unquote header value value1 1 dcnl dcsp dcsp resultname value dcnl dcsp return result
def unquote header value value is filename false dcsp if value and value0 value 1 dcnl dcsp dcsp value value1 1 dcnl dcsp dcsp if not is filename or value 2 dcnl dcsp dcsp dcsp return value replace replace dcnl dcsp return value
def dict from cookiejar cj dcsp cookie dict dcnl dcsp for cookie in cj dcnl dcsp dcsp cookie dictcookie name cookie value dcnl dcsp return cookie dict
def add dict to cookiejar cj cookie dict dcsp cj2 cookiejar from dict cookie dict dcnl dcsp cj update cj2 dcnl dcsp return cj
def get encodings from content content dcsp warnings warn in dcsp requests dcsp 3 0 dcsp get encodings from content dcsp will dcsp be dcsp removed dcsp for dcsp more dcsp information dcsp please dcsp see dcsp the dcsp discussion dcsp on dcsp issue dcsp 2266 dcsp this dcsp warning dcsp should dcsp only dcsp appear dcsp once deprecationwarning dcnl dcsp charset re re compile <meta charset + flags re i dcnl dcsp pragma re re compile <meta content charset + flags re i dcnl dcsp xml re re compile ^< xml encoding + dcnl dcsp return charset re findall content + pragma re findall content + xml re findall content
def get encoding from headers headers dcsp content type headers get contenttype dcnl dcsp if not content type dcnl dcsp dcsp return none dcnl dcsp content type params cgi parse header content type dcnl dcsp if charset in params dcnl dcsp dcsp return params charset strip dcnl dcsp if text in content type dcnl dcsp dcsp return iso88591
def stream decode response unicode iterator r dcsp if r encoding is none dcnl dcsp dcsp for item in iterator dcnl dcsp dcsp dcsp yield item dcnl dcsp dcsp return dcnl dcsp decoder codecs getincrementaldecoder r encoding errors replace dcnl dcsp for chunk in iterator dcnl dcsp dcsp rv decoder decode chunk dcnl dcsp dcsp if rv dcnl dcsp dcsp dcsp yield rv dcnl dcsp rv decoder decode final true dcnl dcsp if rv dcnl dcsp dcsp yield rv
def iter slices string slice length dcsp pos 0 dcnl dcsp while pos < len string dcnl dcsp dcsp yield stringpos pos + slice length dcnl dcsp dcsp pos + slice length
def get unicode from response r dcsp warnings warn in dcsp requests dcsp 3 0 dcsp get unicode from response dcsp will dcsp be dcsp removed dcsp for dcsp more dcsp information dcsp please dcsp see dcsp the dcsp discussion dcsp on dcsp issue dcsp 2266 dcsp this dcsp warning dcsp should dcsp only dcsp appear dcsp once deprecationwarning dcnl dcsp tried encodings dcnl dcsp encoding get encoding from headers r headers dcnl dcsp if encoding dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return str r content encoding dcnl dcsp dcsp except unicodeerror dcnl dcsp dcsp dcsp tried encodings append encoding dcnl dcsp try dcnl dcsp dcsp return str r content encoding errors replace dcnl dcsp except typeerror dcnl dcsp dcsp return r content
def unquote unreserved uri dcsp parts uri split dcnl dcsp for i in range 1 len parts dcnl dcsp dcsp h partsi0 2 dcnl dcsp dcsp if len h 2 and h isalnum dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp c chr int h 16 dcnl dcsp dcsp dcsp except valueerror dcnl dcsp dcsp dcsp dcsp raise invalidurl invalid dcsp percentescape dcsp sequence dcsp s h dcnl dcsp dcsp dcsp if c in unreserved set dcnl dcsp dcsp dcsp dcsp partsi c + partsi2 dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp partsi + partsi dcnl dcsp dcsp else dcnl dcsp dcsp dcsp partsi + partsi dcnl dcsp return join parts
def requote uri uri dcsp safe with percent + ~ dcnl dcsp safe without percent + ~ dcnl dcsp try dcnl dcsp dcsp return quote unquote unreserved uri safe safe with percent dcnl dcsp except invalidurl dcnl dcsp dcsp return quote uri safe safe without percent
def address in network ip net dcsp ipaddr struct unpack l socket inet aton ip 0 dcnl dcsp netaddr bits net split dcnl dcsp netmask struct unpack l socket inet aton dotted netmask int bits 0 dcnl dcsp network struct unpack l socket inet aton netaddr 0 netmask dcnl dcsp return ipaddr netmask network netmask
def dotted netmask mask dcsp bits 4294967295 ^ 1 << 32 mask 1 dcnl dcsp return socket inet ntoa struct pack i bits
def is valid cidr string network dcsp if string network count 1 dcnl dcsp dcsp try dcnl dcsp dcsp dcsp mask int string network split 1 dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp return false dcnl dcsp dcsp if mask < 1 or mask 32 dcnl dcsp dcsp dcsp return false dcnl dcsp dcsp try dcnl dcsp dcsp dcsp socket inet aton string network split 0 dcnl dcsp dcsp except socket error dcnl dcsp dcsp dcsp return false dcnl dcsp else dcnl dcsp dcsp return false dcnl dcsp return true
def should bypass proxies url dcsp get proxy lambda k os environ get k or os environ get k upper dcnl dcsp no proxy get proxy no proxy dcnl dcsp netloc urlparse url netloc dcnl dcsp if no proxy dcnl dcsp dcsp no proxy host for host in no proxy replace dcsp split if host dcnl dcsp dcsp ip netloc split 0 dcnl dcsp dcsp if is ipv4 address ip dcnl dcsp dcsp dcsp for proxy ip in no proxy dcnl dcsp dcsp dcsp dcsp if is valid cidr proxy ip dcnl dcsp dcsp dcsp dcsp dcsp if address in network ip proxy ip dcnl dcsp dcsp dcsp dcsp dcsp dcsp return true dcnl dcsp dcsp else dcnl dcsp dcsp dcsp for host in no proxy dcnl dcsp dcsp dcsp dcsp if netloc endswith host or netloc split 0 endswith host dcnl dcsp dcsp dcsp dcsp dcsp return true dcnl dcsp try dcnl dcsp dcsp bypass proxy bypass netloc dcnl dcsp except typeerror socket gaierror dcnl dcsp dcsp bypass false dcnl dcsp if bypass dcnl dcsp dcsp return true dcnl dcsp return false
def get environ proxies url dcsp if should bypass proxies url dcnl dcsp dcsp return dcnl dcsp else dcnl dcsp dcsp return getproxies
def select proxy url proxies dcsp proxies proxies or dcnl dcsp urlparts urlparse url dcnl dcsp proxy proxies get urlparts scheme + + urlparts hostname dcnl dcsp if proxy is none dcnl dcsp dcsp proxy proxies get urlparts scheme dcnl dcsp return proxy
def default user agent name pythonrequests dcsp return s s name version
def parse header links value dcsp links dcnl dcsp replace chars dcsp dcnl dcsp for val in re split dcsp < value dcnl dcsp dcsp try dcnl dcsp dcsp dcsp url params val split 1 dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp url params val dcnl dcsp dcsp link dcnl dcsp dcsp link url url strip < dcsp dcnl dcsp dcsp for param in params split dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp key value param split dcnl dcsp dcsp dcsp except valueerror dcnl dcsp dcsp dcsp dcsp break dcnl dcsp dcsp dcsp linkkey strip replace chars value strip replace chars dcnl dcsp dcsp links append link dcnl dcsp return links
def prepend scheme if needed url new scheme dcsp scheme netloc path params query fragment urlparse url new scheme dcnl dcsp if not netloc dcnl dcsp dcsp netloc path path netloc dcnl dcsp return urlunparse scheme netloc path params query fragment
def get auth from url url dcsp parsed urlparse url dcnl dcsp try dcnl dcsp dcsp auth unquote parsed username unquote parsed password dcnl dcsp except attributeerror typeerror dcnl dcsp dcsp auth dcnl dcsp return auth
def to native string string encoding ascii dcsp out none dcnl dcsp if isinstance string builtin str dcnl dcsp dcsp out string dcnl dcsp elif is py2 dcnl dcsp dcsp out string encode encoding dcnl dcsp else dcnl dcsp dcsp out string decode encoding dcnl dcsp return out
def urldefragauth url dcsp scheme netloc path params query fragment urlparse url dcnl dcsp if not netloc dcnl dcsp dcsp netloc path path netloc dcnl dcsp netloc netloc rsplit 1 1 dcnl dcsp return urlunparse scheme netloc path params query
def extract cookies to jar jar request response dcsp if not hasattr response original response and response original response dcnl dcsp dcsp return dcnl dcsp req mockrequest request dcnl dcsp res mockresponse response original response msg dcnl dcsp jar extract cookies res req
def get cookie header jar request dcsp r mockrequest request dcnl dcsp jar add cookie header r dcnl dcsp return r get new headers get cookie
def remove cookie by name cookiejar name domain none path none dcsp clearables dcnl dcsp for cookie in cookiejar dcnl dcsp dcsp if cookie name name dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if domain is not none and domain cookie domain dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if path is not none and path cookie path dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp clearables append cookie domain cookie path cookie name dcnl dcsp for domain path name in clearables dcnl dcsp dcsp cookiejar clear domain path name
def create cookie name value kwargs dcsp result dict version 0 name name value value port none domain path secure false expires none discard true comment none comment url none rest httponly none rfc2109 false dcnl dcsp badargs set kwargs set result dcnl dcsp if badargs dcnl dcsp dcsp err create cookie dcsp got dcsp unexpected dcsp keyword dcsp arguments dcsp s dcnl dcsp dcsp raise typeerror err list badargs dcnl dcsp result update kwargs dcnl dcsp result port specified bool result port dcnl dcsp result domain specified bool result domain dcnl dcsp result domain initial dot result domain startswith dcnl dcsp result path specified bool result path dcnl dcsp return cookielib cookie result
def morsel to cookie morsel dcsp expires none dcnl dcsp if morsel maxage dcnl dcsp dcsp try dcnl dcsp dcsp dcsp expires int time time + int morsel maxage dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp raise typeerror maxage dcsp s dcsp must dcsp be dcsp integer morsel maxage dcnl dcsp elif morsel expires dcnl dcsp dcsp time template a dcsp d b y dcsp h m s dcsp gmt dcnl dcsp dcsp expires calendar timegm time strptime morsel expires time template dcnl dcsp return create cookie comment morsel comment comment url bool morsel comment discard false domain morsel domain expires expires name morsel key path morsel path port none rest httponly morsel httponly rfc2109 false secure bool morsel secure value morsel value version morsel version or 0
def cookiejar from dict cookie dict cookiejar none overwrite true dcsp if cookiejar is none dcnl dcsp dcsp cookiejar requestscookiejar dcnl dcsp if cookie dict is not none dcnl dcsp dcsp names from jar cookie name for cookie in cookiejar dcnl dcsp dcsp for name in cookie dict dcnl dcsp dcsp dcsp if overwrite or name not in names from jar dcnl dcsp dcsp dcsp dcsp cookiejar set cookie create cookie name cookie dictname dcnl dcsp return cookiejar
def merge cookies cookiejar cookies dcsp if not isinstance cookiejar cookielib cookiejar dcnl dcsp dcsp raise valueerror you dcsp can dcsp only dcsp merge dcsp into dcsp cookiejar dcnl dcsp if isinstance cookies dict dcnl dcsp dcsp cookiejar cookiejar from dict cookies cookiejar cookiejar overwrite false dcnl dcsp elif isinstance cookies cookielib cookiejar dcnl dcsp dcsp try dcnl dcsp dcsp dcsp cookiejar update cookies dcnl dcsp dcsp except attributeerror dcnl dcsp dcsp dcsp for cookie in jar in cookies dcnl dcsp dcsp dcsp dcsp cookiejar set cookie cookie in jar dcnl dcsp return cookiejar
def description of lines name u stdin dcsp u universaldetector dcnl dcsp for line in lines dcnl dcsp dcsp u feed line dcnl dcsp u close dcnl dcsp result u result dcnl dcsp if resultu encoding dcnl dcsp dcsp return u 0 dcsp 1 dcsp with dcsp confidence dcsp 2 format name resultu encoding resultu confidence dcnl dcsp else dcnl dcsp dcsp return u 0 dcsp no dcsp result format name
def main argv none dcsp parser argparse argumentparser description u takes dcsp one dcsp or dcsp more dcsp file dcsp paths dcsp and dcsp reports dcsp their dcsp detected dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp encodings formatter class argparse argumentdefaultshelpformatter conflict handler u resolve dcnl dcsp parser add argument u input help u file dcsp whose dcsp encoding dcsp we dcsp would dcsp like dcsp to dcsp determine type argparse filetype u rb nargs u default sys stdin dcnl dcsp parser add argument u version action u version version u prog s dcsp 0 format version dcnl dcsp args parser parse args argv dcnl dcsp for f in args input dcnl dcsp dcsp if f isatty dcnl dcsp dcsp dcsp print u you dcsp are dcsp running dcsp chardetect dcsp interactively dcsp press dcsp + u ctrld dcsp twice dcsp at dcsp the dcsp start dcsp of dcsp a dcsp blank dcsp line dcsp to dcsp signal dcsp the dcsp + u end dcsp of dcsp your dcsp input dcsp if dcsp you dcsp want dcsp help dcsp run dcsp chardetect dcsp + u help n file sys stderr dcnl dcsp dcsp print description of f f name
def add doc func doc dcsp func doc doc
def import module name dcsp import name dcnl dcsp return sys modulesname
def add move move dcsp setattr moveditems move name move
def remove move name dcsp try dcnl dcsp dcsp delattr moveditems name dcnl dcsp except attributeerror dcnl dcsp dcsp try dcnl dcsp dcsp dcsp del moves dict name dcnl dcsp dcsp except keyerror dcnl dcsp dcsp dcsp raise attributeerror no dcsp such dcsp move dcsp r name
def iterkeys d dcsp return iter getattr d iterkeys
def itervalues d dcsp return iter getattr d itervalues
def iteritems d dcsp return iter getattr d iteritems
def with metaclass meta base object dcsp return meta newbase base
def dnsname match dn hostname max wildcards 1 dcsp pats dcnl dcsp if not dn dcnl dcsp dcsp return false dcnl dcsp parts dn split dcnl dcsp leftmost parts0 dcnl dcsp remainder parts1 dcnl dcsp wildcards leftmost count dcnl dcsp if wildcards max wildcards dcnl dcsp dcsp raise certificateerror too dcsp many dcsp wildcards dcsp in dcsp certificate dcsp dns dcsp name dcsp + repr dn dcnl dcsp if not wildcards dcnl dcsp dcsp return dn lower hostname lower dcnl dcsp if leftmost dcnl dcsp dcsp pats append ^ + dcnl dcsp elif leftmost startswith xn or hostname startswith xn dcnl dcsp dcsp pats append re escape leftmost dcnl dcsp else dcnl dcsp dcsp pats append re escape leftmost replace ^ dcnl dcsp for frag in remainder dcnl dcsp dcsp pats append re escape frag dcnl dcsp pat re compile a + join pats + z re ignorecase dcnl dcsp return pat match hostname
def match hostname cert hostname dcsp if not cert dcnl dcsp dcsp raise valueerror empty dcsp or dcsp no dcsp certificate dcnl dcsp dnsnames dcnl dcsp san cert get subjectaltname dcnl dcsp for key value in san dcnl dcsp dcsp if key dns dcnl dcsp dcsp dcsp if dnsname match value hostname dcnl dcsp dcsp dcsp dcsp return dcnl dcsp dcsp dcsp dnsnames append value dcnl dcsp if not dnsnames dcnl dcsp dcsp for sub in cert get subject dcnl dcsp dcsp dcsp for key value in sub dcnl dcsp dcsp dcsp dcsp if key commonname dcnl dcsp dcsp dcsp dcsp dcsp if dnsname match value hostname dcnl dcsp dcsp dcsp dcsp dcsp dcsp return dcnl dcsp dcsp dcsp dcsp dcsp dnsnames append value dcnl dcsp if len dnsnames 1 dcnl dcsp dcsp raise certificateerror hostname dcsp r dcsp doesn t dcsp match dcsp either dcsp of dcsp s hostname dcsp join map repr dnsnames dcnl dcsp elif len dnsnames 1 dcnl dcsp dcsp raise certificateerror hostname dcsp r dcsp doesn t dcsp match dcsp r hostname dnsnames0 dcnl dcsp else dcnl dcsp dcsp raise certificateerror no dcsp appropriate dcsp commonname dcsp or dcsp subjectaltname dcsp fields dcsp were dcsp found
def add stderr logger level logging debug dcsp logger logging getlogger name dcnl dcsp handler logging streamhandler dcnl dcsp handler setformatter logging formatter asctime s dcsp levelname s dcsp message s dcnl dcsp logger addhandler handler dcnl dcsp logger setlevel level dcnl dcsp logger debug added dcsp a dcsp stderr dcsp logging dcsp handler dcsp to dcsp logger dcsp s name dcnl dcsp return handler
def disable warnings category exceptions httpwarning dcsp warnings simplefilter ignore category
def guess content type filename default application octetstream dcsp if filename dcnl dcsp dcsp return mimetypes guess type filename 0 or default dcnl dcsp return default
def format header param name value dcsp if not any ch in value for ch in r n dcnl dcsp dcsp result s s name value dcnl dcsp dcsp try dcnl dcsp dcsp dcsp result encode ascii dcnl dcsp dcsp except unicodeencodeerror dcnl dcsp dcsp dcsp pass dcnl dcsp dcsp else dcnl dcsp dcsp dcsp return result dcnl dcsp if not six py3 dcnl dcsp dcsp value value encode utf8 dcnl dcsp value email utils encode rfc2231 value utf8 dcnl dcsp value s s name value dcnl dcsp return value
def choose boundary dcsp return uuid4 hex
def iter field objects fields dcsp if isinstance fields dict dcnl dcsp dcsp i six iteritems fields dcnl dcsp else dcnl dcsp dcsp i iter fields dcnl dcsp for field in i dcnl dcsp dcsp if isinstance field requestfield dcnl dcsp dcsp dcsp yield field dcnl dcsp dcsp else dcnl dcsp dcsp dcsp yield requestfield from tuples field
def iter fields fields dcsp if isinstance fields dict dcnl dcsp dcsp return k v for k v in six iteritems fields dcnl dcsp return k v for k v in fields
def encode multipart formdata fields boundary none dcsp body bytesio dcnl dcsp if boundary is none dcnl dcsp dcsp boundary choose boundary dcnl dcsp for field in iter field objects fields dcnl dcsp dcsp body write b s r n boundary dcnl dcsp dcsp writer body write field render headers dcnl dcsp dcsp data field data dcnl dcsp dcsp if isinstance data int dcnl dcsp dcsp dcsp data str data dcnl dcsp dcsp if isinstance data six text type dcnl dcsp dcsp dcsp writer body write data dcnl dcsp dcsp else dcnl dcsp dcsp dcsp body write data dcnl dcsp dcsp body write r n dcnl dcsp body write b s r n boundary dcnl dcsp content type str multipart formdata dcsp boundary s boundary dcnl dcsp return body getvalue content type
def is fp closed obj dcsp try dcnl dcsp dcsp return obj closed dcnl dcsp except attributeerror dcnl dcsp dcsp pass dcnl dcsp try dcnl dcsp dcsp return obj fp is none dcnl dcsp except attributeerror dcnl dcsp dcsp pass dcnl dcsp raise valueerror unable dcsp to dcsp determine dcsp whether dcsp fp dcsp is dcsp closed
def assert header parsing headers dcsp if not isinstance headers httplib httpmessage dcnl dcsp dcsp raise typeerror expected dcsp httplib message dcsp got dcsp 0 format type headers dcnl dcsp defects getattr headers defects none dcnl dcsp get payload getattr headers get payload none dcnl dcsp unparsed data none dcnl dcsp if get payload dcnl dcsp dcsp unparsed data get payload dcnl dcsp if defects or unparsed data dcnl dcsp dcsp raise headerparsingerror defects defects unparsed data unparsed data
def is response to head response dcsp method response method dcnl dcsp if isinstance method int dcnl dcsp dcsp return method 3 dcnl dcsp return method upper head
def current time dcsp return time time
def const compare digest backport a b dcsp result abs len a len b dcnl dcsp for l r in zip bytearray a bytearray b dcnl dcsp dcsp result | l ^ r dcnl dcsp return result 0
def assert fingerprint cert fingerprint dcsp fingerprint fingerprint replace lower dcnl dcsp digest length len fingerprint dcnl dcsp hashfunc hashfunc map get digest length dcnl dcsp if not hashfunc dcnl dcsp dcsp raise sslerror fingerprint dcsp of dcsp invalid dcsp length dcsp 0 format fingerprint dcnl dcsp fingerprint bytes unhexlify fingerprint encode dcnl dcsp cert digest hashfunc cert digest dcnl dcsp if not const compare digest cert digest fingerprint bytes dcnl dcsp dcsp raise sslerror fingerprints dcsp did dcsp not dcsp match dcsp expected dcsp 0 dcsp got dcsp 1 format fingerprint hexlify cert digest
def resolve cert reqs candidate dcsp if candidate is none dcnl dcsp dcsp return cert none dcnl dcsp if isinstance candidate str dcnl dcsp dcsp res getattr ssl candidate none dcnl dcsp dcsp if res is none dcnl dcsp dcsp dcsp res getattr ssl cert + candidate dcnl dcsp dcsp return res dcnl dcsp return candidate
def resolve ssl version candidate dcsp if candidate is none dcnl dcsp dcsp return protocol sslv23 dcnl dcsp if isinstance candidate str dcnl dcsp dcsp res getattr ssl candidate none dcnl dcsp dcsp if res is none dcnl dcsp dcsp dcsp res getattr ssl protocol + candidate dcnl dcsp dcsp return res dcnl dcsp return candidate
def create urllib3 context ssl version none cert reqs none options none ciphers none dcsp context sslcontext ssl version or ssl protocol sslv23 dcnl dcsp cert reqs ssl cert required if cert reqs is none else cert reqs dcnl dcsp if options is none dcnl dcsp dcsp options 0 dcnl dcsp dcsp options | op no sslv2 dcnl dcsp dcsp options | op no sslv3 dcnl dcsp dcsp options | op no compression dcnl dcsp context options | options dcnl dcsp if getattr context supports set ciphers true dcnl dcsp dcsp context set ciphers ciphers or default ciphers dcnl dcsp context verify mode cert reqs dcnl dcsp if getattr context check hostname none is not none dcnl dcsp dcsp context check hostname false dcnl dcsp return context
def ssl wrap socket sock keyfile none certfile none cert reqs none ca certs none server hostname none ssl version none ciphers none ssl context none ca cert dir none dcsp context ssl context dcnl dcsp if context is none dcnl dcsp dcsp context create urllib3 context ssl version cert reqs ciphers ciphers dcnl dcsp if ca certs or ca cert dir dcnl dcsp dcsp try dcnl dcsp dcsp dcsp context load verify locations ca certs ca cert dir dcnl dcsp dcsp except ioerror as e dcnl dcsp dcsp dcsp raise sslerror e dcnl dcsp dcsp except oserror as e dcnl dcsp dcsp dcsp if e errno errno enoent dcnl dcsp dcsp dcsp dcsp raise sslerror e dcnl dcsp dcsp dcsp raise dcnl dcsp if certfile dcnl dcsp dcsp context load cert chain certfile keyfile dcnl dcsp if has sni dcnl dcsp dcsp return context wrap socket sock server hostname server hostname dcnl dcsp warnings warn an dcsp https dcsp request dcsp has dcsp been dcsp made dcsp but dcsp the dcsp sni dcsp subject dcsp name dcsp indication dcsp extension dcsp to dcsp tls dcsp is dcsp not dcsp available dcsp on dcsp this dcsp platform dcsp this dcsp may dcsp cause dcsp the dcsp server dcsp to dcsp present dcsp an dcsp incorrect dcsp tls dcsp certificate dcsp which dcsp can dcsp cause dcsp validation dcsp failures dcsp for dcsp more dcsp information dcsp see dcsp https urllib3 readthedocs org en latest security html snimissingwarning snimissingwarning dcnl dcsp return context wrap socket sock
def is connection dropped conn dcsp sock getattr conn sock false dcnl dcsp if sock is false dcnl dcsp dcsp return false dcnl dcsp if sock is none dcnl dcsp dcsp return true dcnl dcsp if not poll dcnl dcsp dcsp if not select dcnl dcsp dcsp dcsp return false dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return select sock 0 0 0 dcnl dcsp dcsp except socket error dcnl dcsp dcsp dcsp return true dcnl dcsp p poll dcnl dcsp p register sock pollin dcnl dcsp for fno ev in p poll 0 0 dcnl dcsp dcsp if fno sock fileno dcnl dcsp dcsp dcsp return true
def create connection address timeout socket global default timeout source address none socket options none dcsp host port address dcnl dcsp if host startswith dcnl dcsp dcsp host host strip dcnl dcsp err none dcnl dcsp for res in socket getaddrinfo host port 0 socket sock stream dcnl dcsp dcsp af socktype proto canonname sa res dcnl dcsp dcsp sock none dcnl dcsp dcsp try dcnl dcsp dcsp dcsp sock socket socket af socktype proto dcnl dcsp dcsp dcsp set socket options sock socket options dcnl dcsp dcsp dcsp if timeout is not socket global default timeout dcnl dcsp dcsp dcsp dcsp sock settimeout timeout dcnl dcsp dcsp dcsp if source address dcnl dcsp dcsp dcsp dcsp sock bind source address dcnl dcsp dcsp dcsp sock connect sa dcnl dcsp dcsp dcsp return sock dcnl dcsp dcsp except socket error as e dcnl dcsp dcsp dcsp err e dcnl dcsp dcsp dcsp if sock is not none dcnl dcsp dcsp dcsp dcsp sock close dcnl dcsp dcsp dcsp dcsp sock none dcnl dcsp if err is not none dcnl dcsp dcsp raise err dcnl dcsp raise socket error getaddrinfo dcsp returns dcsp an dcsp empty dcsp list
def split first s delims dcsp min idx none dcnl dcsp min delim none dcnl dcsp for d in delims dcnl dcsp dcsp idx s find d dcnl dcsp dcsp if idx < 0 dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if min idx is none or idx < min idx dcnl dcsp dcsp dcsp min idx idx dcnl dcsp dcsp dcsp min delim d dcnl dcsp if min idx is none or min idx < 0 dcnl dcsp dcsp return s none dcnl dcsp return s min idx s min idx + 1 min delim
def parse url url dcsp if not url dcnl dcsp dcsp return url dcnl dcsp scheme none dcnl dcsp auth none dcnl dcsp host none dcnl dcsp port none dcnl dcsp path none dcnl dcsp fragment none dcnl dcsp query none dcnl dcsp if in url dcnl dcsp dcsp scheme url url split 1 dcnl dcsp url path delim split first url dcnl dcsp if delim dcnl dcsp dcsp path delim + path dcnl dcsp if in url dcnl dcsp dcsp auth url url rsplit 1 dcnl dcsp if url and url0 dcnl dcsp dcsp host url url split 1 dcnl dcsp dcsp host + dcnl dcsp if in url dcnl dcsp dcsp host port url split 1 dcnl dcsp dcsp if not host dcnl dcsp dcsp dcsp host host dcnl dcsp dcsp if port dcnl dcsp dcsp dcsp if not port isdigit dcnl dcsp dcsp dcsp dcsp raise locationparseerror url dcnl dcsp dcsp dcsp port int port dcnl dcsp dcsp else dcnl dcsp dcsp dcsp port none dcnl dcsp elif not host and url dcnl dcsp dcsp host url dcnl dcsp if not path dcnl dcsp dcsp return url scheme auth host port path query fragment dcnl dcsp if in path dcnl dcsp dcsp path fragment path split 1 dcnl dcsp if in path dcnl dcsp dcsp path query path split 1 dcnl dcsp return url scheme auth host port path query fragment
def get host url dcsp p parse url url dcnl dcsp return p scheme or http p hostname p port
def make headers keep alive none accept encoding none user agent none basic auth none proxy basic auth none disable cache none dcsp headers dcnl dcsp if accept encoding dcnl dcsp dcsp if isinstance accept encoding str dcnl dcsp dcsp dcsp pass dcnl dcsp dcsp elif isinstance accept encoding list dcnl dcsp dcsp dcsp accept encoding join accept encoding dcnl dcsp dcsp else dcnl dcsp dcsp dcsp accept encoding accept encoding dcnl dcsp dcsp headers acceptencoding accept encoding dcnl dcsp if user agent dcnl dcsp dcsp headers useragent user agent dcnl dcsp if keep alive dcnl dcsp dcsp headers connection keepalive dcnl dcsp if basic auth dcnl dcsp dcsp headers authorization basic dcsp + b64encode b basic auth decode utf8 dcnl dcsp if proxy basic auth dcnl dcsp dcsp headers proxyauthorization basic dcsp + b64encode b proxy basic auth decode utf8 dcnl dcsp if disable cache dcnl dcsp dcsp headers cachecontrol nocache dcnl dcsp return headers
def connection from url url kw dcsp scheme host port get host url dcnl dcsp if scheme https dcnl dcsp dcsp return httpsconnectionpool host port port kw dcnl dcsp else dcnl dcsp dcsp return httpconnectionpool host port port kw
def inject into urllib3 dcsp connection ssl wrap socket ssl wrap socket dcnl dcsp util has sni has sni
def extract from urllib3 dcsp connection ssl wrap socket orig connection ssl wrap socket dcnl dcsp util has sni orig util has sni
def basic auth str username password dcsp authstr basic dcsp + to native string b64encode s s username password encode latin1 strip dcnl dcsp return authstr
def dispatch hook key hooks hook data kwargs dcsp hooks hooks or dict dcnl dcsp hooks hooks get key dcnl dcsp if hooks dcnl dcsp dcsp if hasattr hooks call dcnl dcsp dcsp dcsp hooks hooks dcnl dcsp dcsp for hook in hooks dcnl dcsp dcsp dcsp hook data hook hook data kwargs dcnl dcsp dcsp dcsp if hook data is not none dcnl dcsp dcsp dcsp dcsp hook data hook data dcnl dcsp return hook data
def merge setting request setting session setting dict class ordereddict dcsp if session setting is none dcnl dcsp dcsp return request setting dcnl dcsp if request setting is none dcnl dcsp dcsp return session setting dcnl dcsp if not isinstance session setting mapping and isinstance request setting mapping dcnl dcsp dcsp return request setting dcnl dcsp merged setting dict class to key val list session setting dcnl dcsp merged setting update to key val list request setting dcnl dcsp none keys k for k v in merged setting items if v is none dcnl dcsp for key in none keys dcnl dcsp dcsp del merged settingkey dcnl dcsp return merged setting
def merge hooks request hooks session hooks dict class ordereddict dcsp if session hooks is none or session hooks get response dcnl dcsp dcsp return request hooks dcnl dcsp if request hooks is none or request hooks get response dcnl dcsp dcsp return session hooks dcnl dcsp return merge setting request hooks session hooks dict class
def session dcsp return session
def request method url kwargs dcsp with sessions session as session dcnl dcsp dcsp return session request method method url url kwargs
def get url params none kwargs dcsp kwargs setdefault allow redirects true dcnl dcsp return request get url params params kwargs
def options url kwargs dcsp kwargs setdefault allow redirects true dcnl dcsp return request options url kwargs
def head url kwargs dcsp kwargs setdefault allow redirects false dcnl dcsp return request head url kwargs
def post url data none json none kwargs dcsp return request post url data data json json kwargs
def put url data none kwargs dcsp return request put url data data kwargs
def patch url data none kwargs dcsp return request patch url data data kwargs
def delete url kwargs dcsp return request delete url kwargs
def add doc func doc dcsp func doc doc
def import module name dcsp import name dcnl dcsp return sys modulesname
def add move move dcsp setattr moveditems move name move
def remove move name dcsp try dcnl dcsp dcsp delattr moveditems name dcnl dcsp except attributeerror dcnl dcsp dcsp try dcnl dcsp dcsp dcsp del moves dict name dcnl dcsp dcsp except keyerror dcnl dcsp dcsp dcsp raise attributeerror no dcsp such dcsp move dcsp r name
def with metaclass meta bases dcsp class metaclass meta dcnl dcsp dcsp def new cls name this bases d dcnl dcsp dcsp dcsp return meta name bases d dcnl dcsp return type new metaclass temporary class
def add metaclass metaclass dcsp def wrapper cls dcnl dcsp dcsp orig vars cls dict copy dcnl dcsp dcsp slots orig vars get slots dcnl dcsp dcsp if slots is not none dcnl dcsp dcsp dcsp if isinstance slots str dcnl dcsp dcsp dcsp dcsp slots slots dcnl dcsp dcsp dcsp for slots var in slots dcnl dcsp dcsp dcsp dcsp orig vars pop slots var dcnl dcsp dcsp orig vars pop dict none dcnl dcsp dcsp orig vars pop weakref none dcnl dcsp dcsp return metaclass cls name cls bases orig vars dcnl dcsp return wrapper
def python 2 unicode compatible klass dcsp if py2 dcnl dcsp dcsp if str not in klass dict dcnl dcsp dcsp dcsp raise valueerror python 2 unicode compatible dcsp cannot dcsp be dcsp applied dcsp to dcsp s dcsp because dcsp it dcsp doesn t dcsp define dcsp str klass name dcnl dcsp dcsp klass unicode klass str dcnl dcsp dcsp klass str lambda self self unicode encode utf8 dcnl dcsp return klass
def from file filename mime false dcsp m get magic type mime dcnl dcsp return m from file filename
def from buffer buffer mime false dcsp m get magic type mime dcnl dcsp return m from buffer buffer
def parse url url dcsp if not in url dcnl dcsp dcsp raise valueerror url dcsp is dcsp invalid dcnl dcsp scheme url url split 1 dcnl dcsp parsed urlparse url scheme ws dcnl dcsp if parsed hostname dcnl dcsp dcsp hostname parsed hostname dcnl dcsp else dcnl dcsp dcsp raise valueerror hostname dcsp is dcsp invalid dcnl dcsp port 0 dcnl dcsp if parsed port dcnl dcsp dcsp port parsed port dcnl dcsp is secure false dcnl dcsp if scheme ws dcnl dcsp dcsp if not port dcnl dcsp dcsp dcsp port 80 dcnl dcsp elif scheme wss dcnl dcsp dcsp is secure true dcnl dcsp dcsp if not port dcnl dcsp dcsp dcsp port 443 dcnl dcsp else dcnl dcsp dcsp raise valueerror scheme dcsp s dcsp is dcsp invalid scheme dcnl dcsp if parsed path dcnl dcsp dcsp resource parsed path dcnl dcsp else dcnl dcsp dcsp resource dcnl dcsp if parsed query dcnl dcsp dcsp resource + + parsed query dcnl dcsp return hostname port resource is secure
def get proxy info hostname is secure proxy host none proxy port 0 proxy auth none no proxy none dcsp if is no proxy host hostname no proxy dcnl dcsp dcsp return none 0 none dcnl dcsp if proxy host dcnl dcsp dcsp port proxy port dcnl dcsp dcsp auth proxy auth dcnl dcsp dcsp return proxy host port auth dcnl dcsp env keys http proxy dcnl dcsp if is secure dcnl dcsp dcsp env keys insert 0 https proxy dcnl dcsp for key in env keys dcnl dcsp dcsp value os environ get key none dcnl dcsp dcsp if value dcnl dcsp dcsp dcsp proxy urlparse value dcnl dcsp dcsp dcsp auth proxy username proxy password if proxy username else none dcnl dcsp dcsp dcsp return proxy hostname proxy port auth dcnl dcsp return none 0 none
def setdefaulttimeout timeout dcsp global default timeout dcnl dcsp default timeout timeout
def getdefaulttimeout dcsp return default timeout
def create connection url timeout none class websocket options dcsp sockopt options pop sockopt dcnl dcsp sslopt options pop sslopt dcnl dcsp fire cont frame options pop fire cont frame false dcnl dcsp enable multithread options pop enable multithread false dcnl dcsp skip utf8 validation options pop skip utf8 validation false dcnl dcsp websock class sockopt sockopt sslopt sslopt fire cont frame fire cont frame enable multithread enable multithread skip utf8 validation skip utf8 validation options dcnl dcsp websock settimeout timeout if timeout is not none else getdefaulttimeout dcnl dcsp websock connect url options dcnl dcsp return websock
def enabletrace tracable dcsp global traceenabled dcnl dcsp traceenabled tracable dcnl dcsp if tracable dcnl dcsp dcsp if not logger handlers dcnl dcsp dcsp dcsp logger addhandler logging streamhandler dcnl dcsp dcsp logger setlevel logging debug
def validate utf8 utfbytes dcsp return validate utf8 utfbytes
def register treebuilders from module dcsp this module sys modules bs4 builder dcnl dcsp for name in module all dcnl dcsp dcsp obj getattr module name dcnl dcsp dcsp if issubclass obj treebuilder dcnl dcsp dcsp dcsp setattr this module name obj dcnl dcsp dcsp dcsp this module all append name dcnl dcsp dcsp dcsp this module builder registry register obj
def alias attr dcsp property dcnl dcsp def alias self dcnl dcsp dcsp return getattr self attr dcnl dcsp alias setter dcnl dcsp def alias self dcnl dcsp dcsp return setattr self attr dcnl dcsp return alias
def scan stream loader loader dcsp loader loader stream dcnl dcsp try dcnl dcsp dcsp while loader check token dcnl dcsp dcsp dcsp yield loader get token dcnl dcsp finally dcnl dcsp dcsp loader dispose
def parse stream loader loader dcsp loader loader stream dcnl dcsp try dcnl dcsp dcsp while loader check event dcnl dcsp dcsp dcsp yield loader get event dcnl dcsp finally dcnl dcsp dcsp loader dispose
def compose stream loader loader dcsp loader loader stream dcnl dcsp try dcnl dcsp dcsp return loader get single node dcnl dcsp finally dcnl dcsp dcsp loader dispose
def compose all stream loader loader dcsp loader loader stream dcnl dcsp try dcnl dcsp dcsp while loader check node dcnl dcsp dcsp dcsp yield loader get node dcnl dcsp finally dcnl dcsp dcsp loader dispose
def load stream loader loader dcsp loader loader stream dcnl dcsp try dcnl dcsp dcsp return loader get single data dcnl dcsp finally dcnl dcsp dcsp loader dispose
def load all stream loader loader dcsp loader loader stream dcnl dcsp try dcnl dcsp dcsp while loader check data dcnl dcsp dcsp dcsp yield loader get data dcnl dcsp finally dcnl dcsp dcsp loader dispose
def safe load stream dcsp return load stream safeloader
def safe load all stream dcsp return load all stream safeloader
def emit events stream none dumper dumper canonical none indent none width none allow unicode none line break none dcsp getvalue none dcnl dcsp if stream is none dcnl dcsp dcsp from stringio import stringio dcnl dcsp dcsp stream stringio dcnl dcsp dcsp getvalue stream getvalue dcnl dcsp dumper dumper stream canonical canonical indent indent width width allow unicode allow unicode line break line break dcnl dcsp try dcnl dcsp dcsp for event in events dcnl dcsp dcsp dcsp dumper emit event dcnl dcsp finally dcnl dcsp dcsp dumper dispose dcnl dcsp if getvalue dcnl dcsp dcsp return getvalue
def serialize all nodes stream none dumper dumper canonical none indent none width none allow unicode none line break none encoding utf8 explicit start none explicit end none version none tags none dcsp getvalue none dcnl dcsp if stream is none dcnl dcsp dcsp if encoding is none dcnl dcsp dcsp dcsp from stringio import stringio dcnl dcsp dcsp else dcnl dcsp dcsp dcsp from cstringio import stringio dcnl dcsp dcsp stream stringio dcnl dcsp dcsp getvalue stream getvalue dcnl dcsp dumper dumper stream canonical canonical indent indent width width allow unicode allow unicode line break line break encoding encoding version version tags tags explicit start explicit start explicit end explicit end dcnl dcsp try dcnl dcsp dcsp dumper open dcnl dcsp dcsp for node in nodes dcnl dcsp dcsp dcsp dumper serialize node dcnl dcsp dcsp dumper close dcnl dcsp finally dcnl dcsp dcsp dumper dispose dcnl dcsp if getvalue dcnl dcsp dcsp return getvalue
def serialize node stream none dumper dumper kwds dcsp return serialize all node stream dumper dumper kwds
def dump all documents stream none dumper dumper default style none default flow style none canonical none indent none width none allow unicode none line break none encoding utf8 explicit start none explicit end none version none tags none dcsp getvalue none dcnl dcsp if stream is none dcnl dcsp dcsp if encoding is none dcnl dcsp dcsp dcsp from stringio import stringio dcnl dcsp dcsp else dcnl dcsp dcsp dcsp from cstringio import stringio dcnl dcsp dcsp stream stringio dcnl dcsp dcsp getvalue stream getvalue dcnl dcsp dumper dumper stream default style default style default flow style default flow style canonical canonical indent indent width width allow unicode allow unicode line break line break encoding encoding version version tags tags explicit start explicit start explicit end explicit end dcnl dcsp try dcnl dcsp dcsp dumper open dcnl dcsp dcsp for data in documents dcnl dcsp dcsp dcsp dumper represent data dcnl dcsp dcsp dumper close dcnl dcsp finally dcnl dcsp dcsp dumper dispose dcnl dcsp if getvalue dcnl dcsp dcsp return getvalue
def dump data stream none dumper dumper kwds dcsp return dump all data stream dumper dumper kwds
def safe dump all documents stream none kwds dcsp return dump all documents stream dumper safedumper kwds
def safe dump data stream none kwds dcsp return dump all data stream dumper safedumper kwds
def add implicit resolver tag regexp first none loader loader dumper dumper dcsp loader add implicit resolver tag regexp first dcnl dcsp dumper add implicit resolver tag regexp first
def add path resolver tag path kind none loader loader dumper dumper dcsp loader add path resolver tag path kind dcnl dcsp dumper add path resolver tag path kind
def add constructor tag constructor loader loader dcsp loader add constructor tag constructor
def add multi constructor tag prefix multi constructor loader loader dcsp loader add multi constructor tag prefix multi constructor
def add representer data type representer dumper dumper dcsp dumper add representer data type representer
def add multi representer data type multi representer dumper dumper dcsp dumper add multi representer data type multi representer
def order x noneislast true decreasing false dcsp omitnone false dcnl dcsp if noneislast is none dcnl dcsp dcsp noneislast true dcnl dcsp dcsp omitnone true dcnl dcsp n len x dcnl dcsp ix range n dcnl dcsp if none not in x dcnl dcsp dcsp ix sort reverse decreasing key lambda j xj dcnl dcsp else dcnl dcsp dcsp def key i x x dcnl dcsp dcsp dcsp elem xi dcnl dcsp dcsp dcsp if decreasing noneislast dcnl dcsp dcsp dcsp dcsp return not elem is none elem dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp return elem is none elem dcnl dcsp dcsp ix range n dcnl dcsp dcsp ix sort key key reverse decreasing dcnl dcsp if omitnone dcnl dcsp dcsp n len x dcnl dcsp dcsp for i in range n 1 1 1 dcnl dcsp dcsp dcsp if xixi is none dcnl dcsp dcsp dcsp dcsp n 1 dcnl dcsp dcsp return ix n dcnl dcsp return ix
def rank x noneislast true decreasing false ties first dcsp omitnone false dcnl dcsp if noneislast is none dcnl dcsp dcsp noneislast true dcnl dcsp dcsp omitnone true dcnl dcsp o order x noneislast noneislast decreasing decreasing dcnl dcsp r o dcnl dcsp n len o dcnl dcsp for i in range n dcnl dcsp dcsp roi i dcnl dcsp if ties first or ties not in first average min max random dcnl dcsp dcsp return r dcnl dcsp blocks dcnl dcsp newblock dcnl dcsp for i in range 1 n dcnl dcsp dcsp if xoi xo i 1 dcnl dcsp dcsp dcsp if i 1 not in newblock dcnl dcsp dcsp dcsp dcsp newblock append i 1 dcnl dcsp dcsp dcsp newblock append i dcnl dcsp dcsp elif len newblock 0 dcnl dcsp dcsp dcsp blocks append newblock dcnl dcsp dcsp dcsp newblock dcnl dcsp if len newblock 0 dcnl dcsp dcsp blocks append newblock dcnl dcsp for i block in enumerate blocks dcnl dcsp dcsp if xoblock0 is none dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if ties average dcnl dcsp dcsp dcsp s 0 0 dcnl dcsp dcsp dcsp for j in block dcnl dcsp dcsp dcsp dcsp s + j dcnl dcsp dcsp dcsp s float len block dcnl dcsp dcsp dcsp for j in block dcnl dcsp dcsp dcsp dcsp roj s dcnl dcsp dcsp elif ties min dcnl dcsp dcsp dcsp s min block dcnl dcsp dcsp dcsp for j in block dcnl dcsp dcsp dcsp dcsp roj s dcnl dcsp dcsp elif ties max dcnl dcsp dcsp dcsp s max block dcnl dcsp dcsp dcsp for j in block dcnl dcsp dcsp dcsp dcsp roj s dcnl dcsp dcsp else dcnl dcsp dcsp dcsp for i j in enumerate block dcnl dcsp dcsp dcsp dcsp roj j dcnl dcsp if omitnone dcnl dcsp dcsp r rj for j in range n if xj is not none dcnl dcsp return r
def fuzzy search query elements key lambda x x rank true seq 3 dcsp r match rank query key el for el in elements seq seq dcnl dcsp out el ri for i el in enumerate elements if ri is not none dcnl dcsp return el0 for el in sorted out key lambda el el1
def install cache cache name cache backend sqlite expire after none allowable codes 200 allowable methods get session factory cachedsession backend options dcsp patch session factory lambda session factory cache name cache name backend backend expire after expire after allowable codes allowable codes allowable methods allowable methods backend options
def uninstall cache dcsp patch session factory originalsession
contextmanager dcnl def disabled dcsp previous requests session dcnl dcsp uninstall cache dcnl dcsp try dcnl dcsp dcsp yield dcnl dcsp finally dcnl dcsp dcsp patch session factory previous
def get cache dcsp return requests session cache
def clear dcsp get cache clear
def dict to sequence d dcsp if hasattr d items dcnl dcsp dcsp d d items dcnl dcsp return d
def get netrc auth url dcsp try dcnl dcsp dcsp locations os path expanduser ~ 0 format f for f in netrc files dcnl dcsp dcsp netrc path none dcnl dcsp dcsp for loc in locations dcnl dcsp dcsp dcsp if os path exists loc and not netrc path dcnl dcsp dcsp dcsp dcsp netrc path loc dcnl dcsp dcsp if netrc path is none dcnl dcsp dcsp dcsp return netrc path dcnl dcsp dcsp ri urlparse url dcnl dcsp dcsp host ri netloc split 0 dcnl dcsp dcsp try dcnl dcsp dcsp dcsp netrc netrc netrc path authenticators host dcnl dcsp dcsp dcsp if netrc dcnl dcsp dcsp dcsp dcsp login i 0 if netrc0 else 1 dcnl dcsp dcsp dcsp dcsp return netrclogin i netrc2 dcnl dcsp dcsp except netrcparseerror ioerror dcnl dcsp dcsp dcsp pass dcnl dcsp except importerror attributeerror dcnl dcsp dcsp pass
def guess filename obj dcsp name getattr obj name none dcnl dcsp if name and name0 < and name 1 dcnl dcsp dcsp return os path basename name
def from key val list value dcsp if value is none dcnl dcsp dcsp return none dcnl dcsp if isinstance value str bytes bool int dcnl dcsp dcsp raise valueerror cannot dcsp encode dcsp objects dcsp that dcsp are dcsp not dcsp 2tuples dcnl dcsp return ordereddict value
def to key val list value dcsp if value is none dcnl dcsp dcsp return none dcnl dcsp if isinstance value str bytes bool int dcnl dcsp dcsp raise valueerror cannot dcsp encode dcsp objects dcsp that dcsp are dcsp not dcsp 2tuples dcnl dcsp if isinstance value dict dcnl dcsp dcsp value value items dcnl dcsp return list value
def parse list header value dcsp result dcnl dcsp for item in parse list header value dcnl dcsp dcsp if item 1 item 1 dcnl dcsp dcsp dcsp item unquote header value item1 1 dcnl dcsp dcsp result append item dcnl dcsp return result
def parse dict header value dcsp result dcnl dcsp for item in parse list header value dcnl dcsp dcsp if not in item dcnl dcsp dcsp dcsp resultitem none dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp name value item split 1 dcnl dcsp dcsp if value 1 value 1 dcnl dcsp dcsp dcsp value unquote header value value1 1 dcnl dcsp dcsp resultname value dcnl dcsp return result
def unquote header value value is filename false dcsp if value and value0 value 1 dcnl dcsp dcsp value value1 1 dcnl dcsp dcsp if not is filename or value 2 dcnl dcsp dcsp dcsp return value replace replace dcnl dcsp return value
def dict from cookiejar cj dcsp cookie dict dcnl dcsp for cookie in cj dcnl dcsp dcsp cookie dictcookie name cookie value dcnl dcsp return cookie dict
def add dict to cookiejar cj cookie dict dcsp cj2 cookiejar from dict cookie dict dcnl dcsp cj update cj2 dcnl dcsp return cj
def get encodings from content content dcsp charset re re compile <meta charset + flags re i dcnl dcsp return charset re findall content
def get encoding from headers headers dcsp content type headers get contenttype dcnl dcsp if not content type dcnl dcsp dcsp return none dcnl dcsp content type params cgi parse header content type dcnl dcsp if charset in params dcnl dcsp dcsp return params charset strip dcnl dcsp if text in content type dcnl dcsp dcsp return iso88591
def stream decode response unicode iterator r dcsp if r encoding is none dcnl dcsp dcsp for item in iterator dcnl dcsp dcsp dcsp yield item dcnl dcsp dcsp return dcnl dcsp decoder codecs getincrementaldecoder r encoding errors replace dcnl dcsp for chunk in iterator dcnl dcsp dcsp rv decoder decode chunk dcnl dcsp dcsp if rv dcnl dcsp dcsp dcsp yield rv dcnl dcsp rv decoder decode final true dcnl dcsp if rv dcnl dcsp dcsp yield rv
def iter slices string slice length dcsp pos 0 dcnl dcsp while pos < len string dcnl dcsp dcsp yield stringpos pos + slice length dcnl dcsp dcsp pos + slice length
def get unicode from response r dcsp tried encodings dcnl dcsp encoding get encoding from headers r headers dcnl dcsp if encoding dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return str r content encoding dcnl dcsp dcsp except unicodeerror dcnl dcsp dcsp dcsp tried encodings append encoding dcnl dcsp try dcnl dcsp dcsp return str r content encoding errors replace dcnl dcsp except typeerror dcnl dcsp dcsp return r content
def unquote unreserved uri dcsp parts uri split dcnl dcsp for i in range 1 len parts dcnl dcsp dcsp h partsi0 2 dcnl dcsp dcsp if len h 2 and h isalnum dcnl dcsp dcsp dcsp c chr int h 16 dcnl dcsp dcsp dcsp if c in unreserved set dcnl dcsp dcsp dcsp dcsp partsi c + partsi2 dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp partsi + partsi dcnl dcsp dcsp else dcnl dcsp dcsp dcsp partsi + partsi dcnl dcsp return join parts
def requote uri uri dcsp return quote unquote unreserved uri safe + ~
def get environ proxies url dcsp proxy keys all http https ftp socks dcnl dcsp get proxy lambda k os environ get k or os environ get k upper dcnl dcsp no proxy get proxy no proxy dcnl dcsp if no proxy dcnl dcsp dcsp no proxy no proxy split dcnl dcsp dcsp netloc urlparse url netloc dcnl dcsp dcsp for host in no proxy dcnl dcsp dcsp dcsp if netloc endswith host or netloc split 0 endswith host dcnl dcsp dcsp dcsp dcsp return dcnl dcsp proxies key get proxy key + proxy for key in proxy keys dcnl dcsp return dict key val for key val in proxies if val
def default user agent dcsp implementation platform python implementation dcnl dcsp if implementation cpython dcnl dcsp dcsp implementation version platform python version dcnl dcsp elif implementation pypy dcnl dcsp dcsp implementation version s s s sys pypy version info major sys pypy version info minor sys pypy version info micro dcnl dcsp dcsp if sys pypy version info releaselevel final dcnl dcsp dcsp dcsp implementation version join implementation version sys pypy version info releaselevel dcnl dcsp elif implementation jython dcnl dcsp dcsp implementation version platform python version dcnl dcsp elif implementation ironpython dcnl dcsp dcsp implementation version platform python version dcnl dcsp else dcnl dcsp dcsp implementation version unknown dcnl dcsp try dcnl dcsp dcsp p system platform system dcnl dcsp dcsp p release platform release dcnl dcsp except ioerror dcnl dcsp dcsp p system unknown dcnl dcsp dcsp p release unknown dcnl dcsp return dcsp join pythonrequests s version s s implementation implementation version s s p system p release
def parse header links value dcsp links dcnl dcsp replace chars dcsp dcnl dcsp for val in value split dcnl dcsp dcsp try dcnl dcsp dcsp dcsp url params val split 1 dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp url params val dcnl dcsp dcsp link dcnl dcsp dcsp link url url strip < dcsp dcnl dcsp dcsp for param in params split dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp key value param split dcnl dcsp dcsp dcsp except valueerror dcnl dcsp dcsp dcsp dcsp break dcnl dcsp dcsp dcsp linkkey strip replace chars value strip replace chars dcnl dcsp dcsp links append link dcnl dcsp return links
def prepend scheme if needed url new scheme dcsp scheme netloc path params query fragment urlparse url new scheme dcnl dcsp if not netloc dcnl dcsp dcsp netloc path path netloc dcnl dcsp return urlunparse scheme netloc path params query fragment
def get auth from url url dcsp if url dcnl dcsp dcsp parsed urlparse url dcnl dcsp dcsp return parsed username parsed password dcnl dcsp else dcnl dcsp dcsp return
def extract cookies to jar jar request response dcsp req mockrequest request dcnl dcsp res mockresponse response original response msg dcnl dcsp jar extract cookies res req
def get cookie header jar request dcsp r mockrequest request dcnl dcsp jar add cookie header r dcnl dcsp return r get new headers get cookie
def remove cookie by name cookiejar name domain none path none dcsp clearables dcnl dcsp for cookie in cookiejar dcnl dcsp dcsp if cookie name name dcnl dcsp dcsp dcsp if domain is none or domain cookie domain dcnl dcsp dcsp dcsp dcsp if path is none or path cookie path dcnl dcsp dcsp dcsp dcsp dcsp clearables append cookie domain cookie path cookie name dcnl dcsp for domain path name in clearables dcnl dcsp dcsp cookiejar clear domain path name
def create cookie name value kwargs dcsp result dict version 0 name name value value port none domain path secure false expires none discard true comment none comment url none rest httponly none rfc2109 false dcnl dcsp badargs set kwargs set result dcnl dcsp if badargs dcnl dcsp dcsp err create cookie dcsp got dcsp unexpected dcsp keyword dcsp arguments dcsp s dcnl dcsp dcsp raise typeerror err list badargs dcnl dcsp result update kwargs dcnl dcsp result port specified bool result port dcnl dcsp result domain specified bool result domain dcnl dcsp result domain initial dot result domain startswith dcnl dcsp result path specified bool result path dcnl dcsp return cookielib cookie result
def morsel to cookie morsel dcsp c create cookie name morsel key value morsel value version morsel version or 0 port none port specified false domain morsel domain domain specified bool morsel domain domain initial dot morsel domain startswith path morsel path path specified bool morsel path secure bool morsel secure expires morsel maxage or morsel expires discard false comment morsel comment comment url bool morsel comment rest httponly morsel httponly rfc2109 false dcnl dcsp return c
def cookiejar from dict cookie dict cookiejar none dcsp if cookiejar is none dcnl dcsp dcsp cookiejar requestscookiejar dcnl dcsp if cookie dict is not none dcnl dcsp dcsp for name in cookie dict dcnl dcsp dcsp dcsp cookiejar set cookie create cookie name cookie dictname dcnl dcsp return cookiejar
def add doc func doc dcsp func doc doc
def import module name dcsp import name dcnl dcsp return sys modulesname
def add move move dcsp setattr moveditems move name move
def remove move name dcsp try dcnl dcsp dcsp delattr moveditems name dcnl dcsp except attributeerror dcnl dcsp dcsp try dcnl dcsp dcsp dcsp del moves dict name dcnl dcsp dcsp except keyerror dcnl dcsp dcsp dcsp raise attributeerror no dcsp such dcsp move dcsp r name
def iterkeys d dcsp return iter getattr d iterkeys
def itervalues d dcsp return iter getattr d itervalues
def iteritems d dcsp return iter getattr d iteritems
def with metaclass meta base object dcsp return meta newbase base
def match hostname cert hostname dcsp if not cert dcnl dcsp dcsp raise valueerror empty dcsp or dcsp no dcsp certificate dcnl dcsp dnsnames dcnl dcsp san cert get subjectaltname dcnl dcsp for key value in san dcnl dcsp dcsp if key dns dcnl dcsp dcsp dcsp if dnsname to pat value match hostname dcnl dcsp dcsp dcsp dcsp return dcnl dcsp dcsp dcsp dnsnames append value dcnl dcsp if not dnsnames dcnl dcsp dcsp for sub in cert get subject dcnl dcsp dcsp dcsp for key value in sub dcnl dcsp dcsp dcsp dcsp if key commonname dcnl dcsp dcsp dcsp dcsp dcsp if dnsname to pat value match hostname dcnl dcsp dcsp dcsp dcsp dcsp dcsp return dcnl dcsp dcsp dcsp dcsp dcsp dnsnames append value dcnl dcsp if len dnsnames 1 dcnl dcsp dcsp raise certificateerror hostname dcsp r dcsp doesn t dcsp match dcsp either dcsp of dcsp s hostname dcsp join map repr dnsnames dcnl dcsp elif len dnsnames 1 dcnl dcsp dcsp raise certificateerror hostname dcsp r dcsp doesn t dcsp match dcsp r hostname dnsnames0 dcnl dcsp else dcnl dcsp dcsp raise certificateerror no dcsp appropriate dcsp commonname dcsp or dcsp subjectaltname dcsp fields dcsp were dcsp found
def add stderr logger level logging debug dcsp logger logging getlogger name dcnl dcsp handler logging streamhandler dcnl dcsp handler setformatter logging formatter asctime s dcsp levelname s dcsp message s dcnl dcsp logger addhandler handler dcnl dcsp logger setlevel level dcnl dcsp logger debug added dcsp an dcsp stderr dcsp logging dcsp handler dcsp to dcsp logger dcsp s name dcnl dcsp return handler
def split first s delims dcsp min idx none dcnl dcsp min delim none dcnl dcsp for d in delims dcnl dcsp dcsp idx s find d dcnl dcsp dcsp if idx < 0 dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if min idx is none or idx < min idx dcnl dcsp dcsp dcsp min idx idx dcnl dcsp dcsp dcsp min delim d dcnl dcsp if min idx is none or min idx < 0 dcnl dcsp dcsp return s none dcnl dcsp return s min idx s min idx + 1 min delim
def parse url url dcsp scheme none dcnl dcsp auth none dcnl dcsp host none dcnl dcsp port none dcnl dcsp path none dcnl dcsp fragment none dcnl dcsp query none dcnl dcsp if in url dcnl dcsp dcsp scheme url url split 1 dcnl dcsp url path delim split first url dcnl dcsp if delim dcnl dcsp dcsp path delim + path dcnl dcsp if in url dcnl dcsp dcsp auth url url split 1 dcnl dcsp if url and url0 dcnl dcsp dcsp host url url1 split 1 dcnl dcsp if in url dcnl dcsp dcsp host port url split 1 dcnl dcsp dcsp if not host dcnl dcsp dcsp dcsp host host dcnl dcsp dcsp if not port isdigit dcnl dcsp dcsp dcsp raise locationparseerror failed dcsp to dcsp parse dcsp s url dcnl dcsp dcsp port int port dcnl dcsp elif not host and url dcnl dcsp dcsp host url dcnl dcsp if not path dcnl dcsp dcsp return url scheme auth host port path query fragment dcnl dcsp if in path dcnl dcsp dcsp path fragment path split 1 dcnl dcsp if in path dcnl dcsp dcsp path query path split 1 dcnl dcsp return url scheme auth host port path query fragment
def get host url dcsp p parse url url dcnl dcsp return p scheme or http p hostname p port
def make headers keep alive none accept encoding none user agent none basic auth none dcsp headers dcnl dcsp if accept encoding dcnl dcsp dcsp if isinstance accept encoding str dcnl dcsp dcsp dcsp pass dcnl dcsp dcsp elif isinstance accept encoding list dcnl dcsp dcsp dcsp accept encoding join accept encoding dcnl dcsp dcsp else dcnl dcsp dcsp dcsp accept encoding gzip deflate dcnl dcsp dcsp headers acceptencoding accept encoding dcnl dcsp if user agent dcnl dcsp dcsp headers useragent user agent dcnl dcsp if keep alive dcnl dcsp dcsp headers connection keepalive dcnl dcsp if basic auth dcnl dcsp dcsp headers authorization basic dcsp + b64encode six b basic auth decode utf8 dcnl dcsp return headers
def is connection dropped conn dcsp sock getattr conn sock false dcnl dcsp if not sock dcnl dcsp dcsp return false dcnl dcsp if not poll dcnl dcsp dcsp if not select dcnl dcsp dcsp dcsp return false dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return select sock 0 0 0 dcnl dcsp dcsp except socketerror dcnl dcsp dcsp dcsp return true dcnl dcsp p poll dcnl dcsp p register sock pollin dcnl dcsp for fno ev in p poll 0 0 dcnl dcsp dcsp if fno sock fileno dcnl dcsp dcsp dcsp return true
def resolve cert reqs candidate dcsp if candidate is none dcnl dcsp dcsp return cert none dcnl dcsp if isinstance candidate str dcnl dcsp dcsp res getattr ssl candidate none dcnl dcsp dcsp if res is none dcnl dcsp dcsp dcsp res getattr ssl cert + candidate dcnl dcsp dcsp return res dcnl dcsp return candidate
def resolve ssl version candidate dcsp if candidate is none dcnl dcsp dcsp return protocol sslv23 dcnl dcsp if isinstance candidate str dcnl dcsp dcsp res getattr ssl candidate none dcnl dcsp dcsp if res is none dcnl dcsp dcsp dcsp res getattr ssl protocol + candidate dcnl dcsp dcsp return res dcnl dcsp return candidate
def assert fingerprint cert fingerprint dcsp hashfunc map 16 md5 20 sha1 dcnl dcsp fingerprint fingerprint replace lower dcnl dcsp digest length rest divmod len fingerprint 2 dcnl dcsp if rest or digest length not in hashfunc map dcnl dcsp dcsp raise sslerror fingerprint dcsp is dcsp of dcsp invalid dcsp length dcnl dcsp fingerprint bytes unhexlify fingerprint encode dcnl dcsp hashfunc hashfunc mapdigest length dcnl dcsp cert digest hashfunc cert digest dcnl dcsp if not cert digest fingerprint bytes dcnl dcsp dcsp raise sslerror fingerprints dcsp did dcsp not dcsp match dcsp expected dcsp 0 dcsp got dcsp 1 format hexlify fingerprint bytes hexlify cert digest
def choose boundary dcsp return uuid4 hex
def iter fields fields dcsp if isinstance fields dict dcnl dcsp dcsp return k v for k v in six iteritems fields dcnl dcsp return k v for k v in fields
def encode multipart formdata fields boundary none dcsp body bytesio dcnl dcsp if boundary is none dcnl dcsp dcsp boundary choose boundary dcnl dcsp for fieldname value in iter fields fields dcnl dcsp dcsp body write b s r n boundary dcnl dcsp dcsp if isinstance value tuple dcnl dcsp dcsp dcsp if len value 3 dcnl dcsp dcsp dcsp dcsp filename data content type value dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp filename data value dcnl dcsp dcsp dcsp dcsp content type get content type filename dcnl dcsp dcsp dcsp writer body write contentdisposition dcsp formdata dcsp name s dcsp filename s r n fieldname filename dcnl dcsp dcsp dcsp body write b contenttype dcsp s r n r n content type dcnl dcsp dcsp else dcnl dcsp dcsp dcsp data value dcnl dcsp dcsp dcsp writer body write contentdisposition dcsp formdata dcsp name s r n fieldname dcnl dcsp dcsp dcsp body write r n dcnl dcsp dcsp if isinstance data int dcnl dcsp dcsp dcsp data str data dcnl dcsp dcsp if isinstance data six text type dcnl dcsp dcsp dcsp writer body write data dcnl dcsp dcsp else dcnl dcsp dcsp dcsp body write data dcnl dcsp dcsp body write r n dcnl dcsp body write b s r n boundary dcnl dcsp content type str multipart formdata dcsp boundary s boundary dcnl dcsp return body getvalue content type
def connection from url url kw dcsp scheme host port get host url dcnl dcsp if scheme https dcnl dcsp dcsp return httpsconnectionpool host port port kw dcnl dcsp else dcnl dcsp dcsp return httpconnectionpool host port port kw
def inject into urllib3 dcsp connectionpool ssl wrap socket ssl wrap socket dcnl dcsp util has sni has sni
def extract from urllib3 dcsp connectionpool ssl wrap socket orig connectionpool ssl wrap socket dcnl dcsp util has sni orig util has sni
def basic auth str username password dcsp return basic dcsp + b64encode s s username password encode latin1 strip decode latin1
def dispatch hook key hooks hook data kwargs dcsp hooks hooks or dict dcnl dcsp if key in hooks dcnl dcsp dcsp hooks hooks get key dcnl dcsp dcsp if hasattr hooks call dcnl dcsp dcsp dcsp hooks hooks dcnl dcsp dcsp for hook in hooks dcnl dcsp dcsp dcsp hook data hook hook data kwargs dcnl dcsp dcsp dcsp if hook data is not none dcnl dcsp dcsp dcsp dcsp hook data hook data dcnl dcsp return hook data
def merge kwargs local kwarg default kwarg dcsp if default kwarg is none dcnl dcsp dcsp return local kwarg dcnl dcsp if isinstance local kwarg str dcnl dcsp dcsp return local kwarg dcnl dcsp if local kwarg is none dcnl dcsp dcsp return default kwarg dcnl dcsp if not hasattr default kwarg items dcnl dcsp dcsp return local kwarg dcnl dcsp default kwarg from key val list default kwarg dcnl dcsp local kwarg from key val list local kwarg dcnl dcsp def get original key original keys new key dcnl dcsp dcsp n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp finds dcsp the dcsp key dcsp from dcsp original keys dcsp that dcsp caseinsensitive dcsp matches dcsp new key n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcnl dcsp dcsp for original key in original keys dcnl dcsp dcsp dcsp if key lower original key lower dcnl dcsp dcsp dcsp dcsp return original key dcnl dcsp dcsp return new key dcnl dcsp kwargs default kwarg copy dcnl dcsp original keys kwargs keys dcnl dcsp for key value in local kwarg items dcnl dcsp dcsp kwargsget original key original keys key value dcnl dcsp for k v in local kwarg items dcnl dcsp dcsp if v is none dcnl dcsp dcsp dcsp del kwargsk dcnl dcsp return kwargs
def session dcsp return session
def request method url kwargs dcsp session sessions session dcnl dcsp return session request method method url url kwargs
def get url kwargs dcsp kwargs setdefault allow redirects true dcnl dcsp return request get url kwargs
def options url kwargs dcsp kwargs setdefault allow redirects true dcnl dcsp return request options url kwargs
def head url kwargs dcsp kwargs setdefault allow redirects false dcnl dcsp return request head url kwargs
def post url data none kwargs dcsp return request post url data data kwargs
def put url data none kwargs dcsp return request put url data data kwargs
def patch url data none kwargs dcsp return request patch url data data kwargs
def delete url kwargs dcsp return request delete url kwargs
def where dcsp return os path join os path dirname file cacert pem
def register treebuilders from module dcsp this module sys modules alp request bs4 builder dcnl dcsp for name in module all dcnl dcsp dcsp obj getattr module name dcnl dcsp dcsp if issubclass obj treebuilder dcnl dcsp dcsp dcsp setattr this module name obj dcnl dcsp dcsp dcsp this module all append name dcnl dcsp dcsp dcsp this module builder registry register obj
def alias attr dcsp property dcnl dcsp def alias self dcnl dcsp dcsp return getattr self attr dcnl dcsp alias setter dcnl dcsp def alias self dcnl dcsp dcsp return setattr self attr dcnl dcsp return alias
def add doc func doc dcsp func doc doc
def import module name dcsp import name dcnl dcsp return sys modulesname
def add move move dcsp setattr moveditems move name move
def remove move name dcsp try dcnl dcsp dcsp delattr moveditems name dcnl dcsp except attributeerror dcnl dcsp dcsp try dcnl dcsp dcsp dcsp del moves dict name dcnl dcsp dcsp except keyerror dcnl dcsp dcsp dcsp raise attributeerror no dcsp such dcsp move dcsp r name
def iterkeys d kw dcsp return iter getattr d iterkeys kw
def itervalues d kw dcsp return iter getattr d itervalues kw
def iteritems d kw dcsp return iter getattr d iteritems kw
def iterlists d kw dcsp return iter getattr d iterlists kw
def with metaclass meta bases dcsp return meta newbase bases
def readplist pathorfile dcsp didopen false dcnl dcsp result none dcnl dcsp if isinstance pathorfile six binary type six text type dcnl dcsp dcsp pathorfile open pathorfile rb dcnl dcsp dcsp didopen true dcnl dcsp try dcnl dcsp dcsp reader plistreader pathorfile dcnl dcsp dcsp result reader parse dcnl dcsp except notbinaryplistexception as e dcnl dcsp dcsp try dcnl dcsp dcsp dcsp pathorfile seek 0 dcnl dcsp dcsp dcsp result plistlib readplist pathorfile dcnl dcsp dcsp dcsp result wrapdataobject result for binary true dcnl dcsp dcsp except exception as e dcnl dcsp dcsp dcsp raise invalidplistexception e dcnl dcsp if didopen dcnl dcsp dcsp pathorfile close dcnl dcsp return result
def createsettingsfile dcsp try dcnl dcsp dcsp with open settings path dcnl dcsp dcsp dcsp pass dcnl dcsp except ioerror dcnl dcsp dcsp file open settings path w+ dcnl dcsp dcsp file close dcnl dcsp dcsp alp writeplist default settings settings path
def createdatabase dcsp global settings dcnl dcsp conn lite connect settings sqlitedb dcnl dcsp with conn dcnl dcsp dcsp cur conn cursor dcnl dcsp dcsp cur execute create dcsp table dcsp clips id dcsp integer dcsp primary dcsp key dcsp title dcsp text dcsp subtitle dcsp text dcsp url dcsp text dcsp appurl dcsp text dcsp notes dcsp text
def udpatedatabasefromkippt dcsp global settings dcnl dcsp if not os path exists os path join alp local settings sqlitedb dcnl dcsp dcsp createdatabase dcnl dcsp clips readallclips dcnl dcsp if clips none dcnl dcsp dcsp return dcnl dcsp conn lite connect settings sqlitedb dcnl dcsp with conn dcnl dcsp dcsp cur conn cursor dcnl dcsp dcsp cur execute delete dcsp from dcsp clips dcnl dcsp dcsp for clip in clips dcnl dcsp dcsp dcsp title clip title dcnl dcsp dcsp dcsp subtitle clip title dcnl dcsp dcsp dcsp url clip url dcnl dcsp dcsp dcsp app url clip app url dcnl dcsp dcsp dcsp notes clip notes dcnl dcsp dcsp dcsp sql insert dcsp into dcsp clips dcsp values null dcnl dcsp dcsp dcsp sql + s title dcnl dcsp dcsp dcsp sql + s subtitle dcnl dcsp dcsp dcsp sql + s url dcnl dcsp dcsp dcsp sql + s app url dcnl dcsp dcsp dcsp sql + s notes dcnl dcsp dcsp dcsp sql + dcnl dcsp dcsp dcsp cur execute sql
def readallclips dcsp global settings dcnl dcsp k kippt settings username password utils getkeychainpassword dcnl dcsp clips k clips all dcnl dcsp count clips meta total count dcnl dcsp clips k clips all limit count dcnl dcsp return clips objects
def search keywords dcsp global settings dcnl dcsp if len keywords < 1 dcnl dcsp dcsp return none dcnl dcsp conn lite connect settings sqlitedb dcnl dcsp titles dcnl dcsp urls dcnl dcsp notes dcnl dcsp for word in keywords dcnl dcsp dcsp titles append title dcsp like dcsp s word dcnl dcsp dcsp urls append url dcsp like dcsp s word dcnl dcsp dcsp notes append notes dcsp like dcsp s word dcnl dcsp titles dcsp and dcsp join titles dcnl dcsp urls dcsp and dcsp join urls dcnl dcsp notes dcsp and dcsp join notes dcnl dcsp sql select dcsp title dcsp subtitle dcsp url dcsp appurl dcnl dcsp sql + dcsp from dcsp clips dcnl dcsp sql + dcsp where dcsp s dcsp or titles dcnl dcsp sql + dcsp dcsp s dcsp or dcsp urls dcnl dcsp sql + dcsp dcsp s notes dcnl dcsp alfreditems dcnl dcsp with conn dcnl dcsp dcsp cur conn cursor dcnl dcsp dcsp cur execute sql dcnl dcsp dcsp rows cur fetchall dcnl dcsp dcsp for row in rows dcnl dcsp dcsp dcsp itemdict dict title row0 subtitle row1 arg row2 valid true dcnl dcsp dcsp dcsp item alp item itemdict dcnl dcsp dcsp dcsp alfreditems append item dcnl dcsp return alfreditems
def main dcsp global settings dcnl dcsp createsettingsfile dcnl dcsp settings alp readplist settings path dcnl dcsp if settings firstrun true dcnl dcsp dcsp udpatedatabasefromkippt dcnl dcsp dcsp settings firstrun false dcnl dcsp dcsp settings credentialschanged false dcnl dcsp dcsp alp writeplist settings settings path dcnl dcsp elif settings credentialschanged true dcnl dcsp dcsp udpatedatabasefromkippt dcnl dcsp dcsp settings credentialschanged false dcnl dcsp dcsp alp writeplist settings settings path dcnl dcsp elif settings updateclips true dcnl dcsp dcsp udpatedatabasefromkippt dcnl dcsp dcsp settings updateclips false dcnl dcsp dcsp alp writeplist settings settings path dcnl dcsp args alp args dcnl dcsp if len args < 1 dcnl dcsp dcsp return dcnl dcsp items search args dcnl dcsp if items is not none dcnl dcsp dcsp alp feedback items dcnl dcsp else dcnl dcsp dcsp print no dcsp items dcsp found
def dict to sequence d dcsp if hasattr d items dcnl dcsp dcsp d d items dcnl dcsp return d
def get netrc auth url dcsp try dcnl dcsp dcsp locations os path expanduser ~ 0 format f for f in netrc files dcnl dcsp dcsp netrc path none dcnl dcsp dcsp for loc in locations dcnl dcsp dcsp dcsp if os path exists loc and not netrc path dcnl dcsp dcsp dcsp dcsp netrc path loc dcnl dcsp dcsp if netrc path is none dcnl dcsp dcsp dcsp return netrc path dcnl dcsp dcsp ri urlparse url dcnl dcsp dcsp host ri netloc split 0 dcnl dcsp dcsp try dcnl dcsp dcsp dcsp netrc netrc netrc path authenticators host dcnl dcsp dcsp dcsp if netrc dcnl dcsp dcsp dcsp dcsp login i 0 if netrc0 else 1 dcnl dcsp dcsp dcsp dcsp return netrclogin i netrc2 dcnl dcsp dcsp except netrcparseerror ioerror dcnl dcsp dcsp dcsp pass dcnl dcsp except importerror attributeerror dcnl dcsp dcsp pass
def guess filename obj dcsp name getattr obj name none dcnl dcsp if name and name0 < and name 1 dcnl dcsp dcsp return os path basename name
def from key val list value dcsp if value is none dcnl dcsp dcsp return none dcnl dcsp if isinstance value str bytes bool int dcnl dcsp dcsp raise valueerror cannot dcsp encode dcsp objects dcsp that dcsp are dcsp not dcsp 2tuples dcnl dcsp return ordereddict value
def to key val list value dcsp if value is none dcnl dcsp dcsp return none dcnl dcsp if isinstance value str bytes bool int dcnl dcsp dcsp raise valueerror cannot dcsp encode dcsp objects dcsp that dcsp are dcsp not dcsp 2tuples dcnl dcsp if isinstance value collections mapping dcnl dcsp dcsp value value items dcnl dcsp return list value
def parse list header value dcsp result dcnl dcsp for item in parse list header value dcnl dcsp dcsp if item 1 item 1 dcnl dcsp dcsp dcsp item unquote header value item1 1 dcnl dcsp dcsp result append item dcnl dcsp return result
def parse dict header value dcsp result dcnl dcsp for item in parse list header value dcnl dcsp dcsp if not in item dcnl dcsp dcsp dcsp resultitem none dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp name value item split 1 dcnl dcsp dcsp if value 1 value 1 dcnl dcsp dcsp dcsp value unquote header value value1 1 dcnl dcsp dcsp resultname value dcnl dcsp return result
def unquote header value value is filename false dcsp if value and value0 value 1 dcnl dcsp dcsp value value1 1 dcnl dcsp dcsp if not is filename or value 2 dcnl dcsp dcsp dcsp return value replace replace dcnl dcsp return value
def dict from cookiejar cj dcsp cookie dict dcnl dcsp for cookie in cj dcnl dcsp dcsp cookie dictcookie name cookie value dcnl dcsp return cookie dict
def add dict to cookiejar cj cookie dict dcsp cj2 cookiejar from dict cookie dict dcnl dcsp cj update cj2 dcnl dcsp return cj
def get encodings from content content dcsp charset re re compile <meta charset + flags re i dcnl dcsp return charset re findall content
def get encoding from headers headers dcsp content type headers get contenttype dcnl dcsp if not content type dcnl dcsp dcsp return none dcnl dcsp content type params cgi parse header content type dcnl dcsp if charset in params dcnl dcsp dcsp return params charset strip dcnl dcsp if text in content type dcnl dcsp dcsp return iso88591
def stream decode response unicode iterator r dcsp if r encoding is none dcnl dcsp dcsp for item in iterator dcnl dcsp dcsp dcsp yield item dcnl dcsp dcsp return dcnl dcsp decoder codecs getincrementaldecoder r encoding errors replace dcnl dcsp for chunk in iterator dcnl dcsp dcsp rv decoder decode chunk dcnl dcsp dcsp if rv dcnl dcsp dcsp dcsp yield rv dcnl dcsp rv decoder decode final true dcnl dcsp if rv dcnl dcsp dcsp yield rv
def iter slices string slice length dcsp pos 0 dcnl dcsp while pos < len string dcnl dcsp dcsp yield stringpos pos + slice length dcnl dcsp dcsp pos + slice length
def get unicode from response r dcsp tried encodings dcnl dcsp encoding get encoding from headers r headers dcnl dcsp if encoding dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return str r content encoding dcnl dcsp dcsp except unicodeerror dcnl dcsp dcsp dcsp tried encodings append encoding dcnl dcsp try dcnl dcsp dcsp return str r content encoding errors replace dcnl dcsp except typeerror dcnl dcsp dcsp return r content
def unquote unreserved uri dcsp parts uri split dcnl dcsp for i in range 1 len parts dcnl dcsp dcsp h partsi0 2 dcnl dcsp dcsp if len h 2 and h isalnum dcnl dcsp dcsp dcsp c chr int h 16 dcnl dcsp dcsp dcsp if c in unreserved set dcnl dcsp dcsp dcsp dcsp partsi c + partsi2 dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp partsi + partsi dcnl dcsp dcsp else dcnl dcsp dcsp dcsp partsi + partsi dcnl dcsp return join parts
def requote uri uri dcsp return quote unquote unreserved uri safe + ~
def get environ proxies url dcsp get proxy lambda k os environ get k or os environ get k upper dcnl dcsp no proxy get proxy no proxy dcnl dcsp netloc urlparse url netloc dcnl dcsp if no proxy dcnl dcsp dcsp no proxy no proxy split dcnl dcsp dcsp for host in no proxy dcnl dcsp dcsp dcsp if netloc endswith host or netloc split 0 endswith host dcnl dcsp dcsp dcsp dcsp return dcnl dcsp if proxy bypass netloc dcnl dcsp dcsp return dcnl dcsp return getproxies
def default user agent dcsp implementation platform python implementation dcnl dcsp if implementation cpython dcnl dcsp dcsp implementation version platform python version dcnl dcsp elif implementation pypy dcnl dcsp dcsp implementation version s s s sys pypy version info major sys pypy version info minor sys pypy version info micro dcnl dcsp dcsp if sys pypy version info releaselevel final dcnl dcsp dcsp dcsp implementation version join implementation version sys pypy version info releaselevel dcnl dcsp elif implementation jython dcnl dcsp dcsp implementation version platform python version dcnl dcsp elif implementation ironpython dcnl dcsp dcsp implementation version platform python version dcnl dcsp else dcnl dcsp dcsp implementation version unknown dcnl dcsp try dcnl dcsp dcsp p system platform system dcnl dcsp dcsp p release platform release dcnl dcsp except ioerror dcnl dcsp dcsp p system unknown dcnl dcsp dcsp p release unknown dcnl dcsp return dcsp join pythonrequests s version s s implementation implementation version s s p system p release
def parse header links value dcsp links dcnl dcsp replace chars dcsp dcnl dcsp for val in value split dcnl dcsp dcsp try dcnl dcsp dcsp dcsp url params val split 1 dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp url params val dcnl dcsp dcsp link dcnl dcsp dcsp link url url strip < dcsp dcnl dcsp dcsp for param in params split dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp key value param split dcnl dcsp dcsp dcsp except valueerror dcnl dcsp dcsp dcsp dcsp break dcnl dcsp dcsp dcsp linkkey strip replace chars value strip replace chars dcnl dcsp dcsp links append link dcnl dcsp return links
def prepend scheme if needed url new scheme dcsp scheme netloc path params query fragment urlparse url new scheme dcnl dcsp if not netloc dcnl dcsp dcsp netloc path path netloc dcnl dcsp return urlunparse scheme netloc path params query fragment
def get auth from url url dcsp if url dcnl dcsp dcsp parsed urlparse url dcnl dcsp dcsp return parsed username parsed password dcnl dcsp else dcnl dcsp dcsp return
def extract cookies to jar jar request response dcsp if not hasattr response original response and response original response dcnl dcsp dcsp return dcnl dcsp req mockrequest request dcnl dcsp res mockresponse response original response msg dcnl dcsp jar extract cookies res req
def get cookie header jar request dcsp r mockrequest request dcnl dcsp jar add cookie header r dcnl dcsp return r get new headers get cookie
def remove cookie by name cookiejar name domain none path none dcsp clearables dcnl dcsp for cookie in cookiejar dcnl dcsp dcsp if cookie name name dcnl dcsp dcsp dcsp if domain is none or domain cookie domain dcnl dcsp dcsp dcsp dcsp if path is none or path cookie path dcnl dcsp dcsp dcsp dcsp dcsp clearables append cookie domain cookie path cookie name dcnl dcsp for domain path name in clearables dcnl dcsp dcsp cookiejar clear domain path name
def create cookie name value kwargs dcsp result dict version 0 name name value value port none domain path secure false expires none discard true comment none comment url none rest httponly none rfc2109 false dcnl dcsp badargs set kwargs set result dcnl dcsp if badargs dcnl dcsp dcsp err create cookie dcsp got dcsp unexpected dcsp keyword dcsp arguments dcsp s dcnl dcsp dcsp raise typeerror err list badargs dcnl dcsp result update kwargs dcnl dcsp result port specified bool result port dcnl dcsp result domain specified bool result domain dcnl dcsp result domain initial dot result domain startswith dcnl dcsp result path specified bool result path dcnl dcsp return cookielib cookie result
def morsel to cookie morsel dcsp expires none dcnl dcsp if morsel maxage dcnl dcsp dcsp expires time time + morsel maxage dcnl dcsp elif morsel expires dcnl dcsp dcsp expires morsel expires dcnl dcsp dcsp if type expires type dcnl dcsp dcsp dcsp time template a dcsp d b y dcsp h m s dcsp gmt dcnl dcsp dcsp dcsp expires time mktime time strptime expires time template dcnl dcsp c create cookie name morsel key value morsel value version morsel version or 0 port none domain morsel domain path morsel path secure bool morsel secure expires expires discard false comment morsel comment comment url bool morsel comment rest httponly morsel httponly rfc2109 false dcnl dcsp return c
def cookiejar from dict cookie dict cookiejar none dcsp if cookiejar is none dcnl dcsp dcsp cookiejar requestscookiejar dcnl dcsp if cookie dict is not none dcnl dcsp dcsp for name in cookie dict dcnl dcsp dcsp dcsp cookiejar set cookie create cookie name cookie dictname dcnl dcsp return cookiejar
def add doc func doc dcsp func doc doc
def import module name dcsp import name dcnl dcsp return sys modulesname
def add move move dcsp setattr moveditems move name move
def remove move name dcsp try dcnl dcsp dcsp delattr moveditems name dcnl dcsp except attributeerror dcnl dcsp dcsp try dcnl dcsp dcsp dcsp del moves dict name dcnl dcsp dcsp except keyerror dcnl dcsp dcsp dcsp raise attributeerror no dcsp such dcsp move dcsp r name
def iterkeys d dcsp return iter getattr d iterkeys
def itervalues d dcsp return iter getattr d itervalues
def iteritems d dcsp return iter getattr d iteritems
def with metaclass meta base object dcsp return meta newbase base
def match hostname cert hostname dcsp if not cert dcnl dcsp dcsp raise valueerror empty dcsp or dcsp no dcsp certificate dcnl dcsp dnsnames dcnl dcsp san cert get subjectaltname dcnl dcsp for key value in san dcnl dcsp dcsp if key dns dcnl dcsp dcsp dcsp if dnsname to pat value match hostname dcnl dcsp dcsp dcsp dcsp return dcnl dcsp dcsp dcsp dnsnames append value dcnl dcsp if not dnsnames dcnl dcsp dcsp for sub in cert get subject dcnl dcsp dcsp dcsp for key value in sub dcnl dcsp dcsp dcsp dcsp if key commonname dcnl dcsp dcsp dcsp dcsp dcsp if dnsname to pat value match hostname dcnl dcsp dcsp dcsp dcsp dcsp dcsp return dcnl dcsp dcsp dcsp dcsp dcsp dnsnames append value dcnl dcsp if len dnsnames 1 dcnl dcsp dcsp raise certificateerror hostname dcsp r dcsp doesn t dcsp match dcsp either dcsp of dcsp s hostname dcsp join map repr dnsnames dcnl dcsp elif len dnsnames 1 dcnl dcsp dcsp raise certificateerror hostname dcsp r dcsp doesn t dcsp match dcsp r hostname dnsnames0 dcnl dcsp else dcnl dcsp dcsp raise certificateerror no dcsp appropriate dcsp commonname dcsp or dcsp subjectaltname dcsp fields dcsp were dcsp found
def add stderr logger level logging debug dcsp logger logging getlogger name dcnl dcsp handler logging streamhandler dcnl dcsp handler setformatter logging formatter asctime s dcsp levelname s dcsp message s dcnl dcsp logger addhandler handler dcnl dcsp logger setlevel level dcnl dcsp logger debug added dcsp an dcsp stderr dcsp logging dcsp handler dcsp to dcsp logger dcsp s name dcnl dcsp return handler
def split first s delims dcsp min idx none dcnl dcsp min delim none dcnl dcsp for d in delims dcnl dcsp dcsp idx s find d dcnl dcsp dcsp if idx < 0 dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if min idx is none or idx < min idx dcnl dcsp dcsp dcsp min idx idx dcnl dcsp dcsp dcsp min delim d dcnl dcsp if min idx is none or min idx < 0 dcnl dcsp dcsp return s none dcnl dcsp return s min idx s min idx + 1 min delim
def parse url url dcsp scheme none dcnl dcsp auth none dcnl dcsp host none dcnl dcsp port none dcnl dcsp path none dcnl dcsp fragment none dcnl dcsp query none dcnl dcsp if in url dcnl dcsp dcsp scheme url url split 1 dcnl dcsp url path delim split first url dcnl dcsp if delim dcnl dcsp dcsp path delim + path dcnl dcsp if in url dcnl dcsp dcsp auth url url split 1 dcnl dcsp if url and url0 dcnl dcsp dcsp host url url split 1 dcnl dcsp dcsp host + dcnl dcsp if in url dcnl dcsp dcsp host port url split 1 dcnl dcsp dcsp if not host dcnl dcsp dcsp dcsp host host dcnl dcsp dcsp if not port isdigit dcnl dcsp dcsp dcsp raise locationparseerror failed dcsp to dcsp parse dcsp s url dcnl dcsp dcsp port int port dcnl dcsp elif not host and url dcnl dcsp dcsp host url dcnl dcsp if not path dcnl dcsp dcsp return url scheme auth host port path query fragment dcnl dcsp if in path dcnl dcsp dcsp path fragment path split 1 dcnl dcsp if in path dcnl dcsp dcsp path query path split 1 dcnl dcsp return url scheme auth host port path query fragment
def get host url dcsp p parse url url dcnl dcsp return p scheme or http p hostname p port
def make headers keep alive none accept encoding none user agent none basic auth none dcsp headers dcnl dcsp if accept encoding dcnl dcsp dcsp if isinstance accept encoding str dcnl dcsp dcsp dcsp pass dcnl dcsp dcsp elif isinstance accept encoding list dcnl dcsp dcsp dcsp accept encoding join accept encoding dcnl dcsp dcsp else dcnl dcsp dcsp dcsp accept encoding gzip deflate dcnl dcsp dcsp headers acceptencoding accept encoding dcnl dcsp if user agent dcnl dcsp dcsp headers useragent user agent dcnl dcsp if keep alive dcnl dcsp dcsp headers connection keepalive dcnl dcsp if basic auth dcnl dcsp dcsp headers authorization basic dcsp + b64encode six b basic auth decode utf8 dcnl dcsp return headers
def is connection dropped conn dcsp sock getattr conn sock false dcnl dcsp if not sock dcnl dcsp dcsp return false dcnl dcsp if not poll dcnl dcsp dcsp if not select dcnl dcsp dcsp dcsp return false dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return select sock 0 0 0 dcnl dcsp dcsp except socketerror dcnl dcsp dcsp dcsp return true dcnl dcsp p poll dcnl dcsp p register sock pollin dcnl dcsp for fno ev in p poll 0 0 dcnl dcsp dcsp if fno sock fileno dcnl dcsp dcsp dcsp return true
def resolve cert reqs candidate dcsp if candidate is none dcnl dcsp dcsp return cert none dcnl dcsp if isinstance candidate str dcnl dcsp dcsp res getattr ssl candidate none dcnl dcsp dcsp if res is none dcnl dcsp dcsp dcsp res getattr ssl cert + candidate dcnl dcsp dcsp return res dcnl dcsp return candidate
def resolve ssl version candidate dcsp if candidate is none dcnl dcsp dcsp return protocol sslv23 dcnl dcsp if isinstance candidate str dcnl dcsp dcsp res getattr ssl candidate none dcnl dcsp dcsp if res is none dcnl dcsp dcsp dcsp res getattr ssl protocol + candidate dcnl dcsp dcsp return res dcnl dcsp return candidate
def assert fingerprint cert fingerprint dcsp hashfunc map 16 md5 20 sha1 dcnl dcsp fingerprint fingerprint replace lower dcnl dcsp digest length rest divmod len fingerprint 2 dcnl dcsp if rest or digest length not in hashfunc map dcnl dcsp dcsp raise sslerror fingerprint dcsp is dcsp of dcsp invalid dcsp length dcnl dcsp fingerprint bytes unhexlify fingerprint encode dcnl dcsp hashfunc hashfunc mapdigest length dcnl dcsp cert digest hashfunc cert digest dcnl dcsp if not cert digest fingerprint bytes dcnl dcsp dcsp raise sslerror fingerprints dcsp did dcsp not dcsp match dcsp expected dcsp 0 dcsp got dcsp 1 format hexlify fingerprint bytes hexlify cert digest
def is fp closed obj dcsp if hasattr obj fp dcnl dcsp dcsp return obj fp is none dcnl dcsp return obj closed
def choose boundary dcsp return uuid4 hex
def iter fields fields dcsp if isinstance fields dict dcnl dcsp dcsp return k v for k v in six iteritems fields dcnl dcsp return k v for k v in fields
def encode multipart formdata fields boundary none dcsp body bytesio dcnl dcsp if boundary is none dcnl dcsp dcsp boundary choose boundary dcnl dcsp for fieldname value in iter fields fields dcnl dcsp dcsp body write b s r n boundary dcnl dcsp dcsp if isinstance value tuple dcnl dcsp dcsp dcsp if len value 3 dcnl dcsp dcsp dcsp dcsp filename data content type value dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp filename data value dcnl dcsp dcsp dcsp dcsp content type get content type filename dcnl dcsp dcsp dcsp writer body write contentdisposition dcsp formdata dcsp name s dcsp filename s r n fieldname filename dcnl dcsp dcsp dcsp body write b contenttype dcsp s r n r n content type dcnl dcsp dcsp else dcnl dcsp dcsp dcsp data value dcnl dcsp dcsp dcsp writer body write contentdisposition dcsp formdata dcsp name s r n fieldname dcnl dcsp dcsp dcsp body write r n dcnl dcsp dcsp if isinstance data int dcnl dcsp dcsp dcsp data str data dcnl dcsp dcsp if isinstance data six text type dcnl dcsp dcsp dcsp writer body write data dcnl dcsp dcsp else dcnl dcsp dcsp dcsp body write data dcnl dcsp dcsp body write r n dcnl dcsp body write b s r n boundary dcnl dcsp content type str multipart formdata dcsp boundary s boundary dcnl dcsp return body getvalue content type
def connection from url url kw dcsp scheme host port get host url dcnl dcsp if scheme https dcnl dcsp dcsp return httpsconnectionpool host port port kw dcnl dcsp else dcnl dcsp dcsp return httpconnectionpool host port port kw
def inject into urllib3 dcsp connectionpool ssl wrap socket ssl wrap socket dcnl dcsp util has sni has sni
def extract from urllib3 dcsp connectionpool ssl wrap socket orig connectionpool ssl wrap socket dcnl dcsp util has sni orig util has sni
def basic auth str username password dcsp return basic dcsp + b64encode s s username password encode latin1 strip decode latin1
def dispatch hook key hooks hook data kwargs dcsp hooks hooks or dict dcnl dcsp if key in hooks dcnl dcsp dcsp hooks hooks get key dcnl dcsp dcsp if hasattr hooks call dcnl dcsp dcsp dcsp hooks hooks dcnl dcsp dcsp for hook in hooks dcnl dcsp dcsp dcsp hook data hook hook data kwargs dcnl dcsp dcsp dcsp if hook data is not none dcnl dcsp dcsp dcsp dcsp hook data hook data dcnl dcsp return hook data
def merge setting request setting session setting dict class ordereddict dcsp if session setting is none dcnl dcsp dcsp return request setting dcnl dcsp if request setting is none dcnl dcsp dcsp return session setting dcnl dcsp if not isinstance session setting mapping and isinstance request setting mapping dcnl dcsp dcsp return request setting dcnl dcsp merged setting dict class to key val list session setting dcnl dcsp merged setting update to key val list request setting dcnl dcsp for k v in request setting items dcnl dcsp dcsp if v is none dcnl dcsp dcsp dcsp del merged settingk dcnl dcsp return merged setting
def session dcsp return session
def request method url kwargs dcsp session sessions session dcnl dcsp return session request method method url url kwargs
def get url kwargs dcsp kwargs setdefault allow redirects true dcnl dcsp return request get url kwargs
def options url kwargs dcsp kwargs setdefault allow redirects true dcnl dcsp return request options url kwargs
def head url kwargs dcsp kwargs setdefault allow redirects false dcnl dcsp return request head url kwargs
def post url data none kwargs dcsp return request post url data data kwargs
def put url data none kwargs dcsp return request put url data data kwargs
def patch url data none kwargs dcsp return request patch url data data kwargs
def delete url kwargs dcsp return request delete url kwargs
def where dcsp return os path join os path dirname file cacert pem
def dict to sequence d dcsp if hasattr d items dcnl dcsp dcsp d d items dcnl dcsp return d
def get netrc auth url dcsp try dcnl dcsp dcsp locations os path expanduser ~ 0 format f for f in netrc files dcnl dcsp dcsp netrc path none dcnl dcsp dcsp for loc in locations dcnl dcsp dcsp dcsp if os path exists loc and not netrc path dcnl dcsp dcsp dcsp dcsp netrc path loc dcnl dcsp dcsp if netrc path is none dcnl dcsp dcsp dcsp return netrc path dcnl dcsp dcsp ri urlparse url dcnl dcsp dcsp host ri netloc split 0 dcnl dcsp dcsp try dcnl dcsp dcsp dcsp netrc netrc netrc path authenticators host dcnl dcsp dcsp dcsp if netrc dcnl dcsp dcsp dcsp dcsp login i 0 if netrc0 else 1 dcnl dcsp dcsp dcsp dcsp return netrclogin i netrc2 dcnl dcsp dcsp except netrcparseerror ioerror dcnl dcsp dcsp dcsp pass dcnl dcsp except importerror attributeerror dcnl dcsp dcsp pass
def guess filename obj dcsp name getattr obj name none dcnl dcsp if name and name0 < and name 1 dcnl dcsp dcsp return os path basename name
def from key val list value dcsp if value is none dcnl dcsp dcsp return none dcnl dcsp if isinstance value str bytes bool int dcnl dcsp dcsp raise valueerror cannot dcsp encode dcsp objects dcsp that dcsp are dcsp not dcsp 2tuples dcnl dcsp return ordereddict value
def to key val list value dcsp if value is none dcnl dcsp dcsp return none dcnl dcsp if isinstance value str bytes bool int dcnl dcsp dcsp raise valueerror cannot dcsp encode dcsp objects dcsp that dcsp are dcsp not dcsp 2tuples dcnl dcsp if isinstance value dict dcnl dcsp dcsp value value items dcnl dcsp return list value
def parse list header value dcsp result dcnl dcsp for item in parse list header value dcnl dcsp dcsp if item 1 item 1 dcnl dcsp dcsp dcsp item unquote header value item1 1 dcnl dcsp dcsp result append item dcnl dcsp return result
def parse dict header value dcsp result dcnl dcsp for item in parse list header value dcnl dcsp dcsp if not in item dcnl dcsp dcsp dcsp resultitem none dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp name value item split 1 dcnl dcsp dcsp if value 1 value 1 dcnl dcsp dcsp dcsp value unquote header value value1 1 dcnl dcsp dcsp resultname value dcnl dcsp return result
def unquote header value value is filename false dcsp if value and value0 value 1 dcnl dcsp dcsp value value1 1 dcnl dcsp dcsp if not is filename or value 2 dcnl dcsp dcsp dcsp return value replace replace dcnl dcsp return value
def dict from cookiejar cj dcsp cookie dict dcnl dcsp for cookie in cj dcnl dcsp dcsp cookie dictcookie name cookie value dcnl dcsp return cookie dict
def add dict to cookiejar cj cookie dict dcsp cj2 cookiejar from dict cookie dict dcnl dcsp cj update cj2 dcnl dcsp return cj
def get encodings from content content dcsp charset re re compile <meta charset + flags re i dcnl dcsp return charset re findall content
def get encoding from headers headers dcsp content type headers get contenttype dcnl dcsp if not content type dcnl dcsp dcsp return none dcnl dcsp content type params cgi parse header content type dcnl dcsp if charset in params dcnl dcsp dcsp return params charset strip dcnl dcsp if text in content type dcnl dcsp dcsp return iso88591
def stream decode response unicode iterator r dcsp if r encoding is none dcnl dcsp dcsp for item in iterator dcnl dcsp dcsp dcsp yield item dcnl dcsp dcsp return dcnl dcsp decoder codecs getincrementaldecoder r encoding errors replace dcnl dcsp for chunk in iterator dcnl dcsp dcsp rv decoder decode chunk dcnl dcsp dcsp if rv dcnl dcsp dcsp dcsp yield rv dcnl dcsp rv decoder decode final true dcnl dcsp if rv dcnl dcsp dcsp yield rv
def iter slices string slice length dcsp pos 0 dcnl dcsp while pos < len string dcnl dcsp dcsp yield stringpos pos + slice length dcnl dcsp dcsp pos + slice length
def get unicode from response r dcsp tried encodings dcnl dcsp encoding get encoding from headers r headers dcnl dcsp if encoding dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return str r content encoding dcnl dcsp dcsp except unicodeerror dcnl dcsp dcsp dcsp tried encodings append encoding dcnl dcsp try dcnl dcsp dcsp return str r content encoding errors replace dcnl dcsp except typeerror dcnl dcsp dcsp return r content
def stream decompress iterator mode gzip dcsp if mode not in gzip deflate dcnl dcsp dcsp raise valueerror stream decompress dcsp mode dcsp must dcsp be dcsp gzip dcsp or dcsp deflate dcnl dcsp zlib mode 16 + zlib max wbits if mode gzip else zlib max wbits dcnl dcsp dec zlib decompressobj zlib mode dcnl dcsp try dcnl dcsp dcsp for chunk in iterator dcnl dcsp dcsp dcsp rv dec decompress chunk dcnl dcsp dcsp dcsp if rv dcnl dcsp dcsp dcsp dcsp yield rv dcnl dcsp except zlib error dcnl dcsp dcsp yield chunk dcnl dcsp dcsp for chunk in iterator dcnl dcsp dcsp dcsp yield chunk dcnl dcsp else dcnl dcsp dcsp buf dec decompress bytes dcnl dcsp dcsp rv buf + dec flush dcnl dcsp dcsp if rv dcnl dcsp dcsp dcsp yield rv
def unquote unreserved uri dcsp parts uri split dcnl dcsp for i in range 1 len parts dcnl dcsp dcsp h partsi0 2 dcnl dcsp dcsp if len h 2 and h isalnum dcnl dcsp dcsp dcsp c chr int h 16 dcnl dcsp dcsp dcsp if c in unreserved set dcnl dcsp dcsp dcsp dcsp partsi c + partsi2 dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp partsi + partsi dcnl dcsp dcsp else dcnl dcsp dcsp dcsp partsi + partsi dcnl dcsp return join parts
def requote uri uri dcsp return quote unquote unreserved uri safe + ~
def get environ proxies url dcsp proxy keys all http https ftp socks dcnl dcsp get proxy lambda k os environ get k or os environ get k upper dcnl dcsp no proxy get proxy no proxy dcnl dcsp if no proxy dcnl dcsp dcsp no proxy no proxy split dcnl dcsp dcsp netloc urlparse url netloc dcnl dcsp dcsp for host in no proxy dcnl dcsp dcsp dcsp if netloc endswith host or netloc split 0 endswith host dcnl dcsp dcsp dcsp dcsp return dcnl dcsp proxies key get proxy key + proxy for key in proxy keys dcnl dcsp return dict key val for key val in proxies if val
def default user agent dcsp implementation platform python implementation dcnl dcsp if implementation cpython dcnl dcsp dcsp implementation version platform python version dcnl dcsp elif implementation pypy dcnl dcsp dcsp implementation version s s s sys pypy version info major sys pypy version info minor sys pypy version info micro dcnl dcsp dcsp if sys pypy version info releaselevel final dcnl dcsp dcsp dcsp implementation version join implementation version sys pypy version info releaselevel dcnl dcsp elif implementation jython dcnl dcsp dcsp implementation version platform python version dcnl dcsp elif implementation ironpython dcnl dcsp dcsp implementation version platform python version dcnl dcsp else dcnl dcsp dcsp implementation version unknown dcnl dcsp try dcnl dcsp dcsp p system platform system dcnl dcsp dcsp p release platform release dcnl dcsp except ioerror dcnl dcsp dcsp p system unknown dcnl dcsp dcsp p release unknown dcnl dcsp return dcsp join pythonrequests s version s s implementation implementation version s s p system p release
def parse header links value dcsp links dcnl dcsp replace chars dcsp dcnl dcsp for val in value split dcnl dcsp dcsp try dcnl dcsp dcsp dcsp url params val split 1 dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp url params val dcnl dcsp dcsp link dcnl dcsp dcsp link url url strip < dcsp dcnl dcsp dcsp for param in params split dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp key value param split dcnl dcsp dcsp dcsp except valueerror dcnl dcsp dcsp dcsp dcsp break dcnl dcsp dcsp dcsp linkkey strip replace chars value strip replace chars dcnl dcsp dcsp links append link dcnl dcsp return links
def prepend scheme if needed url new scheme dcsp scheme netloc path params query fragment urlparse url new scheme dcnl dcsp if not netloc dcnl dcsp dcsp netloc path path netloc dcnl dcsp return urlunparse scheme netloc path params query fragment
def get auth from url url dcsp if url dcnl dcsp dcsp parsed urlparse url dcnl dcsp dcsp return parsed username parsed password dcnl dcsp else dcnl dcsp dcsp return
def extract cookies to jar jar request response dcsp req mockrequest request dcnl dcsp res mockresponse response original response msg dcnl dcsp jar extract cookies res req
def get cookie header jar request dcsp r mockrequest request dcnl dcsp jar add cookie header r dcnl dcsp return r get new headers get cookie
def remove cookie by name cookiejar name domain none path none dcsp clearables dcnl dcsp for cookie in cookiejar dcnl dcsp dcsp if cookie name name dcnl dcsp dcsp dcsp if domain is none or domain cookie domain dcnl dcsp dcsp dcsp dcsp if path is none or path cookie path dcnl dcsp dcsp dcsp dcsp dcsp clearables append cookie domain cookie path cookie name dcnl dcsp for domain path name in clearables dcnl dcsp dcsp cookiejar clear domain path name
def create cookie name value kwargs dcsp result dict version 0 name name value value port none domain path secure false expires none discard true comment none comment url none rest httponly none rfc2109 false dcnl dcsp badargs set kwargs set result dcnl dcsp if badargs dcnl dcsp dcsp err create cookie dcsp got dcsp unexpected dcsp keyword dcsp arguments dcsp s dcnl dcsp dcsp raise typeerror err list badargs dcnl dcsp result update kwargs dcnl dcsp result port specified bool result port dcnl dcsp result domain specified bool result domain dcnl dcsp result domain initial dot result domain startswith dcnl dcsp result path specified bool result path dcnl dcsp return cookielib cookie result
def morsel to cookie morsel dcsp c create cookie name morsel key value morsel value version morsel version or 0 port none port specified false domain morsel domain domain specified bool morsel domain domain initial dot morsel domain startswith path morsel path path specified bool morsel path secure bool morsel secure expires morsel maxage or morsel expires discard false comment morsel comment comment url bool morsel comment rest httponly morsel httponly rfc2109 false dcnl dcsp return c
def cookiejar from dict cookie dict cookiejar none dcsp if cookiejar is none dcnl dcsp dcsp cookiejar requestscookiejar dcnl dcsp if cookie dict is not none dcnl dcsp dcsp for name in cookie dict dcnl dcsp dcsp dcsp cookiejar set cookie create cookie name cookie dictname dcnl dcsp return cookiejar
def add doc func doc dcsp func doc doc
def import module name dcsp import name dcnl dcsp return sys modulesname
def add move move dcsp setattr moveditems move name move
def remove move name dcsp try dcnl dcsp dcsp delattr moveditems name dcnl dcsp except attributeerror dcnl dcsp dcsp try dcnl dcsp dcsp dcsp del moves dict name dcnl dcsp dcsp except keyerror dcnl dcsp dcsp dcsp raise attributeerror no dcsp such dcsp move dcsp r name
def iterkeys d dcsp return iter getattr d iterkeys
def itervalues d dcsp return iter getattr d itervalues
def iteritems d dcsp return iter getattr d iteritems
def with metaclass meta base object dcsp return meta newbase base
def match hostname cert hostname dcsp if not cert dcnl dcsp dcsp raise valueerror empty dcsp or dcsp no dcsp certificate dcnl dcsp dnsnames dcnl dcsp san cert get subjectaltname dcnl dcsp for key value in san dcnl dcsp dcsp if key dns dcnl dcsp dcsp dcsp if dnsname to pat value match hostname dcnl dcsp dcsp dcsp dcsp return dcnl dcsp dcsp dcsp dnsnames append value dcnl dcsp if not dnsnames dcnl dcsp dcsp for sub in cert get subject dcnl dcsp dcsp dcsp for key value in sub dcnl dcsp dcsp dcsp dcsp if key commonname dcnl dcsp dcsp dcsp dcsp dcsp if dnsname to pat value match hostname dcnl dcsp dcsp dcsp dcsp dcsp dcsp return dcnl dcsp dcsp dcsp dcsp dcsp dnsnames append value dcnl dcsp if len dnsnames 1 dcnl dcsp dcsp raise certificateerror hostname dcsp r dcsp doesn t dcsp match dcsp either dcsp of dcsp s hostname dcsp join map repr dnsnames dcnl dcsp elif len dnsnames 1 dcnl dcsp dcsp raise certificateerror hostname dcsp r dcsp doesn t dcsp match dcsp r hostname dnsnames0 dcnl dcsp else dcnl dcsp dcsp raise certificateerror no dcsp appropriate dcsp commonname dcsp or dcsp subjectaltname dcsp fields dcsp were dcsp found
def add stderr logger level logging debug dcsp logger logging getlogger name dcnl dcsp handler logging streamhandler dcnl dcsp handler setformatter logging formatter asctime s dcsp levelname s dcsp message s dcnl dcsp logger addhandler handler dcnl dcsp logger setlevel level dcnl dcsp logger debug added dcsp an dcsp stderr dcsp logging dcsp handler dcsp to dcsp logger dcsp s name dcnl dcsp return handler
def split first s delims dcsp min idx none dcnl dcsp min delim none dcnl dcsp for d in delims dcnl dcsp dcsp idx s find d dcnl dcsp dcsp if idx < 0 dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if min idx is none or idx < min idx dcnl dcsp dcsp dcsp min idx idx dcnl dcsp dcsp dcsp min delim d dcnl dcsp if min idx is none or min idx < 0 dcnl dcsp dcsp return s none dcnl dcsp return s min idx s min idx + 1 min delim
def parse url url dcsp scheme none dcnl dcsp auth none dcnl dcsp host none dcnl dcsp port none dcnl dcsp path none dcnl dcsp fragment none dcnl dcsp query none dcnl dcsp if in url dcnl dcsp dcsp scheme url url split 1 dcnl dcsp url path delim split first url dcnl dcsp if delim dcnl dcsp dcsp path delim + path dcnl dcsp if in url dcnl dcsp dcsp auth url url split 1 dcnl dcsp if url and url0 dcnl dcsp dcsp host url url1 split 1 dcnl dcsp if in url dcnl dcsp dcsp host port url split 1 dcnl dcsp dcsp if not host dcnl dcsp dcsp dcsp host host dcnl dcsp dcsp if not port isdigit dcnl dcsp dcsp dcsp raise locationparseerror failed dcsp to dcsp parse dcsp s url dcnl dcsp dcsp port int port dcnl dcsp elif not host and url dcnl dcsp dcsp host url dcnl dcsp if not path dcnl dcsp dcsp return url scheme auth host port path query fragment dcnl dcsp if in path dcnl dcsp dcsp path fragment path split 1 dcnl dcsp if in path dcnl dcsp dcsp path query path split 1 dcnl dcsp return url scheme auth host port path query fragment
def get host url dcsp p parse url url dcnl dcsp return p scheme or http p hostname p port
def make headers keep alive none accept encoding none user agent none basic auth none dcsp headers dcnl dcsp if accept encoding dcnl dcsp dcsp if isinstance accept encoding str dcnl dcsp dcsp dcsp pass dcnl dcsp dcsp elif isinstance accept encoding list dcnl dcsp dcsp dcsp accept encoding join accept encoding dcnl dcsp dcsp else dcnl dcsp dcsp dcsp accept encoding gzip deflate dcnl dcsp dcsp headers acceptencoding accept encoding dcnl dcsp if user agent dcnl dcsp dcsp headers useragent user agent dcnl dcsp if keep alive dcnl dcsp dcsp headers connection keepalive dcnl dcsp if basic auth dcnl dcsp dcsp headers authorization basic dcsp + b64encode six b basic auth decode utf8 dcnl dcsp return headers
def is connection dropped conn dcsp sock getattr conn sock false dcnl dcsp if not sock dcnl dcsp dcsp return false dcnl dcsp if not poll dcnl dcsp dcsp if not select dcnl dcsp dcsp dcsp return false dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return select sock 0 0 0 dcnl dcsp dcsp except socketerror dcnl dcsp dcsp dcsp return true dcnl dcsp p poll dcnl dcsp p register sock pollin dcnl dcsp for fno ev in p poll 0 0 dcnl dcsp dcsp if fno sock fileno dcnl dcsp dcsp dcsp return true
def resolve cert reqs candidate dcsp if candidate is none dcnl dcsp dcsp return cert none dcnl dcsp if isinstance candidate str dcnl dcsp dcsp res getattr ssl candidate none dcnl dcsp dcsp if res is none dcnl dcsp dcsp dcsp res getattr ssl cert + candidate dcnl dcsp dcsp return res dcnl dcsp return candidate
def resolve ssl version candidate dcsp if candidate is none dcnl dcsp dcsp return protocol sslv23 dcnl dcsp if isinstance candidate str dcnl dcsp dcsp res getattr ssl candidate none dcnl dcsp dcsp if res is none dcnl dcsp dcsp dcsp res getattr ssl protocol + candidate dcnl dcsp dcsp return res dcnl dcsp return candidate
def assert fingerprint cert fingerprint dcsp hashfunc map 16 md5 20 sha1 dcnl dcsp fingerprint fingerprint replace lower dcnl dcsp digest length rest divmod len fingerprint 2 dcnl dcsp if rest or digest length not in hashfunc map dcnl dcsp dcsp raise sslerror fingerprint dcsp is dcsp of dcsp invalid dcsp length dcnl dcsp fingerprint bytes unhexlify fingerprint encode dcnl dcsp hashfunc hashfunc mapdigest length dcnl dcsp cert digest hashfunc cert digest dcnl dcsp if not cert digest fingerprint bytes dcnl dcsp dcsp raise sslerror fingerprints dcsp did dcsp not dcsp match dcsp expected dcsp 0 dcsp got dcsp 1 format hexlify fingerprint bytes hexlify cert digest
def choose boundary dcsp return uuid4 hex
def iter fields fields dcsp if isinstance fields dict dcnl dcsp dcsp return k v for k v in six iteritems fields dcnl dcsp return k v for k v in fields
def encode multipart formdata fields boundary none dcsp body bytesio dcnl dcsp if boundary is none dcnl dcsp dcsp boundary choose boundary dcnl dcsp for fieldname value in iter fields fields dcnl dcsp dcsp body write b s r n boundary dcnl dcsp dcsp if isinstance value tuple dcnl dcsp dcsp dcsp if len value 3 dcnl dcsp dcsp dcsp dcsp filename data content type value dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp filename data value dcnl dcsp dcsp dcsp dcsp content type get content type filename dcnl dcsp dcsp dcsp writer body write contentdisposition dcsp formdata dcsp name s dcsp filename s r n fieldname filename dcnl dcsp dcsp dcsp body write b contenttype dcsp s r n r n content type dcnl dcsp dcsp else dcnl dcsp dcsp dcsp data value dcnl dcsp dcsp dcsp writer body write contentdisposition dcsp formdata dcsp name s r n fieldname dcnl dcsp dcsp dcsp body write r n dcnl dcsp dcsp if isinstance data int dcnl dcsp dcsp dcsp data str data dcnl dcsp dcsp if isinstance data six text type dcnl dcsp dcsp dcsp writer body write data dcnl dcsp dcsp else dcnl dcsp dcsp dcsp body write data dcnl dcsp dcsp body write r n dcnl dcsp body write b s r n boundary dcnl dcsp content type b multipart formdata dcsp boundary s boundary dcnl dcsp return body getvalue content type
def connection from url url kw dcsp scheme host port get host url dcnl dcsp if scheme https dcnl dcsp dcsp return httpsconnectionpool host port port kw dcnl dcsp else dcnl dcsp dcsp return httpconnectionpool host port port kw
def inject into urllib3 dcsp connectionpool ssl wrap socket ssl wrap socket dcnl dcsp util has sni has sni
def extract from urllib3 dcsp connectionpool ssl wrap socket orig connectionpool ssl wrap socket dcnl dcsp util has sni orig util has sni
def basic auth str username password dcsp return basic dcsp + b64encode s s username password encode latin1 strip decode latin1
def dispatch hook key hooks hook data kwargs dcsp hooks hooks or dict dcnl dcsp if key in hooks dcnl dcsp dcsp hooks hooks get key dcnl dcsp dcsp if hasattr hooks call dcnl dcsp dcsp dcsp hooks hooks dcnl dcsp dcsp for hook in hooks dcnl dcsp dcsp dcsp hook data hook hook data kwargs dcnl dcsp dcsp dcsp if hook data is not none dcnl dcsp dcsp dcsp dcsp hook data hook data dcnl dcsp return hook data
def merge kwargs local kwarg default kwarg dcsp if default kwarg is none dcnl dcsp dcsp return local kwarg dcnl dcsp if isinstance local kwarg str dcnl dcsp dcsp return local kwarg dcnl dcsp if local kwarg is none dcnl dcsp dcsp return default kwarg dcnl dcsp if not hasattr default kwarg items dcnl dcsp dcsp return local kwarg dcnl dcsp default kwarg from key val list default kwarg dcnl dcsp local kwarg from key val list local kwarg dcnl dcsp def get original key original keys new key dcnl dcsp dcsp n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp finds dcsp the dcsp key dcsp from dcsp original keys dcsp that dcsp caseinsensitive dcsp matches dcsp new key n dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcsp dcnl dcsp dcsp for original key in original keys dcnl dcsp dcsp dcsp if key lower original key lower dcnl dcsp dcsp dcsp dcsp return original key dcnl dcsp dcsp return new key dcnl dcsp kwargs default kwarg copy dcnl dcsp original keys kwargs keys dcnl dcsp for key value in local kwarg items dcnl dcsp dcsp kwargsget original key original keys key value dcnl dcsp for k v in local kwarg items dcnl dcsp dcsp if v is none dcnl dcsp dcsp dcsp del kwargsk dcnl dcsp return kwargs
def session dcsp return session
def request method url kwargs dcsp session sessions session dcnl dcsp return session request method method url url kwargs
def get url kwargs dcsp kwargs setdefault allow redirects true dcnl dcsp return request get url kwargs
def options url kwargs dcsp kwargs setdefault allow redirects true dcnl dcsp return request options url kwargs
def head url kwargs dcsp kwargs setdefault allow redirects false dcnl dcsp return request head url kwargs
def post url data none kwargs dcsp return request post url data data kwargs
def put url data none kwargs dcsp return request put url data data kwargs
def patch url data none kwargs dcsp return request patch url data data kwargs
def delete url kwargs dcsp return request delete url kwargs
def where dcsp return os path join os path dirname file cacert pem
def search s keywords dcsp acora acorabuilder keywords build dcnl dcsp return acora findall s
def search ignore case s keywords dcsp acora acorabuilder keywords build ignore case true dcnl dcsp return acora findall s
def nfa2dfa tree ignore case dcsp def visit all tree visitor dcnl dcsp dcsp visitor tree dcnl dcsp dcsp for node in tree values dcnl dcsp dcsp dcsp visit all node visitor dcnl dcsp states dcnl dcsp visit all tree states append dcnl dcsp next state id len states dcnl dcsp transitions dcnl dcsp chars by state dcnl dcsp new eq classes set dcnl dcsp for state in states dcnl dcsp dcsp chars chars by statestate set dcnl dcsp dcsp for char target in state items dcnl dcsp dcsp dcsp if ignore case dcnl dcsp dcsp dcsp dcsp char char lower dcnl dcsp dcsp dcsp transitions state char set target dcnl dcsp dcsp dcsp chars add char dcnl dcsp dcsp for char target in tree items dcnl dcsp dcsp dcsp if ignore case dcnl dcsp dcsp dcsp dcsp char char lower dcnl dcsp dcsp dcsp chars add char dcnl dcsp dcsp dcsp key state char dcnl dcsp dcsp dcsp if key in transitions dcnl dcsp dcsp dcsp dcsp transitionskey add target dcnl dcsp dcsp dcsp dcsp new eq classes add key dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp transitionskey set target dcnl dcsp existing eq classes dcnl dcsp eq classes by state dcnl dcsp while new eq classes dcnl dcsp dcsp eq classes new eq classes dcnl dcsp dcsp new eq classes set dcnl dcsp dcsp for key in eq classes dcnl dcsp dcsp dcsp eq states transitionskey dcnl dcsp dcsp dcsp if len eq states < 2 dcnl dcsp dcsp dcsp dcsp continue dcnl dcsp dcsp dcsp eq key tuple sorted s id for s in eq states dcnl dcsp dcsp dcsp if eq key in existing eq classes dcnl dcsp dcsp dcsp dcsp transitionskey set existing eq classeseq key dcnl dcsp dcsp dcsp dcsp continue dcnl dcsp dcsp dcsp new state nfastate next state id dcnl dcsp dcsp dcsp matches dcnl dcsp dcsp dcsp for s in eq states dcnl dcsp dcsp dcsp dcsp matches extend s matches dcnl dcsp dcsp dcsp matches sort key len reverse true dcnl dcsp dcsp dcsp new state matches matches dcnl dcsp dcsp dcsp eq classes by statenew state eq states dcnl dcsp dcsp dcsp existing eq classeseq key new state dcnl dcsp dcsp dcsp next state id + 1 dcnl dcsp dcsp dcsp transitionskey set new state dcnl dcsp dcsp dcsp new chars chars by statenew state set dcnl dcsp dcsp dcsp for state in eq states dcnl dcsp dcsp dcsp dcsp chars chars by statestate dcnl dcsp dcsp dcsp dcsp new chars update chars dcnl dcsp dcsp dcsp dcsp for char in chars dcnl dcsp dcsp dcsp dcsp dcsp targets set dcnl dcsp dcsp dcsp dcsp dcsp for target in transitions state char dcnl dcsp dcsp dcsp dcsp dcsp dcsp if target in eq classes by state dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp targets update eq classes by statetarget dcnl dcsp dcsp dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp dcsp dcsp targets add target dcnl dcsp dcsp dcsp dcsp dcsp new key new state char dcnl dcsp dcsp dcsp dcsp dcsp if new key in transitions dcnl dcsp dcsp dcsp dcsp dcsp dcsp transitionsnew key update targets dcnl dcsp dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp dcsp transitionsnew key set targets dcnl dcsp dcsp dcsp dcsp dcsp new eq classes add new key dcnl dcsp for key state set in transitions items dcnl dcsp dcsp assert len state set 1 dcnl dcsp dcsp transitionskey tuple state set 0 dcnl dcsp if ignore case dcnl dcsp dcsp for state char target in list transitions items dcnl dcsp dcsp dcsp transitions state char upper target dcnl dcsp return tree transitions
def configure cache name cache backend sqlite expire after none allowable codes 200 allowable methods get monkey patch true backend options dcsp try dcnl dcsp dcsp global cache dcnl dcsp dcsp cache backends registrybackend cache name backend options dcnl dcsp except keyerror dcnl dcsp dcsp raise valueerror unsupported dcsp backend dcsp s dcsp try dcsp one dcsp of dcsp s backend dcsp join backends registry keys dcnl dcsp if monkey patch dcnl dcsp dcsp redo patch dcnl dcsp config expire after expire after dcnl dcsp config allowable codes allowable codes dcnl dcsp config allowable methods allowable methods
def has url url dcsp return cache has url url
contextmanager dcnl def disabled dcsp previous request send dcnl dcsp undo patch dcnl dcsp try dcnl dcsp dcsp yield dcnl dcsp finally dcnl dcsp dcsp request send previous
contextmanager dcnl def enabled dcsp previous request send dcnl dcsp redo patch dcnl dcsp try dcnl dcsp dcsp yield dcnl dcsp finally dcnl dcsp dcsp request send previous
def clear dcsp cache clear
def undo patch dcsp request send original request send
def redo patch dcsp request send request send hook
def get cache dcsp return cache
def delete url url dcsp cache del cached url url
def get os ca bundle path dcsp for path in possible ca bundle paths dcnl dcsp dcsp if os path exists path dcnl dcsp dcsp dcsp return path dcnl dcsp return none
def dict to sequence d dcsp if hasattr d items dcnl dcsp dcsp d d items dcnl dcsp return d
def get netrc auth url dcsp try dcnl dcsp dcsp locations os path expanduser ~ 0 format f for f in netrc files dcnl dcsp dcsp netrc path none dcnl dcsp dcsp for loc in locations dcnl dcsp dcsp dcsp if os path exists loc and not netrc path dcnl dcsp dcsp dcsp dcsp netrc path loc dcnl dcsp dcsp if netrc path is none dcnl dcsp dcsp dcsp return netrc path dcnl dcsp dcsp ri urlparse url dcnl dcsp dcsp host ri netloc split 0 dcnl dcsp dcsp try dcnl dcsp dcsp dcsp netrc netrc netrc path authenticators host dcnl dcsp dcsp dcsp if netrc dcnl dcsp dcsp dcsp dcsp login i 0 if netrc0 else 1 dcnl dcsp dcsp dcsp dcsp return netrclogin i netrc2 dcnl dcsp dcsp except netrcparseerror ioerror dcnl dcsp dcsp dcsp pass dcnl dcsp except importerror attributeerror dcnl dcsp dcsp pass
def guess filename obj dcsp name getattr obj name none dcnl dcsp if name and name0 < and name 1 dcnl dcsp dcsp return name
def from key val list value dcsp if value is none dcnl dcsp dcsp return none dcnl dcsp if isinstance value str bytes bool int dcnl dcsp dcsp raise valueerror cannot dcsp encode dcsp objects dcsp that dcsp are dcsp not dcsp 2tuples dcnl dcsp return ordereddict value
def to key val list value dcsp if value is none dcnl dcsp dcsp return none dcnl dcsp if isinstance value str bytes bool int dcnl dcsp dcsp raise valueerror cannot dcsp encode dcsp objects dcsp that dcsp are dcsp not dcsp 2tuples dcnl dcsp if isinstance value dict dcnl dcsp dcsp value value items dcnl dcsp return list value
def parse list header value dcsp result dcnl dcsp for item in parse list header value dcnl dcsp dcsp if item 1 item 1 dcnl dcsp dcsp dcsp item unquote header value item1 1 dcnl dcsp dcsp result append item dcnl dcsp return result
def parse dict header value dcsp result dcnl dcsp for item in parse list header value dcnl dcsp dcsp if not in item dcnl dcsp dcsp dcsp resultitem none dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp name value item split 1 dcnl dcsp dcsp if value 1 value 1 dcnl dcsp dcsp dcsp value unquote header value value1 1 dcnl dcsp dcsp resultname value dcnl dcsp return result
def unquote header value value is filename false dcsp if value and value0 value 1 dcnl dcsp dcsp value value1 1 dcnl dcsp dcsp if not is filename or value 2 dcnl dcsp dcsp dcsp return value replace replace dcnl dcsp return value
def header expand headers dcsp collector dcnl dcsp if isinstance headers dict dcnl dcsp dcsp headers list headers items dcnl dcsp elif isinstance headers basestring dcnl dcsp dcsp return headers dcnl dcsp elif isinstance headers str dcnl dcsp dcsp return headers encode latin1 dcnl dcsp elif headers is none dcnl dcsp dcsp return headers dcnl dcsp for i value params in enumerate headers dcnl dcsp dcsp params dcnl dcsp dcsp for p k p v in list params items dcnl dcsp dcsp dcsp params append s s p k p v dcnl dcsp dcsp collector append value dcnl dcsp dcsp collector append dcsp dcnl dcsp dcsp if len params dcnl dcsp dcsp dcsp collector append dcsp join params dcnl dcsp dcsp dcsp if not len headers i + 1 dcnl dcsp dcsp dcsp dcsp collector append dcsp dcnl dcsp if collector 1 in dcsp dcsp dcnl dcsp dcsp del collector 1 dcnl dcsp return join collector
def dict from cookiejar cj dcsp cookie dict dcnl dcsp for cookie in cj dcnl dcsp dcsp cookie dictcookie name cookie value dcnl dcsp return cookie dict
def add dict to cookiejar cj cookie dict dcsp cj2 cookiejar from dict cookie dict dcnl dcsp for cookie in cj2 dcnl dcsp dcsp cj set cookie cookie dcnl dcsp return cj
def get encodings from content content dcsp charset re re compile <meta charset + flags re i dcnl dcsp return charset re findall content
def get encoding from headers headers dcsp content type headers get contenttype dcnl dcsp if not content type dcnl dcsp dcsp return none dcnl dcsp content type params cgi parse header content type dcnl dcsp if charset in params dcnl dcsp dcsp return params charset strip dcnl dcsp if text in content type dcnl dcsp dcsp return iso88591
def stream decode response unicode iterator r dcsp if r encoding is none dcnl dcsp dcsp for item in iterator dcnl dcsp dcsp dcsp yield item dcnl dcsp dcsp return dcnl dcsp decoder codecs getincrementaldecoder r encoding errors replace dcnl dcsp for chunk in iterator dcnl dcsp dcsp rv decoder decode chunk dcnl dcsp dcsp if rv dcnl dcsp dcsp dcsp yield rv dcnl dcsp rv decoder decode final true dcnl dcsp if rv dcnl dcsp dcsp yield rv
def iter slices string slice length dcsp pos 0 dcnl dcsp while pos < len string dcnl dcsp dcsp yield stringpos pos + slice length dcnl dcsp dcsp pos + slice length
def get unicode from response r dcsp tried encodings dcnl dcsp encoding get encoding from headers r headers dcnl dcsp if encoding dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return str r content encoding dcnl dcsp dcsp except unicodeerror dcnl dcsp dcsp dcsp tried encodings append encoding dcnl dcsp try dcnl dcsp dcsp return str r content encoding errors replace dcnl dcsp except typeerror dcnl dcsp dcsp return r content
def stream decompress iterator mode gzip dcsp if mode not in gzip deflate dcnl dcsp dcsp raise valueerror stream decompress dcsp mode dcsp must dcsp be dcsp gzip dcsp or dcsp deflate dcnl dcsp zlib mode 16 + zlib max wbits if mode gzip else zlib max wbits dcnl dcsp dec zlib decompressobj zlib mode dcnl dcsp try dcnl dcsp dcsp for chunk in iterator dcnl dcsp dcsp dcsp rv dec decompress chunk dcnl dcsp dcsp dcsp if rv dcnl dcsp dcsp dcsp dcsp yield rv dcnl dcsp except zlib error dcnl dcsp dcsp yield chunk dcnl dcsp dcsp for chunk in iterator dcnl dcsp dcsp dcsp yield chunk dcnl dcsp else dcnl dcsp dcsp buf dec decompress bytes dcnl dcsp dcsp rv buf + dec flush dcnl dcsp dcsp if rv dcnl dcsp dcsp dcsp yield rv
def unquote unreserved uri dcsp try dcnl dcsp dcsp parts uri split dcnl dcsp dcsp for i in range 1 len parts dcnl dcsp dcsp dcsp h partsi0 2 dcnl dcsp dcsp dcsp if len h 2 and h isalnum dcnl dcsp dcsp dcsp dcsp c chr int h 16 dcnl dcsp dcsp dcsp dcsp if c in unreserved set dcnl dcsp dcsp dcsp dcsp dcsp partsi c + partsi2 dcnl dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp partsi + partsi dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp partsi + partsi dcnl dcsp dcsp return join parts dcnl dcsp except valueerror dcnl dcsp dcsp return uri
def requote uri uri dcsp return quote unquote unreserved uri safe + ~
def get environ proxies dcsp proxy keys all http https ftp socks no dcnl dcsp get proxy lambda k os environ get k or os environ get k upper dcnl dcsp proxies key get proxy key + proxy for key in proxy keys dcnl dcsp return dict key val for key val in proxies if val
def default user agent dcsp implementation platform python implementation dcnl dcsp if implementation cpython dcnl dcsp dcsp implementation version platform python version dcnl dcsp elif implementation pypy dcnl dcsp dcsp implementation version s s s sys pypy version info major sys pypy version info minor sys pypy version info micro dcnl dcsp dcsp if sys pypy version info releaselevel final dcnl dcsp dcsp dcsp implementation version join implementation version sys pypy version info releaselevel dcnl dcsp elif implementation jython dcnl dcsp dcsp implementation version platform python version dcnl dcsp elif implementation ironpython dcnl dcsp dcsp implementation version platform python version dcnl dcsp else dcnl dcsp dcsp implementation version unknown dcnl dcsp return dcsp join pythonrequests s version s s implementation implementation version s s platform system platform release
def parse header links value dcsp links dcnl dcsp replace chars dcsp dcnl dcsp for val in value split dcnl dcsp dcsp try dcnl dcsp dcsp dcsp url params val split 1 dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp url params val dcnl dcsp dcsp link dcnl dcsp dcsp link url url strip < dcsp dcnl dcsp dcsp for param in params split dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp key value param split dcnl dcsp dcsp dcsp except valueerror dcnl dcsp dcsp dcsp dcsp break dcnl dcsp dcsp dcsp linkkey strip replace chars value strip replace chars dcnl dcsp dcsp links append link dcnl dcsp return links
def extract cookies to jar jar request response dcsp req mockrequest request dcnl dcsp res mockresponse response original response msg dcnl dcsp jar extract cookies res req
def get cookie header jar request dcsp r mockrequest request dcnl dcsp jar add cookie header r dcnl dcsp return r get new headers get cookie
def remove cookie by name cookiejar name domain none path none dcsp clearables dcnl dcsp for cookie in cookiejar dcnl dcsp dcsp if cookie name name dcnl dcsp dcsp dcsp if domain is none or domain cookie domain dcnl dcsp dcsp dcsp dcsp if path is none or path cookie path dcnl dcsp dcsp dcsp dcsp dcsp clearables append cookie domain cookie path cookie name dcnl dcsp for domain path name in clearables dcnl dcsp dcsp cookiejar clear domain path name
def create cookie name value kwargs dcsp result dict version 0 name name value value port none domain path secure false expires none discard true comment none comment url none rest httponly none rfc2109 false dcnl dcsp badargs set kwargs set result dcnl dcsp if badargs dcnl dcsp dcsp err create cookie dcsp got dcsp unexpected dcsp keyword dcsp arguments dcsp s dcnl dcsp dcsp raise typeerror err list badargs dcnl dcsp result update kwargs dcnl dcsp result port specified bool result port dcnl dcsp result domain specified bool result domain dcnl dcsp result domain initial dot result domain startswith dcnl dcsp result path specified bool result path dcnl dcsp return cookielib cookie result
def morsel to cookie morsel dcsp c create cookie name morsel key value morsel value version morsel version or 0 port none port specified false domain morsel domain domain specified bool morsel domain domain initial dot morsel domain startswith path morsel path path specified bool morsel path secure bool morsel secure expires morsel maxage or morsel expires discard false comment morsel comment comment url bool morsel comment rest httponly morsel httponly rfc2109 false dcnl dcsp return c
def cookiejar from dict cookie dict cookiejar none dcsp if cookiejar is none dcnl dcsp dcsp cookiejar requestscookiejar dcnl dcsp if cookie dict is not none dcnl dcsp dcsp for name in cookie dict dcnl dcsp dcsp dcsp cookiejar set cookie create cookie name cookie dictname dcnl dcsp return cookiejar
def construct base string http method base string uri normalized encoded request parameters dcsp base string utils escape http method upper dcnl dcsp base string + u dcnl dcsp base string + utils escape base string uri dcnl dcsp base string + u dcnl dcsp base string + utils escape normalized encoded request parameters dcnl dcsp return base string
def normalize base string uri uri dcsp if not isinstance uri unicode dcnl dcsp dcsp raise valueerror uri dcsp must dcsp be dcsp a dcsp unicode dcsp object dcnl dcsp scheme netloc path params query fragment urlparse urlparse uri dcnl dcsp scheme scheme lower dcnl dcsp netloc netloc lower dcnl dcsp default ports u http u 80 u https u 443 dcnl dcsp if u in netloc dcnl dcsp dcsp host port netloc split u 1 dcnl dcsp dcsp if scheme port in default ports dcnl dcsp dcsp dcsp netloc host dcnl dcsp return urlparse urlunparse scheme netloc path u u u
def collect parameters uri query body headers none exclude oauth signature true dcsp headers headers or dcnl dcsp params dcnl dcsp if uri query dcnl dcsp dcsp params extend urlparse parse qsl uri query keep blank values true dcnl dcsp if headers dcnl dcsp dcsp headers lower dict k lower v for k v in headers items dcnl dcsp dcsp authorization header headers lower get u authorization dcnl dcsp dcsp if authorization header is not none dcnl dcsp dcsp dcsp params extend i for i in utils parse authorization header authorization header if i0 u realm dcnl dcsp bodyparams extract params body or dcnl dcsp params extend bodyparams dcnl dcsp unescaped params dcnl dcsp for k v in params dcnl dcsp dcsp if k startswith u oauth dcnl dcsp dcsp dcsp v utils unescape v dcnl dcsp dcsp unescaped params append k v dcnl dcsp if exclude oauth signature dcnl dcsp dcsp unescaped params filter lambda i i0 u oauth signature unescaped params dcnl dcsp return unescaped params
def normalize parameters params dcsp key values utils escape k utils escape v for k v in params dcnl dcsp key values sort dcnl dcsp parameter parts u 0 1 format k v for k v in key values dcnl dcsp return u join parameter parts
def sign hmac sha1 base string client secret resource owner secret dcsp text base string dcnl dcsp key utils escape client secret or u dcnl dcsp key + u dcnl dcsp key + utils escape resource owner secret or u dcnl dcsp key utf8 key encode utf8 dcnl dcsp text utf8 text encode utf8 dcnl dcsp signature hmac new key utf8 text utf8 hashlib sha1 dcnl dcsp return binascii b2a base64 signature digest 1 decode utf8
def sign rsa sha1 base string rsa private key dcsp from crypto publickey import rsa dcnl dcsp from crypto signature import pkcs1 v1 5 dcnl dcsp from crypto hash import sha dcnl dcsp key rsa importkey rsa private key dcnl dcsp h sha new base string dcnl dcsp p pkcs1 v1 5 new key dcnl dcsp return binascii b2a base64 p sign h 1 decode utf8
def sign plaintext client secret resource owner secret dcsp signature utils escape client secret or u dcnl dcsp signature + u dcnl dcsp signature + utils escape resource owner secret or u dcnl dcsp return signature
def verify hmac sha1 request client secret none resource owner secret none dcsp norm params normalize parameters request params dcnl dcsp uri normalize base string uri request uri dcnl dcsp base string construct base string request http method uri norm params dcnl dcsp signature sign hmac sha1 base string client secret resource owner secret dcnl dcsp return safe string equals signature request signature
def verify rsa sha1 request rsa public key dcsp from crypto publickey import rsa dcnl dcsp from crypto signature import pkcs1 v1 5 dcnl dcsp from crypto hash import sha dcnl dcsp key rsa importkey rsa public key dcnl dcsp norm params normalize parameters request params dcnl dcsp uri normalize base string uri request uri dcnl dcsp message construct base string request http method uri norm params dcnl dcsp h sha new message dcnl dcsp p pkcs1 v1 5 new key dcnl dcsp sig binascii a2b base64 request signature dcnl dcsp return p verify h sig
def verify plaintext request client secret none resource owner secret none dcsp signature sign plaintext client secret resource owner secret dcnl dcsp return safe string equals signature request signature
def filter params target dcsp def wrapper params args kwargs dcnl dcsp dcsp params filter oauth params params dcnl dcsp dcsp return target params args kwargs dcnl dcsp wrapper doc target doc dcnl dcsp return wrapper
def filter oauth params params dcsp is oauth lambda kv kv0 startswith u oauth dcnl dcsp if isinstance params dict dcnl dcsp dcsp return filter is oauth params items dcnl dcsp else dcnl dcsp dcsp return filter is oauth params
def escape u dcsp if not isinstance u unicode dcnl dcsp dcsp raise valueerror only dcsp unicode dcsp objects dcsp are dcsp escapable dcnl dcsp return quote u safe ~
def urlencode query dcsp if isinstance query dict dcnl dcsp dcsp query query items dcnl dcsp return u join u join escape k escape v for k v in query
def parse keqv list l dcsp encoded list u encode utf8 for u in l dcnl dcsp encoded parsed urllib2 parse keqv list encoded list dcnl dcsp return dict k decode utf8 v decode utf8 for k v in encoded parsed items
def parse http list u dcsp encoded str u encode utf8 dcnl dcsp encoded list urllib2 parse http list encoded str dcnl dcsp return s decode utf8 for s in encoded list
def parse authorization header authorization header dcsp auth scheme u oauth dcsp dcnl dcsp if authorization header startswith auth scheme dcnl dcsp dcsp authorization header authorization header replace auth scheme u 1 dcnl dcsp items parse http list authorization header dcnl dcsp try dcnl dcsp dcsp return parse keqv list items items dcnl dcsp except valueerror dcnl dcsp dcsp raise valueerror malformed dcsp authorization dcsp header
utils filter params dcnl def prepare headers oauth params headers none realm none dcsp headers headers or dcnl dcsp authorization header parameters parts dcnl dcsp for oauth parameter name value in oauth params dcnl dcsp dcsp escaped name utils escape oauth parameter name dcnl dcsp dcsp escaped value utils escape value dcnl dcsp dcsp part u 0 1 format escaped name escaped value dcnl dcsp dcsp authorization header parameters parts append part dcnl dcsp authorization header parameters dcsp join authorization header parameters parts dcnl dcsp if realm dcnl dcsp dcsp authorization header parameters u realm s dcsp realm + authorization header parameters dcnl dcsp authorization header u oauth dcsp s authorization header parameters dcnl dcsp full headers dcnl dcsp full headers update headers dcnl dcsp full headersu authorization authorization header dcnl dcsp return full headers
def append params oauth params params dcsp merged list params dcnl dcsp merged extend oauth params dcnl dcsp merged sort key lambda i i0 startswith oauth dcnl dcsp return merged
def prepare form encoded body oauth params body dcsp return append params oauth params body
def prepare request uri query oauth params uri dcsp sch net path par query fra urlparse uri dcnl dcsp query urlencode append params oauth params extract params query or dcnl dcsp return urlunparse sch net path par query fra
def host from uri uri dcsp default ports u http u 80 u https u 443 dcnl dcsp sch netloc path par query fra urlparse urlparse uri dcnl dcsp if u in netloc dcnl dcsp dcsp netloc port netloc split u 1 dcnl dcsp else dcnl dcsp dcsp port default ports get sch upper dcnl dcsp return netloc port
def escape u dcsp if not isinstance u unicode dcnl dcsp dcsp raise valueerror only dcsp unicode dcsp objects dcsp are dcsp escapable dcnl dcsp return urllib quote u encode utf8 safe ~
def prepare grant uri uri client id response type redirect uri none scope none state none kwargs dcsp params u response type response type u client id client id dcnl dcsp if redirect uri dcnl dcsp dcsp params append u redirect uri redirect uri dcnl dcsp if scope dcnl dcsp dcsp params append u scope scope dcnl dcsp if state dcnl dcsp dcsp params append u state state dcnl dcsp for k in kwargs dcnl dcsp dcsp params append unicode k kwargsk dcnl dcsp return add params to uri uri params
def prepare token request grant type body u kwargs dcsp params u grant type grant type dcnl dcsp for k in kwargs dcnl dcsp dcsp params append unicode k kwargsk dcnl dcsp return add params to qs body params
def parse authorization code response uri state none dcsp query urlparse urlparse uri query dcnl dcsp params dict urlparse parse qsl query dcnl dcsp if not u code in params dcnl dcsp dcsp raise keyerror missing dcsp code dcsp parameter dcsp in dcsp response dcnl dcsp if state and params get u state none state dcnl dcsp dcsp raise valueerror mismatching dcsp or dcsp missing dcsp state dcsp in dcsp response dcnl dcsp return params
def parse implicit response uri state none scope none dcsp fragment urlparse urlparse uri fragment dcnl dcsp params dict urlparse parse qsl fragment keep blank values true dcnl dcsp validate token parameters params scope dcnl dcsp if state and params get u state none state dcnl dcsp dcsp raise valueerror mismatching dcsp or dcsp missing dcsp state dcsp in dcsp params dcnl dcsp return params
def parse token response body scope none dcsp params json loads body dcnl dcsp validate token parameters params scope dcnl dcsp return params
def validate token parameters params scope none dcsp if not u access token in params dcnl dcsp dcsp raise keyerror missing dcsp access dcsp token dcsp parameter dcnl dcsp if not u token type in params dcnl dcsp dcsp raise keyerror missing dcsp token dcsp type dcsp parameter dcnl dcsp new scope params get u scope none dcnl dcsp if scope and new scope and scope new scope dcnl dcsp dcsp raise warning scope dcsp has dcsp changed dcsp to dcsp s new scope
def prepare mac header token uri key http method nonce none headers none body none ext u hash algorithm u hmacsha1 dcsp http method http method upper dcnl dcsp host port utils host from uri uri dcnl dcsp if hash algorithm lower u hmacsha1 dcnl dcsp dcsp h hashlib sha1 dcnl dcsp else dcnl dcsp dcsp h hashlib sha256 dcnl dcsp nonce nonce or u 0 1 format utils generate nonce utils generate timestamp dcnl dcsp sch net path par query fra urlparse uri dcnl dcsp if query dcnl dcsp dcsp request uri path + u + query dcnl dcsp else dcnl dcsp dcsp request uri path dcnl dcsp if body is not none dcnl dcsp dcsp bodyhash b2a base64 h body digest 1 decode utf8 dcnl dcsp else dcnl dcsp dcsp bodyhash u dcnl dcsp base dcnl dcsp base append nonce dcnl dcsp base append http method upper dcnl dcsp base append request uri dcnl dcsp base append host dcnl dcsp base append port dcnl dcsp base append bodyhash dcnl dcsp base append ext dcnl dcsp base string n join base + u n dcnl dcsp if isinstance key unicode dcnl dcsp dcsp key key encode utf8 dcnl dcsp sign hmac new key base string h dcnl dcsp sign b2a base64 sign digest 1 decode utf8 dcnl dcsp header dcnl dcsp header append u mac dcsp id s token dcnl dcsp header append u nonce s nonce dcnl dcsp if bodyhash dcnl dcsp dcsp header append u bodyhash s bodyhash dcnl dcsp if ext dcnl dcsp dcsp header append u ext s ext dcnl dcsp header append u mac s sign dcnl dcsp headers headers or dcnl dcsp headersu authorization u dcsp join header dcnl dcsp return headers
def prepare bearer uri token uri dcsp return add params to uri uri u access token token
def prepare bearer headers token headers none dcsp headers headers or dcnl dcsp headersu authorization u bearer dcsp s token dcnl dcsp return headers
def prepare bearer body token body u dcsp return add params to qs body u access token token
def encode params utf8 params dcsp encoded dcnl dcsp for k v in params dcnl dcsp dcsp encoded append k encode utf8 if isinstance k unicode else k v encode utf8 if isinstance v unicode else v dcnl dcsp return encoded
def decode params utf8 params dcsp decoded dcnl dcsp for k v in params dcnl dcsp dcsp decoded append k decode utf8 if isinstance k str else k v decode utf8 if isinstance v str else v dcnl dcsp return decoded
def urldecode query dcsp if query and not set query < urlencoded dcnl dcsp dcsp raise valueerror invalid dcsp characters dcsp in dcsp query dcsp string dcnl dcsp invalid hex u ^09afaf| 09afaf^09afaf dcnl dcsp if len re findall invalid hex query dcnl dcsp dcsp raise valueerror invalid dcsp hex dcsp encoding dcsp in dcsp query dcsp string dcnl dcsp query query decode utf8 if isinstance query str else query dcnl dcsp params urlparse parse qsl query keep blank values true dcnl dcsp return decode params utf8 params
def extract params raw dcsp if isinstance raw basestring dcnl dcsp dcsp try dcnl dcsp dcsp dcsp params urldecode raw dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp params none dcnl dcsp elif hasattr raw iter dcnl dcsp dcsp try dcnl dcsp dcsp dcsp dict raw dcnl dcsp dcsp except valueerror dcnl dcsp dcsp dcsp params none dcnl dcsp dcsp except typeerror dcnl dcsp dcsp dcsp params none dcnl dcsp dcsp else dcnl dcsp dcsp dcsp params list raw items if isinstance raw dict else raw dcnl dcsp dcsp dcsp params decode params utf8 params dcnl dcsp else dcnl dcsp dcsp params none dcnl dcsp return params
def generate nonce dcsp return unicode unicode random getrandbits 64 + generate timestamp
def generate timestamp dcsp return unicode int time time
def generate token length 30 chars unicode ascii character set dcsp rand random systemrandom dcnl dcsp return u join rand choice chars for x in range length
def add params to qs query params dcsp queryparams urlparse parse qsl query keep blank values true dcnl dcsp queryparams extend params dcnl dcsp return urlencode queryparams
def add params to uri uri params dcsp sch net path par query fra urlparse urlparse uri dcnl dcsp query add params to qs query params dcnl dcsp return urlparse urlunparse sch net path par query fra
def safe string equals a b dcsp if len a len b dcnl dcsp dcsp return false dcnl dcsp result 0 dcnl dcsp for x y in zip a b dcnl dcsp dcsp result | ord x ^ ord y dcnl dcsp return result 0
def add doc func doc dcsp func doc doc
def import module name dcsp import name dcnl dcsp return sys modulesname
def add move move dcsp setattr moveditems move name move
def remove move name dcsp try dcnl dcsp dcsp delattr moveditems name dcnl dcsp except attributeerror dcnl dcsp dcsp try dcnl dcsp dcsp dcsp del moves dict name dcnl dcsp dcsp except keyerror dcnl dcsp dcsp dcsp raise attributeerror no dcsp such dcsp move dcsp r name
def iterkeys d dcsp return getattr d iterkeys
def itervalues d dcsp return getattr d itervalues
def iteritems d dcsp return getattr d iteritems
def with metaclass meta base object dcsp return meta newbase base
def match hostname cert hostname dcsp if not cert dcnl dcsp dcsp raise valueerror empty dcsp or dcsp no dcsp certificate dcnl dcsp dnsnames dcnl dcsp san cert get subjectaltname dcnl dcsp for key value in san dcnl dcsp dcsp if key dns dcnl dcsp dcsp dcsp if dnsname to pat value match hostname dcnl dcsp dcsp dcsp dcsp return dcnl dcsp dcsp dcsp dnsnames append value dcnl dcsp if not dnsnames dcnl dcsp dcsp for sub in cert get subject dcnl dcsp dcsp dcsp for key value in sub dcnl dcsp dcsp dcsp dcsp if key commonname dcnl dcsp dcsp dcsp dcsp dcsp if dnsname to pat value match hostname dcnl dcsp dcsp dcsp dcsp dcsp dcsp return dcnl dcsp dcsp dcsp dcsp dcsp dnsnames append value dcnl dcsp if len dnsnames 1 dcnl dcsp dcsp raise certificateerror hostname dcsp r dcsp doesn t dcsp match dcsp either dcsp of dcsp s hostname dcsp join map repr dnsnames dcnl dcsp elif len dnsnames 1 dcnl dcsp dcsp raise certificateerror hostname dcsp r dcsp doesn t dcsp match dcsp r hostname dnsnames0 dcnl dcsp else dcnl dcsp dcsp raise certificateerror no dcsp appropriate dcsp commonname dcsp or dcsp subjectaltname dcsp fields dcsp were dcsp found
def add stderr logger level logging debug dcsp logger logging getlogger name dcnl dcsp handler logging streamhandler dcnl dcsp handler setformatter logging formatter asctime s dcsp levelname s dcsp message s dcnl dcsp logger addhandler handler dcnl dcsp logger setlevel level dcnl dcsp logger debug added dcsp an dcsp stderr dcsp logging dcsp handler dcsp to dcsp logger dcsp s name dcnl dcsp return handler
def split first s delims dcsp min idx none dcnl dcsp min delim none dcnl dcsp for d in delims dcnl dcsp dcsp idx s find d dcnl dcsp dcsp if idx < 0 dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if min idx is none or idx < min idx dcnl dcsp dcsp dcsp min idx idx dcnl dcsp dcsp dcsp min delim d dcnl dcsp if min idx is none or min idx < 0 dcnl dcsp dcsp return s none dcnl dcsp return s min idx s min idx + 1 min delim
def parse url url dcsp scheme none dcnl dcsp auth none dcnl dcsp host none dcnl dcsp port none dcnl dcsp path none dcnl dcsp fragment none dcnl dcsp query none dcnl dcsp if in url dcnl dcsp dcsp scheme url url split 1 dcnl dcsp url path delim split first url dcnl dcsp if delim dcnl dcsp dcsp path delim + path dcnl dcsp if in url dcnl dcsp dcsp auth url url split 1 dcnl dcsp if url and url0 dcnl dcsp dcsp host url url1 split 1 dcnl dcsp if in url dcnl dcsp dcsp host port url split 1 dcnl dcsp dcsp if not host dcnl dcsp dcsp dcsp host host dcnl dcsp dcsp if not port isdigit dcnl dcsp dcsp dcsp raise locationparseerror failed dcsp to dcsp parse dcsp s url dcnl dcsp dcsp port int port dcnl dcsp elif not host and url dcnl dcsp dcsp host url dcnl dcsp if not path dcnl dcsp dcsp return url scheme auth host port path query fragment dcnl dcsp if in path dcnl dcsp dcsp path fragment path split 1 dcnl dcsp if in path dcnl dcsp dcsp path query path split 1 dcnl dcsp return url scheme auth host port path query fragment
def get host url dcsp p parse url url dcnl dcsp return p scheme or http p hostname p port
def make headers keep alive none accept encoding none user agent none basic auth none dcsp headers dcnl dcsp if accept encoding dcnl dcsp dcsp if isinstance accept encoding str dcnl dcsp dcsp dcsp pass dcnl dcsp dcsp elif isinstance accept encoding list dcnl dcsp dcsp dcsp accept encoding join accept encoding dcnl dcsp dcsp else dcnl dcsp dcsp dcsp accept encoding gzip deflate dcnl dcsp dcsp headers acceptencoding accept encoding dcnl dcsp if user agent dcnl dcsp dcsp headers useragent user agent dcnl dcsp if keep alive dcnl dcsp dcsp headers connection keepalive dcnl dcsp if basic auth dcnl dcsp dcsp headers authorization basic dcsp + b64encode six b basic auth decode utf8 dcnl dcsp return headers
def is connection dropped conn dcsp sock getattr conn sock false dcnl dcsp if not sock dcnl dcsp dcsp return false dcnl dcsp if not poll dcnl dcsp dcsp if not select dcnl dcsp dcsp dcsp return false dcnl dcsp dcsp try dcnl dcsp dcsp dcsp return select sock 0 0 0 dcnl dcsp dcsp except socketerror dcnl dcsp dcsp dcsp return true dcnl dcsp p poll dcnl dcsp p register sock pollin dcnl dcsp for fno ev in p poll 0 0 dcnl dcsp dcsp if fno sock fileno dcnl dcsp dcsp dcsp return true
def choose boundary dcsp return uuid4 hex
def iter fields fields dcsp if isinstance fields dict dcnl dcsp dcsp return k v for k v in six iteritems fields dcnl dcsp return k v for k v in fields
def encode multipart formdata fields boundary none dcsp body bytesio dcnl dcsp if boundary is none dcnl dcsp dcsp boundary choose boundary dcnl dcsp for fieldname value in iter fields fields dcnl dcsp dcsp body write b s r n boundary dcnl dcsp dcsp if isinstance value tuple dcnl dcsp dcsp dcsp filename data value dcnl dcsp dcsp dcsp writer body write contentdisposition dcsp formdata dcsp name s dcsp filename s r n fieldname filename dcnl dcsp dcsp dcsp body write b contenttype dcsp s r n r n get content type filename dcnl dcsp dcsp else dcnl dcsp dcsp dcsp data value dcnl dcsp dcsp dcsp writer body write contentdisposition dcsp formdata dcsp name s r n fieldname dcnl dcsp dcsp dcsp body write contenttype dcsp text plain r n r n dcnl dcsp dcsp if isinstance data int dcnl dcsp dcsp dcsp data str data dcnl dcsp dcsp if isinstance data six text type dcnl dcsp dcsp dcsp writer body write data dcnl dcsp dcsp else dcnl dcsp dcsp dcsp body write data dcnl dcsp dcsp body write r n dcnl dcsp body write b s r n boundary dcnl dcsp content type b multipart formdata dcsp boundary s boundary dcnl dcsp return body getvalue content type
def connection from url url kw dcsp scheme host port get host url dcnl dcsp if scheme https dcnl dcsp dcsp return httpsconnectionpool host port port kw dcnl dcsp else dcnl dcsp dcsp return httpconnectionpool host port port kw
def basic auth str username password dcsp return basic dcsp + b64encode s s username password encode latin1 strip decode latin1
def negotiate value r dcsp authreq r headers get wwwauthenticate none dcnl dcsp if authreq dcnl dcsp dcsp rx re compile s negotiate s ^ re i dcnl dcsp dcsp mo rx search authreq dcnl dcsp dcsp if mo dcnl dcsp dcsp dcsp return mo group 1 dcnl dcsp return none
def dispatch hook key hooks hook data dcsp hooks hooks or dict dcnl dcsp if key in hooks dcnl dcsp dcsp hooks hooks get key dcnl dcsp dcsp if hasattr hooks call dcnl dcsp dcsp dcsp hooks hooks dcnl dcsp dcsp for hook in hooks dcnl dcsp dcsp dcsp hook data hook hook data dcnl dcsp dcsp dcsp if hook data is not none dcnl dcsp dcsp dcsp dcsp hook data hook data dcnl dcsp return hook data
def merge kwargs local kwarg default kwarg dcsp if default kwarg is none dcnl dcsp dcsp return local kwarg dcnl dcsp if isinstance local kwarg str dcnl dcsp dcsp return local kwarg dcnl dcsp if local kwarg is none dcnl dcsp dcsp return default kwarg dcnl dcsp if not hasattr default kwarg items dcnl dcsp dcsp return local kwarg dcnl dcsp default kwarg from key val list default kwarg dcnl dcsp local kwarg from key val list local kwarg dcnl dcsp kwargs default kwarg copy dcnl dcsp kwargs update local kwarg dcnl dcsp for k v in local kwarg items dcnl dcsp dcsp if v is none dcnl dcsp dcsp dcsp del kwargsk dcnl dcsp return kwargs
def session kwargs dcsp return session kwargs
def catch exceptions if in safe mode function dcsp def wrapped method url kwargs dcnl dcsp dcsp if kwargs get config and kwargs get config get safe mode or kwargs get session and kwargs get session config get safe mode dcnl dcsp dcsp dcsp try dcnl dcsp dcsp dcsp dcsp return function method url kwargs dcnl dcsp dcsp dcsp except requestexception connectionerror httperror socket timeout socket gaierror as e dcnl dcsp dcsp dcsp dcsp r response dcnl dcsp dcsp dcsp dcsp r error e dcnl dcsp dcsp dcsp dcsp r raw httpresponse dcnl dcsp dcsp dcsp dcsp r status code 0 dcnl dcsp dcsp dcsp dcsp return r dcnl dcsp dcsp return function method url kwargs dcnl dcsp return wrapped
catch exceptions if in safe mode dcnl def request method url kwargs dcsp adhoc session false dcnl dcsp session kwargs pop session none dcnl dcsp if session is none dcnl dcsp dcsp session sessions session dcnl dcsp dcsp adhoc session true dcnl dcsp try dcnl dcsp dcsp return session request method method url url kwargs dcnl dcsp finally dcnl dcsp dcsp if adhoc session dcnl dcsp dcsp dcsp session close
def get url kwargs dcsp kwargs setdefault allow redirects true dcnl dcsp return request get url kwargs
def options url kwargs dcsp kwargs setdefault allow redirects true dcnl dcsp return request options url kwargs
def head url kwargs dcsp kwargs setdefault allow redirects false dcnl dcsp return request head url kwargs
def post url data none kwargs dcsp return request post url data data kwargs
def put url data none kwargs dcsp return request put url data data kwargs
def patch url data none kwargs dcsp return request patch url data data kwargs
def delete url kwargs dcsp return request delete url kwargs
def register treebuilders from module dcsp this module sys modules pyal request bs4 builder dcnl dcsp for name in module all dcnl dcsp dcsp obj getattr module name dcnl dcsp dcsp if issubclass obj treebuilder dcnl dcsp dcsp dcsp setattr this module name obj dcnl dcsp dcsp dcsp this module all append name dcnl dcsp dcsp dcsp this module builder registry register obj
def alias attr dcsp property dcnl dcsp def alias self dcnl dcsp dcsp return getattr self attr dcnl dcsp alias setter dcnl dcsp def alias self dcnl dcsp dcsp return setattr self attr dcnl dcsp return alias
def encode multipart formdata fields files dcsp boundary this is the boundary dcnl dcsp crlf r n dcnl dcsp l dcnl dcsp for key value in fields dcnl dcsp dcsp l append + boundary dcnl dcsp dcsp l append contentdisposition dcsp formdata dcsp name s key dcnl dcsp dcsp l append dcnl dcsp dcsp l append value dcnl dcsp for key filename value in files dcnl dcsp dcsp l append + boundary dcnl dcsp dcsp l append contentdisposition dcsp formdata dcsp name s dcsp filename s key filename dcnl dcsp dcsp l append contenttype dcsp s get content type filename dcnl dcsp dcsp l append dcnl dcsp dcsp l append value dcnl dcsp l append + boundary + dcnl dcsp l append dcnl dcsp body crlf join l dcnl dcsp content type multipart formdata dcsp boundary s boundary dcnl dcsp return content type body
def urllib2 download client download url filename resuming false dcsp assert not resuming dcnl dcsp print downloading download url to filename dcnl dcsp request urllib2 request download url headers cookie gdriveid + client get gdriveid dcnl dcsp response urllib2 urlopen request dcnl dcsp import shutil dcnl dcsp with open filename wb as output dcnl dcsp dcsp shutil copyfileobj response output
command usage echo dcsp arguments dcnl def echo args dcsp print dcsp join expand command line args
command name hash usage compute dcsp hashes dcnl def print hash args dcsp import lixian hash dcnl dcsp lixian hash main expand command line args
command name diagnostics usage print dcsp helpful dcsp information dcsp for dcsp diagnostics dcnl def lx diagnostics args dcsp print default encoding dcsp default encoding dcnl dcsp import sys dcnl dcsp print sys getdefaultencoding dcsp sys getdefaultencoding dcnl dcsp print sys getfilesystemencoding dcsp sys getfilesystemencoding dcnl dcsp print print dcsp u u4e2d u6587 encode utf8 dcsp u u4e2d u6587 encode utf8 dcnl dcsp print print dcsp u u4e2d u6587 encode gbk dcsp u u4e2d u6587 encode gbk
command usage convert dcsp thunder dcsp and dcsp more dcsp to dcsp normal dcsp url dcnl def decode url args dcsp from lixian url import url unmask dcnl dcsp for x in args dcnl dcsp dcsp print url unmask x
command usage parse dcsp links dcsp from dcsp kuai xunlei com dcnl def kuai args dcsp import lixian kuai dcnl dcsp lixian kuai main args
command usage parse dcsp links dcnl def extend links args dcsp args parse command line args name dcnl dcsp import lixian tasks extended dcnl dcsp for x in lixian tasks extended extend links if not args name else lixian tasks extended extend links name args dcnl dcsp dcsp print x
command usage list dcsp files dcsp in dcsp local dcsp torrent dcnl def list torrent args dcsp args parse command line args size dcnl dcsp for p in args dcnl dcsp dcsp with open p rb as stream dcnl dcsp dcsp dcsp from lixian hash bt import bdecode dcnl dcsp dcsp dcsp info bdecode stream read info dcnl dcsp dcsp dcsp print info name decode utf8 encode default encoding dcnl dcsp dcsp dcsp if files in info dcnl dcsp dcsp dcsp dcsp for f in info files dcnl dcsp dcsp dcsp dcsp dcsp if f path 0 startswith padding file dcnl dcsp dcsp dcsp dcsp dcsp dcsp continue dcnl dcsp dcsp dcsp dcsp dcsp path join f path decode utf8 encode default encoding dcnl dcsp dcsp dcsp dcsp dcsp if args size dcnl dcsp dcsp dcsp dcsp dcsp dcsp from lixian util import format size dcnl dcsp dcsp dcsp dcsp dcsp dcsp print s dcsp s path format size f length dcnl dcsp dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp dcsp print path dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp path info name decode utf8 encode default encoding dcnl dcsp dcsp dcsp dcsp if args size dcnl dcsp dcsp dcsp dcsp dcsp from lixian util import format size dcnl dcsp dcsp dcsp dcsp dcsp print s dcsp s path format size info length dcnl dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp print path
command usage get dcsp torrent dcsp by dcsp task dcsp id dcsp or dcsp info dcsp hash dcnl def get torrent args dcsp from lixian cli import parse login command line dcnl dcsp args parse login command line args dcnl dcsp client xunleiclient args username args password args cookies dcnl dcsp for id in args dcnl dcsp dcsp id id lower dcnl dcsp dcsp import re dcnl dcsp dcsp if re match afaf09 40 id dcnl dcsp dcsp dcsp torrent client get torrent file by info hash id dcnl dcsp dcsp elif re match d+ id dcnl dcsp dcsp dcsp tasks client read all tasks dcnl dcsp dcsp dcsp from lixian tasks import find task by id dcnl dcsp dcsp dcsp task find task by id tasks id dcnl dcsp dcsp dcsp assert task id + dcsp not dcsp found dcnl dcsp dcsp dcsp id task bt hash dcnl dcsp dcsp dcsp id id lower dcnl dcsp dcsp dcsp torrent client get torrent file by info hash id dcnl dcsp dcsp else dcnl dcsp dcsp dcsp raise notimplementederror dcnl dcsp dcsp path id + torrent dcnl dcsp dcsp print path dcnl dcsp dcsp with open path wb as output dcnl dcsp dcsp dcsp output write torrent
command usage export dcsp task dcsp download dcsp urls dcsp as dcsp aria2 dcsp format dcnl def export aria2 args dcsp from lixian cli import parse login command line dcnl dcsp args parse login command line args dcnl dcsp print export aria2 conf args
command usage concurrently dcsp download dcsp tasks dcsp in dcsp aria2 dcnl def download aria2 args dcsp from lixian cli import parse login command line dcnl dcsp args parse login command line args keys j alias maxconcurrentdownloads j dcnl dcsp j get config aria2j args j or 5 dcnl dcsp aria2 conf export aria2 conf args dcnl dcsp import platform dcnl dcsp if platform system windows dcnl dcsp dcsp download aria2 temp aria2 conf j dcnl dcsp else dcnl dcsp dcsp download aria2 stdin aria2 conf j
def encode multipart formdata fields files dcsp boundary this is the boundary dcnl dcsp crlf r n dcnl dcsp l dcnl dcsp for key value in fields dcnl dcsp dcsp l append + boundary dcnl dcsp dcsp l append contentdisposition dcsp formdata dcsp name s key dcnl dcsp dcsp l append dcnl dcsp dcsp l append value dcnl dcsp for key filename value in files dcnl dcsp dcsp l append + boundary dcnl dcsp dcsp l append contentdisposition dcsp formdata dcsp name s dcsp filename s key filename dcnl dcsp dcsp l append contenttype dcsp s get content type filename dcnl dcsp dcsp l append dcnl dcsp dcsp l append value dcnl dcsp l append + boundary + dcnl dcsp l append dcnl dcsp body crlf join l dcnl dcsp content type multipart formdata dcsp boundary s boundary dcnl dcsp return content type body
download tool urllib2 dcnl def urllib2 download client download url filename resuming false dcsp assert not resuming dcnl dcsp print downloading download url to filename dcnl dcsp request urllib2 request download url headers cookie gdriveid + client get gdriveid dcnl dcsp response urllib2 urlopen request dcnl dcsp import shutil dcnl dcsp with open filename wb as output dcnl dcsp dcsp shutil copyfileobj response output
command usage parse dcsp links dcsp from dcsp kuai xunlei com dcnl def kuai args dcsp import lixian kuai dcnl dcsp lixian kuai main args
command usage convert dcsp thunder dcsp and dcsp more dcsp to dcsp normal dcsp url dcnl def decode url args dcsp from lixian url import url unmask dcnl dcsp for x in args dcnl dcsp dcsp print url unmask x
command name gettorrent usage get dcsp torrent dcsp by dcsp task dcsp id dcsp or dcsp info dcsp hash dcnl command line parser dcnl with parser parse login dcnl def get torrent args dcsp client create client args dcnl dcsp for id in args dcnl dcsp dcsp id id lower dcnl dcsp dcsp import re dcnl dcsp dcsp if re match afaf09 40 id dcnl dcsp dcsp dcsp torrent client get torrent file by info hash id dcnl dcsp dcsp elif re match d+ id dcnl dcsp dcsp dcsp import lixian query dcnl dcsp dcsp dcsp task lixian query get task by id client id dcnl dcsp dcsp dcsp id task bt hash dcnl dcsp dcsp dcsp id id lower dcnl dcsp dcsp dcsp torrent client get torrent file by info hash id dcnl dcsp dcsp else dcnl dcsp dcsp dcsp raise notimplementederror dcnl dcsp dcsp path id + torrent dcnl dcsp dcsp print path dcnl dcsp dcsp with open path wb as output dcnl dcsp dcsp dcsp output write torrent
command usage parse dcsp links dcnl def extend links args dcsp from lixian cli parser import parse command line dcnl dcsp from lixian encoding import default encoding dcnl dcsp args parse command line args name dcnl dcsp import lixian plugins parsers dcnl dcsp if args name dcnl dcsp dcsp for x in lixian plugins parsers extend links name args dcnl dcsp dcsp dcsp print x encode default encoding dcnl dcsp else dcnl dcsp dcsp for x in lixian plugins parsers extend links args dcnl dcsp dcsp dcsp print x
command name hash usage compute dcsp hashes dcnl def print hash args dcsp import lixian hash dcnl dcsp import lixian cli parser dcnl dcsp lixian hash main lixian cli parser expand command line args
command name diagnostics usage print dcsp helpful dcsp information dcsp for dcsp diagnostics dcnl def lx diagnostics args dcsp from lixian encoding import default encoding dcnl dcsp print default encoding dcsp default encoding dcnl dcsp import sys dcnl dcsp print sys getdefaultencoding dcsp sys getdefaultencoding dcnl dcsp print sys getfilesystemencoding dcsp sys getfilesystemencoding dcnl dcsp print print dcsp u u4e2d u6587 encode utf8 dcsp u u4e2d u6587 encode utf8 dcnl dcsp print print dcsp u u4e2d u6587 encode gbk dcsp u u4e2d u6587 encode gbk
command usage echo dcsp arguments dcnl def echo args dcsp import lixian cli parser dcnl dcsp print dcsp join lixian cli parser expand command line args
command usage export dcsp task dcsp download dcsp urls dcsp as dcsp aria2 dcsp format dcnl command line parser dcnl with parser parse login dcnl def export aria2 args dcsp print export aria2 conf args
command usage concurrently dcsp download dcsp tasks dcsp in dcsp aria2 dcnl command line parser dcnl with parser parse login dcnl command line value maxconcurrentdownloads alias j default get config aria2j 5 dcnl def download aria2 args dcsp aria2 conf export aria2 conf args dcnl dcsp import platform dcnl dcsp if platform system windows dcnl dcsp dcsp download aria2 temp aria2 conf args max concurrent downloads dcnl dcsp else dcnl dcsp dcsp download aria2 stdin aria2 conf args max concurrent downloads
command usage list dcsp files dcsp in dcsp local dcsp torrent dcnl def list torrent args dcsp args parse command line args size default size get config size dcnl dcsp torrents args dcnl dcsp if not torrents dcnl dcsp dcsp from glob import glob dcnl dcsp dcsp torrents glob torrent dcnl dcsp if not torrents dcnl dcsp dcsp raise exception no dcsp torrent dcsp file dcsp found dcnl dcsp for p in torrents dcnl dcsp dcsp with open p rb as stream dcnl dcsp dcsp dcsp from lixian hash bt import bdecode dcnl dcsp dcsp dcsp b bdecode stream read dcnl dcsp dcsp dcsp encoding b encoding b dcnl dcsp dcsp dcsp info b info dcnl dcsp dcsp dcsp from lixian util import format size dcnl dcsp dcsp dcsp if args size dcnl dcsp dcsp dcsp dcsp size sum f length for f in info files if files in info else info length dcnl dcsp dcsp dcsp dcsp print b name info encoding encode default encoding format size size dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp print b name info encoding encode default encoding dcnl dcsp dcsp dcsp if files in info dcnl dcsp dcsp dcsp dcsp for f in info files dcnl dcsp dcsp dcsp dcsp dcsp if f path 0 startswith padding file dcnl dcsp dcsp dcsp dcsp dcsp dcsp continue dcnl dcsp dcsp dcsp dcsp dcsp path join b path f encoding encode default encoding dcnl dcsp dcsp dcsp dcsp dcsp if args size dcnl dcsp dcsp dcsp dcsp dcsp dcsp print s dcsp s path format size f length dcnl dcsp dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp dcsp print path dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp path b name info encoding encode default encoding dcnl dcsp dcsp dcsp dcsp if args size dcnl dcsp dcsp dcsp dcsp dcsp from lixian util import format size dcnl dcsp dcsp dcsp dcsp dcsp print s dcsp s path format size info length dcnl dcsp dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp dcsp print path
task filter protocol size dcnl def filter by size keyword task dcsp m re match ^ < d+ d+ gm + keyword flags re i dcnl dcsp assert m keyword dcnl dcsp less or great n u less or more m groups dcnl dcsp assert bool less or great ^ bool less or more must dcsp bt dcsp <size dcsp size dcsp size dcsp or dcsp size+ dcnl dcsp size float n none 1 g 1000 3 g 1000 3 m 1000 2 m 1000 2 u dcnl dcsp if less or great < or less or more dcnl dcsp dcsp return task size < size dcnl dcsp else dcnl dcsp dcsp return task size size
task filter protocol sort batch true dcnl def sort by name keyword tasks dcsp return sorted tasks key lambda x x name
task filter protocol totalsize batch true dcnl def fetch by total size keyword tasks dcsp m re match ^ d+ d+ gm keyword flags re i dcnl dcsp assert m keyword dcnl dcsp n u m groups dcnl dcsp limit float n none 1 g 1000 3 g 1000 3 m 1000 2 m 1000 2 u dcnl dcsp total 0 dcnl dcsp results dcnl dcsp for t in tasks dcnl dcsp dcsp total + t size dcnl dcsp dcsp if total < limit dcnl dcsp dcsp dcsp results append t dcnl dcsp dcsp else dcnl dcsp dcsp dcsp return results dcnl dcsp return results
def order x noneislast true decreasing false dcsp omitnone false dcnl dcsp if noneislast is none dcnl dcsp dcsp noneislast true dcnl dcsp dcsp omitnone true dcnl dcsp n len x dcnl dcsp ix range n dcnl dcsp if none not in x dcnl dcsp dcsp ix sort reverse decreasing key lambda j xj dcnl dcsp else dcnl dcsp dcsp def key i x x dcnl dcsp dcsp dcsp elem xi dcnl dcsp dcsp dcsp if decreasing noneislast dcnl dcsp dcsp dcsp dcsp return not elem is none elem dcnl dcsp dcsp dcsp else dcnl dcsp dcsp dcsp dcsp return elem is none elem dcnl dcsp dcsp ix range n dcnl dcsp dcsp ix sort key key reverse decreasing dcnl dcsp if omitnone dcnl dcsp dcsp n len x dcnl dcsp dcsp for i in range n 1 1 1 dcnl dcsp dcsp dcsp if xixi is none dcnl dcsp dcsp dcsp dcsp n 1 dcnl dcsp dcsp return ix n dcnl dcsp return ix
def rank x noneislast true decreasing false ties first dcsp omitnone false dcnl dcsp if noneislast is none dcnl dcsp dcsp noneislast true dcnl dcsp dcsp omitnone true dcnl dcsp o order x noneislast noneislast decreasing decreasing dcnl dcsp r o dcnl dcsp n len o dcnl dcsp for i in range n dcnl dcsp dcsp roi i dcnl dcsp if ties first or ties not in first average min max random dcnl dcsp dcsp return r dcnl dcsp blocks dcnl dcsp newblock dcnl dcsp for i in range 1 n dcnl dcsp dcsp if xoi xo i 1 dcnl dcsp dcsp dcsp if i 1 not in newblock dcnl dcsp dcsp dcsp dcsp newblock append i 1 dcnl dcsp dcsp dcsp newblock append i dcnl dcsp dcsp elif len newblock 0 dcnl dcsp dcsp dcsp blocks append newblock dcnl dcsp dcsp dcsp newblock dcnl dcsp if len newblock 0 dcnl dcsp dcsp blocks append newblock dcnl dcsp for i block in enumerate blocks dcnl dcsp dcsp if xoblock0 is none dcnl dcsp dcsp dcsp continue dcnl dcsp dcsp if ties average dcnl dcsp dcsp dcsp s 0 0 dcnl dcsp dcsp dcsp for j in block dcnl dcsp dcsp dcsp dcsp s + j dcnl dcsp dcsp dcsp s float len block dcnl dcsp dcsp dcsp for j in block dcnl dcsp dcsp dcsp dcsp roj s dcnl dcsp dcsp elif ties min dcnl dcsp dcsp dcsp s min block dcnl dcsp dcsp dcsp for j in block dcnl dcsp dcsp dcsp dcsp roj s dcnl dcsp dcsp elif ties max dcnl dcsp dcsp dcsp s max block dcnl dcsp dcsp dcsp for j in block dcnl dcsp dcsp dcsp dcsp roj s dcnl dcsp dcsp else dcnl dcsp dcsp dcsp for i j in enumerate block dcnl dcsp dcsp dcsp dcsp roj j dcnl dcsp if omitnone dcnl dcsp dcsp r rj for j in range n if xj is not none dcnl dcsp return r
def fuzzy search query elements key lambda x x rank true seq 3 dcsp r match rank query key el for el in elements seq seq dcnl dcsp out el ri for i el in enumerate elements if ri is not none dcnl dcsp return el0 for el in sorted out key lambda el el1
def get results arg dcsp bookmarks tower get bookmarks bookmarks file dcnl dcsp if arg dcnl dcsp dcsp results sorted bookmarks key lambda x x sort order dcnl dcsp else dcnl dcsp dcsp titles alp fuzzy search arg bookmarks key lambda x x title dcnl dcsp dcsp paths alp fuzzy search arg bookmarks key lambda x x path dcnl dcsp dcsp results set titles union set paths dcnl dcsp return results
def get items arg dcsp items dcnl dcsp for count bookmark in enumerate get results arg dcnl dcsp dcsp items append alp item title bookmark title subtitle bookmark path arg bookmark path icon clonerepoicon png dcnl dcsp return items
def configure cache name cache backend sqlite expire after none allowable codes 200 allowable methods get monkey patch true backend options dcsp try dcnl dcsp dcsp global cache dcnl dcsp dcsp cache backends registrybackend cache name backend options dcnl dcsp except keyerror dcnl dcsp dcsp raise valueerror unsupported dcsp backend dcsp s dcsp try dcsp one dcsp of dcsp s backend dcsp join backends registry keys dcnl dcsp if monkey patch dcnl dcsp dcsp redo patch dcnl dcsp config expire after expire after dcnl dcsp config allowable codes allowable codes dcnl dcsp config allowable methods allowable methods
def has url url dcsp return cache has url url
