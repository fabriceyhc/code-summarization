Ignores a twitter account from showing up in the AoA tool
Unignores a twitter account from showing up in the AoA tool
Return the dict needed for tweetshtml to render a tweet + replies
Fetch a list of tweets DCNL Args: DCNL limit: the maximum number of tweets returned DCNL max_id: Return tweets with tweet_id less than this DCNL reply_to: Return only tweets that are replies to the given Tweet If DCNL None, return only top-level (non-reply) tweets DCNL filter: One of the keys from FILTERS
AJAX view returning a list of tweets
Customer Care Landing page
Moderate banned AoA twitter handles
Post a tweet, and return a rendering of it (and any replies)
Hide the tweet with a given ID Only hides tweets that are not replies DCNL and do not have replies DCNL Returns proper HTTP status codes
Handle the reply save signal DCNL * We award the Army of Awesome badge on 50 tweets
The moderation queue
Update the status of a flagged object
Build and send the announcement emails to a group
An ajax view to create a new announcement for the current locale
An ajax view to delete an announcement
Sends the award notification email DCNL :arg award: the django-badger Award instance
Get or create a badge DCNL The badge_template is a dict and must have a slug key All DCNL the values in the dict will be formatted with year, if one DCNL is specified For example: DCNL badge_template[\slug\]format(year=year) DCNL If a badge with the specified slug doesn\t exist, we create DCNL the badge with the specified slug and the rest of the items DCNL in the dict
Notifies award recipient that he/she has an award!
Get new visitor data from Google Analytics and save
Calculate new l10n coverage numbers and save DCNL L10n coverage is a measure of the amount of translations that are DCNL up to date, weighted by the number of visits for each locale DCNL The "algorithm" (see Bug 727084): DCNL SUMO visits = Total SUMO visits for the last 30 days; DCNL Total translated = 0; DCNL For each locale { DCNL Total up to date = Total up to date + DCNL ((Number of up to date articles in the en-US top 50 visited)/50 ) * DCNL (Visitors for that locale / SUMO visits)); DCNL An up to date article is any of the following: DCNL * An en-US article (by definition it is always up to date) DCNL * The latest en-US revision has been translated DCNL * There are only new revisions with TYPO_SIGNIFICANCE not translated DCNL * There is only one revision of MEDIUM_SIGNIFICANCE not translated
Calculate and save contributor metrics
Calculate and save the support forum contributor counts DCNL An support forum contributor is a user that has replied 10 times DCNL in the past 30 days to questions that aren\t his/her own
Calculate and save the KB (en-US and L10n) contributor counts DCNL A KB contributor is a user that has edited or reviewed a Revision DCNL in the last 30 days
Calculate and save the AoA contributor counts DCNL An AoA contributor is a user that has replied in the last 30 days
Get new search CTR data from Google Analytics and save
Returns the date of the latest metric value
Get the top documents by visits
Exit survey handling DCNL * Collect new exit survey results DCNL * Save results to our metrics table DCNL * Add new emails collected to the exit survey
Collect and save new exit survey results
Add question askers to a surveygizmo campaign to get surveyed
Of the group ``users``, count how many made a contribution in ``date_range``
Get the email addresses collected between startdate and enddate
Add email to the exit survey campaign
Collect and aggregate the exit survey results for the date
Return the daily grouped queryset we need for model_cls
Return the monthly grouped queryset we need for model_cls
The date from which we start querying monthly data
Remap the query result DCNL kwargs = { DCNL <label>=[ DCNL {\count\: 45, \month\: 2L, \year\: 2010L}, DCNL {\count\: 6, \month\: 2L, \year\: 2010L},   # Note duplicate date DCNL {\count\: 12, \month\: 1L, \year\: 2010L}, DCNL {\count\: 1, \month\: 12L, \year\: 2009L}, DCNL <label>=[{},], DCNL returns [ DCNL datetimedate(2009, 12, 1): {\<label>\: 1}, DCNL datetimedate(2010, 1, 1): {\<label>\: 12}, DCNL datetimedate(2010, 2, 1): {\<label>\: 51}  # Note summed counts
Merge query results arrays into one array DCNL From: DCNL [{"date": "2011-10-01", "votes": 3},] DCNL and DCNL [{"date": "2011-10-01", "helpful": 7},] DCNL To: DCNL [{"date": "2011-10-01", "votes": 3, "helpful": 7},]
Return a DB cursor for reading
Parse a text date like ``"2004-08-30`` into a triple of numbers DCNL May fling ValueErrors or TypeErrors around if the input or date is invalid DCNL It should at least be a string--I mean, come on
Check if the user has a permission on a specific object DCNL Returns boolean
Check if the user has a permission or owns the object DCNL Ownership is determined by comparing perm_objfield_name to the user in DCNL context
Given a user, a permission, an object (obj) and another object to check DCNL permissions against (perm_obj), return True if the user has perm on DCNL obj
Return whether a user has a permission globally or on a given object
Return whether an object has an authority permission that references it DCNL If it doesn\t, we sometimes treat that permission as free to everyone, DCNL since the auth backends we currently use have no concept of granting a DCNL permission to the world DCNL Considers only approved permissions to exist
Helper function that returns a decorator DCNL * redirect func ----- If truthy, a redirect will occur DCNL * deny_func --------- If truthy, HttpResponseForbidden is returned DCNL * redirect_url_func - Evaluated at view time, returns the redirect URL DCNL ie where to go if redirect_func is truthy DCNL * redirect_field ---- What field to set in the url, defaults to Django\s DCNL Set this to None to exclude it from the URL
Requires that the user *not* be logged in
Requires that the user is logged in
A replacement for djangocontribauthdecoratorspermission_required DCNL that doesn\t ask authenticated users to log in
Act like permission_required_or_403 but also grant permission to owners DCNL Arguments: DCNL perm: authority permission to check, eg \forums_forumedit_forum\ DCNL owner_attr: Attr of model object that references the owner DCNL obj_lookup: Triple that specifies a lookup to the object on which DCNL ownership should be compared Items in the tuple are DCNL (model class or import path thereof, DCNL kwarg name specifying field and comparator (eg \id__exact\), DCNL name of kwarg containing the value to which to compare) DCNL perm_obj_lookup: Triple that specifies a lookup to the object on which DCNL to check for permission Elements of the tuple are as in DCNL obj_lookup
Return the object indicated by the lookup triple and the kwargs passed DCNL to the view
Given an uploaded file, a user, and other data, it creates an Image
Uploads an image from the request
Checks the permissions for user on media (image or video) DCNL Pass in: * media object (Image or Video) DCNL * (logged in) user DCNL * perm_type = \delete\, \change\, \add\ DCNL Raises PermissionDenied if not allowed Owner is always allowed
Save a media form, add user to updated_by DCNL Warning: this assumes you\re calling it from a subclass of MediaForm
The media gallery DCNL Filter can be set to \images\ or \videos\
Finalizes an uploaded draft
Delete an existing draft for the user
AJAX endpoint to media gallery DCNL Returns an HTML list representation of the media
Search the media gallery
Delete media and redirect to gallery view
Edit media means only changing the description, for now
The media page
Upload images or videos from requestFILES
Returns an image or video along with media format for the image
Get video and image drafts for a given user
Initializes the media form with an Image/Video instance and POSTed data DCNL form_cls is a django ModelForm DCNL Request method must be POST for POST data to be bound DCNL exclude_fields contains the list of fields to default to their current DCNL value from the Image/Video object
Send a welcome email to first time contributors DCNL Anyone who has made a contribution more than 24 hours ago and has not DCNL already gotten a welcome email should get a welcome email
Get the top Support Forum contributors
Get the top KB editors (locale=\en-US\)
Get the top l10n contributors for the KB
Get the top Army of Awesome contributors
Apply the date and locale filters to the EU query
Community hub landing page
Find users by username and displayname DCNL Uses the ES user\s index
Top contributors list view
Make sure the locale is enabled on SUMO
Return a URL to the group\s avatar
Edit group avatar
Delete group avatar
Add a member to the group
Remove a member from the group
Add a leader to the group
Remove a leader from the group
Join the Contributors group
Can the given user edit the given group profile?
Can the given user add and remove leaders?
Return the most recent post in the given set, excluding the given post DCNL If there are none, return None
When a user\s username is changed, we must reindex the threads DCNL they participated in
View all the forums
View all the threads in a forum
View all the posts in a thread
Reply to a thread
Start a new thread
Lock/Unlock a thread
Mark/unmark a thread sticky
Edit a thread
Delete a thread
Move a thread
Edit a post
Delete a post
Watch/unwatch a thread (based on \watch\ POST param)
Watch/unwatch a forum (based on \watch\ POST param)
Ajax preview of posts
Return an interable of EmailMessages to send when a new post is DCNL created
Return an interable of EmailMessages to send when a new thread is DCNL created
Return True if `user` is watching the discussion for `locale` and DCNL False, otherwise
Return the most recent post in the given set, excluding the given post DCNL If there are none, return None
Given a slug and a request, get the document or 404
View all the threads in a discussion forum
View all the posts in a thread
Ratelimiting helper for kbforum threads and replies DCNL They are ratelimited together with the same key
Reply to a thread
Start a new thread
Lock/Unlock a thread
Mark/unmark a thread sticky
Edit a thread
Delete a thread
Edit a post
Delete a post
Watch/unwatch a thread (based on \watch\ POST param)
Watch/unwatch a locale
Watch/unwatch a document (based on \watch\ POST param)
Ajax preview of posts
The product picker page
The product landing page
The document listing page for a product + topic
Build a query that matches objects with a content type that matches an action
Hit a simple push endpoint to send a notification to a user DCNL Handles and record any HTTP errors May retry up to ``max_retries`` DCNL times by recursing DCNL This function tries hard to handle any potential errors, so it may DCNL be used in a loop that iterates over many actions to send, without DCNL the loop needing to contain error handling logic DCNL @param endpoint: The url to PUT to DCNL @param version: The version to include in the push Should be an integer DCNL greater than the version used every other time this endpoint has DCNL been called Timestamps and DB auto increment fields work well DCNL @param max_retries: The maximum number of times to try again
Call every notification handler for a notification
Send simple push notifications to users that have opted in to them DCNL This will be called as a part of a celery task
When an Action is created, notify every user following something in the Action
Register a function to be called via Celery for every notification DCNL This may be used as a decorator or as a simple function
Send notification of a new private message
Send a private message DCNL :arg to: a list of Users to send the message to DCNL :arg sender: the User who is sending the message DCNL :arg text: the message text
Returns the number of unread messages for the specified user
Adds the unread private messages count to the context DCNL * Returns 0 for anonymous users DCNL * Returns 0 if waffle flag is off
Send a new private message
Apply action to selected messages
Ajax preview of posts
Print timeline block
Make a compatible version of pip importable Raise a RuntimeError if we DCNL couldn\t
Return a short, 7-bit-safe representation of a hash DCNL If you pass a sha256, this results in the hash algorithm that the Wheel DCNL format (PEP 427) uses, except here it\s intended to be run across the DCNL downloaded archive before unpacking
Return the path and line number of the file from which an DCNL InstallRequirement came
Yield hashes from contiguous comment lines before line ``line_number``
Delegate to pip the given args (starting with the subcommand), and raise DCNL ``PipException`` if something goes wrong
Return the hash of a downloaded file
Return whether this is probably a git sha
Return an iterable of filtered arguments DCNL :arg argv: Arguments, starting after the subcommand DCNL :arg want_paths: If True, the returned iterable includes the paths to any DCNL requirements files following a ``-r`` or ``--requirement`` option DCNL :arg want_other: If True, the returned iterable includes the args that are DCNL not a requirement-file path or a ``-r`` or ``--requirement`` flag
Return the peep hash of one or more files, returning a shell status code DCNL or raising a PipException DCNL :arg argv: The commandline args, starting after the subcommand
Memoize a method that should return the same result every time on a DCNL given instance
Return a PackageFinder respecting command-line options DCNL :arg argv: Everything after the subcommand
Return a map of key -> list of things
Execute something before the first item of iter, something else for each DCNL item, and a third thing after the last DCNL If there are no items in the iterable, don\t execute anything
Return a list of DownloadedReqs representing the requirements parsed DCNL out of a given requirements file DCNL :arg path: The path to the requirements file DCNL :arg argv: The commandline args, starting after the subcommand
Perform the ``peep install`` subcommand, returning a shell status code DCNL or raising a PipException DCNL :arg argv: The commandline args, starting after the subcommand
Convert a peep requirements file to one compatble with pip-8 hashing DCNL Loses comments and tromps on URLs, so the result will need a little manual DCNL massaging, but the hard part--the hash conversion--is done for you
Be the top-level entrypoint Return a shell status code
Do typical sumo update
Of the group ``users``, count how many made a contribution in ``date_range``
This function provides functionality for the \ifhasperm\ template tag DCNL Syntax:: DCNL {% ifhasperm PERMISSION_LABELCHECK_NAME USER *OBJS %} DCNL lalala DCNL {% else %} DCNL meh DCNL {% endifhasperm %} DCNL {% ifhasperm "poll_permissionchange_poll" requestuser %} DCNL lalala DCNL {% else %} DCNL meh DCNL {% endifhasperm %}
Renders an "add permissions" form for the given object If no object DCNL is given it will render a select box to choose from DCNL Syntax:: DCNL {% permission_form for OBJ using PERMISSION_LABELCHECK_NAME [with TEMPLATE] %} DCNL {% permission_form for lesson using "lesson_permissionadd_lesson" %}
Renders an "add permissions" form for the given object If no object DCNL is given it will render a select box to choose from DCNL Syntax:: DCNL {% permission_request_form for OBJ and PERMISSION_LABELCHECK_NAME [with TEMPLATE] %} DCNL {% permission_request_form for lesson using "lesson_permissionadd_lesson" DCNL with "authority/permission_request_formhtml" %}
Retrieves all permissions associated with the given obj and user DCNL and assigns the result to a context variable DCNL Syntax:: DCNL {% get_permissions obj %} DCNL {% for perm in permissions %} DCNL {{ perm }} DCNL {% endfor %} DCNL {% get_permissions obj as "my_permissions" %} DCNL {% get_permissions obj for requestuser as "my_permissions" %}
Retrieves all permissions requests associated with the given obj and user DCNL and assigns the result to a context variable DCNL Syntax:: DCNL {% get_permission_requests obj %} DCNL {% for perm in permissions %} DCNL {{ perm }} DCNL {% endfor %} DCNL {% get_permission_requests obj as "my_permissions" %} DCNL {% get_permission_requests obj for requestuser as "my_permissions" %}
Performs a permission check with the given signature, user and objects DCNL and assigns the result to a context variable DCNL Syntax:: DCNL {% get_permission PERMISSION_LABELCHECK_NAME for USER and *OBJS [as VARNAME] %} DCNL {% get_permission "poll_permissionchange_poll" DCNL for requestuser and poll as "is_allowed" %} DCNL {% get_permission "poll_permissionchange_poll" DCNL for requestuser and poll,second_poll as "is_allowed" %} DCNL {% if is_allowed %} DCNL I\ve got ze power to change ze pollllllzzz Muahahaa DCNL {% else %} DCNL Meh No power for meeeee DCNL {% endif %}
Performs a permission request check with the given signature, user and objects DCNL and assigns the result to a context variable DCNL Syntax:: DCNL {% get_permission_request PERMISSION_LABELCHECK_NAME for USER and *OBJS [as VARNAME] %} DCNL {% get_permission_request "poll_permissionchange_poll" DCNL for requestuser and poll as "asked_for_permissio" %} DCNL {% get_permission_request "poll_permissionchange_poll" DCNL for requestuser and poll,second_poll as "asked_for_permissio" %} DCNL {% if asked_for_permissio %} DCNL Dude, you already asked for permission! DCNL {% else %} DCNL Oh, please fill out this 20 page form and sign here DCNL {% endif %}
Renders a html link to the delete view of the given permission Returns DCNL no content if the request-user has no permission to delete foreign DCNL permissions
Renders a html link to the delete view of the given permission request DCNL Returns no content if the request-user has no permission to delete foreign DCNL permissions
Renders a html link to the approve view of the given permission request DCNL Returns no content if the request-user has no permission to delete foreign DCNL permissions
Goes and imports the permissions submodule of every app in INSTALLED_APPS DCNL to make sure the permission set classes are registered correctly
Decorator for views that checks whether a user has a particular permission DCNL enabled, redirecting to the log-in page if necessary
Decorator that wraps the permission_required decorator and returns a DCNL permission denied (403) page instead of redirecting to the login URL
Default 403 handler DCNL Templates: `403html` DCNL Context: DCNL request_path DCNL The path of the requested URL (eg, \/app/pages/bad_page/\)
Fetch and store a webpay product icon DCNL Parameters: DCNL **url** DCNL Absolute URL of icon DCNL **ext_size** DCNL The height/width size that the developer claims it to be DCNL **size** DCNL The height/width webpay wants us to resize it to DCNL The icon will be resized if its ext_size is larger than size DCNL See webpay for details on how this is used for in-app payments
Generates a webpay/solitude external ID given an addon\s primary key
Prepare a JWT describing the item about to be purchased when DCNL working with navigatormozPay() DCNL See the MDN docs for details on the JWT fields: DCNL https://developermozillaorg/en-US/Marketplace/Monetization DCNL /In-app_payments_section/mozPay_iap
Returns a signed JWT to use for signature checking DCNL This is for Nagios checks to ensure that Marketplace\s DCNL signed tokens are valid when processed by Webpay
Task intended to run via command line to update all apps\ supported locales DCNL based on the current version
Clean out apps signed for reviewers
Calculate popularity of app for all regions and per region DCNL Returns value in the format of:: DCNL {\all\: <global installs>, DCNL <region_slug>: <regional installs>,
Update app install counts for all published apps DCNL We break these into chunks so we can bulk index them Each chunk will DCNL process the apps in it and reindex them in bulk After all the chunks are DCNL processed we find records that haven\t been updated and purge/reindex those DCNL so we nullify their values
Calculate trending for app for all regions and per region DCNL a = installs from 8 days ago to 1 day ago DCNL b = installs from 29 days ago to 9 days ago, averaged per week DCNL trending = (a - b) / b if a > 100 and b > 1 else 0 DCNL Returns value in the format of:: DCNL {\all\: <global trending score>, DCNL <region_slug>: <regional trending score>,
Update trending for all published apps DCNL We break these into chunks so we can bulk index them Each chunk will DCNL process the apps in it and reindex them in bulk After all the chunks are DCNL processed we find records that haven\t been updated and purge/reindex those DCNL so we nullify their values
Sets up tasks to do user install dumps
Site-wide garbage collections
Returns a list of locales found in the "locales" property of the manifest DCNL This will convert locales found in the SHORTER_LANGUAGES setting to their DCNL full locale It will also remove locales not found in AMO_LANGUAGES DCNL Note: The default_locale is not included
{bodyid, ratingid} to translated ratinglabel
Dehydrate an object of content ratings from rating IDs to dict
Create a "mini" manifest for a packaged app or langpack and cache it (Call DCNL with `force=True` to bypass existing cache) DCNL Note that platform expects name/developer/locales to match the data from DCNL the real manifest in the package, so it needs to be read from the zip file DCNL Returns a tuple with the minifest contents and the corresponding etag
Cleans a model instance slug DCNL This strives to be as generic as possible as it\s used by Webapps DCNL and maybe less in the future :-D
Put all translations into a translations dict
The try/except AttributeError allows this to be used where the input is DCNL ambiguous, and could be either an already-reversed URL or a Version object
Set nomination date when app is pending review
Pre-generate an Android APK for a public app
Return IDs of Webapp objects excluded from a particular region or excluded DCNL due to Geodata flags
If the addon is premium, require a purchase DCNL Must be called after addon_view decorator
Check that the addon can become premium
Don\t evaluate qs or the locale will get stuck on whatever the server DCNL starts with The app_view() decorator will call qs with no arguments before DCNL doing anything, so lambdas are ok DCNL GOOD: Webappobjectsvalid DCNL GOOD: lambda: Webappobjectsvalid()filter() DCNL BAD: Webappobjectsvalid()
The try/except AttributeError allows this to be used where the input is DCNL ambiguous, and could be either an already-reversed URL or a Version object
Returns a user object This user is suitable for assigning to DCNL cron jobs or long running tasks
Create an user if he doesn\t exist already, assign him to a group and DCNL create a token for him DCNL if ``overwrite=True`` then existing OAuth credentials for this user will be DCNL deleted, if any DCNL If OAuth credentials are not specified, random key and secret will be DCNL generated
Query for a user matching a given email
Verify a BrowserID login attempt If the BrowserID assertion is DCNL good, but no account exists, create one
A pre-configured wrapper around the app validator
Resizes addon/websites icons
Resizes webapp/website promo imgs
Optimizes a PNG image by running it through Pngcrush Returns hash DCNL src -- filesystem image path DCNL hash_field -- field name to save the new hash on instance if passing DCNL instance through set_modified_on
Resizes preview images and stores the sizes on the preview
Saves the icon for `obj` to its final destination `obj` can be an app or a DCNL website
Saves the promo image for `obj` to its final destination DCNL `obj` can be an app or a website
Downloads a webapp icon from the location specified in the manifest DCNL Returns False if icon was not able to be retrieved DCNL If `file_pk` is not provided it will use the file from the app\s DCNL `current_version`
Return a validation object that looks like the add-on validator
Email app developers notifying them of new regions added
Update blocked regions based on a list of regions to exclude
Flag app for rereview if it receives an Adult content rating
Convert a resource URI to the primary key of the resource
Escalate the app if it uses prerelease permissions
Restore an incomplete app to its former status The app will be marked DCNL as its previous status or PENDING if it was never reviewed
Image should be shrunk so that the longest side is 32px
Image stays the same, since the new size is bigger than both sides
Image stays the same, since the new size is the same
Resize multiple images at once
Resize promo image
A function that mocks `storageopen` and throws an IOError if you try to DCNL open a 128x128px icon
Return a uuid for use in the payment flow In debugging it prefixes DCNL the value of the uuid so its easier to spot in logs and such
Use this decorator on Provider methods to ensure that the account DCNL being passed into the method belongs to that provider
Get a provider implementation instance by name or id
Wrapper for developer page titles
Wrapper function for ``breadcrumbs`` Prepends \Developers\ breadcrumb DCNL **items** DCNL list of [(url, label)] to be inserted after Add-on DCNL **addon** DCNL Adds the Add-on name to the end of the trail  If items are DCNL specified then the Add-on will be linked DCNL **add_default** DCNL Prepends trail back to home when True  Default is False
Requires user to be add-on owner or admin DCNL When allow_editors is True, an editor can view the page DCNL When `staff` is True, users in the Staff or Support Staff groups are DCNL allowed Users in the Developers group are allowed read-only
Set up the queryset and filtering for addon listing for Dashboard
Ratings can be created via IARC pinging our API DCNL Thus we can\t display a success message via the standard POST/req/res DCNL To workaround, we stored app\s rating\s `modified` from edit page DCNL When hitting back to the ratings summary page, calc what msg to show DCNL old_status -- app status during ratings edit page DCNL old_modified -- rating modified datetime during ratings edit page
Wrapper function for `_upload_manifest` so we can keep the DCNL standalone validator separate from the manifest upload stuff
Safe wrapper around JSON dict containing a validation result
Blocklists the app by creating a new version/file
Handle search filters and queries for transactions
Same as the rest framework reverse, except does not get the base URL
Custom exception handler for DRF, which doesn\t provide one for HTTP DCNL responses like tastypie does
Returns an include statement containing URL patterns for the passed API DCNL version Adds a namespace if that version does not match DCNL `settingsAPI_CURRENT_VERSION`, to ensure that reversed URLs always use the DCNL current version
A resource that is designed to be exposed externally and contains DCNL settings or waffle flags that might be relevant to the client app
"Two-legged" OAuth authorization isn\t standard and so not DCNL supported by current versions of oauthlib The implementation DCNL here is sufficient for simple developer tools and testing Real DCNL usage of OAuth will always require directing the user to the DCNL authorization page so that a resource-owner token can be DCNL generated
Get a hash identifying an user DCNL It\s a hash of session key, ip and user agent
Create a new record in the database with the given values DCNL :param key: DCNL The type of stats you\re sending, eg "appinstall" DCNL :param request: DCNL The request associated with this call It will be used to define who DCNL the user is DCNL :para: data: DCNL The data you want to store You can pass the data to this function as DCNL named arguments
Helper function for building Fireplace URLs `path` is the URL route, DCNL and `name` (if specified) is the name given to the route
Serves the frontend single-page apps
A page to mimic commonplace\s fxa-authorize page to handle login
If we are hitting the Fireplace detail page, get the app for Open Graph DCNL tags
Will remove all validation results  Used when the validator is DCNL upgraded and results may no longer be relevant
Get the actual file path of fileorpath if it\s a FileUpload object
Get a file-like object, whether given a FileUpload object or an DCNL UploadedFile
Extracts the zip file
Copies from the source to the destination, removing the destination DCNL if it exists and is a directory
pkg is a filepath or a djangocorefilesUploadedFile DCNL or filesmodelsFileUpload
Returns an MD5 hash for a filename
On delete of the file object from the database, unlink the file from DCNL the file system
Uses NFD to normalize unicode strings
This is to serve files off of stamo, not standard amo For this we DCNL use token based authentication
Adds a `feature_profile` on the request object if one is present and the DCNL dev parameter is either firefoxos or android DCNL Does nothing if one was already set
Updates the prices and price currency objects based on the tiers DCNL Tiers should be a list containing a dictionary of currency / value pairs DCNL The value of US is required so that we can look up the price tier If the DCNL price tier for US isn\t found, we skip whole tier If the currency isn\t DCNL found but the tier is, we create the currency DCNL This is intended to be called via a migration or other command
Returns a list of the default providers from the settings as the DCNL appropriate constants
Ensure that when PriceCurrencies are updated, all the apps that use them DCNL are re-indexed into ES so that the region information will be correct
When the contribution table is updated with the data from PayPal, DCNL update the addon purchase table Will figure out if we need to add to or DCNL delete from the AddonPurchase table
Sends an email to the purchaser of the app
Return JSON dict of {status: complete|incomplete} DCNL The status of the payment is only complete when it exists by uuid, DCNL was purchased by the logged in user, and has been marked paid by the DCNL JWT postback After that the UI is free to call app/purchase/record DCNL to generate a receipt
Verify signature and set contribution to paid
Verify signature from and create a refund contribution tied DCNL to the original transaction
Check that the webapp can become premium
Check if it can be purchased, returns False if not premium DCNL Must be called after the app_view decorator
If the addon is premium, require a purchase DCNL Must be called after app_view decorator
Handles empty and invalid values for sort and sort order DCNL \created\ by ascending is the default ordering
Handles empty and invalid values for sort and sort order DCNL \created\ by ascending is the default ordering
Generate table header sort links DCNL pretty_name -- name displayed on table header DCNL sort_field -- name of the sort_type GET parameter for the column DCNL get_params -- additional get_params to include in the sort_link DCNL sort -- the current sort type DCNL order -- the current sort order
Wrapper function for ``breadcrumbs`` Prepends \Editor Tools\ DCNL breadcrumbs DCNL **queue** DCNL Explicit queue type to set DCNL **items** DCNL list of [(url, label)] to be inserted after Add-on
Returns tuple of tab navigation for the queue pages DCNL Each tuple contains three elements: (url, tab_code, tab_text)
Returns tuple of tab navigation for the log pages DCNL Each tuple contains three elements: (named url, tab_code, tab_text)
Get table header sort links DCNL pretty_name -- name displayed on table header DCNL sort_field -- name of get parameter, referenced to in views
Returns the rolling average from the past 30 days of the time taken for a DCNL pending app to become public
Returns a datetime given an Elasticsearch date/datetime field
Requires the user to be logged in as a reviewer or admin, or allows DCNL someone with rule \ReviewerTools:View\ for GET requests DCNL Reviewer is someone who is in one of the groups with the following DCNL permissions: DCNL Apps:Review DCNL moderator=True extends this to users in groups who have the permssion: DCNL Apps:ModerateReview
Redirect to apps home page if app reviewer
Returns unreviewed apps progress DCNL Return the number of apps still unreviewed for a given period of time and DCNL the percentage
Queue for reviewing app reviews
Queue for reviewing abuse reports for apps
Queue for reviewing abuse reports for websites
Queue a translation that needs to be saved for a particular object To DCNL generate the key, call make_key
Removes all translations in the queue
Returns a key for this object
For a given key, save all the translations The key is used to ensure that DCNL we only save the translations for the given object (and not all of them) DCNL Once saved, they will be deleted
Return as many characters as possible without going over the limit DCNL Return the truncated text and the characters left before the limit, if any
Truncate the text of an html5lib tree
Find the length of the text content, excluding markup
Return a slice of ``html`` <= length chars DCNL killwords and end are currently ignored DCNL ONLY USE FOR KNOWN-SAFE HTML
For forms, compares initial data against cleaned_data for TransFields DCNL Returns True if data is the same Returns False if data is different DCNL Arguments: DCNL field -- name of the form field as-is DCNL initial -- data in the form of {\description_en-us\: \x\, DCNL \description_en-br\: \y\} DCNL data -- cleaned data in the form of {\description\: {\init\: \\, DCNL \en-us\: \x\, DCNL \en-br\: \y\}
Like django\s to_language, but en_us or en-us comes out as en-US
Pass in a language (u\en-US\) get back a Locale object courtesy of DCNL Babel  Use this to figure out currencies, bidi, names, etc
Activate the settings lang, or lang provided, while in context
Return a locale we support, or None
This will clean up newlines so that nl2br can properly be called on the DCNL cleaned text
Switch between Translation and Purified/Linkified Translations
Connect signals so the translation gets saved during objsave()
Use this signal on a model to iterate through all the translations added DCNL to the hold queue and save them all Hook this up to the pre_save signal DCNL on the model
Test HTML attributes for languages different than the site language
Test for nastiness-removal in the transfield\s locale
locale_html must still work if field is None
Truncating should not introduce xss issues
Put all translations into a translations dict
Order the QuerySet by the translated field, honoring the current and DCNL fallback locales  Returns a new QuerySet DCNL The model being sorted needs a get_fallback() classmethod that describes DCNL the fallback locale  get_fallback() can return a string or a Field
HTML attributes for languages different than the site language
Wrapper for jinja\s truncate that checks if the object has a DCNL __truncate__ attribute first DCNL Altering the jinja2 default of killwords=False because of DCNL https://bugzillamozillaorg/show_bugcgi?id=624642, which could occur DCNL elsewhere
Generates the locale menu for zamboni l10n
Get obj\s default locale
Blocked tags are not allowed DCNL Restricted tags can only be edited by Reviewers and Curators
Fetch tags from `objs` in one query and then attach them to a property on DCNL each instance DCNL Assumes every instance in `objs` uses the same model
Admin, or someone with AdminTools:View, required DCNL If reviewers=True        ReviewerAdminTools:View is allowed also
Takes a bunch of (addon, user) pairs and sets the denormalized fields for DCNL all reviews matching that pair
Does email for yesterday\s ratings (right after the day has passed) DCNL Sends an email containing all reviews for that day for certain app
Return whether or not the requestuser can delete reviews DCNL People who can delete reviews: DCNL * The original review author DCNL * Reviewers, but only if they aren\t listed as an author of the add-on DCNL * Users in a group with "Users:Edit" privileges DCNL * Users in a group with "Apps:ModerateReview" privileges
Returns the name of the current carrier (or None) for the DCNL request lifecycle DCNL Example: telefonica
Returns the carrier ID for the request lifecycle
Sets the name of the carrier for the current request lifecycle
Returns a region class definition given a slug, id, or class definition
Remove accents from input
Get the region for the current request lifecycle
Set the region for the current request lifecycle
Returns popularity value for the given obj to use in Elasticsearch DCNL If no region, uses global value DCNL If region and region is not mature, uses global value DCNL Otherwise uses regional popularity value
Returns trending value for the given obj to use in Elasticsearch DCNL If no region, uses global value DCNL If region and region is not mature, uses global value DCNL Otherwise uses regional popularity value
Returns the boost used in Elasticsearch for this app DCNL The boost is based on a few factors, the most important is number of DCNL installs We use log10 so the boost doesn\t completely overshadow any DCNL other boosting we do at query time
Returns a datetime given an Elasticsearch date/datetime field
Given a list of IDs and an indexer, index into ES DCNL If an reindexation is currently occurring, index on both the old and new
Return a dict of Monolith based statistics queries DCNL The dict is of the form:: DCNL {\<metric_name>\: [{\count\: <callable>, \dimensions\: <dimensions>}]} DCNL Where `dimensions` is an optional dict of dimensions we expect to filter on DCNL via Monolith DCNL If a date is specified and applies to the job it will be used  Otherwise DCNL the date will default to today()
Update monolith statistics
Migrate deprecated background color (hex) to color (name)
Generate random string
Downloads a website icon from the location passed to the task DCNL Returns False if icon was not able to be retrieved
Downloads a promo image from the location passed to the task DCNL Returns False if promo image was not able to be retrieved
Generate random string for websites
Regions that have ratings bodies
Regions without ratings bodies and fallback to the GENERIC rating body
Return a map of region slugs to ratings body labels for use in DCNL serializers and to send to Fireplace DCNL eg {\us\: \esrb\, \mx\: \esrb\, \es\: \pegi\, \br\: \classind\}
Get the region list and sort by name DCNL Requires a function due to localisation
Get the region choices and sort by name DCNL Requires a function due to localisation
Maps ActivityLog action ids to Commbadge note types
List of all ratings with waffled bodies
Create a list of tuples (choices) after we know the locale since this DCNL attempts to concatenate two lazy translations in constants file
Converts ratings body\s or rating\s iarc_name to a slug-like label DCNL (eg "USK" to "usk")
Returns a rating with translated fields attached and with fields that are DCNL easily created dynamically
Returns a rating body with translated fields attached
Prepends root icon path to path
Take an extension pk and extract 128x128 icon from its zip file, build DCNL resized PNG copies of it at the dimensions we use, optimize those and store DCNL them in our public storage DCNL When done, `icon_hash` property should be set on the extension
Reset the locale field for all translations on existing Extensions This DCNL is done to fix bug 1215094: some translations were created with the wrong DCNL language - the one from the request, instead of the one from the DCNL default_language field
Update extension status as well as fields for which the manifest is the DCNL source of truth when an ExtensionVersion is made public or was public and DCNL is deleted
Download the signed archive for a given public extension/version
Download an archive for a given extension/version, signed on-the-fly DCNL with reviewers certificate DCNL Only reviewers can access this
Download the unsigned archive for a given extension/version DCNL Only reviewers and developers can do this
Delete a tuple from a list of tuples based on its first item
Passed a string, returns a two-tuple indicating the language of that DCNL string, and the confidence on a 0-10 scale DCNL If the confidence is below 07, or below 09 in a string of 3 words or DCNL less, will return None
Passed a string, will return a dict mapping \language\: string, suitable to DCNL be assigned to the value of a TranslatedField If the language can not be DCNL determined with confidence, will assume English
Wraps the function with a decorator that bounces to the right step
Decorator that checks if the user has read the dev agreement, redirecting DCNL if not
Determine which step to redirect user to
This is a fake "Terms" view that we overlay the login DCNL We link here from the Developer Hub landing page
Generate the file names in a stored directory tree by walking the tree DCNL top-down DCNL For each directory in the tree rooted at the directory top (including top DCNL itself), it yields a 3-tuple (dirpath, dirnames, filenames) DCNL This is intended for use with an implementation of the Django storage API DCNL You can specify something other than the private storage instance with DCNL the storage keyword argument
Copy a path (src_path) from a storage (src_storage) to a path (dst_path) DCNL on a different storage (dst_storage) DCNL Defaults to copying from and to private storage
Move a path (src_path) from a storage (src_storage) to a path (dst_path) DCNL on a different storage (dst_storage), by copying and then deleting the DCNL source DCNL Defaults to moving from and to private storage
eg mktlog(mktLOGCREATE_ADDON, []), DCNL mktlog(mktLOGADD_FILE_TO_VERSION, file, version)
Sets modified on one object at a time
A wrapper around djangocoremailEmailMessage DCNL Adds blocked emails checking and error logging
Sends mail using a Jinja template with autoescaping turned off DCNL Jinja is especially useful for sending email since it has whitespace DCNL control
Sends HTML mail using a Jinja template with autoescaping turned off
Try to import ``helperspy`` from each app in INSTALLED_APPS
Date/Time converted to seconds since epoch
Given a sequence, we sort it and group it by a key DCNL key should be a string (used with attrgetter) or a function
Get a Paginator, abstracting some common paging actions DCNL If you pass ``count``, that value will be used instead of calling DCNL ``count()`` on the queryset  This can be good if the queryset would DCNL produce an expensive count query
Yield successive n-sized chunks from seq DCNL >>> for group in chunked(range(8), 3): DCNL      print group DCNL [0, 1, 2] DCNL [3, 4, 5] DCNL [6, 7]
A Unicode-safe URLencoder
Raise an error if the string has any punctuation characters DCNL Regexes don\t work here because they won\t check alnums in the right DCNL locale
Resizes and image from src, to dst Returns width and height
Returns a key with namespace value appended If increment is True, the DCNL namespace will be incremented effectively invalidating the cache DCNL Memcache doesn\t have namespaces, but we can simulate them by storing a DCNL "%(key)s_namespace" value Invalidating the namespace simply requires DCNL editing that key Your application will no longer request the old keys, DCNL and they will eventually fall off the end of the LRU and be reclaimed
Returns a string you can pass to pathpath safely
Simply wraps the cef_log function so we don\t need to pass in the config DCNL dictionary every time  See bug 707060  env can be either a request DCNL object or just the requestMETA dictionary
Escape html in JSON value, including nested items
Strip the BOM (byte order mark) from byte string `data` DCNL Returns a new byte string
Guess the encoding of a string and decode it
Remove a local temp directory DCNL This is just a wrapper around shutilrmtree() Use it to indicate you are DCNL certain that your executing code is operating on a local temp dir, not a DCNL directory managed by the Django Storage API
Returns index-YYYYMMDDHHMMSS with the current time
Returns a datetime DCNL If `created` is "now", it returns `datetimedatetimenow()` If `created` DCNL is set use that Otherwise generate a random datetime in the year 2011
Create an app DCNL complete -- fills out app details + creates content ratings DCNL rated -- creates content ratings
Returns either the icon URL for a given (`obj`, `size`) base_url_format` DCNL is a string that will be used for url formatting if we are not using a DCNL remote storage, see ADDON_ICON_URL for an example DCNL If no icon type if set on the `obj`, then the url for the DCNL appropriate default icon for the given `size` will be returned DCNL `obj` needs to implement `icon_type` and `icon_hash` properties for this DCNL function to work DCNL Note: does not check size, so it can return 404 URLs if you specify an DCNL invalid size
Returns either the promo img URL for a given (`obj`, `size`) DCNL base_url_format` is a string that will be used for url formatting, see DCNL WEBAPP_PROMO_IMG_URL for an example DCNL If no promo img type if set on the `obj`, then the url for the DCNL appropriate default icon for the given `size` will be returned DCNL `obj` needs to implement `promo_img_hash` properties for this function to DCNL work
Build up a formset-happy POST DCNL *args is a sequence of forms going into the formset DCNL prefix and initial_count can be set in **kw
Gather initial data from the form into a dict
Useful for comparing an `expected` list of links against PyQuery DCNL `elements` Expected format of links is a list of tuples, like so: DCNL (\Home\, \/\), DCNL (\Extensions\, reverse(\browseextensions\)), DCNL If you\d like to check if a particular item in the list is selected, DCNL pass as `selected` the title of the link DCNL Links are verified by default
Assert that the validation (JSON) does not contain a traceback DCNL Note that this does not test whether the addon passed DCNL validation or not
Returns a datetime DCNL If `created` is "now", it returns `datetimedatetimenow()` If `created` DCNL is set use that Otherwise generate a random datetime in the year 2011
Creates a request factory, logged in with the user
If not provided, email will be \factoryuser<number>@mozillacom\ DCNL If email has no \@\ it will be corrected to \email@mozillacom\
We load gettext catalogs in this order: DCNL django/locale/djangopo DCNL locale/djangopo DCNL If Django doesn\t have a locale, it returns the en-us catalog as a DCNL fallback  But then we take that catalog and merge in our messagespo DCNL That\s no good because we just mixed some other locale into en-us DCNL This test will be invalid once Django gets an mn locale
Given a specific set of primary keys, assure that we return addons DCNL in that order
We want None to show up as \\  We do this in JINJA_CONFIG
Turns a Python object into a response
Normal responses get passed through
json_viewerror returns 400 responses
Within this context, all queries go to the master
Given a query set and a list of primary keys, return a set of objects from DCNL the query set in that exact order
Store global Marketplace-wide info used in the header
Wrapper function for ``breadcrumbs`` DCNL **items** DCNL list of [(url, label)] to be inserted after Add-on DCNL **product** DCNL Adds the App/Add-on name to the end of the trail  If items are DCNL specified then the App/Add-on will be linked DCNL **add_default** DCNL Prepends trail back to home when True  Default is True
Gets the path to a localizable document in the current language with DCNL fallback to en-US
Takes a URL and prepends the SITE_URL
Helper for Django\s ``reverse`` in templates
Get a MEDIA_URL link with a cache buster querystring
Get a STATIC_URL link with a cache buster querystring
This overrides jingohelpersf to convert input to unicode if needed DCNL This is needed because of DCNL https://githubcom/jbalogh/jingo/pull/54#issuecomment-36728948
Strips control characters from a string
Date/Time format according to ISO 8601
Like Django\s login_required, but with to= instead of next= DCNL If redirect=False then we return 401 instead of redirecting to the DCNL login page  That\s nice for ajax views
Pairs of (app, action) If any permission passes, call the function DCNL Otherwise raise 403
Return a response as JSON If you are just wrapping a view, DCNL then use the json_view decorator
Will update the modified timestamp on the provided objects when the wrapped DCNL function exits sucessfully (returns a truthy value) If the function DCNL returns a dict, it will also use that dict as additional keyword arguments DCNL to update on the provided objects DCNL Looks up objects defined in the set_modified_on kwarg
Allow other sites to access this resource, see DCNL https://developermozillaorg/en/HTTP_access_control
Sets the user to be the task user, then unsets it
Serve mini manifest ("minifest") for Yulelog\s packaged `zip`
Serve mini manifest ("minifest") for Yogafire\s packaged `zip`
Generate a `robotstxt`
Accept CSP reports and log them
Turn the QUERY_STRING into a unicode- and ascii-safe string DCNL We need unicode so it can be combined with a reversed URL, but it has to be DCNL ascii to go in a Location header  iri_to_uri seems like a good compromise
Get transaction details from Solitude API
Shows the app activity age for single app
Shows the purchase page for another user
Shows the user activity page for another user
Get a list of dicts describing the payment portals for this app or user DCNL Either app or user is required
Update supported_locales for an individual app Set latest=True to use the DCNL latest current version instead of the most recent public version
Inherit nomination date for new packaged app versions
On delete of the version object call the file delete and signals
Parse emails and save notes
Creates a note on an obj version\s thread DCNL Creates a thread if a thread doesn\t already exist DCNL CC\s app\s Mozilla contacts to auto-join thread DCNL obj -- app or extension DCNL version -- obj version DCNL author -- UserProfile for the note\s author DCNL body -- string/text for note comment DCNL note_type -- integer for note_type (mkt constant), defaults to 0/NO_ACTION DCNL (eg commAPPROVAL, commREJECTION, commNO_ACTION) DCNL perms -- object of groups to grant permission to, will set flags on Thread DCNL (eg {\developer\: False, \staff\: True}) DCNL attachments -- formset of attachment files
Stuff to do after creating note, also used in comm api\s post_save
Create attachments from CommAttachmentFormSet onto note
Saves an attachment and returns the filename
Check ACLs
Cross-reference ACLs and Note/Thread permissions
It\s named `app` for historical reasons, but it `obj` can be either a DCNL Webapp or Extension DCNL Check if user has any app-level ACLs DCNL (Mozilla contact, admin, review, senior reviewer, developer)
Check if the user has read/write permissions on the given thread DCNL Developers of the add-on used in the thread, users in the CC list, DCNL and users who post to the thread are allowed to access the object DCNL Moreover, other object permissions are also checked against the ACLs DCNL of the user
Check if the user has read/write permissions on the given note DCNL Developers of the add-on used in the note, users in the CC list, DCNL and users who post to the thread are allowed to access the object DCNL Moreover, other object permissions are also checked against the ACLs DCNL of the user
Email utility used globally by the Communication Dashboard to send emails DCNL Given a note (its actions and permissions), recipients are determined and DCNL emails are sent to appropriate people
Determine email recipients mainly based on CommunicationThreadCC DCNL Returns user_id/user_email tuples
[(user_id, user_email)] -> [(user_email, token)]
Given a list of tuple of user_id/user_email, email bunch of people DCNL note -- commbadge note, the note type determines which email to use DCNL template -- override which template we use
Get context data for comm emails, specifically for review action emails
Returns the "mini" manifest for a langpack
Returns a users uuid suitable for use in the receipt, by looking up DCNL the purchase table Otherwise it just returns \none\ DCNL :params app: the app record DCNL :params user: the UserProfile record
Returns a signed receipt If the seperate signing server is present then DCNL it will use that Otherwise just uses JWT DCNL :params receipt: the receipt to be signed
Creates receipt data for use in payments DCNL :params app: the app record DCNL :params user: the UserProfile record DCNL :params uuid: a uuid placed in the user field for this purchase DCNL :params flavour: None, developer, inapp, or reviewer - the flavour DCNL of receipt DCNL :param: contrib: the Contribution object for the purchase
Creates a receipt for an in-app purchase DCNL :params contrib: the Contribution object for the purchase
Reissues and existing receipt by updating the timestamps and resigning DCNL the receipt This requires a well formatted receipt, but does not verify DCNL the receipt contents DCNL :params receipt: an existing receipt
Return a key for using with encode
Reissues an existing receipt, provided from the client Will only do DCNL so if the receipt is a full receipt and expired
This will match rules found in Group
Determines if the request user has permission to do a certain action DCNL \Admin:%\ is true if the user has any of: DCNL (\Admin:*\, \Admin:%s\%whatever, \*:*\,) as rules
Similar to action_allowed, but takes user instead of request
A convenience function  Check if requestuser has permissions DCNL for the object
Check requestuser\s permissions for the addon DCNL If user is an admin they can do anything DCNL If the app is disabled only admins have permission DCNL If they\re an app owner they can do anything DCNL dev=True checks that the user has an owner or developer role DCNL viewer=True checks that the user has an owner, developer, or viewer role DCNL support=True checks that the user has a support role
Developer Hub landing page
Landing page for support
Landing page for partners
Landing page for installation
Publish - Marketplace badges
Returns the "mini" manifest for packaged apps DCNL If not a packaged app, returns a 404
A hack way to find the local IP without using any Python libraries
This sets up everything needed before indexing: DCNL * Flags the database DCNL * Creates the new index
Perform post-indexing tasks: DCNL * Optimize (which also does a refresh and a flush by default) DCNL * Update settings to reset number of replicas DCNL * Point the alias to this new index DCNL * Unflag the database DCNL * Remove the old index DCNL * Output the current alias configuration
Index the objects DCNL - index: name of the index DCNL Note: `ignore_result=False` is required for the chord to work and trigger DCNL the callback
Chunk the items to index
Validate that the modules that have been set up correctly
Validate that if not in DEBUG mode, key settings have been changed
Return the relevant URL from settings Rather than rely on DCNL a complicated layer of settings to do their work, this just does DCNL it at runtime This allows MEDIA_URL and STATIC_URL to be DCNL changed in a local settings file, without having to override all the DCNL URLs DCNL If the URL starts with https:// or http://, then no changes are made
After settings, including DEBUG has loaded, see if we need to update CSP
You have to explicitly call this to configure logging
Records the given action by sending it to the metrics servers DCNL Currently this is storing the data internally in the monolith temporary DCNL table DCNL :param action: the action related to this request DCNL :param request: the request that triggered this call DCNL :param data: some optional additional data about this call
Try and resize a video and cope if it fails
An error occurred in processing the video, deal with that approp
Given a preview object and a file somewhere: encode into the full DCNL preview size and generate a thumbnail
Find a suitable lib
Return a true random ascii string containing byte_length of randomness DCNL The resulting key is suitable for cryptogrpahy DCNL The key will be hex encoded which means it will be twice as long DCNL as byte_length, ie 40 random bytes yields an 80 byte string DCNL byte_length must be at least 32
Send the receipt to the signing service DCNL This could possibly be made async via celery
Decode and verify that the receipt is sound from a crypto point of view DCNL Will raise errors if the receipt is not valid, returns receipt contents DCNL if it is valid
Crack open the receipt, without checking that the crypto is valid DCNL Returns a list of all the elements of a receipt, which by default is DCNL cert, receipt
This is a mock for using in tests, where we really don\t want to be DCNL actually signing the apps This just copies the file over and returns DCNL the path It doesn\t have much error checking
Sign a packaged app DCNL If `local` is True, we never copy the signed package to remote storage
Generate a manifest and signature and send signature to signing server to DCNL be signed
Returns the proper API endpoint depending whether we are signing for DCNL reviewer or for public consumption
Return True if any of the files have changed
Run ``command`` if any file in ``files`` changes
You have to call this to explicity configure logging
Cracks the receipt using the private key This will probably change DCNL to using the cert at some point, especially when we get the HSM
/en-US/dashboards/macros returns the active macros list
/en-US/dashboards/macros links to the English search results
/en-US/dashboards/macros links to complete search results
Manual search form can search all English pages
Manual search form can search all pages
Function for producing a config dict for the redirect test DCNL You can use simple bash style brace expansion in the `url` and `location` DCNL values If you need the `location` to change with the `url` changes you must DCNL use the same number of expansions or the `location` will be treated as non-expandable DCNL If you use brace expansion this function will return a list of dicts instead of a dict DCNL You must use the `flatten` function provided to prepare your test fixture if you do this DCNL If you combine brace expansion with a compiled regular expression pattern you must DCNL escape any backslashes as this is the escape character for brace expansion DCNL example: DCNL url_test(\/about/drivers{/,html}\, \https://wikimozillaorg/Firefox/Drivers\), DCNL url_test(\/projects/index{de,fr,hr,sq}html\, \/{de,fr,hr,sq}/firefox/products/\), DCNL url_test(\/firefox/notes/\, recompile(r\\/firefox\/[\d\]+\/releasenotes\/\), DCNL url_test(\/firefox/android/{,beta/}notes/\, recompile(r\\/firefox\/android\/[\d\]+{,beta}\/releasenotes\/\ DCNL :param url: The URL in question (absolute or relative) DCNL :param location: If a redirect, either the expected value or a compiled regular expression to match the "Location" header DCNL :param status_code: Expected status code from the request DCNL :param req_headers: Extra headers to send with the request DCNL :param req_kwargs: Extra arguments to pass to requestsget() DCNL :param resp_headers: Dict of headers expected in the response DCNL :param query: Dict of expected query params in `location` URL DCNL :param follow_redirects: Boolean indicating whether redirects should be followed DCNL :param final_status_code: Expected status code after following any redirects DCNL :return: dict or list of dicts
Define a test of a URL\s response DCNL :param url: The URL in question (absolute or relative) DCNL :param location: If a redirect, either the expected value or a compiled regular expression to match the "Location" header DCNL :param status_code: Expected status code from the request DCNL :param req_headers: Extra headers to send with the request DCNL :param req_kwargs: Extra arguments to pass to requestsget() DCNL :param resp_headers: Dict of headers expected in the response DCNL :param base_url: Base URL for the site to test DCNL :param query: Dict of expected query params in `location` URL DCNL :param follow_redirects: Boolean indicating whether redirects should be followed DCNL :param final_status_code: Expected status code after following any redirects
Take a list of dicts which may itself contain some lists of dicts, and DCNL return a generator that will return just the dicts in sequence DCNL Example: DCNL list(flatten([{\dude\: \jeff\}, [{\walter\: \walter\}, {\donny\: \dead\}]])) DCNL > [{\dude\: \jeff\}, {\walter\: \walter\}, {\donny\: \dead\}]
Returns whether the `user` is allowed to upload attachments DCNL This is determined by a negative permission, `disallow_add_attachment` DCNL When the user has this permission, upload is disallowed unless it\s DCNL a superuser or staff
Given a timezone naive or aware datetime return the HTTP date DCNL formatted string to be used in HTTP response headers
Generate a path to store a file attachment
Create a fake file for testing purposes
Serve up an attachment\s file
Redirect an old MindTouch file URL to a new kuma file URL
Create a new Attachment object and populate its initial DCNL revision or show a separate form view that allows to fix form submission DCNL errors DCNL Redirects back to the document\s editing URL on success
Queue deleting expired session items without breaking poor MySQL
Call `f` which has first argument `locale` If `f` raises an DCNL exception indicative of a bad localization of a string, try again in DCNL `settingsWIKI_DEFAULT_LANGUAGE` DCNL NB: This means `f` will be called up to two times!
Renders a template in the currently set locale DCNL Falls back to WIKI_DEFAULT_LANGUAGE in case of error
Return iterable of EmailMessages with user and watch values substituted DCNL A convenience function for generating emails by repeatedly DCNL rendering a Django template with the given ``context_vars`` plus a DCNL ``user`` and ``watches`` key for each pair in ``users_and_watches`` DCNL  Note:: DCNL This is a locale-aware re-write of the same function in django-tidings DCNL It\s kind of goofy--I ain\t gonna lie DCNL :arg subject: lazy gettext subject string DCNL :arg text_template: path to text template file DCNL :arg html_template: path to html template file DCNL :arg context_vars: a map which becomes the Context passed in to the DCNL template and the subject string DCNL :arg from_email: the from email address DCNL :arg default_local: the local to default to if not userlocale DCNL :arg extra_kwargs: additional kwargs to pass into EmailMessage constructor DCNL :returns: generator of EmailMessage objects
This function is for use on the base Field class
This function is for use on the CharField class
Get a Paginator, abstracting some common paging actions
Convert a string to int, with fallback for invalid strings or types
Generate a new filename for a file upload field; delete the previously DCNL uploaded file
Decorator that only allows one instance of the same command to run DCNL at a time
A tool like Django\s get_object_or_404 but returns None in case DCNL of a DoesNotExist exception
Parses tag input, with multiple word input being activated and DCNL delineated by commas and double quotes Quotes take precedence, so DCNL they may contain commas DCNL Returns a sorted list of unique tag names, unless sorted=False DCNL Ported from Jonathan Buchanan\s `django-tagging DCNL <http://django-tagginggooglecodecom/>`_
Return chunks of n length of iterable DCNL If ``len(iterable) % n != 0``, then the last chunk will have DCNL length less than n DCNL Example: DCNL >>> chunked([1, 2, 3, 4, 5], 2) DCNL [(1, 2), (3, 4), (5,)] DCNL :arg iterable: the iterable DCNL :arg n: the chunk length DCNL :returns: generator of chunks from the iterable
Extract a set of unique identifiers from the request DCNL This set will be made up of one of the following combinations, depending DCNL on what\s available: DCNL * user, None, None, unique_MD5_hash DCNL * None, ip, user_agent, unique_MD5_hash
Add a fragment and/or query parameters to a URL DCNL New query params will be appended to exising parameters, except duplicate DCNL names, which will be replaced
Returns date/time formatted using babel\s locale settings Uses the DCNL timezone from settingspy
Return locale from the request, falling back to a default if invalid
Return the Babel locale code, given a normal one
Render list of pages
Helper for Django\s ``reverse`` in templates
Turn HTML entities in a string into unicode
The current year
Add the utm_* tracking parameters to a URL
Returns date/time formatted using babel\s locale settings Uses the DCNL timezone from settingspy
Convert a datetime to the UTC timezone DCNL Assume that naive datetimes (without timezone info) are in system time
Avoid duplicating page param in pagination
Rough reimplementation of nosetoolseq_ DCNL Note: This should be removed as soon as we no longer use it
Rough reimplementation of nosetoolsok_ DCNL Note: This should be removed as soon as we no longer use it
Compares received\s attributes with expected\s kwargs
Return a django user or raise FixtureMissingError
Adds settings to the context
Given an Accept-Language header, return the best-matching language
Set the Prefixer for the current thread
Set the Prefixer for the current thread
Get the Prefixer for the current thread, or None
Wraps Django\s reverse to prepend the correct locale DCNL force_locale -- Ordinarily, if get_url_prefixer() returns None, we return DCNL an unlocalized URL, which will be localized via redirect when visited DCNL Set force_locale to True to force the insertion of a default locale DCNL when there is no set prefixer If you are writing a test and simply DCNL wish to avoid LocaleURLMiddleware\s initial 301 when passing in an DCNL unprefixed URL, it is probably easier to substitute LocalizingClient DCNL for any uses of djangotestclientClient and forgo this kwarg DCNL locale -- By default, reverse prepends the current locale (if set) or DCNL the default locale if force_locale == True To override this behavior DCNL and have it prepend a different locale, pass in the locale parameter DCNL with the desired locale When passing a locale, the force_locale is DCNL not used and is implicitly True
Given a ranked language list, return the best-matching locale
Split the requested path into (locale, path) DCNL locale will be empty if it isn\t found
Parse a list of tags out into a dict of lists by namespace
Decide whether a tag namespace is editable by a user
Given a new set of tags and a user, build a list of allowed new tags DCNL with changes accepted only for namespaces where editing is allowed for DCNL the user For disallowed namespaces, this object\s current tag set will DCNL be imposed DCNL No changes are made; the new tag list is just returned
Helper function that returns a decorator DCNL * redirect func ----- If truthy, a redirect will occur DCNL * deny_func --------- If truthy, HttpResponseForbidden is returned DCNL * redirect_url_func - Evaluated at view time, returns the redirect URL DCNL ie where to go if redirect_func is truthy DCNL * redirect_field ---- What field to set in the url, defaults to Django\s DCNL Set this to None to exclude it from the URL
Requires that the user *not* be logged in
Requires that the user is logged in
A replacement for djangocontribauthdecoratorspermission_required DCNL that doesn\t ask authenticated users to log in
Decorator for Celery task functions If we\re in MAINTENANCE_MODE, skip DCNL the call to the decorated function Otherwise, call the decorated function DCNL as usual
Decorator for view functions If we\re in MAINTENANCE_MODE, redirect DCNL to the maintenance-mode view on requests using the given HTTP "methods" DCNL (or all HTTP methods if "methods" is None) Otherwise, call the DCNL wrapped view function as usual
Render error pages with jinja2
Returns the string of a number formatted for the current language DCNL Uses django\s translationget_language() to find the current language from DCNL the request DCNL Falls back to the default language if babel does not support the current
Turn the QUERY_STRING into a unicode- and ascii-safe string DCNL We need unicode so it can be combined with a reversed URL, but it has to be DCNL ascii to go in a Location header  iri_to_uri seems like a good compromise
Return whether the given ``id`` is a valid Javascript identifier
Return whether the given ``value`` can be used as a JSON-P callback
Returns a link to ban a user
Returns a link to admin a user
Email address -> publicly displayable email
Turns all unicode into html entities, eg &#69; -> E
Turn a list of users into a list of links to their profiles
{{ provider_login_url("github", next="/some/url") }}
{{ providers_media_js() }}
{% set accounts = social_accounts(user) %} DCNL Then: DCNL {{ accountstwitter }} -- a list of connected Twitter accounts DCNL {{ accountstwitter0 }} -- the first Twitter account DCNL {% if accounts %} -- if there is at least one social account
Ban a user
A page to ban a user for the reason of "Spam" and mark the user\s revisions DCNL and page creations as spam, reverting as many of them as possible
A summary page of actions taken when banning a user and reverting revisions DCNL This method takes all the revisions from the last three days, DCNL sends back the list of revisions that were successfully reverted/deleted DCNL and submitted to Akismet, and also a list of DCNL revisions where no action was taken (revisions needing follow up)
Revert document to a specific revision
Delete a Document
The main user view that only collects a bunch of user DCNL specific data to populate the template context
View and edit user profile
Send a recovery email to a user
Login via an account recovery link DCNL Modeled on djangocontribauthviewspassword_reset_confirm, but resets DCNL the password to an unusable password instead of prompting for a new DCNL password
Simple task wrapper for the render() method of the Document model
Task to send email for render_document progress notification
Simple task to render a chunk of documents instead of one per each
A task to acquire the render document lock
A task to release the render document lock
Simple task wrapper for rendering stale documents
Force-refresh cached JSON data after rendering
Make an \edited\ notification email for first-time editors
For the given locale build the appropriate sitemap file and DCNL returns the locale, the file names written and timestamp of the DCNL build
A chord callback task that writes a sitemap index file for the DCNL given results of :func:`~kumawikitasksbuild_locale_sitemap` task
Build and save sitemap files for every MDN language and as a DCNL callback save the sitemap index file as well
Index a list of documents into the provided index DCNL :arg ids: Iterable of `Document` pks to index DCNL :arg index_pk: The `Index` pk of the index to index into DCNL :arg reraise: False if you want errors to be swallowed and True DCNL if you want errors to be thrown DCNL  Note:: DCNL This indexes all the documents in the chunk in one single bulk DCNL indexing call Keep that in mind when you break your indexing DCNL task into chunks
Delete a list of documents from the provided index DCNL :arg ids: Iterable of `Document` pks to remove DCNL :arg index_pk: The `Index` pk of the index to remove items from
Run tidy over the given revision\s content and save it to the DCNL tidy_content field if the content is not equal to the current value DCNL :arg pk: Primary key of `Revision` whose content needs tidying
Delete old DocumentSpamAttemptdata, which contains PII DCNL Also set review to REVIEW_UNAVAILABLE
Return a dict that fills in the blanks in notification templates
Get extra headers for filtering notification emails
Create a notification email for first-time editors
Create a notification email for a spam attempt DCNL Because the spam may be on document creation, the document might be null
Gets sections in a document
Quick and dirty filter to remove <div class="noinclude"> blocks
Given a proposed doc path, try to see if there\s a legacy MindTouch DCNL locale or even a modern Kuma domain in the path If so, signal for a DCNL redirect to a more canonical path In any case, produce a locale and DCNL slug derived from the given path
Return (locale, path, slug) if URL is a Document, False otherwise DCNL If URL doesn\t even point to the document view, raise _NotDocumentView
Given a sequence of document revision IDs, returns a dict matching DCNL those with the number of users Google Analytics thinks has visited DCNL each revision since start_date
Given a sequence of Revision objects, returns a dict matching DCNL their pks with the number of users Google Analytics thinks has visited DCNL each revision since they were created
Format comment for HTML display, with Bugzilla links and slug changes DCNL Keyword Arguments: DCNL rev - The revision DCNL previous_revision - The previous revision (default None) DCNL load_previous - Try loading previous revision if None (default True)
Given the two revisions generate a diff between their tidied DCNL content in the unified diff format
Creates an HTML diff of the passed in content_from and content_to
Provided a selector, returns the relevant content from the document
Recursively escapes strings in an object DCNL Traverses dict, list and tuples These are the data structures supported DCNL by the JSON encoder
Returns the JSON representation of the value
Joins a base ``Site`` URL with a URL path DCNL If no site provided it gets the current site from Site
Create a URL pointing to Kuma DCNL Look for a wiki page in the current locale, or default to given path
* The service isn\t disabled with a timeout of 0 DCNL * The document isn\t empty DCNL * The request has *not* asked for raw source DCNL (eg ?raw) DCNL * The request has *not* asked for no macro evaluation DCNL (eg ?nomacros) DCNL * The request *has* asked for macro evaluation DCNL (eg ?raw&macros)
Perform a kumascript GET request for a document locale and slug
Encode env_vars as kumascript headers, as base64 JSON-encoded values
Attempt to decode any FireLogger-style error messages in the response DCNL from kumascript
Build the cache keys used for Kumascript
Get active macros and their source paths DCNL Return is a dict with the case-sensitive macro name as key, and the subpath DCNL on GitHub as the value  The full URL of the GitHub source is: DCNL https://githubcom/mdn/kumascript/tree/master/macros/{subpath}
Get the macros known to ElasticSearch with their page counts DCNL Return is a dictionary of lowercase macro names to their page counts DCNL This includes things that look like macros, such as Django templates from DCNL the Django learning area, and anything wrapped in {{ }} DCNL Keyword Arguments: DCNL locale - Filter by this locale (default no locale filter)
Get active macros, their source paths, and usage on site DCNL Return is a dict with the case-sensitive macro name as key, and a dict as DCNL value with keys: DCNL * github_subpath - the subpath on GitHub DCNL * count - the number of pages the macro is used on DCNL * en_count - the number of English pages the macro is used on DCNL If there is no ElasticSearch server or it is misconfigured, then the DCNL counts will both be 0
A test user
A second test user
A third test user
An inactive test user
A banned test user
A newly-created top-level English document
A revision that created an English document
A revision that edits an English document
Translate the root document into French
A further edit to the translated document
A top-level English document with mixed contributors (some are valid, DCNL some are banned, and some are inactive)
Mock ElasticSearch client DCNL User should override clientsearchreturn_value DCNL Based on test fixture from elasticsearch_dsl
When KumaScript returns macros, the sources are populated
When KumaScript can\t return macros, the sources are empty
When KumaScript raises an error, the sources are empty
macro_page_count returns macro usage across all locales by default
macro_page_count(\en-US\) returns macro usage in the en-US locale
When KumaScript returns an empty response, macro usage is empty
When ElasticSearch is unreachable, counts are 0
When follow-on ElasticSearch call raises, reraise exception
Comparing two valid revisions of the same document works
A localized revision can be compared to an English source revision
Confirm that the based_on value set in the revision created by an edit DCNL or translate form is the current_revision of the document as of when the DCNL form was first loaded, even if other revisions have been approved in the DCNL meantime
Check document page for zone-style-related features
Check the three rows of the test translation DCNL Row 1: The latest edit of the translation DCNL Row 2: The first translation into French DCNL Row 3: The English revision that the first translation was based on
$history of English doc works
$history for translated documents includes an English revision DCNL This is the revision the first translation was based on
$history for trans docs excludes the English revision if no based_on DCNL This can happen for old translated docs, or ones manually associated with DCNL the parent
$history of unknown page returns 404
$history of half-created document returns 404
Anonymous users are forbidden to request all revisions
Users are allowed to request all revisions
$history will paginate the revisions
$history?limit=(more than revisions) works, removes pagination
$history?limit=nonsense uses the default pagination
Return an empty document with enough stuff filled out that it can be DCNL saved
Return an empty revision with enough stuff filled out that it can be DCNL saved DCNL Revision\s is_approved=False unless you specify otherwise DCNL Requires a users fixture if no creator is provided
Return a revision that is the translation of a default-language one
Normalize HTML5 input, discarding parts not significant for DCNL equivalence in tests
Get or create a group that can edit documents
Get or create a user empowered with document editing
Test wiki_url, without client languages
Assert that the objects contained by `manager` are those in `list_`
Test the nearest zone property of English and non-English documents
Silly end-case test of the nearest-zone property of a non-English document DCNL without a parent
Test is_zone_root
Ensure CSS styles for a zone can be fetched
Ensure that the expiry is not constant
Test the nearest zone job
Make sure we handle the case where we try to get the nearest DCNL zone for a document whose parent-topic has been deleted
Tests basic operation, ordering, caching, and handling of banned and DCNL inactive contributors
If not under a content experiment, use the original Document
If under a content experiment, return original Document and params
If the original is selected as the content experiment, return it
If the variant is selected as the content experiment, return it
If the variant is selected as the content experiment, return it
If the Document for a variant doesn\t exist, return the original
Kumascript reports errors in HTTP headers Kuma should display the errors DCNL with appropriate links for both the "wikipreview" and "wikidocument" DCNL endpoints
Comparing two valid revisions of the same document works
A localized revision can be compared to an English source revision
Comparing revisions without tidied content displays a wait message
Comparing badly-formed revision parameters return 404, not error
If a compare query parameter is missing, a 404 is returned
If the revision is for the wrong document, a 404 is returned
A mock Document that should update
The mock_doc should update search index
Excluded slugs should not update the search index
Do not update the search index if some flags are set
Test the notification context for a created English page
Test the notification context for an edited English page
Test the notification context for a created English page
Test that EditDocumentEvent also notifies for the tree
Test event email parameters for creation of an English page
Test event email parameters for changing an English page
A first edit email is formatted for a new English page
A first edit email is formatted for an English change
A first edit email is formatted for a first translation
A spam attempt email is formatted for a new English page
A spam attempt email is formatted for an English change
A spam attempt email is formatted for a new translation
A spam attempt email is formatted with partial information
The filter drops iframe src that does not match the pattern
Any contents inside an <iframe> should be removed
Populate Documentuuid, without bumping last modified
For historic DocumentSpamAttempt, set to REVIEW_UNAVAILABLE
Select a locale to translate the document to
Utility function to do basic slug splitting
Return a dict with the document data pertinent for the form
Create an HTML fragment preview of the posted wiki syntax
Quickly mark a revision as no longer needing a particular type DCNL of review
Delete a Document
Permanently purge a deleted Document
Extract a code sample from a document and render it as a standalone DCNL HTML document
A view redirecting to the real file serving view of the attachments app DCNL This exists so the writers can use relative paths to files in the DCNL code samples instead of hard coding he file serving URLs DCNL For example on a code sample with the URL: DCNL https://mdnmozillademosorg/fr/docs/Web/CSS/Tools/Outil_Selecteur_Couleurs_CSS$samples/ColorPIcker_Tool DCNL This would allow having files referred to in the CSS as:: DCNL url("files/6067/canvas-controlspng")
For URLs in special namespaces (like Talk:, User:, etc), redirect DCNL if possible to the appropriate new URL in the appropriate DCNL locale If the locale cannot be correctly determined, fall back to DCNL en-US
Given a request to a Mindtouch-generated URL, generate a redirect DCNL to the correct corresponding kuma URL
Return ckeditor config from database
Returns the closest title matches for front-end autosuggests
List wiki documents depending on the optionally given tag
Returns listing of all tags
Lists wiki documents with revisions flagged for review
Lists wiki documents with localization tag
Lists wiki documents with (KumaScript) errors
Lists wiki documents without parent (no English source document)
Lists documents directly under /docs/
List all the revisions of a given document
Create a new wiki page, which is a document and a revision
Handle when a mid-air collision is detected upon submission
Create a new revision of a wiki document, or edit document metadata
Get HTML and rendering errors for a Document DCNL Return is a tuple: DCNL * The HTML DCNL * A list of KumaScript errors encountered during rendering DCNL * True if rendered content was requested but not available DCNL If rendering_params[\use_rendered\] is True, then KumaScript rendering is DCNL attempted If False, pre-rendered content is returned, if any
Get parent-title information for SEO purposes
Apply needed filtering/annotating operations to a Document\s HTML
Perform some response-header manipulation that gets used in DCNL several places
If we\re falling back to a Document in the default locale, figure DCNL out why and whether we can redirect to a translation in the DCNL requested locale
Attempt to fetch a Document at the given locale and slug, and DCNL return it, or return a fallback reason if we weren\t able to
Get Document and rendering parameters changed by the content experiment DCNL If the page is under a content experiment and the selected variant is DCNL valid, the return is (the variant Document, the experiment params) DCNL If the page is under a content experiment but the variant is invalid or DCNL not selected, the return is (original Document, the experiment params) DCNL If the page is not under a content experiment, the return is DCNL (original Document, None)
Retrieves a document and returns its children in a JSON structure
Move a tree of pages
Return a document\s table of contents as HTML
Return some basic document info in a JSON blob
This is deprecated, and only exists temporarily to serve old DCNL document pages that request zone CSS via this endpoint
Toggle watching a document for edits
Toggle watching a tree of documents for edits
When a Document doesn\t exist but the user can create it, return DCNL the creation URL to redirect to
When a Document has been deleted return a 404 DCNL If the user can restore documents, then return a 404 but also include the DCNL template with the form to restore the document
Display a raw Document
View a wiki document
Handle PUT requests as document write API
Creates SPAM Akismet record for revision DCNL Return json object with Akismet Record data DCNL TODO: Create Submitting as HAM record for revision
Decorator for generated content methods DCNL If the backing model field is null, or kwarg force_fresh is True, call the DCNL decorated method to generate and return the content DCNL Otherwise, just return the value in the backing model field
Return a descriptor delegating to an attr of the original document DCNL If `self` is a translation, the descriptor delegates to the attribute DCNL `parent_attr` from the original document Otherwise, it delegates to the DCNL attribute `direct_attr` from `self` DCNL Use this only on a reference to another object, like a ManyToMany or a DCNL ForeignKey Using it on a normal field won\t work well, as it\ll preclude DCNL the use of that field in QuerySet field lookups Also, ModelForms that are DCNL passed instance=this_obj won\t see the inherited value
Sadly copied from taggit to work around the issue of not being DCNL able to use the TaggedItemBase class that has tag field already DCNL defined
Interstitial admin view for purging multiple Documents
HTML link to related revisions for admin change list
HTML link to the current revision for the admin change list
HTML link to the topical parent document for admin change list
HTML link to the parent document for admin change list
HTML link to a list of child documents
HTML link to a list of sibling documents
Public link to the document
Combine several field functions into one block of lines
Combine the document hierarchy nav links
Combine the revision nav links
Combine the rendering times into one block
Format Akismet data as a definition list
Decorator to prevent a page from being indexable by robots
Decorator to allow CORS for GET requests
Decorator to enable readonly mode
Decorator to process document_path into locale and slug, with DCNL auto-redirect if necessary DCNL This function takes generic args and kwargs so it can presume as little DCNL as possible on the view method signature
Reset the nearest-zone cache for this document and its descendants
Reset the URL remap list cache for the given document, assuming it DCNL even has a zone
Landing page news feed
Home page
Bug 646192: MDN affiliate buttons
Serve robotstxt that allows or forbids robots DCNL TODO: After AWS move, try different strategy (WhiteNoise, template)
Return a url matcher suited for urlpatterns DCNL Changes the defaults for locale_prefix and prepend_locale in the DCNL redirect_urls library
Return a locale url matcher suited for urlpatterns DCNL This is suited for matching URLs that may start with a locale, like: DCNL /en-US/docs/Foo/Bar DCNL If the locale is a valid locale, the pattern matches against the remaining DCNL path: DCNL locale=/en-US, path=/docs/Foo/Bar DCNL However, many prefix strings match, so watch out for unintended matches: DCNL /docs/Foo/Bar DCNL can be matched as: DCNL locale=/docs, path=Foo/Bar
Return an iterator providing the dates between `start` and `end`, inclusive
Gather spam statistics for a range of dates DCNL Keywords Arguments: DCNL periods - a sequence of (days, identifier, name) tuples DCNL end_date - The ending anchor date for the statistics
Gather data for recent spam events
The normal macro page is a three-column table
The macro page is a one-column table when counts are unavailable
Dashboard for reviewing revisions
Returns partial username matches
Returns partial topic matches
Dashboard for spam moderators
Returns table of active macros and their page counts
Load LOCALES data from languagesjson DCNL languagesjson is from the product-details project: DCNL https://product-detailsmozillaorg/10/languagesjson
Define a CSS file generated from multiple SCSS files
Define a CSS file that shares the name with the one input SCSS
Prepare a new index for indexing documents into DCNL :arg index_pk: The `Index` ID to create an elasticsearch index of DCNL This also updates the settings to make indexing faster, like disabling DCNL refreshes and replicas
Finalizes the elasticsearch index DCNL :arg index_pk: The `Index` ID to operate on DCNL This performs the following actions:: DCNL * Optimize (which also does a refresh and a flush by default) DCNL * Update settings to reset number of replicas and refresh interval DCNL * Sends an email that the indexing is complete
Returns search url from referer if it was an MDN search
Returns the values of all filter groups, intended to pull key/value pairs DCNL from requests DCNL Eg if \topic\ is a `FilterGroup` slug and given the URL:: DCNL ?q=test&topic=css&topic=html DCNL this will return `[\css\, \html\]` DCNL If the given URL contains \none\, then no filters should be applied
Decorator that logs an error on connection issues DCNL 9 out of 10 doctors say that connection errors are usually because DCNL ES_URLS is set wrong This catches those errors and helps you out DCNL with fixing it
Register a model and index for auto indexing
Return empty array until we restore internal search system
Render an OpenSearch Plugin
A successful response from this endpoint simply proves DCNL that Django is up and running It doesn\t mean that its DCNL supporting services (like MySQL, memcached, Celery) can DCNL be successfully used from within this service
A successful response from this endpoint goes a step further DCNL and means not only that Django is up and running, but also that DCNL the database can be successfully used from within this service DCNL The other supporting services are not checked, but we may find DCNL that we want/need to add them later
Generated secret should be saved as a hash and pass a check
Generate a random API key DCNL see: http://jetfarcom/simple-api-key-generation-in-python/
Enable a view to accept an auth key via HTTP Basic Auth DCNL Key ID expected as username, secret as password DCNL On successful auth, the request will be set with the authkey and the user DCNL owning the key
A simple User record with only the basic information
A Document record with no revisions and no parent topic
A Document record with two revisions and without a parent topic
A translation of the root document
If the Document already exists, short-circuit downloads
Resources are fetched if force=True
A child document requires the parent document
If the parent document is available, it is not requested
If the rendered document is standard, get next resources
If metadata doesn\t match URL, use locale and slug from URL
If the metadata has an error, so does the document
A zone URL requests the zone doc
If the zoned document fails (isn\t a zone), then the doc errors too
The zoned doc is used to normalize the URL
If a document is a redirect, request the target page
If a document is a redirect to a normal page, create a redirect
If a document is a redirect to a zone, request the zone root
If a document is a redirect to an errored zone, doc is also errored
A zoned document has more data passed to storagesave_document()
If a document is a redirect to zone subpage, request the zone root
A zoned subpage has more data passed to storagesave_document()
A localized document will wait for metadata
A localized document will request the English document
An invalid English document path is an error
A localized document will set the English document as parent
A depth > 0 will require the $children resource
If the $children resource is loaded, use it
A root document with one tagged revision
A bad revision path is detected at initialization
On the first call, multiple items are requested from storage
If prereqs are present then source is done
If only the doc is present, then full gather is performed
If stored doc does not agree with stored revision doc, then error
On the first call, multiple items are requested from storage
A revision will request a document on the second pass
If the document slug is different from the revision, doc wins DCNL This appears to be common around page moves
Older revisions can be imported without some tags
If the revision HTML can\t be fetched, the source is errored
If a based_on revision is specified, it is required
If a based_on revision is specified and available, it is used
A session is created once on request
A successful request calls raise_for_status by default
The call to raise_for_status can be omitted
Requests are retried with back off after a Timeout
Requests are retried after expected exceptions
Request fail after too many Timeouts
Setup a test Scraper that handles FakeSource sources
The add_source method initializes a source
Adding a existing source returns True if options were updated
The scraper will loop through sources until complete
The scraper will complete if a source is errored
A scraper with no sources returns early
The scraper will warn if there is a percent in a source DCNL This indicates a JSON-encoded URL was not decoded
The scraper will warn if a dependency block is detected DCNL If no progress is made in a loop, it implies that a dependency is in DCNL error, and further loops will not make any further progress
Local storage objects are None when unset, return the saved value
New tags are created
Existing tags are reused
Existing tags with different capitalization are reused
Tags are created and attached to the new document
Duplicate tags are de-duped on document save DCNL This may not be needed now that bug 1293749 is fixed
An existing document gets new scraped tags
An existing document that has been moved is moved locally
An existing document can have a different ID than remote doc
Can save ca/docs/Project:Quant_a, despite IntegrityError
A document with a vanity URL creates the associated DocumentZone
A document with a plain zone creates the associated DocumentZone
A zone child document does not create a DocumentZone
Creating the current revision updates the associated document
Creating an older revision does not update the associated document
A current revision with duplicate tags does not create dupes on the doc DCNL Historical revisions will have these duplicate tags, even though DCNL bug 1293749 is fixed, because they are stored as strings
Existing tags are reused when saving a current revision
A revision may have no content but include review tags
A banned user creates a self-banning UserBan instance
A complex User record with social and other profile data
Create mock production data requester for Sourcegather testing DCNL Keyword Arguments: DCNL requester_spec - Requester attributes (default request) DCNL response_spec - Response attributes (default content, history) DCNL content - Content of response (default "") DCNL json - Decoded JSON of response (default not JSON) DCNL status_code - Status code of response (default 200, None to error on check) DCNL history - (status_code, path) pairs for redirect history of request DCNL (default no redirects) DCNL final_path - Final path for request (default None)
Create mock database storage for Sourcegather testing DCNL Keyword Arguments: DCNL spec - List of expected Storage method calls (default []) DCNL Any spec that starts with "get_" is initialized to return None
Omitted Source parameters are initialized to defaults
Source parameters are initialized by name
An invalid parameter name raises an exception
An empty merge does not change the Source state
A merge to smaller parameters keeps the current values and state
A merge with the current values keeps the current state
An updating merge updates the values and resets the state
Multiple parameters can be updated in one merge call
For the \int_all\ parameter type, \all\ is a valid and maximum value
For the \text\ parameter type, any non-empty change is an update
current_options returns empty dict for default options
current_options returns the non-default options as a dict
Invalid parameter values raise a ValueError
Sourcedecode_href() turns URL-encoded hrefs into unicode strings
The SourceError exception can be turned into a string
A source that is done can still be gathered
A source that is already in storage loads quickly
A source can raise an error when loading from storage
A source can request other sources as prerequisites
A source may raise an error when loading prerequisites
A source can fail when saving the data
A source with all prereqs can request further sources
Detect URL-encoded paths and fail at init
Detect invalid paths and fail at init
Zone root data can be gathered from metadata on the first pass
Previously stored zone root data prevents scraping
Passing a non-zone URL is detected when processing metadata
If the metadata locale doesn\t match the URL, it is an error DCNL This appears to be common on zoned URLs with only one translation, DCNL and requires reseting the stored JSON data
All metadata prereqs can be satisfied in the first call
All metadata prereqs can be satisfied in the first call
If the metadata 404s, the source is in error
If translations are requested, they are extracted from metadata
Child resources also get the translations request
Child resources also get the revisions request
A Document record with a DocumentZone with style and a redirect
A Document record that is below the zone root
Test a page without redirects
Test a page with non-zone redirects DCNL For example, a page might redirect from http:// to https:// without DCNL changing the path
The zone_css_slug is extracted from zone roots
The zone_css_slug is not extracted from zone children
A missing document results in an error DCNL One cause: translations are requested, and a recently deleted DCNL translation is in the metadata
A empty specification is OK, does nothing
A fixture without dependencies is loaded
A fixture with existing to-many dependencies is loaded
A fixture must define all the natural key items
A fixture with a relation as a key can be loaded
Many-to-many relations of existing instances are updated
An unspecified relation is detected, raises exception
An unspecified relation is detected, raises exception
A userpassword is hashed
If documentcurrent_revision is set, we\re done
If the document history is unavailable, wait
If a revision was requested but not scraped, wait
If a revision was included in history but not scraped, request it
If we\ve scraped all the known revisions, request more history
If a doc has no current rev, scrape all history and fail
A DocumentBaseSource with a top-level slug has no parent
A DocumentBaseSource with a child-level slug has a parent
A DocumentBaseSource with a zone slug starts un-normalized
Initializing with a URL-encoded path raises an exception
If a document has no subpages, none are extracted
Document Subpages are returned as new resources to fetch
depth=all is propagated to child pages
depth=n is propagated as depth=n-1 to child pages
depth=1 is not propagated to child pages
The default is requests if revision count is unspecified
If a revision count is specified, that many are requested
If a revision count is more than the revisions, take note
If the $history endpoint errors, scraping stops
If previously called, populate history from storage
A translated document may include the English source doc
Do typical mdn update
Helper to print all system commands in debug mode
Returns integer board ids available on this machine
lock file from integer id
Username that has locked the device id (Empty string if no lock)
Attempts to lock id, returning success as True/False
Start a process that will free a lock when process pid terminates
Finds a free id, locks it and returns integer id, or -1 if none free DCNL A process is spawned that will free the lock automatically when the DCNL process pid (by default the current python process) terminates
Finds a free id, locks it and returns integer id, or -1 if none free DCNL * Lock must be freed manually *
Attempts to free lock id, returning success as True/False
This is a decorator which can be used to mark functions DCNL as deprecated It will result in a warning being emmitted DCNL when the function is used
Return a CUDAMatException object based on the error code err_code
Creates and returns a new CUDAMatrix with the given shape
Sum the matrix along the given dimension, where 0 represents the leading DCNL dimension and 1 represents the non-leading dimension If a target is DCNL not prvided, a new vector is created for storing the result
Find the dot product between m1 and m2
Compute the vector dot product of matrices m1 and m2
Apply cos to each element of the matrix mat
Apply cos to each element of the matrix mat
Apply sin to each element of the matrix mat
Apply the logistic sigmoid to each element of the matrix mat
Apply the tanh to each element of the matrix mat
Apply abs to each element of the matrix mat
Apply log(1+exp(x)) to each element of the matrix mat If exact is True, use DCNL slow and accurate log and exp
Find the natural logarithm of each element of the matrix mat
Apply the exponential function to each element of the matrix mat
Apply the ceil function to each element of the matrix mat
Apply the floor function to each element of the matrix mat
Compute the square root of each element of the matrix mat
Compute -mat*log(p) - (1-mat)*log(1-p)
Compute -mat*log(p)
Compute mat*(p >= 05) + (1-mat)*(p < 05)
If p is a scalar, compute the \p\th power of each element of the matrix mat, DCNL otherwise raise each element of the matrix mat to the power given by the DCNL corresponding element of the matrix p
Returns array as a float32 array in FORTRAN order
Selects the CUDA device with the given ID
Initialize Cublas
Shut down Cublas
Returns integer board ids available on this machine
lock file from integer id
Username that has locked the device id (Empty string if no lock)
Attempts to lock id, returning success as True/False
Start a process that will free a lock when process pid terminates
